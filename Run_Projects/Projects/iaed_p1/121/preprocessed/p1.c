/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


typedef struct 
{
  int id;
  char desc[63];
  int preco;
  int peso;
  int qtd;
} Produto;
typedef struct 
{
  int n_produtos;
  int peso;
  Produto prods[10000];
} Encomenda;
Produto lista_produtos[10000];
Encomenda encomenda[500];
Produto aux[10000];
int id_p = 0;
int id_e = 0;
void printProduto();
void printEncomenda(int ide);
int existeProduto(int idp);
int estaEncomenda(int idp, int ide);
void adicionaProduto();
void adicionaStock();
void criaEncomenda();
void adicionaProduto_E();
void removeProduto_E();
void removeStock();
void custoEncomenda();
void alteraPreco();
void listaDescQtd();
void ocorreMais_E();
void listaProdutos();
void listaProdutos_E();
int main()
{
  char letra = '\0';
  while (letra != 'x')
  {
    letra = getchar();
    switch (letra)
    {
      case 'a':
        adicionaProduto();
        break;

      case 'q':
        adicionaStock();
        break;

      case 'N':
        criaEncomenda();
        break;

      case 'A':
        adicionaProduto_E();
        break;

      case 'r':
        removeStock();
        break;

      case 'C':
        custoEncomenda();
        break;

      case 'R':
        removeProduto_E();
        break;

      case 'p':
        alteraPreco();
        break;

      case 'E':
        listaDescQtd();
        break;

      case 'm':
        ocorreMais_E();
        break;

      case 'l':
        listaProdutos();
        break;

      case 'L':
        listaProdutos_E();
        break;

      default:
        break;

    }

  }

  return 0;
}

void printProduto()
{
  int i;
  printf("Produtos\n");
  for (i = 0; i < id_p; i++)
  {
    printf("* %s %d %d\n", lista_produtos[i].desc, lista_produtos[i].preco, lista_produtos[i].qtd);
  }

}

void printEncomenda(int ide)
{
  int i;
  printf("Encomenda %d\n", ide);
  for (i = 0; i < encomenda[ide].n_produtos; i++)
  {
    printf("* %s %d %d\n", encomenda[ide].prods[i].desc, encomenda[ide].prods[i].preco, encomenda[ide].prods[i].qtd);
  }

}

int existeProduto(int idp)
{
  int i;
  int pos = -7;
  if (idp < id_p)
  {
    for (i = 0; i < id_p; i++)
    {
      if (lista_produtos[i].id == idp)
      {
        pos = i;
        break;
      }
      else
      {
        
      }

    }

  }
  else
  {
    
  }

  return pos;
}

int estaEncomenda(int idp, int ide)
{
  int i;
  int pos = -7;
  if (idp < id_p)
  {
    for (i = 0; i < encomenda[ide].n_produtos; i++)
    {
      if (encomenda[ide].prods[i].id == idp)
      {
        pos = i;
        break;
      }
      else
      {
        
      }

    }

  }
  else
  {
    
  }

  return pos;
}

void adicionaProduto()
{
  for (int lista_produtos_index = 0; lista_produtos_index < 10; lista_produtos_index++)
  {
    lista_produtos[id_p].desc[lista_produtos_index] = new_sym_var(sizeof(char) * 8);
  }

  lista_produtos[id_p].desc[10 - 1] = '\0';
  lista_produtos[id_p].preco = new_sym_var(sizeof(int) * 8);
  lista_produtos[id_p].peso = new_sym_var(sizeof(int) * 8);
  lista_produtos[id_p].qtd = new_sym_var(sizeof(int) * 8);
  lista_produtos[id_p].id = id_p;
  printf("Novo produto %d.\n", id_p);
  id_p++;
}

void adicionaStock()
{
  int idp;
  int new_qtd;
  int pos_prod;
  idp = new_sym_var(sizeof(int) * 8);
  new_qtd = new_sym_var(sizeof(int) * 8);
  pos_prod = existeProduto(idp);
  if (pos_prod == (-7))
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
  }
  else
  {
    lista_produtos[pos_prod].qtd += new_qtd;
  }

}

void criaEncomenda()
{
  printf("Nova encomenda %d.\n", id_e);
  id_e++;
}

void adicionaProduto_E()
{
  int ide;
  int idp;
  int qtd;
  int pos_prod;
  int pos_enc;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  pos_prod = existeProduto(idp);
  if (ide >= id_e)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (idp >= id_p)
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      if (qtd > lista_produtos[pos_prod].qtd)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
      }
      else
      {
        if ((encomenda[ide].peso + (lista_produtos[pos_prod].peso * qtd)) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
        }
        else
        {
          pos_enc = estaEncomenda(idp, ide);
          if (pos_enc != (-7))
          {
            encomenda[ide].prods[pos_enc].qtd += qtd;
            encomenda[ide].peso += encomenda[ide].prods[pos_enc].peso * qtd;
          }
          else
          {
            encomenda[ide].prods[encomenda[ide].n_produtos] = lista_produtos[pos_prod];
            encomenda[ide].prods[encomenda[ide].n_produtos].qtd = qtd;
            encomenda[ide].peso += lista_produtos[pos_prod].peso * qtd;
            encomenda[ide].n_produtos += 1;
          }

          lista_produtos[pos_prod].qtd -= qtd;
        }

      }

    }

  }

}

void removeStock()
{
  int idp;
  int qtd;
  int pos_prod;
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  pos_prod = existeProduto(idp);
  if (pos_prod == (-7))
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    if ((lista_produtos[pos_prod].qtd - qtd) < 0)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, idp);
    }
    else
    {
      lista_produtos[pos_prod].qtd -= qtd;
    }

  }

}

void custoEncomenda()
{
  int ide;
  int i;
  int custo = 0;
  ide = new_sym_var(sizeof(int) * 8);
  if (ide >= id_e)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    for (i = 0; i < encomenda[ide].n_produtos; i++)
    {
      custo += encomenda[ide].prods[i].qtd * encomenda[ide].prods[i].preco;
    }

    printf("Custo da encomenda %d %d.\n", ide, custo);
  }

}

void removeProduto_E()
{
  int ide;
  int idp;
  int i;
  int pos;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (ide >= id_e)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (idp >= id_p)
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      pos = estaEncomenda(idp, ide);
      if (pos != (-7))
      {
        lista_produtos[existeProduto(idp)].qtd += encomenda[ide].prods[pos].qtd;
        encomenda[ide].peso -= encomenda[ide].prods[pos].peso * encomenda[ide].prods[pos].qtd;
        for (i = pos; i < encomenda[ide].n_produtos; i++)
          encomenda[ide].prods[i] = encomenda[ide].prods[i + 1];

        encomenda[ide].n_produtos--;
      }
      else
      {
        
      }

    }

  }

}

void alteraPreco()
{
  int idp;
  int new_preco;
  int i;
  int pos_prod;
  int pos_enc;
  idp = new_sym_var(sizeof(int) * 8);
  new_preco = new_sym_var(sizeof(int) * 8);
  pos_prod = existeProduto(idp);
  if (pos_prod != (-7))
  {
    lista_produtos[pos_prod].preco = new_preco;
    for (i = 0; i < id_e; i++)
    {
      pos_enc = estaEncomenda(idp, i);
      if (pos_enc != (-7))
      {
        encomenda[i].prods[pos_enc].preco = new_preco;
      }
      else
      {
        
      }

    }

  }
  else
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
  }

}

void listaDescQtd()
{
  int ide;
  int idp;
  int pos_prod_enc;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  pos_prod_enc = estaEncomenda(idp, ide);
  if (idp >= id_p)
  {
    printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    if (ide >= id_e)
    {
      printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
    }
    else
    {
      if (pos_prod_enc == (-7))
      {
        printf("%s 0.\n", lista_produtos[existeProduto(idp)].desc);
      }
      else
      {
        printf("%s %d.\n", encomenda[ide].prods[pos_prod_enc].desc, encomenda[ide].prods[pos_prod_enc].qtd);
      }

    }

  }

}

void ocorreMais_E()
{
  int idp;
  int i;
  int pos_prod_enc;
  int max_id = -1;
  int max = 0;
  idp = new_sym_var(sizeof(int) * 8);
  if (idp >= id_p)
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    if (id_e >= 0)
    {
      for (i = 0; i < id_e; i++)
      {
        pos_prod_enc = estaEncomenda(idp, i);
        if (pos_prod_enc != (-7))
        {
          if (encomenda[i].prods[pos_prod_enc].qtd > max)
          {
            max = encomenda[i].prods[pos_prod_enc].qtd;
            max_id = i;
          }
          else
          {
            
          }

        }
        else
        {
          
        }

      }

      if (max_id != (-1))
      {
        printf("Maximo produto %d %d %d.\n", idp, max_id, max);
      }
      else
      {
        
      }

    }
    else
    {
      
    }

  }

}

void merge(Produto prods[], int left, int mid, int right)
{
  int i;
  int j;
  int k;
  for (i = mid + 1; i > left; i--)
    aux[i - 1] = prods[i - 1];

  for (j = mid; j < right; j++)
    aux[(right + mid) - j] = prods[j + 1];

  for (k = left; k <= right; k++)
    if ((aux[j].preco < aux[i].preco) || ((aux[j].preco == aux[i].preco) && (aux[j].id < aux[i].id)))
  {
    prods[k] = aux[j];
    j--;
  }
  else
  {
    prods[k] = aux[i];
    i++;
  }


}

void mergesort(Produto a[], int l, int r)
{
  int m = (r + l) / 2;
  if (r <= l)
  {
    return;
  }
  else
  {
    
  }

  mergesort(a, l, m);
  mergesort(a, m + 1, r);
  merge(a, l, m, r);
}

void listaProdutos()
{
  mergesort(lista_produtos, 0, id_p - 1);
  printProduto();
}

void merge_E(Produto enc[], int left, int mid, int right)
{
  int i;
  int j;
  int k;
  for (i = mid + 1; i > left; i--)
    aux[i - 1] = enc[i - 1];

  for (j = mid; j < right; j++)
    aux[(right + mid) - j] = enc[j + 1];

  for (k = left; k <= right; k++)
    if ((strcmp(aux[j].desc, aux[i].desc) < 0) || ((strcmp(aux[j].desc, aux[i].desc) == 0) && (aux[j].id < aux[i].id)))
  {
    enc[k] = aux[j];
    j--;
  }
  else
  {
    enc[k] = aux[i];
    i++;
  }


}

void mergesort_E(Produto a[], int l, int r)
{
  int m = (r + l) / 2;
  if (r <= l)
  {
    return;
  }
  else
  {
    
  }

  mergesort_E(a, l, m);
  mergesort_E(a, m + 1, r);
  merge_E(a, l, m, r);
}

void listaProdutos_E()
{
  int ide;
  ide = new_sym_var(sizeof(int) * 8);
  if (ide >= id_e)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    mergesort_E(encomenda[ide].prods, 0, encomenda[ide].n_produtos - 1);
    printEncomenda(ide);
  }

}

