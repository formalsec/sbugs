/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>


typedef struct produto
{
  int identificador;
  char descricao[64];
  int preco;
  int peso;
  int stock;
} Produto;
typedef struct encomenda
{
  int identificador;
  int stock;
} Encomenda;
Produto Produtos_no_sistema[10000];
Encomenda Encomendas_no_sistema[500][200];
int id_produtos;
int id_encomendas;
int id_prod_em_encomenda[500];
int produto_no_sistema(int idp);
int produto_em_stock(int idp, int qtd);
int encomenda_no_sistema(int ide);
int peso_permitido(int ide, int idp, int qtd);
int produto_na_encomenda(int ide, int idp);
int calcula_custo(int ide, int n);
void maximo_produto(int idp);
void merge_produtos(Produto Produtos[], int esq, int drt, char parametro, int ide);
void junta_ordenados(Produto Produtos[], int esq, int meio, int drt, char parametro);
void imprime_vetor(Produto Produtos[], int no_elementos, char parametro, int ide);
void executa_a();
int executa_q();
void executa_N();
int executa_A();
int executa_r();
int executa_R();
int executa_C();
int executa_p();
int executa_E();
int executa_m();
void executa_l();
int executa_L();
int main()
{
  char comando;
  while (1)
  {
    comando = getchar();
    switch (comando)
    {
      case 'a':
      {
        executa_a();
        break;
      }

      case 'q':
      {
        executa_q();
        break;
      }

      case 'N':
      {
        executa_N();
        break;
      }

      case 'A':
      {
        executa_A();
        break;
      }

      case 'r':
      {
        executa_r();
        break;
      }

      case 'R':
      {
        executa_R();
        break;
      }

      case 'C':
      {
        executa_C();
        break;
      }

      case 'p':
      {
        executa_p();
        break;
      }

      case 'E':
      {
        executa_E();
        break;
      }

      case 'm':
      {
        executa_m();
        break;
      }

      case 'l':
      {
        executa_l();
        break;
      }

      case 'L':
      {
        executa_L();
        break;
      }

      case 'x':
        return 0;

    }

    getchar();
  }

  return 1;
}

int produto_no_sistema(int idp)
{
  if (idp < id_produtos)
  {
    return 1;
  }
  else
  {
    return 0;
  }

}

int produto_em_stock(int idp, int qtd)
{
  if (Produtos_no_sistema[idp].stock < qtd)
  {
    return 0;
  }
  else
  {
    return 1;
  }

}

int encomenda_no_sistema(int ide)
{
  if (ide < id_encomendas)
  {
    return 1;
  }
  else
  {
    return 0;
  }

}

int peso_permitido(int ide, int idp, int qtd)
{
  int i;
  int quantidade;
  int identificador;
  int total = 0;
  for (i = 0; i < id_prod_em_encomenda[ide]; i++)
  {
    quantidade = Encomendas_no_sistema[ide][i].stock;
    identificador = Encomendas_no_sistema[ide][i].identificador;
    total += Produtos_no_sistema[identificador].peso * quantidade;
  }

  total += qtd * Produtos_no_sistema[idp].peso;
  if (total > 200)
  {
    return 0;
  }
  else
  {
    return 1;
  }

}

int produto_na_encomenda(int ide, int idp)
{
  int i;
  int j = id_prod_em_encomenda[ide];
  for (i = 0; i < j; i++)
  {
    if (Encomendas_no_sistema[ide][i].identificador == idp)
    {
      return i;
    }
    else
    {
      
    }

  }

  return 200;
}

int calcula_custo(int ide, int n)
{
  int i;
  int idp;
  int qtd;
  int valor;
  int total = 0;
  for (i = 0; i < n; i++)
  {
    idp = Encomendas_no_sistema[ide][i].identificador;
    qtd = Encomendas_no_sistema[ide][i].stock;
    valor = Produtos_no_sistema[idp].preco;
    total += valor * qtd;
  }

  return total;
}

void maximo_produto(int idp)
{
  int resultado[2] = {0};
  int i;
  int j;
  int estado = 0;
  for (i = 0; i < id_encomendas; i++)
    for (j = 0; j < id_prod_em_encomenda[i]; j++)
    if ((Encomendas_no_sistema[i][j].identificador == idp) && (Encomendas_no_sistema[i][j].stock > resultado[1]))
  {
    estado = 1;
    resultado[0] = i;
    resultado[1] = Encomendas_no_sistema[i][j].stock;
  }
  else
  {
    
  }



  if (estado == 1)
  {
    printf("Maximo produto %d %d %d.\n", idp, resultado[0], resultado[1]);
  }
  else
  {
    
  }

}

void merge_produtos(Produto Produtos[], int esq, int drt, char parametro, int ide)
{
  int meio;
  if (esq < drt)
  {
    meio = (esq + drt) / 2;
    if (parametro == 'p')
    {
      merge_produtos(Produtos, esq, meio, 'p', 0);
      merge_produtos(Produtos, meio + 1, drt, 'p', 0);
      junta_ordenados(Produtos, esq, meio, drt, 'p');
    }
    else
    {
      merge_produtos(Produtos, esq, meio, 'd', ide);
      merge_produtos(Produtos, meio + 1, drt, 'd', ide);
      junta_ordenados(Produtos, esq, meio, drt, 'd');
    }

  }
  else
  {
    
  }

}

void junta_ordenados(Produto Produtos[], int esq, int meio, int drt, char parametro)
{
  int i;
  int j;
  int k;
  int lim_esq = (meio - esq) + 1;
  int lim_drt = drt - meio;
  Produto Produtos_esq[10000];
  Produto Produtos_drt[10000];
  for (i = 0; i < lim_esq; i++)
  {
    Produtos_esq[i].preco = Produtos[esq + i].preco;
    Produtos_esq[i].stock = Produtos[esq + i].stock;
    strcpy(Produtos_esq[i].descricao, Produtos[esq + i].descricao);
  }

  for (j = 0; j < lim_drt; j++)
  {
    Produtos_drt[j].preco = Produtos[(meio + 1) + j].preco;
    Produtos_drt[j].stock = Produtos[(meio + 1) + j].stock;
    strcpy(Produtos_drt[j].descricao, Produtos[(meio + 1) + j].descricao);
  }

  i = 0;
  j = 0;
  k = esq;
  while ((i < lim_esq) && (j < lim_drt))
  {
    if (((parametro == 'p') && (Produtos_esq[i].preco <= Produtos_drt[j].preco)) || ((parametro == 'd') && (strcmp(Produtos_esq[i].descricao, Produtos_drt[j].descricao) <= 0)))
    {
      Produtos[k].preco = Produtos_esq[i].preco;
      Produtos[k].stock = Produtos_esq[i].stock;
      strcpy(Produtos[k].descricao, Produtos_esq[i].descricao);
      i++;
    }
    else
    {
      Produtos[k].preco = Produtos_drt[j].preco;
      Produtos[k].stock = Produtos_drt[j].stock;
      strcpy(Produtos[k].descricao, Produtos_drt[j].descricao);
      j++;
    }

    k++;
  }

  while (i < lim_esq)
  {
    Produtos[k].preco = Produtos_esq[i].preco;
    Produtos[k].stock = Produtos_esq[i].stock;
    strcpy(Produtos[k].descricao, Produtos_esq[i].descricao);
    i++;
    k++;
  }

  while (j < lim_drt)
  {
    Produtos[k].preco = Produtos_drt[j].preco;
    Produtos[k].stock = Produtos_drt[j].stock;
    strcpy(Produtos[k].descricao, Produtos_drt[j].descricao);
    j++;
    k++;
  }

}

void imprime_vetor(Produto Produtos[], int no_elementos, char parametro, int ide)
{
  int i;
  if (parametro == 'p')
  {
    printf("Produtos\n");
  }
  else
  {
    printf("Encomenda %d\n", ide);
  }

  for (i = 0; i < no_elementos; i++)
    printf("* %s %d %d\n", Produtos[i].descricao, Produtos[i].preco, Produtos[i].stock);

}

void executa_a()
{
  for (int Produtos_no_sistema_index = 0; Produtos_no_sistema_index < 10; Produtos_no_sistema_index++)
  {
    Produtos_no_sistema[id_produtos].descricao[Produtos_no_sistema_index] = new_sym_var(sizeof(char) * 8);
  }

  Produtos_no_sistema[id_produtos].descricao[10 - 1] = '\0';
  Produtos_no_sistema[id_produtos].preco = new_sym_var(sizeof(int) * 8);
  Produtos_no_sistema[id_produtos].peso = new_sym_var(sizeof(int) * 8);
  Produtos_no_sistema[id_produtos].stock = new_sym_var(sizeof(int) * 8);
  Produtos_no_sistema[id_produtos].identificador = id_produtos;
  printf("Novo produto %d.\n", id_produtos);
  id_produtos++;
}

int executa_q()
{
  int idp;
  int qtd;
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (!produto_no_sistema(idp))
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
    return 0;
  }
  else
  {
    Produtos_no_sistema[idp].stock += qtd;
    return 0;
  }

}

void executa_N()
{
  printf("Nova encomenda %d.\n", id_encomendas);
  id_encomendas++;
}

int executa_A()
{
  int ide;
  int idp;
  int qtd;
  int i;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (!encomenda_no_sistema(ide))
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
    return 0;
  }
  else
  {
    if (!produto_no_sistema(idp))
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
      return 0;
    }
    else
    {
      if (!produto_em_stock(idp, qtd))
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
        return 0;
      }
      else
      {
        if (!peso_permitido(ide, idp, qtd))
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
          return 0;
        }
        else
        {
          
        }

      }

    }

  }

  i = produto_na_encomenda(ide, idp);
  if (i >= 200)
  {
    i = id_prod_em_encomenda[ide];
    Encomendas_no_sistema[ide][i].identificador = idp;
    Encomendas_no_sistema[ide][i].stock = qtd;
    Produtos_no_sistema[idp].stock -= qtd;
    ++id_prod_em_encomenda[ide];
    return 0;
  }
  else
  {
    Encomendas_no_sistema[ide][i].stock += qtd;
    Produtos_no_sistema[idp].stock -= qtd;
    return 0;
  }

}

int executa_r()
{
  int idp;
  int qtd;
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (!produto_no_sistema(idp))
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
    return 0;
  }
  else
  {
    if (!produto_em_stock(idp, qtd))
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, idp);
      return 0;
    }
    else
    {
      Produtos_no_sistema[idp].stock -= qtd;
      return 0;
    }

  }

}

int executa_R()
{
  int ide;
  int idp;
  int i;
  int j;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (!encomenda_no_sistema(ide))
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
    return 0;
  }
  else
  {
    if (!produto_no_sistema(idp))
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
      return 0;
    }
    else
    {
      i = produto_na_encomenda(ide, idp);
      if (i < 200)
      {
        Produtos_no_sistema[idp].stock += Encomendas_no_sistema[ide][i].stock;
        for (j = i; j < id_prod_em_encomenda[ide]; j++)
        {
          Encomendas_no_sistema[ide][j].stock = Encomendas_no_sistema[ide][j + 1].stock;
          Encomendas_no_sistema[ide][j].identificador = Encomendas_no_sistema[ide][j + 1].identificador;
        }

        id_prod_em_encomenda[ide]--;
        return 0;
      }
      else
      {
        return 0;
      }

    }

  }

}

int executa_C()
{
  int ide;
  int total;
  ide = new_sym_var(sizeof(int) * 8);
  if (!encomenda_no_sistema(ide))
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
    return 0;
  }
  else
  {
    total = calcula_custo(ide, id_prod_em_encomenda[ide]);
    printf("Custo da encomenda %d %d.\n", ide, total);
    return 0;
  }

}

int executa_p()
{
  int idp;
  int preco;
  idp = new_sym_var(sizeof(int) * 8);
  preco = new_sym_var(sizeof(int) * 8);
  if (!produto_no_sistema(idp))
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
    return 0;
  }
  else
  {
    Produtos_no_sistema[idp].preco = preco;
    return 0;
  }

}

int executa_E()
{
  int ide;
  int idp;
  int i;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (!encomenda_no_sistema(ide))
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
    return 0;
  }
  else
  {
    if (!produto_no_sistema(idp))
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
      return 0;
    }
    else
    {
      i = produto_na_encomenda(ide, idp);
      if (i < 200)
      {
        printf("%s %d.\n", Produtos_no_sistema[idp].descricao, Encomendas_no_sistema[ide][i].stock);
        return 0;
      }
      else
      {
        printf("%s 0.\n", Produtos_no_sistema[idp].descricao);
        return 0;
      }

    }

  }

}

int executa_m()
{
  int idp;
  idp = new_sym_var(sizeof(int) * 8);
  if (!produto_no_sistema(idp))
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
    return 0;
  }
  else
  {
    if (!id_encomendas)
    {
      return 0;
    }
    else
    {
      maximo_produto(idp);
      return 0;
    }

  }

}

void executa_l()
{
  Produto Produtos[10000];
  int i;
  for (i = 0; i < id_produtos; i++)
  {
    strcpy(Produtos[i].descricao, Produtos_no_sistema[i].descricao);
    Produtos[i].preco = Produtos_no_sistema[i].preco;
    Produtos[i].stock = Produtos_no_sistema[i].stock;
  }

  merge_produtos(Produtos, 0, id_produtos - 1, 'p', 0);
  imprime_vetor(Produtos, id_produtos, 'p', 0);
}

int executa_L()
{
  int ide;
  int i;
  int idp;
  Produto produtos[200];
  ide = new_sym_var(sizeof(int) * 8);
  if (!encomenda_no_sistema(ide))
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
    return 0;
  }
  else
  {
    for (i = 0; i < id_prod_em_encomenda[ide]; i++)
    {
      idp = Encomendas_no_sistema[ide][i].identificador;
      produtos[i].stock = Encomendas_no_sistema[ide][i].stock;
      produtos[i].preco = Produtos_no_sistema[idp].preco;
      strcpy(produtos[i].descricao, Produtos_no_sistema[idp].descricao);
    }

    merge_produtos(produtos, 0, id_prod_em_encomenda[ide] - 1, 'd', ide);
    imprime_vetor(produtos, id_prod_em_encomenda[ide], 'd', ide);
    return 0;
  }

}

