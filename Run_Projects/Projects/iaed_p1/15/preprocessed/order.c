/*File generated by PreProcessor.py*/


#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "myLib.h"
#include "product.h"
#include "order.h"


Order *order_new()
{
  static int next_id = 0;
  Order *order = (Order *) malloc(sizeof(Order));
  if (errno > 0)
  {
    {
      perror("order_new: criar_order");
      exit(errno);
    }
  }
  else
  {
    
  }

  ;
  order->id = next_id++;
  order->count = 0;
  order->weight = 0;
  order->products = 0;
  order->last_product = 0;
  return order;
}

void order_product_free(Order_Product *op)
{
  if (op == 0)
  {
    {
      printf("%s: null pointer\n", "order_product_free");
      exit(1);
    }
  }
  else
  {
    
  }

  ;
  free(op);
}

void order_free(Order *o)
{
  Order_Product *op;
  if (o == 0)
  {
    {
      printf("%s: null pointer\n", "order_free");
      exit(1);
    }
  }
  else
  {
    
  }

  ;
  op = o->products;
  while (op != 0)
  {
    Order_Product *next = op->next;
    order_product_free(op);
    op = next;
  }

  free(o);
}

int order_get_id(const Order *o)
{
  if (o == 0)
  {
    {
      printf("%s: null pointer\n", "order_get_id");
      exit(1);
    }
  }
  else
  {
    
  }

  ;
  return o->id;
}

int order_get_count(const Order *o)
{
  if (o == 0)
  {
    {
      printf("%s: null pointer\n", "order_get_count");
      exit(1);
    }
  }
  else
  {
    
  }

  ;
  return o->count;
}

int order_get_cost(const Order *o)
{
  Order_Product *op;
  int sum = 0;
  if (o == 0)
  {
    {
      printf("%s: null pointer\n", "order_get_cost");
      exit(1);
    }
  }
  else
  {
    
  }

  ;
  op = o->products;
  while (op != 0)
  {
    sum += op->qtd * op->product->preco;
    op = op->next;
  }

  return sum;
}

int order_get_weight(const Order *o)
{
  if (o == 0)
  {
    {
      printf("%s: null pointer\n", "order_get_weight");
      exit(1);
    }
  }
  else
  {
    
  }

  ;
  return o->weight;
}

Order_Product *order_get_product(const Order *o, int pid)
{
  Order_Product *op;
  if (o == 0)
  {
    {
      printf("%s: null pointer\n", "order_get_product");
      exit(1);
    }
  }
  else
  {
    
  }

  ;
  op = o->products;
  while (op != 0)
  {
    if (op->product->id == pid)
    {
      return op;
    }
    else
    {
      
    }

    op = op->next;
  }

  return 0;
}

Order_Product *order_add_product(Order *o, const Product *p, int qtd)
{
  Order_Product *op;
  int weight;
  if (o == 0)
  {
    {
      printf("%s: null pointer\n", "order_add_product: Order");
      exit(1);
    }
  }
  else
  {
    
  }

  ;
  if (p == 0)
  {
    {
      printf("%s: null pointer\n", "order_add_product: Product");
      exit(1);
    }
  }
  else
  {
    
  }

  ;
  weight = qtd * p->peso;
  if ((o->weight + weight) > 200)
  {
    return 0;
  }
  else
  {
    
  }

  op = order_get_product(o, p->id);
  if (op != 0)
  {
    {
      op->qtd += qtd;
    }
  }
  else
  {
    {
      op = (Order_Product *) malloc(sizeof(Order_Product));
      if (errno > 0)
      {
        {
          perror("order_add_product: criar_order_product");
          exit(errno);
        }
      }
      else
      {
        
      }

      ;
      op->product = p;
      op->qtd = qtd;
      op->next = 0;
      op->previous = o->last_product;
      o->count++;
      if (o->last_product != 0)
      {
        o->last_product->next = op;
      }
      else
      {
        
      }

      o->last_product = op;
      if (o->products == 0)
      {
        {
          o->products = op;
        }
      }
      else
      {
        
      }

    }
  }

  o->weight += weight;
  return op;
}

int order_remove_product(Order *o, int pid)
{
  Order_Product *op;
  if (o == 0)
  {
    {
      printf("%s: null pointer\n", "order_remove_product");
      exit(1);
    }
  }
  else
  {
    
  }

  ;
  op = order_get_product(o, pid);
  if (op == 0)
  {
    return -1;
  }
  else
  {
    
  }

  o->count--;
  o->weight -= op->qtd * op->product->peso;
  if (op->previous == 0)
  {
    {
      o->products = op->next;
    }
  }
  else
  {
    
  }

  if (op->next == 0)
  {
    {
      o->last_product = op->previous;
    }
  }
  else
  {
    
  }

  if (op->previous != 0)
  {
    {
      op->previous->next = op->next;
    }
  }
  else
  {
    
  }

  order_product_free(op);
  return 0;
}

void order_list_products(const Order *o)
{
  Order_Product *op;
  const Product *p;
  if (o == 0)
  {
    {
      printf("%s: null pointer\n", "order_list_products");
      exit(1);
    }
  }
  else
  {
    
  }

  ;
  op = o->products;
  printf("Encomenda %d\n", o->id);
  while (op != 0)
  {
    p = op->product;
    printf("* %s %d %d\n", p->descricao, p->preco, op->qtd);
    op = op->next;
  }

}

void order_list_products_by_desc(const Order *o)
{
  order_list_products(o);
}

const Product *order_product_get_product(const Order_Product *op)
{
  if (op == 0)
  {
    {
      printf("%s: null pointer\n", "order_product_get_product");
      exit(1);
    }
  }
  else
  {
    
  }

  ;
  return op->product;
}

int order_product_get_quantity(const Order_Product *op)
{
  if (op == 0)
  {
    {
      printf("%s: null pointer\n", "order_product_get_quantity");
      exit(1);
    }
  }
  else
  {
    
  }

  ;
  return op->qtd;
}

void order_print(const Order *o)
{
  if (o == 0)
  {
    {
      printf("%s: null pointer\n", "order_print");
      exit(1);
    }
  }
  else
  {
    
  }

  ;
  printf("Order: ID=%d C=%d P=%d W=%d\n", order_get_id(o), order_get_count(o), order_get_cost(o), order_get_weight(o));
}

void order_product_print(const Order_Product *op)
{
  if (op == 0)
  {
    {
      printf("%s: null pointer\n", "order_product_print");
      exit(1);
    }
  }
  else
  {
    
  }

  ;
  printf("Order_Product: I=%d Q=%d\n", product_get_id(order_product_get_product(op)), order_product_get_quantity(op));
}

