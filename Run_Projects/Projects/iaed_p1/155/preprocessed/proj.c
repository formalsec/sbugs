/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


typedef struct produto
{
  int idp;
  char descricao[64];
  int preco;
  int peso;
  int qtd_stock;
} Produto;
typedef struct encomenda
{
  int ide;
  int num_prods;
  int peso;
  Produto produto[200];
} Encomenda;
void comando_a();
void comando_q();
void comando_N();
void comando_A();
void comando_r();
void comando_R();
void comando_p();
void comando_l();
void comando_C();
void comando_E();
void comando_m();
void comando_L();
int procura_produto(int ident_prod);
int procura_encomenda(int ident_enc);
int procura_produto_em_encomenda(int ident_enc, int ident_prod);
void mergesort(Produto lista[], int esquerda, int direita);
void merge(Produto lista[], int esquerda, int m, int direita);
int id_produto = 0;
int id_encomenda = 0;
Produto lista_produtos_sistema[10000];
Encomenda lista_encomendas_sistema[500];
int main()
{
  char comando;
  while ((comando = getchar()) != 'x')
  {
    switch (comando)
    {
      case 'a':
        comando_a();
        break;

      case 'q':
        comando_q();
        break;

      case 'N':
        comando_N();
        break;

      case 'A':
        comando_A();
        break;

      case 'r':
        comando_r();
        break;

      case 'R':
        comando_R();
        break;

      case 'C':
        comando_C();
        break;

      case 'p':
        comando_p();
        break;

      case 'E':
        comando_E();
        break;

      case 'm':
        comando_m();
        break;

      case 'l':
        comando_l();
        break;

      case 'L':
        comando_L();
        break;

    }

  }

  return 0;
}

void comando_a()
{
  Produto produto;
  char desc[64];
  int preco;
  int peso;
  int qtd;
  for (int desc_index = 0; desc_index < 10; desc_index++)
  {
    desc[desc_index] = new_sym_var(sizeof(char) * 8);
  }

  desc[10 - 1] = '\0';
  preco = new_sym_var(sizeof(int) * 8);
  peso = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  produto.idp = id_produto;
  strcpy(produto.descricao, desc);
  produto.preco = preco;
  produto.peso = peso;
  produto.qtd_stock = qtd;
  printf("Novo produto %d.\n", id_produto);
  lista_produtos_sistema[id_produto] = produto;
  id_produto += 1;
}

void comando_q()
{
  int ident_prod;
  int qtd;
  ident_prod = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (procura_produto(ident_prod) == 1)
  {
    lista_produtos_sistema[ident_prod].qtd_stock += qtd;
    return;
  }
  else
  {
    
  }

  printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", ident_prod);
}

void comando_N()
{
  Encomenda enc;
  enc.ide = id_encomenda;
  enc.peso = 0;
  enc.num_prods = 0;
  lista_encomendas_sistema[id_encomenda] = enc;
  printf("Nova encomenda %d.\n", id_encomenda);
  id_encomenda += 1;
}

void comando_A()
{
  int ident_enc;
  int ident_prod;
  int qtd;
  ident_enc = new_sym_var(sizeof(int) * 8);
  ident_prod = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (procura_encomenda(ident_enc) == 1)
  {
    if (procura_produto(ident_prod) == 1)
    {
      int peso = lista_encomendas_sistema[ident_enc].peso + (lista_produtos_sistema[ident_prod].peso * qtd);
      if ((lista_produtos_sistema[ident_prod].qtd_stock - qtd) < 0)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", ident_prod, ident_enc);
      }
      else
      {
        if (peso > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", ident_prod, ident_enc);
        }
        else
        {
          if (procura_produto_em_encomenda(ident_enc, ident_prod) != (-1))
          {
            int i = procura_produto_em_encomenda(ident_enc, ident_prod);
            lista_encomendas_sistema[ident_enc].produto[i].qtd_stock += qtd;
            lista_encomendas_sistema[ident_enc].peso = peso;
            lista_produtos_sistema[ident_prod].qtd_stock -= qtd;
          }
          else
          {
            int indice = lista_encomendas_sistema[ident_enc].num_prods;
            lista_encomendas_sistema[ident_enc].peso = peso;
            lista_encomendas_sistema[ident_enc].produto[indice].idp = lista_produtos_sistema[ident_prod].idp;
            lista_encomendas_sistema[ident_enc].produto[indice].qtd_stock = qtd;
            strcpy(lista_encomendas_sistema[ident_enc].produto[indice].descricao, lista_produtos_sistema[ident_prod].descricao);
            lista_encomendas_sistema[ident_enc].produto[indice].peso = lista_produtos_sistema[ident_prod].peso;
            lista_encomendas_sistema[ident_enc].produto[indice].preco = lista_produtos_sistema[ident_prod].preco;
            lista_produtos_sistema[ident_prod].qtd_stock -= qtd;
            lista_encomendas_sistema[ident_enc].num_prods += 1;
          }

        }

      }

    }
    else
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", ident_prod, ident_enc);
    }

  }
  else
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", ident_prod, ident_enc);
  }

}

void comando_r()
{
  int ident_prod;
  int qtd;
  ident_prod = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (procura_produto(ident_prod) == 1)
  {
    int remocao = lista_produtos_sistema[ident_prod].qtd_stock - qtd;
    if (remocao < 0)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, ident_prod);
    }
    else
    {
      lista_produtos_sistema[ident_prod].qtd_stock = remocao;
    }

  }
  else
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", ident_prod);
  }

}

void comando_R()
{
  int ident_enc;
  int ident_prod;
  ident_enc = new_sym_var(sizeof(int) * 8);
  ident_prod = new_sym_var(sizeof(int) * 8);
  if (procura_encomenda(ident_enc) == 1)
  {
    if (procura_produto(ident_prod) == 1)
    {
      if (procura_produto_em_encomenda(ident_enc, ident_prod) != (-1))
      {
        int pos_remove = procura_produto_em_encomenda(ident_enc, ident_prod);
        lista_encomendas_sistema[ident_enc].peso -= lista_produtos_sistema[ident_prod].peso * lista_encomendas_sistema[ident_enc].produto[pos_remove].qtd_stock;
        lista_produtos_sistema[ident_prod].qtd_stock += lista_encomendas_sistema[ident_enc].produto[pos_remove].qtd_stock;
        lista_encomendas_sistema[ident_enc].produto[pos_remove].qtd_stock = 0;
      }
      else
      {
        
      }

    }
    else
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", ident_prod, ident_enc);
    }

  }
  else
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", ident_prod, ident_enc);
  }

}

void comando_C()
{
  int ident_enc;
  ident_enc = new_sym_var(sizeof(int) * 8);
  if (procura_encomenda(ident_enc) == 1)
  {
    int i;
    int lim_enc = lista_encomendas_sistema[ident_enc].num_prods;
    int custo_total = 0;
    for (i = 0; i < lim_enc; i++)
    {
      custo_total += lista_encomendas_sistema[ident_enc].produto[i].preco * lista_encomendas_sistema[ident_enc].produto[i].qtd_stock;
    }

    printf("Custo da encomenda %d %d.\n", ident_enc, custo_total);
  }
  else
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ident_enc);
  }

}

void comando_p()
{
  int i;
  int ident_prod;
  int preco;
  ident_prod = new_sym_var(sizeof(int) * 8);
  preco = new_sym_var(sizeof(int) * 8);
  if (procura_produto(ident_prod) == 1)
  {
    lista_produtos_sistema[ident_prod].preco = preco;
    for (i = 0; i < id_encomenda; i++)
    {
      if (procura_produto_em_encomenda(i, ident_prod) != (-1))
      {
        int pos_produto = procura_produto_em_encomenda(i, ident_prod);
        lista_encomendas_sistema[i].produto[pos_produto].preco = preco;
      }
      else
      {
        
      }

    }

  }
  else
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", ident_prod);
  }

}

void comando_E()
{
  int ident_enc;
  int ident_prod;
  ident_enc = new_sym_var(sizeof(int) * 8);
  ident_prod = new_sym_var(sizeof(int) * 8);
  if (procura_encomenda(ident_enc) == 1)
  {
    if (procura_produto(ident_prod) == 1)
    {
      if (procura_produto_em_encomenda(ident_enc, ident_prod) != (-1))
      {
        int pos_produto = procura_produto_em_encomenda(ident_enc, ident_prod);
        printf("%s %d.\n", lista_encomendas_sistema[ident_enc].produto[pos_produto].descricao, lista_encomendas_sistema[ident_enc].produto[pos_produto].qtd_stock);
      }
      else
      {
        printf("%s %d.\n", lista_produtos_sistema[ident_prod].descricao, 0);
      }

    }
    else
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", ident_prod);
    }

  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ident_enc);
  }

}

void comando_m()
{
  int ident_prod;
  ident_prod = new_sym_var(sizeof(int) * 8);
  if (procura_produto(ident_prod) == 1)
  {
    int i;
    int ide;
    int max = 0;
    for (i = 0; i < id_encomenda; i++)
    {
      if (procura_produto_em_encomenda(i, ident_prod) != (-1))
      {
        int pos_produto = procura_produto_em_encomenda(i, ident_prod);
        if (max < lista_encomendas_sistema[i].produto[pos_produto].qtd_stock)
        {
          max = lista_encomendas_sistema[i].produto[pos_produto].qtd_stock;
          ide = i;
        }
        else
        {
          
        }

      }
      else
      {
        
      }

    }

    if (max > 0)
    {
      printf("Maximo produto %d %d %d.\n", ident_prod, ide, max);
    }
    else
    {
      
    }

  }
  else
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", ident_prod);
  }

}

void comando_l()
{
  int i;
  Produto lista_prods_ordenada[10000];
  for (i = 0; i < id_produto; i++)
  {
    lista_prods_ordenada[i] = lista_produtos_sistema[i];
  }

  mergesort(lista_prods_ordenada, 0, id_produto - 1);
  printf("Produtos\n");
  for (i = 0; i < id_produto; i++)
  {
    printf("* %s %d %d\n", lista_prods_ordenada[i].descricao, lista_prods_ordenada[i].preco, lista_prods_ordenada[i].qtd_stock);
  }

}

void comando_L()
{
  int ident_enc;
  ident_enc = new_sym_var(sizeof(int) * 8);
  if (procura_encomenda(ident_enc) == 1)
  {
    int i;
    int j;
    int prods_enc = lista_encomendas_sistema[ident_enc].num_prods;
    Encomenda encomenda_ordenada;
    for (i = 0; i < prods_enc; i++)
    {
      strcpy(encomenda_ordenada.produto[i].descricao, lista_encomendas_sistema[ident_enc].produto[i].descricao);
      encomenda_ordenada.produto[i].preco = lista_encomendas_sistema[ident_enc].produto[i].preco;
      encomenda_ordenada.produto[i].qtd_stock = lista_encomendas_sistema[ident_enc].produto[i].qtd_stock;
    }

    printf("Encomenda %d\n", ident_enc);
    for (i = 1; i < prods_enc; i++)
    {
      Produto v = encomenda_ordenada.produto[i];
      j = i - 1;
      while ((j >= 0) && (strcmp(v.descricao, encomenda_ordenada.produto[j].descricao) < 0))
      {
        encomenda_ordenada.produto[j + 1] = encomenda_ordenada.produto[j];
        j--;
      }

      encomenda_ordenada.produto[j + 1] = v;
    }

    for (i = 0; i < prods_enc; i++)
    {
      if (encomenda_ordenada.produto[i].qtd_stock != 0)
      {
        printf("* %s %d %d\n", encomenda_ordenada.produto[i].descricao, encomenda_ordenada.produto[i].preco, encomenda_ordenada.produto[i].qtd_stock);
      }
      else
      {
        
      }

    }

  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ident_enc);
  }

}

int procura_produto(int ident_prod)
{
  if (ident_prod < id_produto)
  {
    return 1;
  }
  else
  {
    
  }

  return -1;
}

int procura_encomenda(int ident_enc)
{
  if (ident_enc < id_encomenda)
  {
    return 1;
  }
  else
  {
    return -1;
  }

}

int procura_produto_em_encomenda(int ident_enc, int ident_prod)
{
  int i;
  char descricao_prod[64];
  strcpy(descricao_prod, lista_produtos_sistema[ident_prod].descricao);
  for (i = 0; i < lista_encomendas_sistema[ident_enc].num_prods; i++)
  {
    if (strcmp(lista_encomendas_sistema[ident_enc].produto[i].descricao, descricao_prod) == 0)
    {
      return i;
    }
    else
    {
      
    }

  }

  return -1;
}

void mergesort(Produto lista[], int esquerda, int direita)
{
  int m = (esquerda + direita) / 2;
  if (direita <= esquerda)
  {
    return;
  }
  else
  {
    
  }

  mergesort(lista, esquerda, m);
  mergesort(lista, m + 1, direita);
  merge(lista, esquerda, m, direita);
}

void merge(Produto lista[], int esquerda, int m, int direita)
{
  int i;
  int j;
  int k;
  Produto aux[10000];
  for (i = m + 1; i > esquerda; i--)
  {
    aux[i - 1] = lista[i - 1];
  }

  for (j = m; j < direita; j++)
  {
    aux[(direita + m) - j] = lista[j + 1];
  }

  for (k = esquerda; k <= direita; k++)
  {
    if (aux[j].preco < aux[i].preco)
    {
      lista[k] = aux[j--];
    }
    else
    {
      if (aux[j].preco == aux[i].preco)
      {
        if (aux[j].idp < aux[i].idp)
        {
          lista[k] = aux[j--];
        }
        else
        {
          lista[k] = aux[i++];
        }

      }
      else
      {
        lista[k] = aux[i++];
      }

    }

  }

}

