/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


typedef struct produto
{
  int id;
  char descricao[63];
  int preco;
  int peso;
  int quantidade;
} Produto;
int idp_atual = 0;
int ide_atual = 0;
Produto stock_produtos[10000];
Produto encomendas[500][200];
Produto aux[10000];
void comando_a(char descricao[], int preco, int peso, int qtd);
void comando_q(int idp, int qtd);
void comando_N();
void comando_A(int ide, int idp, int qtd);
void comando_r(int idp, int qtd);
void comando_R(int ide, int idp);
void comando_C(int ide);
void comando_p(int idp, int preco);
void comando_E(int ide, int idp);
void comando_m(int idp);
void comando_l();
void comando_L(int ide);
int peso_encomenda(int ide);
void mergesort(Produto a[], int l, int r);
void merge(Produto a[], int l, int m, int r);
int main()
{
  char c = '0';
  char descricao[63];
  int preco;
  int peso;
  int qtd;
  int idp;
  int ide;
  while (c != 'x')
  {
    c = new_sym_var(sizeof(char) * 8);
    switch (c)
    {
      case 'a':
        for (int descricao_index = 0; descricao_index < 10; descricao_index++)
      {
        descricao[descricao_index] = new_sym_var(sizeof(char) * 8);
      }

        descricao[10 - 1] = '\0';
        preco = new_sym_var(sizeof(int) * 8);
        peso = new_sym_var(sizeof(int) * 8);
        qtd = new_sym_var(sizeof(int) * 8);
        comando_a(descricao, preco, peso, qtd);
        break;

      case 'q':
        idp = new_sym_var(sizeof(int) * 8);
        qtd = new_sym_var(sizeof(int) * 8);
        comando_q(idp, qtd);
        break;

      case 'N':
        comando_N();
        break;

      case 'A':
        ide = new_sym_var(sizeof(int) * 8);
        idp = new_sym_var(sizeof(int) * 8);
        qtd = new_sym_var(sizeof(int) * 8);
        comando_A(ide, idp, qtd);
        break;

      case 'r':
        idp = new_sym_var(sizeof(int) * 8);
        qtd = new_sym_var(sizeof(int) * 8);
        comando_r(idp, qtd);
        break;

      case 'R':
        ide = new_sym_var(sizeof(int) * 8);
        idp = new_sym_var(sizeof(int) * 8);
        comando_R(ide, idp);
        break;

      case 'C':
        ide = new_sym_var(sizeof(int) * 8);
        comando_C(ide);
        break;

      case 'p':
        idp = new_sym_var(sizeof(int) * 8);
        preco = new_sym_var(sizeof(int) * 8);
        comando_p(idp, preco);
        break;

      case 'E':
        ide = new_sym_var(sizeof(int) * 8);
        idp = new_sym_var(sizeof(int) * 8);
        comando_E(ide, idp);
        break;

      case 'm':
        idp = new_sym_var(sizeof(int) * 8);
        comando_m(idp);
        break;

      case 'l':
        comando_l();
        break;

      case 'L':
        ide = new_sym_var(sizeof(int) * 8);
        comando_L(ide);
        break;

      case 'x':
        break;

    }

  }

  return 0;
}

void comando_a(char descricao[], int preco, int peso, int qtd)
{
  stock_produtos[idp_atual].id = idp_atual;
  strcpy(stock_produtos[idp_atual].descricao, descricao);
  stock_produtos[idp_atual].preco = preco;
  stock_produtos[idp_atual].peso = peso;
  stock_produtos[idp_atual].quantidade = qtd;
  printf("Novo produto %d.\n", idp_atual);
  idp_atual++;
}

void comando_q(int idp, int qtd)
{
  if (idp >= idp_atual)
  {
    {
      printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
    }
  }
  else
  {
    {
      stock_produtos[idp].quantidade += qtd;
    }
  }

}

void comando_N()
{
  printf("Nova encomenda %d.\n", ide_atual);
  ide_atual++;
}

void comando_A(int ide, int idp, int qtd)
{
  if (ide >= ide_atual)
  {
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
    }
  }
  else
  {
    if (idp >= idp_atual)
    {
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
      }
    }
    else
    {
      if (stock_produtos[idp].quantidade < qtd)
      {
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
        }
      }
      else
      {
        if ((peso_encomenda(ide) + (stock_produtos[idp].peso * qtd)) > 200)
        {
          {
            printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
          }
        }
        else
        {
          {
            int i;
            int a = 0;
            for (i = 0; encomendas[ide][i].peso != 0; i++)
            {
              if (encomendas[ide][i].id == idp)
              {
                {
                  stock_produtos[idp].quantidade -= qtd;
                  encomendas[ide][i].quantidade += qtd;
                  a = 1;
                  break;
                }
              }
              else
              {
                
              }

            }

            if (a == 0)
            {
              {
                stock_produtos[idp].quantidade -= qtd;
                encomendas[ide][i] = stock_produtos[idp];
                encomendas[ide][i].quantidade = qtd;
              }
            }
            else
            {
              
            }

          }
        }

      }

    }

  }

}

void comando_r(int idp, int qtd)
{
  if (idp >= idp_atual)
  {
    {
      printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
    }
  }
  else
  {
    if (stock_produtos[idp].quantidade < qtd)
    {
      {
        printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, idp);
      }
    }
    else
    {
      {
        stock_produtos[idp].quantidade -= qtd;
      }
    }

  }

}

void comando_R(int ide, int idp)
{
  if (ide >= ide_atual)
  {
    {
      printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
    }
  }
  else
  {
    if (idp >= idp_atual)
    {
      {
        printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
      }
    }
    else
    {
      {
        int i;
        for (i = 0; encomendas[ide][i].peso != 0; i++)
        {
          if (encomendas[ide][i].id == idp)
          {
            {
              stock_produtos[idp].quantidade += encomendas[ide][i].quantidade;
              encomendas[ide][i].quantidade = 0;
            }
          }
          else
          {
            
          }

        }

      }
    }

  }

}

void comando_C(int ide)
{
  if (ide >= ide_atual)
  {
    {
      printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
    }
  }
  else
  {
    {
      int i;
      int r = 0;
      for (i = 0; encomendas[ide][i].peso != 0; i++)
      {
        r += encomendas[ide][i].preco * encomendas[ide][i].quantidade;
      }

      printf("Custo da encomenda %d %d.\n", ide, r);
    }
  }

}

void comando_p(int idp, int preco)
{
  if (idp >= idp_atual)
  {
    {
      printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
    }
  }
  else
  {
    {
      int i;
      int j;
      stock_produtos[idp].preco = preco;
      for (i = 0; i < ide_atual; i++)
      {
        for (j = 0; encomendas[i][j].peso != 0; j++)
        {
          if (encomendas[i][j].id == idp)
          {
            {
              encomendas[i][j].preco = preco;
            }
          }
          else
          {
            
          }

        }

      }

    }
  }

}

void comando_E(int ide, int idp)
{
  if (ide >= ide_atual)
  {
    {
      printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
    }
  }
  else
  {
    if (idp >= idp_atual)
    {
      {
        printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
      }
    }
    else
    {
      {
        int i;
        int a = 0;
        for (i = 0; encomendas[ide][i].peso != 0; i++)
        {
          if (encomendas[ide][i].id == idp)
          {
            {
              printf("%s %d.\n", encomendas[ide][i].descricao, encomendas[ide][i].quantidade);
              a = 1;
              break;
            }
          }
          else
          {
            
          }

        }

        if (a == 0)
        {
          {
            printf("%s 0.\n", stock_produtos[idp].descricao);
          }
        }
        else
        {
          
        }

      }
    }

  }

}

void comando_m(int idp)
{
  if (idp >= idp_atual)
  {
    {
      printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
    }
  }
  else
  {
    {
      int i;
      int j;
      int r = -1;
      int l = idp_atual;
      for (i = 0; i < ide_atual; i++)
      {
        for (j = 0; encomendas[i][j].peso != 0; j++)
        {
          if (((encomendas[i][j].id == idp) && (encomendas[i][j].quantidade > r)) || (((encomendas[i][j].id == idp) && (encomendas[i][j].quantidade == r)) && (i < l)))
          {
            {
              r = encomendas[i][j].quantidade;
              l = i;
            }
          }
          else
          {
            
          }

        }

      }

      if (r > 0)
      {
        {
          printf("Maximo produto %d %d %d.\n", idp, l, r);
        }
      }
      else
      {
        
      }

    }
  }

}

void comando_l()
{
  int i;
  Produto k[10000] = {{0}};
  for (i = 0; i < idp_atual; i++)
  {
    k[i] = stock_produtos[i];
  }

  mergesort(k, 0, idp_atual);
  printf("Produtos\n");
  for (i = 1; i < (idp_atual + 1); i++)
  {
    printf("* %s %d %d\n", k[i].descricao, k[i].preco, k[i].quantidade);
  }

}

void comando_L(int ide)
{
  if (ide >= ide_atual)
  {
    {
      printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
    }
  }
  else
  {
    {
      int i;
      int j;
      Produto k[200] = {{0}};
      Produto a;
      for (i = 0; encomendas[ide][i].peso != 0; i++)
      {
        k[i] = encomendas[ide][i];
      }

      for (i = 0; k[i].peso != 0; i++)
      {
        for (j = i + 1; k[j].peso != 0; j++)
        {
          if (strcmp(k[i].descricao, k[j].descricao) > 0)
          {
            {
              a = k[i];
              k[i] = k[j];
              k[j] = a;
            }
          }
          else
          {
            
          }

        }

      }

      printf("Encomenda %d\n", ide);
      for (i = 0; k[i].peso != 0; i++)
      {
        if (k[i].quantidade != 0)
        {
          {
            printf("* %s %d %d\n", k[i].descricao, k[i].preco, k[i].quantidade);
          }
        }
        else
        {
          
        }

      }

    }
  }

}

int peso_encomenda(int ide)
{
  int i;
  int r = 0;
  for (i = 0; encomendas[ide][i].peso != 0; i++)
  {
    r += encomendas[ide][i].peso * encomendas[ide][i].quantidade;
  }

  return r;
}

void merge(Produto a[], int l, int m, int r)
{
  int i;
  int j;
  int k;
  for (i = m + 1; i > l; i--)
  {
    aux[i - 1] = a[i - 1];
  }

  for (j = m; j < r; j++)
  {
    aux[(r + m) - j] = a[j + 1];
  }

  for (k = l; k <= r; k++)
  {
    if ((aux[j].preco < aux[i].preco) || ((aux[j].preco == aux[i].preco) && (aux[j].id < aux[i].id)))
    {
      {
        a[k] = aux[j--];
      }
    }
    else
    {
      {
        a[k] = aux[i++];
      }
    }

  }

}

void mergesort(Produto a[], int l, int r)
{
  int m = (r + l) / 2;
  if (r <= l)
  {
    {
      return;
    }
  }
  else
  {
    
  }

  mergesort(a, l, m);
  mergesort(a, m + 1, r);
  merge(a, l, m, r);
}

