/*File generated by PreProcessor.py*/


#include "encomenda.h"
#include "constants.h"
#include <stdlib.h>
#include <stdio.h>
#include <string.h>


int nameComp(char *c1, char *c2)
{
  int lenght;
  int i;
  if (strcmp(c1, c2) < 0)
  {
    {
      lenght = strlen(c1);
    }
  }
  else
  {
    {
      lenght = strlen(c2);
    }
  }

  for (i = 0; i < lenght; i++)
  {
    if (c1[i] < c2[i])
    {
      {
        return -1;
      }
    }
    else
    {
      if (c1[i] > c2[i])
      {
        {
          return 1;
        }
      }
      else
      {
        
      }

    }

  }

  return 0;
}

void selectionSortProd(Encomenda e)
{
  int i;
  int j;
  int temp;
  Produto p;
  for (i = 0; i < (e.nProds - 1); i++)
  {
    temp = i;
    for (j = i + 1; j <= (e.nProds - 1); j++)
    {
      if (nameComp(getProdName(e.prods[j]), getProdName(e.prods[temp])) == (-1))
      {
        {
          temp = j;
        }
      }
      else
      {
        
      }

    }

    p = e.prods[i];
    e.prods[i] = e.prods[temp];
    e.prods[temp] = p;
  }

}

int prodInEnc(Encomenda e, int idp)
{
  int i;
  for (i = 0; i < e.nProds; i++)
  {
    if (getProdID(e.prods[i]) == idp)
    {
      {
        return i;
      }
    }
    else
    {
      
    }

  }

  return -1;
}

Encomenda createEncomenda(int id)
{
  Encomenda new;
  new.prods = malloc(10000 * (sizeof(Produto)));
  if (!new.prods)
  {
    {
      perror("Error of allocation in createEncomenda");
      exit(1);
    }
  }
  else
  {
    
  }

  new.weight = 0;
  new.nProds = 0;
  new.id = id;
  return new;
}

Encomenda changeProdPriceInEnc(Encomenda e, int idp, int newPrice)
{
  int pos = prodInEnc(e, idp);
  if (pos != (-1))
  {
    {
      e.prods[pos] = changePrice(e.prods[pos], newPrice);
    }
  }
  else
  {
    
  }

  return e;
}

Encomenda addEncProd(Encomenda e, Produto p)
{
  int pos = prodInEnc(e, getProdID(p));
  if (pos == (-1))
  {
    {
      e.prods[e.nProds] = p;
      e.nProds++;
    }
  }
  else
  {
    {
      e.prods[pos] = addStock(e.prods[pos], getProdStock(p));
    }
  }

  e.weight += getProdWeight(p) * getProdStock(p);
  return e;
}

int getEncWeight(Encomenda e)
{
  return e.weight;
}

void free_enco(Encomenda e)
{
  if (!e.prods)
  {
    {
      return;
    }
  }
  else
  {
    
  }

  free(e.prods);
}

Encomenda removeEncProd(Encomenda e, int idp)
{
  int pos = prodInEnc(e, idp);
  if (pos != (-1))
  {
    {
      e.weight -= getProdStock(e.prods[pos]) * getProdWeight(e.prods[pos]);
      e.prods[pos] = removeStock(e.prods[pos], getProdStock(e.prods[pos]));
    }
  }
  else
  {
    
  }

  return e;
}

int getProdStockInEnc(Encomenda e, int idp)
{
  int pos = prodInEnc(e, idp);
  if (pos != (-1))
  {
    {
      return getProdStock(e.prods[pos]);
    }
  }
  else
  {
    
  }

  return 0;
}

char *getProdNameInEnc(Encomenda e, int idp)
{
  int pos = prodInEnc(e, idp);
  return getProdName(e.prods[pos]);
}

int getEncPrice(Encomenda e)
{
  int i;
  int total = 0;
  for (i = 0; i < e.nProds; i++)
  {
    if (getProdStock(e.prods[i]) != 0)
    {
      {
        total += getProdPrice(e.prods[i]) * getProdStock(e.prods[i]);
      }
    }
    else
    {
      
    }

  }

  return total;
}

void listProd(Encomenda e)
{
  int i;
  selectionSortProd(e);
  for (i = 0; i < e.nProds; i++)
  {
    if (getProdStock(e.prods[i]) > 0)
    {
      {
        fprintf(outputFile, "* ");
        printProd(e.prods[i]);
      }
    }
    else
    {
      
    }

  }

}

