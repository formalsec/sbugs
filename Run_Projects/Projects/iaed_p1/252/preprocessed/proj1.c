/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>


typedef struct 
{
  int id;
  char descricao_prod[63];
  int preco_prod;
  int peso_prod;
  int quantidade_prod;
} produto;
typedef struct 
{
  int peso_encomenda;
  int preco_encomenda;
  int ie;
  int contador_produtos;
  produto lista_produtos_encomenda[10000];
} encomenda;
int idp = 0;
int ide = 0;
produto aux[10000];
produto aux2[10000];
produto lista_produtos[10000];
encomenda lista_encomendas[500];
void adiciona_produto(char in[1024])
{
  produto novo_produto;
  strcpy(novo_produto.descricao_prod, strtok(in, ":"));
  novo_produto.preco_prod = atoi(strtok(0, ":"));
  novo_produto.peso_prod = atoi(strtok(0, ":"));
  novo_produto.quantidade_prod = atoi(strtok(0, ":"));
  novo_produto.id = idp;
  lista_produtos[idp] = novo_produto;
  printf("Novo produto %d.\n", idp);
  idp++;
}

void adiciona_stock_produto(char in[1024])
{
  int i = atoi(strtok(in, ":"));
  int qtd = atoi(strtok(0, ":"));
  if (i > (idp - 1))
  {
    {
      printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", i);
    }
  }
  else
  {
    {
      lista_produtos[i].quantidade_prod += qtd;
    }
  }

}

void cria_encomenda()
{
  encomenda nova_encomenda;
  nova_encomenda.peso_encomenda = 0;
  nova_encomenda.preco_encomenda = 0;
  nova_encomenda.contador_produtos = 0;
  nova_encomenda.ie = ide;
  lista_encomendas[ide] = nova_encomenda;
  printf("Nova encomenda %d.\n", ide);
  ide++;
}

void adiciona_produto_encomenda(char in[1024])
{
  int id_encomenda = atoi(strtok(in, ":"));
  int id_produto = atoi(strtok(0, ":"));
  int qtd = atoi(strtok(0, ":"));
  int i;
  int flag = -1;
  encomenda a = lista_encomendas[id_encomenda];
  if (id_encomenda >= ide)
  {
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", id_produto, id_encomenda);
    }
  }
  else
  {
    if (id_produto >= idp)
    {
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", id_produto, id_encomenda);
      }
    }
    else
    {
      if (lista_produtos[id_produto].quantidade_prod < qtd)
      {
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", id_produto, id_encomenda);
        }
      }
      else
      {
        if ((a.peso_encomenda + (lista_produtos[id_produto].peso_prod * qtd)) > 200)
        {
          {
            printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", id_produto, id_encomenda);
          }
        }
        else
        {
          {
            for (i = 0; i < a.contador_produtos; i++)
            {
              if (a.lista_produtos_encomenda[i].id == id_produto)
              {
                {
                  flag = i;
                }
              }
              else
              {
                
              }

            }

            if (flag <= (-1))
            {
              {
                a.lista_produtos_encomenda[a.contador_produtos].preco_prod = lista_produtos[id_produto].preco_prod;
                a.lista_produtos_encomenda[a.contador_produtos].peso_prod = lista_produtos[id_produto].peso_prod;
                strcpy(a.lista_produtos_encomenda[a.contador_produtos].descricao_prod, lista_produtos[id_produto].descricao_prod);
                a.lista_produtos_encomenda[a.contador_produtos].id = id_produto;
                a.peso_encomenda += lista_produtos[id_produto].peso_prod * qtd;
                a.preco_encomenda += lista_produtos[id_produto].preco_prod * qtd;
                a.lista_produtos_encomenda[a.contador_produtos].quantidade_prod = qtd;
                a.contador_produtos++;
                flag = -1;
              }
            }
            else
            {
              {
                a.peso_encomenda += lista_produtos[id_produto].peso_prod * qtd;
                a.preco_encomenda += lista_produtos[id_produto].preco_prod * qtd;
                a.lista_produtos_encomenda[a.contador_produtos].quantidade_prod += qtd;
                flag = -1;
              }
            }

            lista_produtos[id_produto].quantidade_prod -= qtd;
            lista_encomendas[id_encomenda] = a;
          }
        }

      }

    }

  }

}

void remove_stock_produto(char in[1024])
{
  int ip = atoi(strtok(in, ":"));
  int qtd = atoi(strtok(0, ":"));
  if (ip > (idp - 1))
  {
    {
      printf("Impossivel remover stock do produto %d. Produto inexistente.\n", ip);
    }
  }
  else
  {
    if ((lista_produtos[ip].quantidade_prod - qtd) < 0)
    {
      {
        printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, ip);
      }
    }
    else
    {
      {
        lista_produtos[ip].quantidade_prod -= qtd;
      }
    }

  }

}

void remove_produto_encomenda(char in[1024])
{
  int ie = atoi(strtok(in, ":"));
  int ip = atoi(strtok(0, ":"));
  int i;
  int j;
  encomenda a = lista_encomendas[ie];
  int flag = -1;
  if (ie > (ide - 1))
  {
    {
      printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", ip, ie);
    }
  }
  else
  {
    if (ip > (idp - 1))
    {
      {
        printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", ip, ie);
      }
    }
    else
    {
      {
        for (i = 0; i < a.contador_produtos; i++)
        {
          if (a.lista_produtos_encomenda[i].id == ip)
          {
            {
              flag = i;
            }
          }
          else
          {
            
          }

        }

        if (flag != (-1))
        {
          {
            a.peso_encomenda -= a.lista_produtos_encomenda[ip].peso_prod * a.lista_produtos_encomenda[ip].quantidade_prod;
            a.preco_encomenda -= a.lista_produtos_encomenda[ip].preco_prod * a.lista_produtos_encomenda[ip].quantidade_prod;
            lista_produtos[ip].quantidade_prod += a.lista_produtos_encomenda[ip].quantidade_prod;
            for (j = flag; j < a.contador_produtos; j++)
            {
              a.lista_produtos_encomenda[j] = a.lista_produtos_encomenda[j + 1];
            }

            a.contador_produtos--;
            flag = -1;
            lista_encomendas[ie] = a;
          }
        }
        else
        {
          
        }

      }
    }

  }

}

void calcula_custo_encomenda(char in[1024])
{
  int id_encomenda = atoi(in);
  if (id_encomenda > (ide - 1))
  {
    {
      printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", id_encomenda);
    }
  }
  else
  {
    {
      printf("Custo da encomenda %d %d.\n", id_encomenda, lista_encomendas[id_encomenda].preco_encomenda);
    }
  }

}

void altera_preco_produto(char in[1024])
{
  int ip = atoi(strtok(in, ":"));
  int preco = atoi(strtok(0, ":"));
  int i;
  int e;
  if (ip > (idp - 1))
  {
    {
      printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", ip);
    }
  }
  else
  {
    {
      lista_produtos[ip].preco_prod = preco;
      for (i = 0; i < ide; i++)
      {
        for (e = 0; e < lista_encomendas[i].contador_produtos; e++)
        {
          if (lista_encomendas[i].lista_produtos_encomenda[e].id == ip)
          {
            {
              lista_encomendas[i].lista_produtos_encomenda[e].preco_prod = preco;
              break;
            }
          }
          else
          {
            
          }

        }

      }

    }
  }

}

void lista_desc_quant(char in[1024])
{
  int ie = atoi(strtok(in, ":"));
  int ip = atoi(strtok(0, ":"));
  if (ie > (ide - 1))
  {
    {
      printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ie);
    }
  }
  else
  {
    if (ip > (idp - 1))
    {
      {
        printf("Impossivel listar produto %d. Produto inexistente.\n", ip);
      }
    }
    else
    {
      {
        printf("%s %d.\n", lista_encomendas[ie].lista_produtos_encomenda[ip].descricao_prod, lista_encomendas[ie].lista_produtos_encomenda[ip].quantidade_prod);
      }
    }

  }

}

void lista_ide_prod_max(char in[1024])
{
  int ip = atoi(in);
  int i;
  int e;
  int ie = 0;
  int maior = 0;
  if (ip > (idp - 1))
  {
    {
      printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", ip);
    }
  }
  else
  {
    {
      for (i = 0; i < ide; i++)
      {
        for (e = 0; e < lista_encomendas[i].contador_produtos; e++)
        {
          if (ip == lista_encomendas[i].lista_produtos_encomenda[e].id)
          {
            {
              if (lista_encomendas[i].lista_produtos_encomenda[e].quantidade_prod > maior)
              {
                {
                  maior = lista_encomendas[i].lista_produtos_encomenda[e].quantidade_prod;
                  if (maior == lista_encomendas[i].lista_produtos_encomenda[e].quantidade_prod)
                  {
                    {
                      ie = i;
                    }
                  }
                  else
                  {
                    
                  }

                }
              }
              else
              {
                
              }

            }
          }
          else
          {
            
          }

        }

      }

      if (ip == lista_encomendas[ie].lista_produtos_encomenda[ip].id)
      {
        {
          printf("Maximo produto %d %d %d.\n", ip, ie, maior);
        }
      }
      else
      {
        
      }

    }
  }

}

void merge(produto a[], int l, int m, int r)
{
  int i;
  int j;
  int k;
  for (i = m + 1; i > l; i--)
    aux[i - 1] = a[i - 1];

  for (j = m; j < r; j++)
    aux[(r + m) - j] = a[j + 1];

  for (k = l; k <= r; k++)
    if ((aux[j].preco_prod < aux[i].preco_prod) || (i > m))
  {
    a[k] = aux[j--];
  }
  else
  {
    a[k] = aux[i++];
  }


}

void mergesort(produto a[], int l, int r)
{
  int m = (r + l) / 2;
  if (r <= l)
  {
    return;
  }
  else
  {
    
  }

  mergesort(a, l, m);
  mergesort(a, m + 1, r);
  merge(a, l, m, r);
}

void ordena_produtos_preco()
{
  int i;
  int e;
  produto lista_auxiliar[10000];
  for (i = 0; i < idp; i++)
  {
    lista_auxiliar[i] = lista_produtos[i];
  }

  mergesort(lista_auxiliar, 0, idp - 1);
  printf("Produtos\n");
  for (e = 0; e < idp; e++)
  {
    printf("* %s %d %d\n", lista_auxiliar[e].descricao_prod, lista_auxiliar[e].preco_prod, lista_auxiliar[e].quantidade_prod);
  }

}

void merge2(produto a[], int l, int m, int r)
{
  int i;
  int j;
  int k;
  for (i = m + 1; i > l; i--)
    aux2[i - 1] = a[i - 1];

  for (j = m; j < r; j++)
    aux2[(r + m) - j] = a[j + 1];

  for (k = l; k <= r; k++)
    if ((strcmp(aux2[j].descricao_prod, aux2[i].descricao_prod) < 0) || (i > m))
  {
    a[k] = aux2[j--];
  }
  else
  {
    a[k] = aux2[i++];
  }


}

void mergesort2(produto a[], int l, int r)
{
  int m = (r + l) / 2;
  if (r <= l)
  {
    return;
  }
  else
  {
    
  }

  mergesort2(a, l, m);
  mergesort2(a, m + 1, r);
  merge2(a, l, m, r);
}

void ordena_enc_alfa(char in[1024])
{
  int ie = atoi(in);
  int i;
  int e;
  produto lista_string[10000];
  if (ie >= ide)
  {
    {
      printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ie);
    }
  }
  else
  {
    {
      for (i = 0; i < idp; i++)
      {
        lista_string[i] = lista_encomendas[ie].lista_produtos_encomenda[i];
      }

      mergesort2(lista_string, 0, idp - 1);
      printf("Encomenda %d\n", ie);
      for (e = 0; e < idp; e++)
      {
        if (lista_string[e].preco_prod != 0)
        {
          {
            printf("* %s %d %d\n", lista_string[e].descricao_prod, lista_string[e].preco_prod, lista_string[e].quantidade_prod);
          }
        }
        else
        {
          
        }

      }

    }
  }

}

int main()
{
  char in[1024];
  while (fgets(in, 1024, stdin))
  {
    switch (in[0])
    {
      case 'a':
        adiciona_produto(&in[2]);
        break;

      case 'q':
        adiciona_stock_produto(&in[2]);
        break;

      case 'N':
        cria_encomenda();
        break;

      case 'A':
        adiciona_produto_encomenda(&in[2]);
        break;

      case 'r':
        remove_stock_produto(&in[2]);
        break;

      case 'R':
        remove_produto_encomenda(&in[2]);
        break;

      case 'C':
        calcula_custo_encomenda(&in[2]);
        break;

      case 'p':
        altera_preco_produto(&in[2]);
        break;

      case 'E':
        lista_desc_quant(&in[2]);
        break;

      case 'm':
        lista_ide_prod_max(&in[2]);
        break;

      case 'l':
        ordena_produtos_preco();
        break;

      case 'L':
        ordena_enc_alfa(&in[2]);
        break;

      case 'x':
        return 0;

    }

  }

  return 0;
}

