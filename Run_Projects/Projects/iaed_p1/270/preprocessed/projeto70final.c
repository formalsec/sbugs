/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


typedef struct 
{
  int identificador;
  char descricao[64];
  int preco;
  int peso;
  int quantidade;
} PRODUTO;
typedef struct 
{
  int identificador;
  int produtos[10000];
  int peso;
  int preco;
} ENCOMENDA;
PRODUTO sistema[10000];
int idp = -1;
ENCOMENDA sistema_encomendas[500];
int ide = -1;
void cria_produto(char descricao[64], int preco, int peso, int quantidade);
void adiciona_stock(int i_prod, int quantidade);
void cria_encomenda();
void adiciona_a_encomenda(int i_encomenda, int i_prod, int quantidade);
void remove_stock(int i_prod, int quantidade);
void remove_produto(int i_encomenda, int i_prod);
void calcula_custo(int i_encomenda);
void altera_preco(int i_prod, int preco);
void lista_produto(int i_encomenda, int i_prod);
void produto_mais_pedido(int i_prod);
void ordena_sistema();
void mergesort(PRODUTO a[], int l, int r);
void merge(PRODUTO a[], int l, int m, int r);
void ordena_encomenda(int i_encomenda);
void mergesort2(PRODUTO a[], int l, int r);
void merge2(PRODUTO a[], int l, int m, int r);
int main()
{
  char c;
  char descricao[64];
  int preco;
  int peso;
  int quantidade;
  int i_prod;
  int i_encomenda;
  while (1)
  {
    switch (c = getchar())
    {
      case 'a':
        for (int descricao_index = 0; descricao_index < 10; descricao_index++)
      {
        descricao[descricao_index] = new_sym_var(sizeof(char) * 8);
      }

        descricao[10 - 1] = '\0';
        preco = new_sym_var(sizeof(int) * 8);
        peso = new_sym_var(sizeof(int) * 8);
        quantidade = new_sym_var(sizeof(int) * 8);
        cria_produto(descricao, preco, peso, quantidade);
        break;

      case 'q':
        i_prod = new_sym_var(sizeof(int) * 8);
        quantidade = new_sym_var(sizeof(int) * 8);
        adiciona_stock(i_prod, quantidade);
        break;

      case 'N':
        cria_encomenda();
        break;

      case 'A':
        i_encomenda = new_sym_var(sizeof(int) * 8);
        i_prod = new_sym_var(sizeof(int) * 8);
        quantidade = new_sym_var(sizeof(int) * 8);
        adiciona_a_encomenda(i_encomenda, i_prod, quantidade);
        break;

      case 'r':
        i_prod = new_sym_var(sizeof(int) * 8);
        quantidade = new_sym_var(sizeof(int) * 8);
        remove_stock(i_prod, quantidade);
        break;

      case 'R':
        i_encomenda = new_sym_var(sizeof(int) * 8);
        i_prod = new_sym_var(sizeof(int) * 8);
        remove_produto(i_encomenda, i_prod);
        break;

      case 'C':
        i_encomenda = new_sym_var(sizeof(int) * 8);
        calcula_custo(i_encomenda);
        break;

      case 'p':
        i_prod = new_sym_var(sizeof(int) * 8);
        preco = new_sym_var(sizeof(int) * 8);
        altera_preco(i_prod, preco);
        break;

      case 'E':
        i_encomenda = new_sym_var(sizeof(int) * 8);
        i_prod = new_sym_var(sizeof(int) * 8);
        lista_produto(i_encomenda, i_prod);
        break;

      case 'm':
        i_prod = new_sym_var(sizeof(int) * 8);
        produto_mais_pedido(i_prod);
        break;

      case 'l':
        ordena_sistema();
        break;

      case 'L':
        i_encomenda = new_sym_var(sizeof(int) * 8);
        ordena_encomenda(i_encomenda);
        break;

      case 'x':
        return 0;
        break;

    }

  }

  return 0;
}

void cria_produto(char descricao[64], int preco, int peso, int quantidade)
{
  PRODUTO prod;
  idp++;
  strcpy(prod.descricao, descricao);
  prod.preco = preco;
  prod.peso = peso;
  prod.quantidade = quantidade;
  prod.identificador = idp;
  sistema[idp] = prod;
  printf("Novo produto %d.\n", idp);
}

void adiciona_stock(int i_prod, int quantidade)
{
  if (i_prod > idp)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", i_prod);
  }
  else
  {
    
  }

  sistema[i_prod].quantidade += quantidade;
}

void cria_encomenda()
{
  ENCOMENDA enc;
  int i;
  ide++;
  for (i = 0; i < 10000; i++)
  {
    enc.produtos[i] = 0;
  }

  enc.peso = 0;
  enc.preco = 0;
  sistema_encomendas[ide] = enc;
  printf("Nova encomenda %d.\n", ide);
}

void adiciona_a_encomenda(int i_encomenda, int i_prod, int quantidade)
{
  if (i_encomenda > ide)
  {
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", i_prod, i_encomenda);
      return;
    }
  }
  else
  {
    
  }

  if (i_prod > idp)
  {
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", i_prod, i_encomenda);
      return;
    }
  }
  else
  {
    
  }

  if (quantidade > sistema[i_prod].quantidade)
  {
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", i_prod, i_encomenda);
      return;
    }
  }
  else
  {
    
  }

  if ((sistema_encomendas[i_encomenda].peso + (quantidade * sistema[i_prod].peso)) > 200)
  {
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", i_prod, i_encomenda);
      return;
    }
  }
  else
  {
    
  }

  sistema_encomendas[i_encomenda].peso += quantidade * sistema[i_prod].peso;
  sistema_encomendas[i_encomenda].preco += quantidade * sistema[i_prod].preco;
  sistema_encomendas[i_encomenda].produtos[i_prod] += quantidade;
  remove_stock(i_prod, quantidade);
}

void remove_stock(int i_prod, int quantidade)
{
  if (i_prod > idp)
  {
    {
      printf("Impossivel remover stock do produto %d. Produto inexistente.\n", i_prod);
      return;
    }
  }
  else
  {
    
  }

  if (sistema[i_prod].quantidade < quantidade)
  {
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", quantidade, i_prod);
      return;
    }
  }
  else
  {
    
  }

  sistema[i_prod].quantidade -= quantidade;
}

void remove_produto(int i_encomenda, int i_prod)
{
  if (i_encomenda > ide)
  {
    {
      printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", i_prod, i_encomenda);
      return;
    }
  }
  else
  {
    
  }

  if (i_prod > idp)
  {
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", i_prod, i_encomenda);
      return;
    }
  }
  else
  {
    
  }

  if (sistema_encomendas[i_encomenda].produtos[i_prod] == 0)
  {
    {
      return;
    }
  }
  else
  {
    
  }

  sistema_encomendas[i_encomenda].preco -= sistema[i_prod].preco * sistema_encomendas[i_encomenda].produtos[i_prod];
  sistema[i_prod].quantidade += sistema_encomendas[i_encomenda].produtos[i_prod];
  sistema_encomendas[i_encomenda].peso -= sistema[i_prod].peso * sistema_encomendas[i_encomenda].produtos[i_prod];
  sistema_encomendas[i_encomenda].produtos[i_prod] = 0;
}

void calcula_custo(int i_encomenda)
{
  if (i_encomenda > ide)
  {
    {
      printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", i_encomenda);
      return;
    }
  }
  else
  {
    
  }

  printf("Custo da encomenda %d %d.\n", i_encomenda, sistema_encomendas[i_encomenda].preco);
}

void altera_preco(int i_prod, int preco)
{
  int i;
  if (i_prod > idp)
  {
    {
      printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", i_prod);
      return;
    }
  }
  else
  {
    
  }

  for (i = 0; i <= ide; i++)
    if (sistema_encomendas[i].produtos[i_prod] != 0)
  {
    {
      sistema_encomendas[i].preco += sistema_encomendas[i].produtos[i_prod] * (preco - sistema[i_prod].preco);
    }
  }
  else
  {
    
  }


  sistema[i_prod].preco = preco;
}

void lista_produto(int i_encomenda, int i_prod)
{
  if (ide < i_encomenda)
  {
    {
      printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", i_encomenda);
      return;
    }
  }
  else
  {
    
  }

  if (idp < i_prod)
  {
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", i_prod);
      return;
    }
  }
  else
  {
    
  }

  printf("%s %d.\n", sistema[i_prod].descricao, sistema_encomendas[i_encomenda].produtos[i_prod]);
}

void produto_mais_pedido(int i_prod)
{
  int i_encomenda;
  int quantidade_max = 0;
  int i;
  if (i_prod > idp)
  {
    {
      printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", i_prod);
      return;
    }
  }
  else
  {
    
  }

  if (ide == (-1))
  {
    return;
  }
  else
  {
    
  }

  for (i = 0; i <= ide; i++)
  {
    if (sistema_encomendas[i].produtos[i_prod] > quantidade_max)
    {
      {
        quantidade_max = sistema_encomendas[i].produtos[i_prod];
        i_encomenda = i;
      }
    }
    else
    {
      
    }

  }

  if (quantidade_max == 0)
  {
    return;
  }
  else
  {
    
  }

  printf("Maximo produto %d %d %d.\n", i_prod, i_encomenda, quantidade_max);
}

void ordena_sistema()
{
  PRODUTO sist_cpy[10000];
  int i;
  for (i = 0; i <= idp; i++)
    sist_cpy[i] = sistema[i];

  mergesort(sist_cpy, 0, idp);
  printf("Produtos\n");
  for (i = 0; i <= idp; i++)
  {
    printf("* %s %d %d\n", sist_cpy[i].descricao, sist_cpy[i].preco, sist_cpy[i].quantidade);
  }

}

void merge(PRODUTO a[], int l, int m, int r)
{
  int i;
  int j;
  int k;
  int n1 = (m - l) + 1;
  int n2 = r - m;
  PRODUTO L[10000];
  PRODUTO R[10000];
  for (i = 0; i < n1; i++)
    L[i] = a[l + i];

  for (j = 0; j < n2; j++)
    R[j] = a[(m + 1) + j];

  i = 0;
  j = 0;
  k = l;
  while ((i < n1) && (j < n2))
  {
    if (L[i].preco <= R[j].preco)
    {
      {
        a[k] = L[i++];
      }
    }
    else
    {
      {
        a[k] = R[j++];
      }
    }

    k++;
  }

  while (i < n1)
  {
    a[k] = L[i++];
    k++;
  }

  while (j < n2)
  {
    a[k] = R[j++];
    k++;
  }

}

void mergesort(PRODUTO arr[], int l, int r)
{
  if (l < r)
  {
    {
      int m = l + ((r - l) / 2);
      mergesort(arr, l, m);
      mergesort(arr, m + 1, r);
      merge(arr, l, m, r);
    }
  }
  else
  {
    
  }

}

void ordena_encomenda(int i_encomenda)
{
  PRODUTO enc_cpy[10000];
  int i;
  int counter = 0;
  if (i_encomenda > ide)
  {
    {
      printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", i_encomenda);
      return;
    }
  }
  else
  {
    
  }

  printf("Encomenda %d\n", i_encomenda);
  for (i = 0; i <= idp; i++)
  {
    if (sistema_encomendas[i_encomenda].produtos[i] != 0)
    {
      {
        enc_cpy[counter] = sistema[i];
        enc_cpy[counter].quantidade = sistema_encomendas[i_encomenda].produtos[i];
        counter += 1;
      }
    }
    else
    {
      
    }

  }

  mergesort2(enc_cpy, 0, counter - 1);
  for (i = 0; i < counter; i++)
  {
    printf("* %s %d %d\n", enc_cpy[i].descricao, enc_cpy[i].preco, enc_cpy[i].quantidade);
  }

}

void merge2(PRODUTO a[], int l, int m, int r)
{
  int i;
  int j;
  int k;
  int n1 = (m - l) + 1;
  int n2 = r - m;
  PRODUTO L[10000];
  PRODUTO R[10000];
  for (i = 0; i < n1; i++)
    L[i] = a[l + i];

  for (j = 0; j < n2; j++)
    R[j] = a[(m + 1) + j];

  i = 0;
  j = 0;
  k = l;
  while ((i < n1) && (j < n2))
  {
    if (strcmp(L[i].descricao, R[j].descricao) <= 0)
    {
      a[k] = L[i++];
    }
    else
    {
      a[k] = R[j++];
    }

    k++;
  }

  while (i < n1)
  {
    a[k] = L[i++];
    k++;
  }

  while (j < n2)
  {
    a[k] = R[j++];
    k++;
  }

}

void mergesort2(PRODUTO arr[], int l, int r)
{
  if (l < r)
  {
    {
      int m = l + ((r - l) / 2);
      mergesort2(arr, l, m);
      mergesort2(arr, m + 1, r);
      merge2(arr, l, m, r);
    }
  }
  else
  {
    
  }

}

