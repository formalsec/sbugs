/*File generated by PreProcessor.py*/


#include "all.h"
#include "constants.h"
#include "Sort.h"
#include <stdio.h>
#include <stdlib.h>


extern prod prod_list[];
extern ord ord_list[];
int idp = 0;
int ide = 0;
int idp_list[10000];
int get_error(int ide2, int idp2, long int qt)
{
  if (ide2 >= ide)
  {
    return 1;
  }
  else
  {
    if (idp2 >= idp)
    {
      return 2;
    }
    else
    {
      if (qt > prod_list[idp2].qt)
      {
        return 3;
      }
      else
      {
        {
          long int weight = (qt * prod_list[idp2].weight) + ord_list[ide2].weight;
          if (weight > 200)
          {
            return 4;
          }
          else
          {
            return 0;
          }

        }
      }

    }

  }

}

long int get_prod_qt(int idp2, ord *order)
{
  return order->prod_list[idp2];
}

long int calc_cost(ord *order)
{
  int i;
  long int cost = 0;
  for (i = 0; i < 10000; i++)
  {
    prod *p = &prod_list[i];
    cost += p->price * order->prod_list[i];
  }

  return cost;
}

void add_prod_sys()
{
  prod p;
  idp_list[idp] = idp;
  for (int p_index = 0; p_index < 10; p_index++)
  {
    p.desc[p_index] = new_sym_var(sizeof(char) * 8);
  }

  p.desc[10 - 1] = '\0';
  p.price = new_sym_var(sizeof(long int) * 8);
  p.weight = new_sym_var(sizeof(long int) * 8);
  p.qt = new_sym_var(sizeof(long int) * 8);
  prod_list[idp] = p;
  printf("Novo produto %d.\n", idp++);
}

void add_stock()
{
  int idp2;
  long int qt;
  idp2 = new_sym_var(sizeof(int) * 8);
  qt = new_sym_var(sizeof(long int) * 8);
  if (idp2 >= idp)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp2);
  }
  else
  {
    prod_list[idp2].qt += qt;
  }

}

void add_order()
{
  int i;
  ord o;
  o.len = 0;
  o.weight = 0;
  for (i = 0; i < 10000; i++)
    o.prod_list[i] = 0;

  ord_list[ide] = o;
  printf("Nova encomenda %d.\n", ide++);
}

void add_prod_ord()
{
  int ide2;
  int idp2;
  long int qt;
  int error;
  ide2 = new_sym_var(sizeof(int) * 8);
  idp2 = new_sym_var(sizeof(int) * 8);
  qt = new_sym_var(sizeof(long int) * 8);
  error = get_error(ide2, idp2, qt);
  if (error)
  {
    {
      printf("Impossivel adicionar produto %d a encomenda %d. ", idp2, ide2);
      switch (error)
      {
        case 1:
          printf("Encomenda inexistente.");
          break;

        case 2:
          printf("Produto inexistente.");
          break;

        case 3:
          printf("Quantidade em stock insuficiente.");
          break;

        case 4:
          printf("Peso da encomenda excede o maximo de 200.");
          break;

      }

      printf("\n");
    }
  }
  else
  {
    {
      ord *order = &ord_list[ide2];
      prod *product = &prod_list[idp2];
      if (order->prod_list[idp2] == 0)
      {
        order->len++;
      }
      else
      {
        
      }

      order->prod_list[idp2] += (int) qt;
      product->qt -= qt;
      order->weight += ((int) qt) * product->weight;
    }
  }

}

void remove_stock()
{
  int idp2;
  long int qt;
  prod *p;
  idp2 = new_sym_var(sizeof(int) * 8);
  qt = new_sym_var(sizeof(long int) * 8);
  p = &prod_list[idp2];
  if (idp2 >= idp)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp2);
  }
  else
  {
    if (qt > p->qt)
    {
      printf("Impossivel remover %ld unidades do produto %d do stock. Quantidade insuficiente.\n", qt, idp2);
    }
    else
    {
      p->qt -= qt;
    }

  }

}

void remove_prod()
{
  int ide2;
  int idp2;
  ord *o;
  prod *p;
  ide2 = new_sym_var(sizeof(int) * 8);
  idp2 = new_sym_var(sizeof(int) * 8);
  if (ide2 >= ide)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp2, ide2);
  }
  else
  {
    if (idp2 >= idp)
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp2, ide2);
    }
    else
    {
      {
        long int qt;
        o = &ord_list[ide2];
        p = &prod_list[idp2];
        if (o->prod_list[idp2] == 0)
        {
          return;
        }
        else
        {
          
        }

        qt = get_prod_qt(idp2, o);
        p->qt += qt;
        o->prod_list[idp2] = 0;
        o->len--;
        o->weight -= qt * p->weight;
      }
    }

  }

}

void order_cost()
{
  int ide2;
  ide2 = new_sym_var(sizeof(int) * 8);
  if (ide2 >= ide)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.", ide2);
  }
  else
  {
    printf("Custo da encomenda %d %ld.", ide2, calc_cost(&ord_list[ide2]));
  }

  printf("\n");
}

void change_price()
{
  int idp2;
  long int price;
  idp2 = new_sym_var(sizeof(int) * 8);
  price = new_sym_var(sizeof(long int) * 8);
  if (idp2 >= idp)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp2);
  }
  else
  {
    prod_list[idp2].price = price;
  }

}

void show_prod()
{
  int ide2;
  int idp2;
  ide2 = new_sym_var(sizeof(int) * 8);
  idp2 = new_sym_var(sizeof(int) * 8);
  if (ide2 >= ide)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.", ide2);
  }
  else
  {
    if (idp2 >= idp)
    {
      printf("Impossivel listar produto %d. Produto inexistente.", idp2);
    }
    else
    {
      {
        printf("%s %d.", prod_list[idp2].desc, ord_list[ide2].prod_list[idp2]);
      }
    }

  }

  printf("\n");
}

void most_wanted()
{
  int idp2;
  idp2 = new_sym_var(sizeof(int) * 8);
  if (idp2 >= idp)
  {
    {
      printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp2);
      return;
    }
  }
  else
  {
    
  }

  if (ide)
  {
    {
      int maior = 0;
      long int qt = ord_list[0].prod_list[idp2];
      int i;
      for (i = 1; i < ide; i++)
      {
        if (get_prod_qt(idp2, &ord_list[i]) > qt)
        {
          {
            maior = i;
            qt = ord_list[i].prod_list[idp2];
          }
        }
        else
        {
          
        }

      }

      if (qt > 0)
      {
        printf("Maximo produto %d %d %ld.\n", idp2, maior, qt);
      }
      else
      {
        
      }

    }
  }
  else
  {
    
  }

}

void list_prod_sys()
{
  int i;
  printf("Produtos\n");
  radixsort(idp_list, idp);
  for (i = 0; i < idp; i++)
  {
    prod *p = &prod_list[idp_list[i]];
    printf("* %s %ld %ld\n", p->desc, p->price, p->qt);
    idp_list[i] = i;
  }

}

void list_prod_ord()
{
  int ide2;
  int i;
  int n = 0;
  int *out;
  ord *o;
  ide2 = new_sym_var(sizeof(int) * 8);
  if (ide2 >= ide)
  {
    {
      printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide2);
      return;
    }
  }
  else
  {
    
  }

  printf("Encomenda %d\n", ide2);
  o = &ord_list[ide2];
  if (o->len == 0)
  {
    return;
  }
  else
  {
    
  }

  out = malloc(10000 * (sizeof(int)));
  for (i = 0; i < 10000; i++)
    if (o->prod_list[i])
  {
    *(out + (n++)) = i;
  }
  else
  {
    
  }


  heapsort(out, n - 1);
  for (i = 0; i < n; i++)
  {
    printf("* %s %ld %d\n", prod_list[out[i]].desc, prod_list[out[i]].price, o->prod_list[out[i]]);
  }

  free(out);
}

