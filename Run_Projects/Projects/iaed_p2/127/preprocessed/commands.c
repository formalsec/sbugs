/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "games.h"
#include "teams.h"
#include "commands.h"


link *command_a(link *game_list, link *game_tab, team **teams, long int *cont, long int *max_len)
{
  int score1;
  int score2;
  link node;
  game *new_game;
  link ptr_game;
  team *ptr_team1;
  team *ptr_team2;
  char name[1024];
  char team1[1024];
  char team2[1024];
  (*cont)++;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  for (int team1_index = 0; team1_index < 10; team1_index++)
  {
    team1[team1_index] = new_sym_var(sizeof(char) * 8);
  }

  team1[10 - 1] = '\0';
  for (int team2_index = 0; team2_index < 10; team2_index++)
  {
    team2[team2_index] = new_sym_var(sizeof(char) * 8);
  }

  team2[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  ptr_game = search_g(name, game_tab, *max_len);
  ptr_team1 = search_t(team1, teams, *(max_len + 2));
  ptr_team2 = search_t(team2, teams, *(max_len + 2));
  if (ptr_game != 0)
  {
    {
      printf("%ld Jogo existente.\n", *cont);
      return game_tab;
    }
  }
  else
  {
    if ((ptr_team1 == 0) || (ptr_team2 == 0))
    {
      {
        printf("%ld Equipa inexistente.\n", *cont);
        return game_tab;
      }
    }
    else
    {
      {
        if (score1 > score2)
        {
          {
            ptr_team1->nr_wins++;
          }
        }
        else
        {
          if (score2 > score1)
          {
            {
              ptr_team2->nr_wins++;
            }
          }
          else
          {
            
          }

        }

        new_game = create_game(name, ptr_team1->name, ptr_team2->name, score1, score2);
        node = push(game_list, new_game);
        return add_game_to_table(game_tab, node, max_len);
      }
    }

  }

}

team **command_A(team **teams, team **last_team, long int *cont, long int *max_len)
{
  char name[1024];
  team *new_team;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  (*cont)++;
  if (search_t(name, teams, *(max_len + 2)) == 0)
  {
    {
      new_team = create_team(name);
      new_team->next = *last_team;
      *last_team = new_team;
      return add_team_to_table(teams, new_team, max_len);
    }
  }
  else
  {
    {
      printf("%ld Equipa existente.\n", *cont);
      return teams;
    }
  }

}

void command_l(link *game_list, long int *cont)
{
  link list;
  (*cont)++;
  for (list = *(game_list + 1); list != 0; list = list->prev)
  {
    game *game = list->game;
    printf("%ld %s %s %s %d %d\n", *cont, game->name, game->team1, game->team2, game->score_t1, game->score_t2);
  }

}

void command_p(link *game_tab, long int *cont, long int m)
{
  char name[1024];
  link game_node;
  game *game;
  (*cont)++;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  game_node = search_g(name, game_tab, m);
  if (game_node == 0)
  {
    printf("%ld Jogo inexistente.\n", *cont);
  }
  else
  {
    {
      game = game_node->game;
      printf("%ld %s %s %s %d %d\n", *cont, name, game->team1, game->team2, game->score_t1, game->score_t2);
    }
  }

}

void command_P(team **teams_tab, long int *cont, long int m)
{
  char name[1024];
  team *team;
  (*cont)++;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  team = search_t(name, teams_tab, m);
  if (team == 0)
  {
    printf("%ld Equipa inexistente.\n", *cont);
  }
  else
  {
    printf("%ld %s %ld\n", *cont, name, team->nr_wins);
  }

}

void command_s(link *game_t, team **teams_t, long int *cont, long int *max_len)
{
  char name[1024];
  int sc1;
  int sc2;
  link game_node;
  game *game;
  team *t1;
  team *t2;
  (*cont)++;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  sc1 = new_sym_var(sizeof(int) * 8);
  sc2 = new_sym_var(sizeof(int) * 8);
  game_node = search_g(name, game_t, *max_len);
  if (game_node == 0)
  {
    printf("%ld Jogo inexistente.\n", *cont);
  }
  else
  {
    {
      game = game_node->game;
      t1 = search_t(game->team1, teams_t, *(max_len + 2));
      t2 = search_t(game->team2, teams_t, *(max_len + 2));
      if (sc1 > sc2)
      {
        {
          if (game->score_t1 < game->score_t2)
          {
            {
              t1->nr_wins++;
              t2->nr_wins--;
            }
          }
          else
          {
            if (game->score_t1 == game->score_t2)
            {
              t1->nr_wins++;
            }
            else
            {
              
            }

          }

        }
      }
      else
      {
        if (sc1 < sc2)
        {
          {
            if (game->score_t1 > game->score_t2)
            {
              {
                t1->nr_wins--;
                t2->nr_wins++;
              }
            }
            else
            {
              if (game->score_t1 == game->score_t2)
              {
                t2->nr_wins++;
              }
              else
              {
                
              }

            }

          }
        }
        else
        {
          {
            if (game->score_t1 > game->score_t2)
            {
              t1->nr_wins--;
            }
            else
            {
              if (game->score_t1 < game->score_t2)
              {
                t2->nr_wins--;
              }
              else
              {
                
              }

            }

          }
        }

      }

      game->score_t1 = sc1;
      game->score_t2 = sc2;
    }
  }

}

void delete_game(link *game_list, link *game_tab, team **teams_tab, long int node_ptr, long int *max_len)
{
  link *game_ptr;
  game *game;
  team *ptr_team1;
  team *ptr_team2;
  game_ptr = game_tab + node_ptr;
  game = (*game_ptr)->game;
  if (game->score_t1 > game->score_t2)
  {
    {
      ptr_team1 = search_t(game->team1, teams_tab, *(max_len + 2));
      ptr_team1->nr_wins--;
    }
  }
  else
  {
    if (game->score_t1 < game->score_t2)
    {
      {
        ptr_team2 = search_t(game->team2, teams_tab, *(max_len + 2));
        ptr_team2->nr_wins--;
      }
    }
    else
    {
      
    }

  }

  delete_el(game_list, *game_ptr);
  *game_ptr = 0;
  (*(max_len + 1))--;
  rearrange_tab_g(game_tab, node_ptr, max_len);
}

void command_r(link *game_list, link *game_tab, team **teams_tab, long int *cont, long int *max_len)
{
  char name[1024];
  long int node_ptr;
  (*cont)++;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  node_ptr = search_aux(name, game_tab, *max_len);
  if (node_ptr == (-1))
  {
    printf("%ld Jogo inexistente.\n", *cont);
  }
  else
  {
    {
      delete_game(game_list, game_tab, teams_tab, node_ptr, max_len);
    }
  }

}

int comp_strings(const void *str1, const void *str2)
{
  const char **p_str1 = (const char **) str1;
  const char **p_str2 = (const char **) str2;
  return strcmp(*p_str1, *p_str2);
}

void print_list(char **strs, long int len, long int nr_wins, long int cont)
{
  long int i;
  printf("%ld Melhores %ld\n", cont, nr_wins);
  for (i = 0; i < len; i++)
  {
    printf("%ld * %s\n", cont, *(strs + i));
  }

}

long int winner_list(char **win_list, team *last_team, long int *max_wins)
{
  long int c = 0;
  team *t;
  team *prev;
  prev = last_team;
  *max_wins = last_team->nr_wins;
  for (t = last_team; t != 0; t = t->next)
  {
    if (t->nr_wins > prev->nr_wins)
    {
      {
        *win_list = t->name;
        *max_wins = t->nr_wins;
        prev = t;
        c = 1;
      }
    }
    else
    {
      if (t->nr_wins == prev->nr_wins)
      {
        {
          *(win_list + c) = t->name;
          prev = t;
          c++;
        }
      }
      else
      {
        
      }

    }

  }

  free(t);
  return c;
}

void command_g(team *last_team, long int *cont, long int *max_len)
{
  long int c;
  long int max_wins = 0;
  char **aux_tab = malloc((sizeof(char *)) * (*(max_len + 3)));
  (*cont)++;
  if ((*(max_len + 3)) != 0)
  {
    {
      c = winner_list(aux_tab, last_team, &max_wins);
      qsort(aux_tab, c, sizeof(char *), comp_strings);
      print_list(aux_tab, c, max_wins, *cont);
    }
  }
  else
  {
    
  }

  free(aux_tab);
}

