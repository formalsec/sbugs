/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "teams.h"
#include "games.h"
#include "stackgames.h"
#include "besteams.h"
#include "shared.h"


void add_team(teams **lst_teams, int nl)
{
  char name_aux[1024];
  for (int name_aux_index = 0; name_aux_index < 10; name_aux_index++)
  {
    name_aux[name_aux_index] = new_sym_var(sizeof(char) * 8);
  }

  name_aux[10 - 1] = '\0';
  if (look_team(lst_teams, name_aux) == 1)
  {
    printf("%d Equipa existente.\n", nl);
  }
  else
  {
    {
      teams *team = (teams *) malloc(sizeof(teams));
      team = new_team(team, name_aux);
      insert_new_team(lst_teams, team);
    }
  }

}

void add_game(games **lst_games, teams **lst_teams, int nl, stacks **stack, stacks **head_stack)
{
  int score1;
  int score2;
  char name_aux[1024];
  char team1_aux[1024];
  char team2_aux[1024];
  for (int name_aux_index = 0; name_aux_index < 10; name_aux_index++)
  {
    name_aux[name_aux_index] = new_sym_var(sizeof(char) * 8);
  }

  name_aux[10 - 1] = '\0';
  for (int team1_aux_index = 0; team1_aux_index < 10; team1_aux_index++)
  {
    team1_aux[team1_aux_index] = new_sym_var(sizeof(char) * 8);
  }

  team1_aux[10 - 1] = '\0';
  for (int team2_aux_index = 0; team2_aux_index < 10; team2_aux_index++)
  {
    team2_aux[team2_aux_index] = new_sym_var(sizeof(char) * 8);
  }

  team2_aux[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  if (look_game(lst_games, name_aux) == 1)
  {
    printf("%d Jogo existente.\n", nl);
  }
  else
  {
    if (look_team(lst_teams, team1_aux) == 0)
    {
      printf("%d Equipa inexistente.\n", nl);
    }
    else
    {
      if (look_team(lst_teams, team2_aux) == 0)
      {
        printf("%d Equipa inexistente.\n", nl);
      }
      else
      {
        {
          games *game = (games *) malloc(sizeof(games));
          game = new_game(game, name_aux, team1_aux, team2_aux, score1, score2);
          insert_new_game(lst_games, game);
          insert_game_stack(name_aux, stack, head_stack);
          if (who_won(score1, score2) == 1)
          {
            {
              add_victory(lst_teams, team1_aux);
            }
          }
          else
          {
            if (who_won(score1, score2) == 2)
            {
              {
                add_victory(lst_teams, team2_aux);
              }
            }
            else
            {
              
            }

          }

        }
      }

    }

  }

}

void search_game(games **lst_games, int nl)
{
  char name_aux[1024];
  for (int name_aux_index = 0; name_aux_index < 10; name_aux_index++)
  {
    name_aux[name_aux_index] = new_sym_var(sizeof(char) * 8);
  }

  name_aux[10 - 1] = '\0';
  if (look_game(lst_games, name_aux) == 0)
  {
    {
      printf("%d Jogo inexistente.\n", nl);
    }
  }
  else
  {
    {
      games *game = get_game(lst_games, name_aux);
      printf("%d %s %s %s %d %d\n", nl, game->name, game->team1, game->team2, game->score1, game->score2);
    }
  }

}

void search_team(teams **lst_teams, int nl)
{
  char name_aux[1024];
  for (int name_aux_index = 0; name_aux_index < 10; name_aux_index++)
  {
    name_aux[name_aux_index] = new_sym_var(sizeof(char) * 8);
  }

  name_aux[10 - 1] = '\0';
  if (look_team(lst_teams, name_aux) == 0)
  {
    {
      printf("%d Equipa inexistente.\n", nl);
    }
  }
  else
  {
    {
      teams *team = get_team(lst_teams, name_aux);
      printf("%d %s %d\n", nl, team->name, team->games_w);
    }
  }

}

void change_score(games **lst_games, teams **lst_teams, int nl)
{
  char name_aux[1024];
  int score1;
  int score2;
  for (int name_aux_index = 0; name_aux_index < 10; name_aux_index++)
  {
    name_aux[name_aux_index] = new_sym_var(sizeof(char) * 8);
  }

  name_aux[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  if (look_game(lst_games, name_aux) == 0)
  {
    {
      printf("%d Jogo inexistente.\n", nl);
    }
  }
  else
  {
    {
      games *game = get_game(lst_games, name_aux);
      int old = who_won(game->score1, game->score2);
      int new = who_won(score1, score2);
      if (old != new)
      {
        {
          if (new == 0)
          {
            {
              if (old == 1)
              {
                remove_victory(lst_teams, game->team1);
              }
              else
              {
                remove_victory(lst_teams, game->team2);
              }

            }
          }
          else
          {
            if (old == 0)
            {
              {
                if (new == 1)
                {
                  add_victory(lst_teams, game->team1);
                }
                else
                {
                  add_victory(lst_teams, game->team2);
                }

              }
            }
            else
            {
              {
                if (new == 1)
                {
                  {
                    remove_victory(lst_teams, game->team2);
                    add_victory(lst_teams, game->team1);
                  }
                }
                else
                {
                  {
                    remove_victory(lst_teams, game->team1);
                    add_victory(lst_teams, game->team2);
                  }
                }

              }
            }

          }

        }
      }
      else
      {
        
      }

      game->score1 = score1;
      game->score2 = score2;
    }
  }

}

void delete_game(games **lst_games, teams **lst_teams, int nl, stacks **stack, stacks **head_stack)
{
  char name_aux[1024];
  for (int name_aux_index = 0; name_aux_index < 10; name_aux_index++)
  {
    name_aux[name_aux_index] = new_sym_var(sizeof(char) * 8);
  }

  name_aux[10 - 1] = '\0';
  if (look_game(lst_games, name_aux) == 0)
  {
    {
      printf("%d Jogo inexistente.\n", nl);
    }
  }
  else
  {
    {
      games *game;
      game = get_game(lst_games, name_aux);
      if (who_won(game->score1, game->score2) == 1)
      {
        {
          remove_victory(lst_teams, game->team1);
        }
      }
      else
      {
        if (who_won(game->score1, game->score2) == 2)
        {
          {
            remove_victory(lst_teams, game->team2);
          }
        }
        else
        {
          
        }

      }

      remove_game_stack(stack, game, head_stack);
      remove_game(lst_games, game);
    }
  }

}

void the_best_teams(teams **lst_teams, char **best_teams, int nl)
{
  int max;
  max = most_wins(lst_teams);
  search_and_add_teams_list(lst_teams, best_teams, max);
  sort_the_list(best_teams);
  print_best_teams(best_teams, nl, max);
  clear_list_teams(best_teams, 100);
}

int main()
{
  char caracter;
  int nl = 0;
  teams **lst_teams;
  games **lst_games;
  stacks **stack;
  stacks **head_stack;
  char **best_teams;
  lst_teams = (teams **) malloc((sizeof(teams)) * 517);
  lst_games = (games **) malloc((sizeof(games)) * 517);
  stack = (stacks **) malloc(sizeof(stacks));
  head_stack = (stacks **) malloc(sizeof(stacks));
  best_teams = (char **) malloc((sizeof(char *)) * 100);
  init_teams(lst_teams, 517);
  init_games(lst_games, 517);
  *stack = 0;
  *head_stack = 0;
  init_list_teams(best_teams, 100);
  do
  {
    switch (caracter = getchar())
    {
      case 'a':
        nl++;
        add_game(lst_games, lst_teams, nl, stack, head_stack);
        break;

      case 'A':
        nl++;
        add_team(lst_teams, nl);
        break;

      case 'l':
        nl++;
        print_stack(lst_games, stack, nl);
        break;

      case 'p':
        nl++;
        search_game(lst_games, nl);
        break;

      case 'P':
        nl++;
        search_team(lst_teams, nl);
        break;

      case 'r':
        nl++;
        delete_game(lst_games, lst_teams, nl, stack, head_stack);
        break;

      case 's':
        nl++;
        change_score(lst_games, lst_teams, nl);
        break;

      case 'g':
        nl++;
        the_best_teams(lst_teams, best_teams, nl);
        break;

      default:
        break;

    }

  }
  while (caracter != 'x');
  free_stack_games(stack, head_stack);
  clear_the_games(lst_games);
  clear_the_teams(lst_teams);
  free_list_teams(best_teams);
  return 0;
}

