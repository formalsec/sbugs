/*File generated by PreProcessor.py*/


#include "equipas.h"


int hash(char *nome)
{
  int i = 0;
  int a = 127;
  for (; (*nome) != '\0'; nome++)
  {
    i = ((a * i) + (*nome)) % 2269;
  }

  return i;
}

Equipa newEquipa(char *buffer)
{
  Equipa final = malloc(sizeof(struct equipa));
  final->nome = malloc((sizeof(char *)) * (strlen(buffer) + 1));
  strcpy(final->nome, buffer);
  final->ganhos = 0;
  return final;
}

link EinsertBegin(link head, Equipa equipa)
{
  link new;
  new = malloc(sizeof(struct node));
  new->equipa = equipa;
  new->next = head;
  return new;
}

Equipa EsearchList(link head, char *nome)
{
  link p;
  for (p = head; p != 0; p = p->next)
  {
    if (strcmp(nome, p->equipa->nome) == 0)
    {
      {
        return p->equipa;
      }
    }
    else
    {
      
    }

  }

  return 0;
}

link *EhashInit()
{
  int i;
  link *heads = malloc(2269 * (sizeof(link)));
  for (i = 0; i < 2269; i++)
  {
    heads[i] = 0;
  }

  return heads;
}

Equipa EhashSearch(link *heads, char *nome)
{
  int i = hash(nome);
  return EsearchList(heads[i], nome);
}

link *EhashInsert(link *heads, Equipa equipa)
{
  int i = hash(equipa->nome);
  heads[i] = EinsertBegin(heads[i], equipa);
  return heads;
}

void freeEquipa(Equipa equipa)
{
  free(equipa->nome);
  free(equipa);
}

void freeEList(link head)
{
  link aux;
  while (head != 0)
  {
    aux = head;
    head = head->next;
    freeEquipa(aux->equipa);
    free(aux);
  }

}

void EfreeHash(link *heads)
{
  int i;
  for (i = 0; i < 2269; i++)
  {
    freeEList(heads[i]);
  }

  free(heads);
}

Equipa *listaMaioresVitorias(link *hashEquipas, int *maior, int *count)
{
  Equipa *lista;
  link t;
  int i;
  lista = 0;
  for (i = 0; i < 2269; i++)
  {
    for (t = hashEquipas[i]; t != 0; t = t->next)
    {
      if (t->equipa->ganhos == (*maior))
      {
        {
          *count += 1;
          lista = realloc(lista, (sizeof(Equipa)) * (*count));
          lista[(*count) - 1] = t->equipa;
        }
      }
      else
      {
        if (t->equipa->ganhos > (*maior))
        {
          {
            *maior = t->equipa->ganhos;
            *count = 1;
            free(lista);
            lista = malloc(sizeof(Equipa));
            lista[(*count) - 1] = t->equipa;
          }
        }
        else
        {
          
        }

      }

    }

  }

  qsort(lista, *count, sizeof(Equipa), cmpfunc);
  return lista;
}

int cmpfunc(const void *a, const void *b)
{
  Equipa e1;
  Equipa e2;
  e1 = *((Equipa *) a);
  e2 = *((Equipa *) b);
  return strcmp(e1->nome, e2->nome);
}

