/*File generated by PreProcessor.py*/


#include "principal.h"
#include "codigoAux.h"
#include "jogo.h"
#include "listaJogo.h"
#include "hashtableJogo.h"
#include "equipa.h"
#include "listaEquipa.h"
#include "hashtableEquipa.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>


void analisaComando(char *comando, listaJogo **headsJogos, listaEquipa **headsEquipas, listaJogo *listaDeJogos, listaEquipa *listaDeEquipas, int M_J, int M_E, int *pNL)
{
  switch (comando[0])
  {
    case 'a':
      a_adicionaJogo(comando, headsJogos, headsEquipas, listaDeJogos, M_J, M_E, pNL);
      break;

    case 'l':
      l_listaJogos(listaDeJogos, pNL);
      break;

    case 'p':
      p_procuraJogo(comando, headsJogos, M_J, pNL);
      break;

    case 'r':
      r_apagaJogo(comando, headsJogos, listaDeJogos, headsEquipas, M_J, M_E, pNL);
      break;

    case 's':
      s_alteraScoreJogo(comando, headsJogos, headsEquipas, M_J, M_E, pNL);
      break;

    case 'A':
      A_adicionaEquipa(comando, headsEquipas, listaDeEquipas, M_E, pNL);
      break;

    case 'P':
      P_procuraEquipa(comando, headsEquipas, M_E, pNL);
      break;

    case 'g':
      g_listaEquipasComMaisVitorias(listaDeEquipas, pNL);
      break;

    default:
      break;

  }

}

void a_adicionaJogo(char *comando, listaJogo **headsJogos, listaEquipa **headsEquipas, listaJogo *listaDeJogos, int M_J, int M_E, int *pNL)
{
  int i = 2;
  int *pi = &i;
  char *auxNomeJogo;
  char *auxEquipa1;
  char *auxEquipa2;
  int auxScore1;
  int auxScore2;
  jogo *novoJogo;
  auxNomeJogo = obtemString(comando, pi);
  auxEquipa1 = obtemString(comando, pi);
  auxEquipa2 = obtemString(comando, pi);
  auxScore1 = obtemNumero(comando, pi);
  auxScore2 = obtemNumero(comando, pi);
  if (jogoExiste(headsJogos, auxNomeJogo, M_J))
  {
    {
      printf("%d Jogo existente.\n", *pNL);
      free(auxNomeJogo);
      free(auxEquipa1);
      free(auxEquipa2);
      return;
    }
  }
  else
  {
    
  }

  if ((!equipaExiste(headsEquipas, auxEquipa1, M_E)) || (!equipaExiste(headsEquipas, auxEquipa2, M_E)))
  {
    {
      printf("%d Equipa inexistente.\n", *pNL);
      free(auxNomeJogo);
      free(auxEquipa1);
      free(auxEquipa2);
      return;
    }
  }
  else
  {
    
  }

  novoJogo = criaJogo(auxNomeJogo, auxEquipa1, auxEquipa2, auxScore1, auxScore2, headsEquipas, M_E);
  headsJogos = insereHashTableJogo(headsJogos, novoJogo, M_J);
  listaDeJogos = insereFimListaJogo(listaDeJogos, novoJogo);
  free(auxNomeJogo);
  free(auxEquipa1);
  free(auxEquipa2);
}

void l_listaJogos(listaJogo *Lista, int *pNL)
{
  if ((Lista->head == 0) || (Lista == 0))
  {
    {
      return;
    }
  }
  else
  {
    
  }

  printListaJogo(Lista, pNL);
}

void p_procuraJogo(char *comando, listaJogo **headsJogos, int M_J, int *pNL)
{
  int i = 2;
  int *pi = &i;
  char *auxNome;
  jogo *jogoEncontrado;
  auxNome = obtemString(comando, pi);
  if (!jogoExiste(headsJogos, auxNome, M_J))
  {
    {
      printf("%d Jogo inexistente.\n", *pNL);
      free(auxNome);
      return;
    }
  }
  else
  {
    
  }

  jogoEncontrado = procuraHashTableJogo(headsJogos, auxNome, M_J);
  printJogo(jogoEncontrado, pNL);
  free(auxNome);
}

void r_apagaJogo(char *comando, listaJogo **headsJogos, listaJogo *Lista, listaEquipa **headsEquipas, int M_J, int M_E, int *pNL)
{
  int i = 2;
  int *pi = &i;
  char *auxNome;
  int score1;
  int score2;
  jogo *auxJogo;
  equipa *auxEquipa;
  auxNome = obtemString(comando, pi);
  if (!jogoExiste(headsJogos, auxNome, M_J))
  {
    {
      printf("%d Jogo inexistente.\n", *pNL);
      free(auxNome);
      return;
    }
  }
  else
  {
    
  }

  auxJogo = procuraHashTableJogo(headsJogos, auxNome, M_J);
  score1 = auxJogo->score1;
  score2 = auxJogo->score2;
  if (score1 > score2)
  {
    {
      auxEquipa = procuraHashTableEquipa(headsEquipas, auxJogo->equipa1, M_E);
      auxEquipa->numeroVitorias -= 1;
    }
  }
  else
  {
    if (score1 < score2)
    {
      {
        auxEquipa = procuraHashTableEquipa(headsEquipas, auxJogo->equipa2, M_E);
        auxEquipa->numeroVitorias -= 1;
      }
    }
    else
    {
      
    }

  }

  Lista = removeListaJogo(Lista, auxNome);
  headsJogos = removeHashTableJogo(headsJogos, auxNome, M_J);
  freeJogo(auxJogo);
  free(auxNome);
}

void s_alteraScoreJogo(char *comando, listaJogo **headsJogos, listaEquipa **headsEquipas, int M_J, int M_E, int *pNL)
{
  int i = 2;
  int novoScore1;
  int novoScore2;
  int score1Antigo;
  int score2Antigo;
  int *pi = &i;
  char *auxNome;
  jogo *jogoAux;
  equipa *equipaAux;
  auxNome = obtemString(comando, pi);
  novoScore1 = obtemNumero(comando, pi);
  novoScore2 = obtemNumero(comando, pi);
  if (!jogoExiste(headsJogos, auxNome, M_J))
  {
    {
      printf("%d Jogo inexistente.\n", *pNL);
      free(auxNome);
      return;
    }
  }
  else
  {
    
  }

  jogoAux = procuraHashTableJogo(headsJogos, auxNome, M_J);
  score1Antigo = jogoAux->score1;
  score2Antigo = jogoAux->score2;
  jogoAux->score1 = novoScore1;
  jogoAux->score2 = novoScore2;
  if (novoScore1 == novoScore2)
  {
    {
      {
        if (score1Antigo > score2Antigo)
        {
          {
            equipaAux = procuraHashTableEquipa(headsEquipas, jogoAux->equipa1, M_E);
            equipaAux->numeroVitorias -= 1;
          }
        }
        else
        {
          if (score1Antigo < score2Antigo)
          {
            {
              equipaAux = procuraHashTableEquipa(headsEquipas, jogoAux->equipa2, M_E);
              equipaAux->numeroVitorias -= 1;
            }
          }
          else
          {
            
          }

        }

      }
    }
  }
  else
  {
    
  }

  if (score1Antigo > score2Antigo)
  {
    {
      if (novoScore1 < novoScore2)
      {
        {
          equipaAux = procuraHashTableEquipa(headsEquipas, jogoAux->equipa1, M_E);
          equipaAux->numeroVitorias -= 1;
          equipaAux = procuraHashTableEquipa(headsEquipas, jogoAux->equipa2, M_E);
          equipaAux->numeroVitorias += 1;
        }
      }
      else
      {
        
      }

    }
  }
  else
  {
    if (score1Antigo < score2Antigo)
    {
      {
        if (novoScore1 > novoScore2)
        {
          {
            equipaAux = procuraHashTableEquipa(headsEquipas, jogoAux->equipa2, M_E);
            equipaAux->numeroVitorias -= 1;
            equipaAux = procuraHashTableEquipa(headsEquipas, jogoAux->equipa1, M_E);
            equipaAux->numeroVitorias += 1;
          }
        }
        else
        {
          
        }

      }
    }
    else
    {
      if (score1Antigo == score2Antigo)
      {
        {
          if (novoScore1 < novoScore2)
          {
            {
              equipaAux = procuraHashTableEquipa(headsEquipas, jogoAux->equipa2, M_E);
              equipaAux->numeroVitorias += 1;
            }
          }
          else
          {
            if (novoScore1 > novoScore2)
            {
              {
                equipaAux = procuraHashTableEquipa(headsEquipas, jogoAux->equipa1, M_E);
                equipaAux->numeroVitorias += 1;
              }
            }
            else
            {
              
            }

          }

        }
      }
      else
      {
        
      }

    }

  }

  free(auxNome);
}

void A_adicionaEquipa(char *comando, listaEquipa **headsEquipas, listaEquipa *listaDeEquipas, int M_E, int *pNL)
{
  int i = 2;
  int *pi = &i;
  char *auxNome;
  equipa *novaEquipa;
  auxNome = obtemString(comando, pi);
  if (equipaExiste(headsEquipas, auxNome, M_E))
  {
    {
      printf("%d Equipa existente.\n", *pNL);
      free(auxNome);
      return;
    }
  }
  else
  {
    
  }

  novaEquipa = criaEquipa(auxNome);
  headsEquipas = insereHashTableEquipa(headsEquipas, novaEquipa, M_E);
  listaDeEquipas = insereFimListaEquipa(listaDeEquipas, novaEquipa);
  free(auxNome);
}

void P_procuraEquipa(char *comando, listaEquipa **headsEquipas, int M_E, int *pNL)
{
  int i = 2;
  int *pi = &i;
  char *auxNome;
  equipa *equipaEncontrada;
  auxNome = obtemString(comando, pi);
  if (!equipaExiste(headsEquipas, auxNome, M_E))
  {
    {
      printf("%d Equipa inexistente.\n", *pNL);
      free(auxNome);
      return;
    }
  }
  else
  {
    
  }

  equipaEncontrada = procuraHashTableEquipa(headsEquipas, auxNome, M_E);
  printEquipa(equipaEncontrada, pNL);
  free(auxNome);
}

void g_listaEquipasComMaisVitorias(listaEquipa *ListaDeEquipas, int *pNL)
{
  int maxVitorias;
  int tamanho = 0;
  int i = 0;
  int *pTamanho = &tamanho;
  nodeEquipa *auxNode;
  char equipasComMaisVitorias[500][4000];
  if ((ListaDeEquipas == 0) || (ListaDeEquipas->head == 0))
  {
    {
      return;
    }
  }
  else
  {
    
  }

  if (ListaDeEquipas->head->next == 0)
  {
    {
      printf("%d Melhores %d\n", *pNL, ListaDeEquipas->head->Equipa->numeroVitorias);
      printf("%d * %s\n", *pNL, ListaDeEquipas->head->Equipa->nome);
      return;
    }
  }
  else
  {
    
  }

  maxVitorias = encontraMaxVitorias(ListaDeEquipas);
  auxNode = ListaDeEquipas->head;
  while (auxNode != 0)
  {
    if (auxNode->Equipa->numeroVitorias == maxVitorias)
    {
      {
        copia_String(equipasComMaisVitorias[i], auxNode->Equipa->nome);
        *pTamanho += 1;
        i++;
      }
    }
    else
    {
      
    }

    auxNode = auxNode->next;
  }

  qsort(equipasComMaisVitorias, *pTamanho, 4000, comparaStrings);
  printf("%d Melhores %d\n", *pNL, maxVitorias);
  for (i = 0; i < (*pTamanho); i++)
  {
    printf("%d * %s\n", *pNL, equipasComMaisVitorias[i]);
  }

}

int comparaStrings(const void *string1, const void *string2)
{
  return strcmp(string1, string2);
}

int obtemNumero(char *comando, int *pi)
{
  int j = 0;
  char arrayNumero[4000];
  while ((comando[*pi] < '0') || (comando[*pi] > '9'))
  {
    *pi += 1;
  }

  while ((comando[*pi] >= '0') && (comando[*pi] <= '9'))
  {
    arrayNumero[j] = comando[*pi];
    *pi += 1;
    j++;
  }

  arrayNumero[j] = '\0';
  return atoi(arrayNumero);
}

char *obtemString(char *comando, int *pi)
{
  int j = 0;
  char buffer[4000];
  char *aRetornar;
  while (((((((((((comando[*pi] < '0') && (comando[*pi] != '-')) && (comando[*pi] != 32)) && (comando[*pi] != '.')) && (comando[*pi] != '-')) && (comando[*pi] != '\'')) && (comando[*pi] != '(')) && (comando[*pi] != ')')) || ((comando[*pi] > '9') && (comando[*pi] < 'A'))) || ((comando[*pi] > 'Z') && (comando[*pi] < 'a'))) || (comando[*pi] > 'z'))
  {
    *pi += 1;
  }

  while ((((((((((comando[*pi] >= '0') && (comando[*pi] <= '9')) || ((comando[*pi] >= 'A') && (comando[*pi] <= 'Z'))) || ((comando[*pi] >= 'a') && (comando[*pi] <= 'z'))) || (comando[*pi] == '-')) || (comando[*pi] == '.')) || (comando[*pi] == '\'')) || (comando[*pi] == '(')) || (comando[*pi] == ')')) || (comando[*pi] == 32))
  {
    buffer[j++] = comando[*pi];
    *pi += 1;
  }

  *pi += 1;
  buffer[j] = '\0';
  aRetornar = (char *) malloc((sizeof(char)) * (strlen(buffer) + 1));
  copia_String(aRetornar, buffer);
  return aRetornar;
}

