/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "hash.h"
#include "structs.h"


void a(int NL, int M, Game *stg, Team *stt, link *head, link *tail)
{
  Game g;
  Team t;
  char name[1024];
  char t1[1024];
  char t2[1024];
  ;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  for (int t1_index = 0; t1_index < 10; t1_index++)
  {
    t1[t1_index] = new_sym_var(sizeof(char) * 8);
  }

  t1[10 - 1] = '\0';
  for (int t2_index = 0; t2_index < 10; t2_index++)
  {
    t2[t2_index] = new_sym_var(sizeof(char) * 8);
  }

  t2[10 - 1] = '\0';
  if (STsearchG(name, M, stg) == 0)
  {
    {
      if ((STsearchT(t1, M, stt) != 0) && (STsearchT(t2, M, stt) != 0))
      {
        {
          g = NewGame(head, tail, name, t1, t2);
          STinsertG(g, M, stg);
          if (g->s1 > g->s2)
          {
            {
              t = STsearchT(t1, M, stt);
              t->wins += 1;
            }
          }
          else
          {
            
          }

          if (g->s1 < g->s2)
          {
            {
              t = STsearchT(t2, M, stt);
              t->wins += 1;
            }
          }
          else
          {
            
          }

        }
      }
      else
      {
        printf("%d Equipa inexistente.\n", NL);
      }

    }
  }
  else
  {
    printf("%d Jogo existente.\n", NL);
  }

}

void A(int NL, int M, Team *stt, Team *head)
{
  Team t;
  char name[1024];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  if (STsearchT(name, M, stt) == 0)
  {
    {
      t = NewTeam(name, head);
      STinsertT(t, M, stt);
    }
  }
  else
  {
    printf("%d Equipa existente.\n", NL);
  }

}

void l(int NL, link *head)
{
  PrintGame(head, NL);
}

void p(int NL, int M, Game *stg)
{
  Game g;
  char name[1024];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  g = STsearchG(name, M, stg);
  if (g)
  {
    printf("%d %s %s %s %d %d\n", NL, g->name, g->t1, g->t2, g->s1, g->s2);
  }
  else
  {
    printf("%d Jogo inexistente.\n", NL);
  }

}

void P(int NL, int M, Team *stt)
{
  Team t;
  char name[1024];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  t = STsearchT(name, M, stt);
  if (t)
  {
    printf("%d %s %d\n", NL, t->name, t->wins);
  }
  else
  {
    printf("%d Equipa inexistente.\n", NL);
  }

}

void r(int NL, int M, Game *stg, Team *stt, link *head, link *tail)
{
  Game g;
  Team t;
  char name[1024];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  g = STsearchG(name, M, stg);
  if (g)
  {
    {
      if (g->s1 > g->s2)
      {
        {
          t = STsearchT(g->t1, M, stt);
          t->wins -= 1;
        }
      }
      else
      {
        if (g->s1 < g->s2)
        {
          {
            t = STsearchT(g->t2, M, stt);
            t->wins -= 1;
          }
        }
        else
        {
          
        }

      }

      RemoveGame(head, tail, name);
      STdeleteG(name, M, stg);
    }
  }
  else
  {
    printf("%d Jogo inexistente.\n", NL);
  }

}

void s(int NL, int M, Game *stg, Team *stt)
{
  int s1;
  int s2;
  Game g;
  Team t1;
  Team t2;
  char name[1024];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  s1 = new_sym_var(sizeof(int) * 8);
  s2 = new_sym_var(sizeof(int) * 8);
  g = STsearchG(name, M, stg);
  if (g)
  {
    {
      if ((g->s1 > g->s2) && (s1 < s2))
      {
        {
          t1 = STsearchT(g->t1, M, stt);
          t1->wins -= 1;
          t2 = STsearchT(g->t2, M, stt);
          t2->wins += 1;
        }
      }
      else
      {
        if ((g->s1 < g->s2) && (s1 > s2))
        {
          {
            t1 = STsearchT(g->t1, M, stt);
            t1->wins += 1;
            t2 = STsearchT(g->t2, M, stt);
            t2->wins -= 1;
          }
        }
        else
        {
          if ((g->s1 == g->s2) && (s1 < s2))
          {
            {
              t2 = STsearchT(g->t2, M, stt);
              t2->wins += 1;
            }
          }
          else
          {
            if ((g->s1 == g->s2) && (s1 > s2))
            {
              {
                t1 = STsearchT(g->t1, M, stt);
                t1->wins += 1;
              }
            }
            else
            {
              if ((g->s1 > g->s2) && (s1 == s2))
              {
                {
                  t1 = STsearchT(g->t1, M, stt);
                  t1->wins -= 1;
                }
              }
              else
              {
                if ((g->s1 < g->s2) && (s1 == s2))
                {
                  {
                    t2 = STsearchT(g->t2, M, stt);
                    t2->wins -= 1;
                  }
                }
                else
                {
                  
                }

              }

            }

          }

        }

      }

      g->s1 = s1;
      g->s2 = s2;
    }
  }
  else
  {
    printf("%d Jogo inexistente.\n", NL);
  }

}

int compare(const void *a, const void *b)
{
  const char *A = *((const char **) a);
  const char *B = *((const char **) b);
  return strcmp(A, B);
}

void g(int NL, Team *head)
{
  int i;
  int teams = 0;
  int *lst;
  char **sort;
  Team aux = *head;
  if (aux == 0)
  {
    return;
  }
  else
  {
    
  }

  lst = (int *) malloc((sizeof(int)) * 2);
  lst = MaxWins(head, lst);
  sort = (char **) malloc((sizeof(char *)) * lst[1]);
  while (aux != 0)
  {
    if (aux->wins == lst[0])
    {
      {
        sort[teams++] = aux->name;
      }
    }
    else
    {
      
    }

    aux = aux->next;
  }

  if (teams > 0)
  {
    {
      qsort(sort, teams, sizeof(char *), compare);
      printf("%d Melhores %d\n", NL, lst[0]);
      for (i = 0; i < teams; i++)
        printf("%d * %s\n", NL, sort[i]);

    }
  }
  else
  {
    
  }

  free(lst);
  free(sort);
}

void x(link *head, link *tail, Team *thead, Game *stg, Team *stt)
{
  link gaux;
  Team taux;
  link j = *head;
  Team t = *thead;
  while (j != 0)
  {
    gaux = j->next;
    FreeGame(j->g);
    free(j);
    j = gaux;
  }

  while (t != 0)
  {
    taux = t->next;
    FreeTeam(t);
    t = taux;
  }

  free(tail);
  free(stg);
  free(stt);
  free(head);
  free(thead);
}

int main()
{
  int NL = 1;
  int M = 50021;
  char c;
  Game *stg = 0;
  Team *stt = 0;
  Team *thead = (Team *) malloc(sizeof(Team));
  link *ghead = (link *) malloc(sizeof(link));
  link *gtail = (link *) malloc(sizeof(link));
  *thead = 0;
  *ghead = 0;
  *gtail = 0;
  stg = STinitG(M);
  stt = STinitT(M);
  do
  {
    c = getchar();
    switch (c)
    {
      case 'a':
        a(NL, M, stg, stt, ghead, gtail);
        NL++;
        break;

      case 'A':
        A(NL, M, stt, thead);
        NL++;
        break;

      case 'l':
        l(NL, ghead);
        NL++;
        break;

      case 'p':
        p(NL, M, stg);
        NL++;
        break;

      case 'P':
        P(NL, M, stt);
        NL++;
        break;

      case 'r':
        r(NL, M, stg, stt, ghead, gtail);
        NL++;
        break;

      case 's':
        s(NL, M, stg, stt);
        NL++;
        break;

      case 'g':
        g(NL, thead);
        NL++;
        break;

    }

  }
  while (c != 'x');
  x(ghead, gtail, thead, stg, stt);
  return 0;
}

