/*File generated by PreProcessor.py*/


#include "Generic_Binary_Tree.h"
#include "Generic_Linked_List.h"
#include "equipa.h"
#include "jogo.h"


int sign(int x)
{
  return (x > 0) - (x < 0);
}

int nome_compare_func(void *a, void *b)
{
  return strcmp((char *) b, (char *) a);
}

void bt_free_equipa(void *data)
{
  free_equipa(data);
}

void bt_free_jogo(void *data)
{
  free_jogo(data);
}

void *bt_get_nome_equipa(void *a)
{
  return (void *) get_nome_equipa((Equipa *) a);
}

void *bt_get_nome_jogo(void *a)
{
  return (void *) get_nome_jogo((Jogo *) a);
}

void ad_equipa(int *nl, BTlink *equipas)
{
  char nome[1023];
  Equipa *equipa;
  (*nl)++;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  equipa = cria_equipa(nome);
  if (bintree_add_item(equipas, equipa, sizeof(*equipa), bt_free_equipa, bt_get_nome_equipa, nome_compare_func))
  {
    {
      printf("%d Equipa existente.\n", *nl);
      return;
    }
  }
  else
  {
    
  }

}

void ad_jogo(int *nl, BTlink *equipas, BTlink *jogos, int *i_jogos)
{
  char nome[1023];
  char e1_nome[1023];
  char e2_nome[1023];
  Jogo *jogo;
  void *e1;
  void *e2;
  int s1;
  int s2;
  (*nl)++;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  for (int e1_nome_index = 0; e1_nome_index < 10; e1_nome_index++)
  {
    e1_nome[e1_nome_index] = new_sym_var(sizeof(char) * 8);
  }

  e1_nome[10 - 1] = '\0';
  for (int e2_nome_index = 0; e2_nome_index < 10; e2_nome_index++)
  {
    e2_nome[e2_nome_index] = new_sym_var(sizeof(char) * 8);
  }

  e2_nome[10 - 1] = '\0';
  s1 = new_sym_var(sizeof(int) * 8);
  s2 = new_sym_var(sizeof(int) * 8);
  if (bintree_search(*jogos, nome, bt_get_nome_jogo, nome_compare_func) != 0)
  {
    {
      printf("%d Jogo existente.\n", *nl);
      return;
    }
  }
  else
  {
    
  }

  e1 = (Equipa *) bintree_search(*equipas, e1_nome, bt_get_nome_equipa, nome_compare_func);
  e2 = (Equipa *) bintree_search(*equipas, e2_nome, bt_get_nome_equipa, nome_compare_func);
  if ((e1 == 0) || (e2 == 0))
  {
    {
      printf("%d Equipa inexistente.\n", *nl);
      return;
    }
  }
  else
  {
    
  }

  jogo = cria_jogo(nome, e1, e2, s1, s2, *nl);
  if (s1 > s2)
  {
    {
      alt_score_equipa(get_equipa1_jogo(jogo), 1);
    }
  }
  else
  {
    if (s1 < s2)
    {
      {
        alt_score_equipa(get_equipa2_jogo(jogo), 1);
      }
    }
    else
    {
      
    }

  }

  bintree_add_item(jogos, jogo, sizeof(*jogo), bt_free_jogo, bt_get_nome_jogo, nome_compare_func);
  (*i_jogos)++;
}

void procura_jogo(int *nl, BTlink jogos)
{
  char nome[1023];
  Jogo *jogo;
  (*nl)++;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  jogo = (Jogo *) bintree_search(jogos, nome, bt_get_nome_jogo, nome_compare_func);
  if (jogo == 0)
  {
    {
      printf("%d Jogo inexistente.\n", *nl);
    }
  }
  else
  {
    {
      printf("%d %s %s %s %d %d\n", *nl, get_nome_jogo(jogo), get_nome_equipa(get_equipa1_jogo(jogo)), get_nome_equipa(get_equipa2_jogo(jogo)), get_score1_jogo(jogo), get_score2_jogo(jogo));
    }
  }

}

void procura_equipa(int *nl, BTlink equipas)
{
  char nome[1023];
  Equipa *equipa;
  (*nl)++;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  equipa = (Equipa *) bintree_search(equipas, nome, bt_get_nome_equipa, nome_compare_func);
  if (equipa == 0)
  {
    {
      printf("%d Equipa inexistente.\n", *nl);
    }
  }
  else
  {
    {
      printf("%d %s %d\n", *nl, get_nome_equipa(equipa), get_score_equipa(equipa));
    }
  }

}

void remove_jogo(int *nl, BTlink *jogos, int *i_jogos)
{
  char nome[1023];
  Jogo *jogo;
  (*nl)++;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  if ((*jogos) == 0)
  {
    {
      printf("%d Jogo inexistente.\n", *nl);
      return;
    }
  }
  else
  {
    
  }

  jogo = bintree_search(*jogos, nome, bt_get_nome_jogo, nome_compare_func);
  if (jogo == 0)
  {
    {
      printf("%d Jogo inexistente.\n", *nl);
      return;
    }
  }
  else
  {
    
  }

  if (get_score1_jogo(jogo) > get_score2_jogo(jogo))
  {
    {
      alt_score_equipa(get_equipa1_jogo(jogo), -1);
    }
  }
  else
  {
    if (get_score1_jogo(jogo) < get_score2_jogo(jogo))
    {
      {
        alt_score_equipa(get_equipa2_jogo(jogo), -1);
      }
    }
    else
    {
      
    }

  }

  bintree_delete_item(jogos, nome, bt_get_nome_jogo, bt_free_jogo, nome_compare_func);
  (*i_jogos)--;
}

void altera_pontuacao(int *nl, BTlink *jogos)
{
  char nome[1023];
  int s1;
  int s2;
  int prev_s1;
  int prev_s2;
  Jogo *jogo;
  (*nl)++;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  s1 = new_sym_var(sizeof(int) * 8);
  s2 = new_sym_var(sizeof(int) * 8);
  jogo = bintree_search(*jogos, nome, bt_get_nome_jogo, nome_compare_func);
  if (jogo == 0)
  {
    {
      printf("%d Jogo inexistente.\n", *nl);
      return;
    }
  }
  else
  {
    
  }

  prev_s1 = get_score1_jogo(jogo);
  prev_s2 = get_score2_jogo(jogo);
  alt_score_jogo(jogo, s1, s2);
  if (sign(prev_s1 - prev_s2) == sign(s1 - s2))
  {
    return;
  }
  else
  {
    
  }

  if (sign(prev_s1 - prev_s2) == 1)
  {
    alt_score_equipa(get_equipa1_jogo(jogo), -1);
  }
  else
  {
    if (sign(prev_s1 - prev_s2) == (-1))
    {
      alt_score_equipa(get_equipa1_jogo(jogo), sign(s1 - s2));
    }
    else
    {
      if (sign(prev_s1 - prev_s2) == 0)
      {
        alt_score_equipa(get_equipa1_jogo(jogo), (1 + sign(s1 - s2)) / 2);
      }
      else
      {
        
      }

    }

  }

  if (sign(prev_s2 - prev_s1) == 1)
  {
    alt_score_equipa(get_equipa2_jogo(jogo), -1);
  }
  else
  {
    if (sign(prev_s2 - prev_s1) == (-1))
    {
      alt_score_equipa(get_equipa2_jogo(jogo), sign(s2 - s1));
    }
    else
    {
      if (sign(prev_s2 - prev_s1) == 0)
      {
        alt_score_equipa(get_equipa2_jogo(jogo), (1 + sign(s2 - s1)) / 2);
      }
      else
      {
        
      }

    }

  }

}

int cmp_id(const void *a, const void *b)
{
  return (*((Jogo **) a))->id - (*((Jogo **) b))->id;
}

void lista_jogos(int *nl, BTlink *jogos, int i_jogos)
{
  int i;
  void **lista_jogos;
  i = 0;
  (*nl)++;
  if ((*jogos) != 0)
  {
    {
      lista_jogos = malloc((sizeof(Jogo *)) * i_jogos);
      bintree_array(*jogos, lista_jogos, sizeof(Jogo *));
      qsort(lista_jogos, i_jogos, sizeof(struct Jogo **), cmp_id);
      for (i = 0; i < i_jogos; i++)
      {
        printf("%d %s %s %s %d %d\n", *nl, ((Jogo *) lista_jogos[i])->nome, get_nome_equipa(((Jogo *) lista_jogos[i])->e1), get_nome_equipa(((Jogo *) lista_jogos[i])->e2), ((Jogo *) lista_jogos[i])->s1, ((Jogo *) lista_jogos[i])->s2);
      }

      free(lista_jogos);
    }
  }
  else
  {
    
  }

}

int cmp_func(const void *a, const void *b)
{
  return (*((Equipa **) b))->vitorias - (*((Equipa **) a))->vitorias;
}

void condition(void *a, Link *lista)
{
  int best;
  int team_score;
  if (a == 0)
  {
    return;
  }
  else
  {
    
  }

  team_score = get_score_equipa((Equipa *) a);
  if ((*lista) != 0)
  {
    best = get_score_equipa((Equipa *) linkedlist_get_item(*lista, 0));
  }
  else
  {
    best = 0;
  }

  if (team_score > best)
  {
    {
      *lista = linkedlist_reset(*lista, free);
      linkedlist_add_item(lista, a, sizeof(Equipa));
      best = team_score;
    }
  }
  else
  {
    if (team_score == best)
    {
      {
        linkedlist_add_item(lista, a, sizeof(Equipa));
      }
    }
    else
    {
      
    }

  }

}

void lista_equipas(int *nl, BTlink *equipas)
{
  Link lista_equipas;
  int i;
  int count = 0;
  (*nl)++;
  if ((*equipas) != 0)
  {
    {
      lista_equipas = bintree_to_list_condition(*equipas, condition);
      count = linkedlist_get_length(lista_equipas);
      printf("%d Melhores %d\n", *nl, get_score_equipa((Equipa *) linkedlist_get_item(lista_equipas, 0)));
      for (i = 0; i < count; i++)
      {
        printf("%d * %s\n", *nl, get_nome_equipa((Equipa *) linkedlist_get_item(lista_equipas, i)));
      }

      linkedlist_free(lista_equipas, free);
    }
  }
  else
  {
    
  }

}

int main()
{
  char cmd;
  int nl = 0;
  int i_jogos = 0;
  BTlink equipas = bintree_create();
  BTlink jogos = bintree_create();
  while (1)
  {
    cmd = new_sym_var(sizeof(char) * 8);
    switch (cmd)
    {
      case 'a':
        ad_jogo(&nl, &equipas, &jogos, &i_jogos);
        break;

      case 'A':
        ad_equipa(&nl, &equipas);
        break;

      case 'p':
        procura_jogo(&nl, jogos);
        break;

      case 'P':
        procura_equipa(&nl, equipas);
        break;

      case 'r':
        remove_jogo(&nl, &jogos, &i_jogos);
        break;

      case 's':
        altera_pontuacao(&nl, &jogos);
        break;

      case 'l':
        lista_jogos(&nl, &jogos, i_jogos);
        break;

      case 'g':
        lista_equipas(&nl, &equipas);
        break;

      case 'x':
        bintree_free(equipas, bt_free_equipa);
        bintree_free(jogos, bt_free_jogo);
        return 0;
        break;

    }

  }

  return 0;
}

