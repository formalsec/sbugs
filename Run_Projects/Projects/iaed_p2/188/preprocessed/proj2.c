/*File generated by PreProcessor.py*/


#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "operationsovertable.h"
#include "operationsoverteamlist.h"


Junta *a(Junta *tabela, team equipa, int count);
team A(team equipa, int count);
void p(campeonato *tabela, int count);
void P(team equipa, int count);
void l(copa *golo, int count);
Junta *r(Junta *tudo, team equipa, int M, int Count);
Junta *s(Junta *tudo, team equipa, int count);
void g(team equipa, int Count);
void x(Junta *tudo, team equipa);
team libertaequipa(team equipa);
copa *libertalista(copa *lista);
campeonato libertahashtable(campeonato jogo);
int main()
{
  Junta *tudo;
  team equipa;
  char c;
  int M = 1051;
  int i = 0;
  equipa = 0;
  tudo = (Junta *) malloc(sizeof(struct Junta));
  tudo->hashtable = init_array(tudo->hashtable, M);
  tudo->lista = 0;
  while ((c = getchar()) != EOF)
  {
    switch (c)
    {
      case 'a':
        i += 1;
        tudo = a(tudo, equipa, i);
        break;

      case 'A':
        i += 1;
        equipa = A(equipa, i);
        break;

      case 'l':
        i += 1;
        l(tudo->lista, i);
        break;

      case 'p':
        i += 1;
        p(tudo->hashtable, i);
        break;

      case 'P':
        i += 1;
        P(equipa, i);
        break;

      case 'r':
        i += 1;
        r(tudo, equipa, M, i);
        break;

      case 's':
        i += 1;
        tudo = s(tudo, equipa, i);
        break;

      case 'g':
        i += 1;
        g(equipa, i);
        break;

      case 'x':
        x(tudo, equipa);
        break;

    }

  }

  return 0;
}

Junta *a(Junta *tudo, team equipa, int count)
{
  char n[1024];
  char e1[1024];
  char e2[1024];
  int i;
  int z;
  int M = 1051;
  game head = (game) malloc(sizeof(struct jogo));
  campeonato cabeca;
  team crazy1;
  team crazy2;
  for (int n_index = 0; n_index < 10; n_index++)
  {
    n[n_index] = new_sym_var(sizeof(char) * 8);
  }

  n[10 - 1] = '\0';
  for (int e1_index = 0; e1_index < 10; e1_index++)
  {
    e1[e1_index] = new_sym_var(sizeof(char) * 8);
  }

  e1[10 - 1] = '\0';
  for (int e2_index = 0; e2_index < 10; e2_index++)
  {
    e2[e2_index] = new_sym_var(sizeof(char) * 8);
  }

  e2[10 - 1] = '\0';
  i = new_sym_var(sizeof(int) * 8);
  z = new_sym_var(sizeof(int) * 8);
  head->nome = strdup(n);
  head->equipa1 = strdup(e1);
  head->equipa2 = strdup(e2);
  head->score1 = i;
  head->score2 = z;
  cabeca = search_hash(tudo->hashtable, head->nome);
  if (cabeca == 0)
  {
    crazy1 = searchTeams(head->equipa1, equipa);
    crazy2 = searchTeams(head->equipa2, equipa);
    if ((crazy1 != 0) && (crazy2 != 0))
    {
      tudo->lista = InsereEnd(tudo->lista, head);
      equipa = analisaVitorias(head->equipa1, head->equipa2, head->score1, head->score2, equipa);
      tudo->hashtable = insert_hash(tudo->hashtable, head, M);
      free(head->nome);
      free(head->equipa1);
      free(head->equipa2);
      free(head);
      return tudo;
    }
    else
    {
      printf("%d Equipa inexistente.\n", count);
    }

  }
  else
  {
    printf("%d Jogo existente.\n", count);
  }

  free(head->nome);
  free(head->equipa1);
  free(head->equipa2);
  free(head);
  return tudo;
}

team A(team headequipa, int count)
{
  team cabeca;
  char n[1024];
  char *s;
  for (int n_index = 0; n_index < 10; n_index++)
  {
    n[n_index] = new_sym_var(sizeof(char) * 8);
  }

  n[10 - 1] = '\0';
  s = (char *) malloc((sizeof(char)) * (strlen(n) + 1));
  strcpy(s, n);
  cabeca = searchTeams(s, headequipa);
  if (cabeca == 0)
  {
    cabeca = insertBegin(headequipa, s);
    free(s);
    return cabeca;
  }
  else
  {
    printf("%d Equipa existente.\n", count);
  }

  free(s);
  return headequipa;
}

void p(campeonato *tabela, int count)
{
  int size = 0;
  campeonato cabeca;
  char name[1024];
  char *s;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  size = strlen(name) + 1;
  s = malloc(size);
  strcpy(s, name);
  cabeca = search_hash(tabela, s);
  if (cabeca != 0)
  {
    printf("%d %s %s %s %d %d\n", count, cabeca->j->nome, cabeca->j->equipa1, cabeca->j->equipa2, cabeca->j->score1, cabeca->j->score2);
    free(s);
  }
  else
  {
    printf("%d Jogo inexistente.\n", count);
    free(s);
  }

}

void P(team headequipa, int count)
{
  team vitorias;
  char string[1024];
  char *S;
  for (int string_index = 0; string_index < 10; string_index++)
  {
    string[string_index] = new_sym_var(sizeof(char) * 8);
  }

  string[10 - 1] = '\0';
  S = (char *) malloc((sizeof(char)) * (strlen(string) + 1));
  strcpy(S, string);
  vitorias = searchTeams(S, headequipa);
  if (vitorias != 0)
  {
    free(S);
    printf("%d %s %d\n", count, vitorias->nome, vitorias->vitorias);
  }
  else
  {
    free(S);
    printf("%d Equipa inexistente.\n", count);
  }

}

void l(copa *golo, int count)
{
  copa *t;
  for (t = golo; t != 0; t = t->next)
    printf("%d %s %s %s %d %d\n", count, t->text, t->Pequipa, t->Sequipa, t->Pscore, t->Sscore);

}

Junta *r(Junta *tudo, team equipa, int M, int Count)
{
  char n[1024];
  char *text;
  campeonato cabeca;
  for (int n_index = 0; n_index < 10; n_index++)
  {
    n[n_index] = new_sym_var(sizeof(char) * 8);
  }

  n[10 - 1] = '\0';
  text = (char *) malloc((sizeof(char)) * (strlen(n) + 1));
  strcpy(text, n);
  cabeca = search_hash(tudo->hashtable, text);
  if (cabeca != 0)
  {
    Remove_Vitoria(cabeca->j->equipa1, cabeca->j->equipa2, cabeca->j->score1, cabeca->j->score2, equipa);
    tudo->hashtable = removeEl(tudo->hashtable, text, M);
    tudo->lista = RLista(tudo->lista, text);
    free(text);
    return tudo;
  }
  else
  {
    printf("%d Jogo inexistente.\n", Count);
  }

  free(text);
  return tudo;
}

Junta *s(Junta *tudo, team equipa, int Count)
{
  char n[1024];
  char *string;
  campeonato cabeca;
  copa *cabana;
  int s1 = 0;
  int s2 = 0;
  for (int n_index = 0; n_index < 10; n_index++)
  {
    n[n_index] = new_sym_var(sizeof(char) * 8);
  }

  n[10 - 1] = '\0';
  s1 = new_sym_var(sizeof(int) * 8);
  s2 = new_sym_var(sizeof(int) * 8);
  string = (char *) malloc((sizeof(char)) * (strlen(n) + 1));
  strcpy(string, n);
  cabeca = search_hash(tudo->hashtable, string);
  if (cabeca != 0)
  {
    if (s1 == s2)
    {
      if (cabeca->j->score1 > cabeca->j->score2)
      {
        Retira_Vitoria(cabeca->j->equipa1, equipa);
        cabeca->j->score1 = s1;
        cabeca->j->score2 = s2;
      }
      else
      {
        if (cabeca->j->score2 > cabeca->j->score1)
        {
          Retira_Vitoria(cabeca->j->equipa2, equipa);
          cabeca->j->score1 = s1;
          cabeca->j->score2 = s2;
        }
        else
        {
          
        }

      }

    }
    else
    {
      if (s1 > s2)
      {
        if (cabeca->j->score1 == cabeca->j->score2)
        {
          Adiciona_Vitoria(cabeca->j->equipa1, equipa);
          cabeca->j->score1 = s1;
          cabeca->j->score2 = s2;
        }
        else
        {
          if (cabeca->j->score1 < cabeca->j->score2)
          {
            Retira_Vitoria(cabeca->j->equipa2, equipa);
            Adiciona_Vitoria(cabeca->j->equipa1, equipa);
            cabeca->j->score1 = s1;
            cabeca->j->score2 = s2;
          }
          else
          {
            
          }

        }

      }
      else
      {
        if (s1 < s2)
        {
          if (cabeca->j->score1 == cabeca->j->score2)
          {
            Adiciona_Vitoria(cabeca->j->equipa2, equipa);
            cabeca->j->score1 = s1;
            cabeca->j->score2 = s2;
          }
          else
          {
            if (cabeca->j->score1 > cabeca->j->score2)
            {
              Retira_Vitoria(cabeca->j->equipa1, equipa);
              Adiciona_Vitoria(cabeca->j->equipa2, equipa);
              cabeca->j->score1 = s1;
              cabeca->j->score2 = s2;
            }
            else
            {
              
            }

          }

        }
        else
        {
          
        }

      }

    }

    cabeca->j->score1 = s1;
    cabeca->j->score2 = s2;
    cabana = Search_Copas(tudo->lista, cabeca->j->nome);
    cabana->Pscore = s1;
    cabana->Sscore = s2;
  }
  else
  {
    printf("%d Jogo inexistente.\n", Count);
  }

  free(string);
  return tudo;
}

void g(team cabeca, int Count)
{
  int size = 0;
  char *nomes[500];
  team t;
  if (cabeca != 0)
  {
    int j = cabeca->vitorias;
    int e = 0;
    int i = 0;
    for (t = cabeca; t != 0; t = t->next)
    {
      if (j < t->vitorias)
      {
        j = t->vitorias;
      }
      else
      {
        
      }

    }

    for (t = cabeca; t != 0; t = t->next)
    {
      if (j == t->vitorias)
      {
        size = strlen(t->nome) + 1;
        nomes[e] = malloc(size);
        strncpy(nomes[e], t->nome, size);
        e++;
      }
      else
      {
        
      }

    }

    printf("%d Melhores %d\n", Count, j);
    qsort(nomes, e, sizeof(team), cmpfunc);
    for (i = 0; i < e; i++)
    {
      printf("%d * %s\n", Count, nomes[i]);
      free(nomes[i]);
    }

  }
  else
  {
    
  }

}

void x(Junta *tudo, team equipa)
{
  int i;
  while (equipa != 0)
  {
    equipa = libertaequipa(equipa);
  }

  while (tudo->lista != 0)
  {
    tudo->lista = libertalista(tudo->lista);
  }

  for (i = 0; i < 1051; i++)
  {
    if (tudo->hashtable[i] != 0)
    {
      while (tudo->hashtable[i] != 0)
      {
        tudo->hashtable[i] = libertahashtable(tudo->hashtable[i]);
      }

      free(tudo->hashtable[i]);
    }
    else
    {
      
    }

  }

  free(tudo->hashtable);
  free(tudo->lista);
  free(tudo);
}

