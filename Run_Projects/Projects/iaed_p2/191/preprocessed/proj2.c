/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "HashtableGame.h"
#include "HashtableTeam.h"


static void copyGames(Game **src, Game *dest, int size)
{
  int i;
  int j;
  j = 0;
  for (i = 0; i < size; i++)
  {
    if ((src[i] != 0) && (!src[i]->isDeleted))
    {
      {
        dest[j++] = *src[i];
      }
    }
    else
    {
      
    }

  }

}

static void copyTeams(Team **src, Team *dest, int size)
{
  int i;
  int j;
  j = 0;
  for (i = 0; i < size; i++)
  {
    if ((src[i] != 0) && (!src[i]->isDeleted))
    {
      {
        dest[j++] = *src[i];
      }
    }
    else
    {
      
    }

  }

}

static int compareGame(const void *a, const void *b)
{
  Game *game1;
  Game *game2;
  game1 = (Game *) a;
  game2 = (Game *) b;
  return game1->id - game2->id;
}

static int compareTeam(const void *a, const void *b)
{
  Team *team1;
  Team *team2;
  team1 = (Team *) a;
  team2 = (Team *) b;
  return team2->nWon - team1->nWon;
}

static int compareTeamName(const void *a, const void *b)
{
  Team *team1;
  Team *team2;
  team1 = (Team *) a;
  team2 = (Team *) b;
  return strcmp(team1->name, team2->name);
}

void addGame(HTG *htg, HTT *htt, int cmdCount, unsigned int id, unsigned int score[], char *teamStr1, char *teamStr2, char *name)
{
  Game *game;
  Team *team1;
  Team *team2;
  game = getGame(htg, name);
  team1 = getTeam(htt, teamStr1);
  team2 = getTeam(htt, teamStr2);
  if (game != 0)
  {
    {
      printf("%d Jogo existente.\n", cmdCount);
      return;
    }
  }
  else
  {
    if ((team1 == 0) || (team2 == 0))
    {
      {
        printf("%d Equipa inexistente.\n", cmdCount);
        return;
      }
    }
    else
    {
      
    }

  }

  game = newGame(id, score, team1, team2, name);
  insertHTG(htg, game);
}

void addTeam(HTT *htt, unsigned int id, int cmdCount, char *name)
{
  Team *team;
  team = getTeam(htt, name);
  if (team != 0)
  {
    {
      printf("%d Equipa existente.\n", cmdCount);
      return;
    }
  }
  else
  {
    
  }

  team = newTeam(id, name);
  insertHTT(htt, team);
}

void searchTeam(HTT *htt, int cmdCount, char *name)
{
  Team *team;
  team = getTeam(htt, name);
  if (team == 0)
  {
    {
      printf("%d Equipa inexistente.\n", cmdCount);
      return;
    }
  }
  else
  {
    
  }

  printf("%d %s %d\n", cmdCount, team->name, team->nWon);
}

void searchGame(HTG *htg, int cmdCount, char *name)
{
  Game *game;
  game = getGame(htg, name);
  if (game == 0)
  {
    {
      printf("%d Jogo inexistente.\n", cmdCount);
      return;
    }
  }
  else
  {
    
  }

  printf("%d %s %s %s %u %u\n", cmdCount, game->name, game->team1->name, game->team2->name, game->score[0], game->score[1]);
}

void listGames(HTG *htg, int cmdCount)
{
  Game *games;
  Game **vector;
  int size;
  int factor;
  int i;
  size = htg->size;
  factor = htg->factor;
  vector = htg->items;
  if (size == 0)
  {
    {
      return;
    }
  }
  else
  {
    
  }

  games = (Game *) malloc((sizeof(Game)) * size);
  copyGames(vector, games, factor);
  qsort(games, size, sizeof(Game), compareGame);
  for (i = 0; i < size; i++)
  {
    printf("%d %s %s %s %u %u\n", cmdCount, games[i].name, games[i].team1->name, games[i].team2->name, games[i].score[0], games[i].score[1]);
  }

  free(games);
}

void changeScore(HTG *htg, int cmdCount, char *name, unsigned int score[])
{
  Game *game;
  game = getGame(htg, name);
  if (game == 0)
  {
    {
      printf("%d Jogo inexistente.\n", cmdCount);
      return;
    }
  }
  else
  {
    
  }

  if (game->score[0] > game->score[1])
  {
    {
      if (score[0] < score[1])
      {
        {
          game->team1->nWon--;
          game->team2->nWon++;
        }
      }
      else
      {
        if (score[0] == score[1])
        {
          {
            game->team1->nWon--;
          }
        }
        else
        {
          
        }

      }

    }
  }
  else
  {
    if (game->score[0] < game->score[1])
    {
      {
        if (score[0] > score[1])
        {
          {
            game->team1->nWon++;
            game->team2->nWon--;
          }
        }
        else
        {
          if (score[0] == score[1])
          {
            {
              game->team2->nWon--;
            }
          }
          else
          {
            
          }

        }

      }
    }
    else
    {
      if (game->score[0] == game->score[1])
      {
        {
          if (score[0] > score[1])
          {
            {
              game->team1->nWon++;
            }
          }
          else
          {
            if (score[0] < score[1])
            {
              {
                game->team2->nWon++;
              }
            }
            else
            {
              
            }

          }

        }
      }
      else
      {
        
      }

    }

  }

  game->score[0] = score[0];
  game->score[1] = score[1];
}

void listMostWon(HTT *htt, int cmdCount)
{
  Team *teams;
  Team **vector;
  char **temp;
  int i;
  int size;
  int factor;
  size = htt->size;
  factor = htt->factor;
  vector = htt->items;
  if (size == 0)
  {
    {
      return;
    }
  }
  else
  {
    
  }

  teams = (Team *) malloc((sizeof(Team)) * size);
  copyTeams(vector, teams, factor);
  qsort(teams, size, sizeof(Team), compareTeam);
  for (i = 0; i < size; i++)
  {
    if (teams[i].nWon != teams[0].nWon)
    {
      {
        break;
      }
    }
    else
    {
      
    }

  }

  size = i;
  temp = (char **) malloc((sizeof(char *)) * size);
  for (i = 0; i < size; i++)
  {
    temp[i] = teams[i].name;
  }

  qsort(temp, size, sizeof(char *), compareTeamName);
  printf("%d Melhores %d\n", cmdCount, teams[0].nWon);
  for (i = 0; i < size; i++)
  {
    printf("%d * %s\n", cmdCount, temp[i]);
  }

  free(teams);
  free(temp);
}

void removeGame(HTG *htg, int cmdCount, char *name)
{
  Game *game;
  game = getGame(htg, name);
  if (game == 0)
  {
    {
      printf("%d Jogo inexistente.\n", cmdCount);
      return;
    }
  }
  else
  {
    
  }

  if (game->score[0] > game->score[1])
  {
    {
      game->team1->nWon--;
    }
  }
  else
  {
    if (game->score[0] < game->score[1])
    {
      {
        game->team2->nWon--;
      }
    }
    else
    {
      
    }

  }

  deleteHTG(htg, game);
}

void freeTables(HTG *htg, HTT *htt)
{
  freeHTT(htt);
  freeHTG(htg);
}

void menu(HTG *htg, HTT *htt, int cmdCount, unsigned int teamID, unsigned int gameID, unsigned int score[], char command, char name[], char teamStr1[], char teamStr2[])
{
  while (command != 'x')
  {
    switch (command)
    {
      case 'a':
        getchar();
        for (int name_index = 0; name_index < 10; name_index++)
      {
        name[name_index] = new_sym_var(sizeof(char) * 8);
      }

        name[10 - 1] = '\0';
        for (int teamStr1_index = 0; teamStr1_index < 10; teamStr1_index++)
      {
        teamStr1[teamStr1_index] = new_sym_var(sizeof(char) * 8);
      }

        teamStr1[10 - 1] = '\0';
        for (int teamStr2_index = 0; teamStr2_index < 10; teamStr2_index++)
      {
        teamStr2[teamStr2_index] = new_sym_var(sizeof(char) * 8);
      }

        teamStr2[10 - 1] = '\0';
        score[0] = new_sym_var(sizeof(unsigned int) * 8);
        score[1] = new_sym_var(sizeof(unsigned int) * 8);
        addGame(htg, htt, ++cmdCount, gameID++, score, teamStr1, teamStr2, name);
        break;

      case 'l':
        listGames(htg, ++cmdCount);
        break;

      case 'p':
        getchar();
        for (int name_index = 0; name_index < 10; name_index++)
      {
        name[name_index] = new_sym_var(sizeof(char) * 8);
      }

        name[10 - 1] = '\0';
        searchGame(htg, ++cmdCount, name);
        break;

      case 'r':
        getchar();
        for (int name_index = 0; name_index < 10; name_index++)
      {
        name[name_index] = new_sym_var(sizeof(char) * 8);
      }

        name[10 - 1] = '\0';
        removeGame(htg, ++cmdCount, name);
        break;

      case 's':
        getchar();
        for (int name_index = 0; name_index < 10; name_index++)
      {
        name[name_index] = new_sym_var(sizeof(char) * 8);
      }

        name[10 - 1] = '\0';
        score[0] = new_sym_var(sizeof(unsigned int) * 8);
        score[1] = new_sym_var(sizeof(unsigned int) * 8);
        changeScore(htg, ++cmdCount, name, score);
        break;

      case 'A':
        getchar();
        for (int name_index = 0; name_index < 10; name_index++)
      {
        name[name_index] = new_sym_var(sizeof(char) * 8);
      }

        name[10 - 1] = '\0';
        addTeam(htt, teamID++, ++cmdCount, name);
        break;

      case 'P':
        getchar();
        for (int name_index = 0; name_index < 10; name_index++)
      {
        name[name_index] = new_sym_var(sizeof(char) * 8);
      }

        name[10 - 1] = '\0';
        searchTeam(htt, ++cmdCount, name);
        break;

      case 'g':
        listMostWon(htt, ++cmdCount);
        break;

      default:
        break;

    }

    command = getchar();
  }

}

int main()
{
  int cmdCount;
  unsigned int teamID;
  unsigned int gameID;
  unsigned int score[2];
  char command;
  char name[1024];
  char teamStr1[1024];
  char teamStr2[1024];
  HTG *htg;
  HTT *htt;
  htg = newHTG(3011, 0);
  htt = newHTT(3011, 0);
  cmdCount = 0;
  teamID = 0;
  gameID = 0;
  command = getchar();
  menu(htg, htt, cmdCount, teamID, gameID, score, command, name, teamStr1, teamStr2);
  freeTables(htg, htt);
  return 0;
}

