/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdbool.h>


int id_output = 1;
typedef struct Jogo
{
  char nome[1050];
  struct Equipa *equipa_1;
  struct Equipa *equipa_2;
  int score_1;
  int score_2;
  struct Jogo *next;
  struct Jogo *prox_cron;
} Jogo;
typedef struct HashJ
{
  struct Jogo *head;
} HashJ;
typedef struct Equipa
{
  char nome[1050];
  int num_vitorias;
  struct Equipa *next;
} Equipa;
typedef struct HashE
{
  struct Equipa *head;
} HashE;
HashJ jogos[26];
HashE equipas[26];
Jogo *head_cron;
Jogo *tail_cron;
int getchave(char argv[])
{
  char letra = argv[0];
  return letra % 26;
}

Equipa *procura_equipa(char argv[])
{
  int hash = getchave(argv);
  Equipa *x = equipas[hash].head;
  for (; x != 0; x = x->next)
  {
    if (!strcmp(x->nome, argv))
    {
      return x;
    }
    else
    {
      
    }

  }

  return 0;
}

Jogo *procura_jogo(char argv[])
{
  int hash = getchave(argv);
  Jogo *x = jogos[hash].head;
  for (; x != 0; x = x->next)
  {
    if (!strcmp(x->nome, argv))
    {
      return x;
    }
    else
    {
      
    }

  }

  return 0;
}

void adiciona_jogo(char argv[])
{
  char delimt[2] = ":";
  char name[1050];
  Equipa *eqp_1;
  Equipa *eqp_2;
  char eqp_1_2[1050];
  char eqp_2_2[1050];
  char scr_1[1050];
  char scr_2[1050];
  int scr_1_2;
  int scr_2_2;
  Jogo *x;
  int hash;
  hash = getchave(argv);
  x = jogos[hash].head;
  strcpy(name, strtok(argv, delimt));
  strcpy(eqp_1_2, strtok(0, delimt));
  strcpy(eqp_2_2, strtok(0, delimt));
  strcpy(scr_1, strtok(0, delimt));
  strcpy(scr_2, strtok(0, delimt));
  scr_1_2 = strtol(scr_1, 0, 10);
  scr_2_2 = strtol(scr_2, 0, 10);
  eqp_1 = procura_equipa(eqp_1_2);
  eqp_2 = procura_equipa(eqp_2_2);
  if (!(!procura_jogo(name)))
  {
    printf("%d %s\n", id_output, "Jogo existente.");
    id_output++;
    return;
  }
  else
  {
    
  }

  if (!eqp_1)
  {
    printf("%d %s\n", id_output, "Equipa inexistente.");
    id_output++;
    return;
  }
  else
  {
    
  }

  if (!eqp_2)
  {
    printf("%d %s\n", id_output, "Equipa inexistente.");
    id_output++;
    return;
  }
  else
  {
    
  }

  jogos[hash].head = malloc(sizeof(struct Jogo));
  jogos[hash].head->prox_cron = 0;
  strcpy(jogos[hash].head->nome, name);
  jogos[hash].head->equipa_1 = eqp_1;
  jogos[hash].head->equipa_2 = eqp_2;
  jogos[hash].head->score_1 = scr_1_2;
  jogos[hash].head->score_2 = scr_2_2;
  jogos[hash].head->next = x;
  if (scr_1_2 > scr_2_2)
  {
    jogos[hash].head->equipa_1->num_vitorias++;
  }
  else
  {
    if (scr_1_2 < scr_2_2)
    {
      jogos[hash].head->equipa_2->num_vitorias++;
    }
    else
    {
      
    }

  }

  if (!head_cron)
  {
    head_cron = jogos[hash].head;
    tail_cron = jogos[hash].head;
  }
  else
  {
    tail_cron->prox_cron = jogos[hash].head;
    tail_cron = jogos[hash].head;
  }

  id_output++;
}

void adiciona_equipa(char argv[])
{
  Equipa *x;
  int hash;
  hash = getchave(argv);
  x = equipas[hash].head;
  if (procura_equipa(argv) != 0)
  {
    printf("%d %s\n", id_output, "Equipa existente.");
    id_output++;
  }
  else
  {
    if (!x)
    {
      equipas[hash].head = malloc(sizeof(struct Equipa));
      strcpy(equipas[hash].head->nome, argv);
      equipas[hash].head->num_vitorias = 0;
      equipas[hash].head->next = 0;
      id_output++;
      return;
    }
    else
    {
      x = malloc(sizeof(struct Equipa));
      x->next = equipas[hash].head;
      equipas[hash].head = x;
      strcpy(x->nome, argv);
      x->num_vitorias = 0;
      id_output++;
    }

  }

}

void lista_jogos()
{
  Jogo *temp;
  temp = head_cron;
  while (temp)
  {
    printf("%d %s %s %s %d %d\n", id_output, temp->nome, temp->equipa_1->nome, temp->equipa_2->nome, temp->score_1, temp->score_2);
    temp = temp->prox_cron;
  }

  id_output++;
}

void procura_jogos(char argv[])
{
  char *name;
  char eqp_1[1050];
  char eqp_2[1050];
  int scr_1;
  int scr_2;
  Jogo *x;
  name = argv;
  x = procura_jogo(argv);
  if (!x)
  {
    printf("%d %s\n", id_output, "Jogo inexistente.");
    id_output++;
  }
  else
  {
    strcpy(eqp_1, x->equipa_1->nome);
    strcpy(eqp_2, x->equipa_2->nome);
    scr_1 = x->score_1;
    scr_2 = x->score_2;
    printf("%d %s %s %s %d %d\n", id_output, name, eqp_1, eqp_2, scr_1, scr_2);
    id_output++;
  }

}

void procura_equipas(char argv[])
{
  int num_jogos_ganhos;
  Equipa *x;
  x = procura_equipa(argv);
  if (!x)
  {
    printf("%d %s\n", id_output, "Equipa inexistente.");
    id_output++;
  }
  else
  {
    num_jogos_ganhos = x->num_vitorias;
    printf("%d %s %d\n", id_output, argv, num_jogos_ganhos);
    id_output++;
  }

}

void apaga_jogo(char argv[])
{
  Jogo *x;
  Jogo *prev_cron = 0;
  Jogo *prev = 0;
  int hash;
  hash = getchave(argv);
  x = jogos[hash].head;
  for (; x;)
  {
    if (!strcmp(x->nome, argv))
    {
      break;
    }
    else
    {
      
    }

    prev = x;
    x = x->next;
  }

  for (x = head_cron; x != 0;)
  {
    if (!strcmp(x->nome, argv))
    {
      break;
    }
    else
    {
      
    }

    prev_cron = x;
    x = x->prox_cron;
  }

  if (!x)
  {
    printf("%d %s\n", id_output, "Jogo inexistente.");
    id_output++;
  }
  else
  {
    if (x->score_1 > x->score_2)
    {
      x->equipa_1->num_vitorias--;
    }
    else
    {
      if (x->score_1 < x->score_2)
      {
        x->equipa_2->num_vitorias--;
      }
      else
      {
        
      }

    }

    if (head_cron == x)
    {
      head_cron = x->next;
    }
    else
    {
      prev_cron->prox_cron = x->prox_cron;
    }

    if (tail_cron == x)
    {
      if (head_cron == x)
      {
        tail_cron = 0;
      }
      else
      {
        tail_cron = prev_cron;
      }

    }
    else
    {
      
    }

    if (jogos[hash].head == x)
    {
      jogos[hash].head = x->next;
    }
    else
    {
      prev->next = x->next;
    }

    free(x);
    id_output++;
  }

}

void altera_score(char argv[])
{
  char delimt[2] = ":";
  char name[1050];
  char scr_1[1050];
  char scr_2[1050];
  int scr_1_2;
  int scr_2_2;
  Jogo *x;
  int hash;
  hash = getchave(argv);
  x = jogos[hash].head;
  strcpy(name, strtok(argv, delimt));
  strcpy(scr_1, strtok(0, delimt));
  strcpy(scr_2, strtok(0, delimt));
  scr_1_2 = strtol(scr_1, 0, 10);
  scr_2_2 = strtol(scr_2, 0, 10);
  x = procura_jogo(name);
  if (!x)
  {
    printf("%d %s\n", id_output, "Jogo inexistente.");
    id_output++;
  }
  else
  {
    if (x->score_1 > x->score_2)
    {
      if (scr_2_2 > scr_1_2)
      {
        x->equipa_1->num_vitorias--;
        x->equipa_2->num_vitorias++;
      }
      else
      {
        
      }

    }
    else
    {
      if (x->score_1 < x->score_2)
      {
        if (scr_1_2 > scr_2_2)
        {
          x->equipa_1->num_vitorias++;
          x->equipa_2->num_vitorias--;
        }
        else
        {
          
        }

      }
      else
      {
        
      }

    }

    x->score_1 = scr_1_2;
    x->score_2 = scr_2_2;
    id_output++;
  }

}

int maximo_vitorias()
{
  int max = 0;
  Equipa *x;
  int i;
  for (i = 0; i < 25; i++)
  {
    if (!equipas[i].head)
    {
      continue;
    }
    else
    {
      
    }

    for (x = equipas[i].head; x; x = x->next)
    {
      if (x->num_vitorias > max)
      {
        max = x->num_vitorias;
      }
      else
      {
        
      }

    }

  }

  return max;
}

void encontra_mais_vitorias()
{
  int num_max_vitorias = maximo_vitorias();
  int i;
  int j;
  int n;
  Equipa *x;
  Equipa *temp;
  Equipa *equipas_mais_vitorias[80000];
  j = 0;
  for (i = 0; i < 25; i++)
  {
    if (!equipas[i].head)
    {
      continue;
    }
    else
    {
      
    }

    for (x = equipas[i].head; x; x = x->next)
    {
      if (x->num_vitorias == num_max_vitorias)
      {
        equipas_mais_vitorias[j] = x;
        j++;
      }
      else
      {
        
      }

    }

  }

  n = j;
  for (i = 0; i < (n - 1); i++)
  {
    for (j = 0; j < ((n - i) - 1); j++)
    {
      if (strcmp(equipas_mais_vitorias[j]->nome, equipas_mais_vitorias[j + 1]->nome) > 0)
      {
        temp = equipas_mais_vitorias[j];
        equipas_mais_vitorias[j] = equipas_mais_vitorias[j + 1];
        equipas_mais_vitorias[j + 1] = temp;
      }
      else
      {
        
      }

    }

  }

  if (n > 0)
  {
    printf("%d %s %d\n", id_output, "Melhores", num_max_vitorias);
    for (i = 0; i < n; i++)
    {
      printf("%d %s %s\n", id_output, "*", equipas_mais_vitorias[i]->nome);
    }

  }
  else
  {
    
  }

  id_output++;
}

int main()
{
  int i;
  Jogo *x;
  Jogo *temp_J;
  Equipa *y;
  Equipa *temp_E;
  char instruction[80000];
  char cmd = ' ';
  head_cron = 0;
  while (cmd != 'x')
  {
    cmd = getchar();
    switch (cmd)
    {
      case 'a':
        getchar();
        for (int instruction_index = 0; instruction_index < 10; instruction_index++)
      {
        instruction[instruction_index] = new_sym_var(sizeof(char) * 8);
      }

        instruction[10 - 1] = '\0';
        adiciona_jogo(instruction);
        break;

      case 'A':
        getchar();
        for (int instruction_index = 0; instruction_index < 10; instruction_index++)
      {
        instruction[instruction_index] = new_sym_var(sizeof(char) * 8);
      }

        instruction[10 - 1] = '\0';
        adiciona_equipa(instruction);
        break;

      case 'l':
        lista_jogos(instruction);
        break;

      case 'p':
        getchar();
        for (int instruction_index = 0; instruction_index < 10; instruction_index++)
      {
        instruction[instruction_index] = new_sym_var(sizeof(char) * 8);
      }

        instruction[10 - 1] = '\0';
        procura_jogos(instruction);
        break;

      case 'P':
        getchar();
        for (int instruction_index = 0; instruction_index < 10; instruction_index++)
      {
        instruction[instruction_index] = new_sym_var(sizeof(char) * 8);
      }

        instruction[10 - 1] = '\0';
        procura_equipas(instruction);
        break;

      case 'r':
        getchar();
        for (int instruction_index = 0; instruction_index < 10; instruction_index++)
      {
        instruction[instruction_index] = new_sym_var(sizeof(char) * 8);
      }

        instruction[10 - 1] = '\0';
        apaga_jogo(instruction);
        break;

      case 's':
        getchar();
        for (int instruction_index = 0; instruction_index < 10; instruction_index++)
      {
        instruction[instruction_index] = new_sym_var(sizeof(char) * 8);
      }

        instruction[10 - 1] = '\0';
        altera_score(instruction);
        break;

      case 'g':
        encontra_mais_vitorias(instruction);
        break;

    }

  }

  for (i = 0; i < 25; i++)
  {
    if (jogos[i].head)
    {
      for (x = jogos[i].head; x;)
      {
        temp_J = x;
        x = x->next;
        free(temp_J);
      }

    }
    else
    {
      
    }

  }

  for (i = 0; i < 25; i++)
  {
    if (equipas[i].head)
    {
      for (y = equipas[i].head; y;)
      {
        temp_E = y;
        y = y->next;
        free(temp_E);
      }

    }
    else
    {
      
    }

  }

  return 0;
}

