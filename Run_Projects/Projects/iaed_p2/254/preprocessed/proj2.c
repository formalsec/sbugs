/*File generated by PreProcessor.py*/


#include <stdio.h>    	/*Bibliotecas de funcoes*/
#include <string.h>
#include <stdlib.h>


typedef struct jogo
{
  char *nome;
  char *equipa1;
  char *equipa2;
  int golos1;
  int golos2;
  struct jogo *next;
} *jogo;
typedef struct equipa
{
  char *nome;
  int wins;
  struct equipa *next;
} *equipa;
typedef struct linked_list_jogo
{
  struct jogo *ptr;
  struct linked_list_jogo *next;
} *linked_list_jogo;
int NL = 1;
int existe_equipas = 0;
void liberta_equipas(equipa *h)
{
  int i;
  equipa aux;
  for (i = 0; i < 1997; i++)
  {
    while (h[i] != 0)
    {
      aux = h[i]->next;
      free(h[i]->nome);
      free(h[i]);
      h[i] = aux;
    }

  }

  free(h);
}

void liberta_equipas1(equipa *h)
{
  int i;
  equipa aux;
  for (i = 0; i < 1; i++)
  {
    while (h[i] != 0)
    {
      aux = h[i]->next;
      free(h[i]->nome);
      free(h[i]);
      h[i] = aux;
    }

  }

  free(h);
}

void liberta_jogos(jogo *h)
{
  int i;
  jogo aux;
  for (i = 0; i < 1997; i++)
  {
    while (h[i] != 0)
    {
      aux = h[i]->next;
      free(h[i]->nome);
      free(h[i]->equipa1);
      free(h[i]->equipa2);
      free(h[i]);
      h[i] = aux;
    }

  }

  free(h);
}

void liberta_jogos1(linked_list_jogo *h)
{
  int i;
  linked_list_jogo aux;
  for (i = 0; i < 1; i++)
  {
    while (h[i] != 0)
    {
      aux = h[i]->next;
      free(h[i]);
      h[i] = aux;
    }

  }

  free(h);
}

int ASCII(char *name)
{
  int s;
  int i;
  int x;
  int ascii = 0;
  s = strlen(name);
  x = 0;
  for (i = 0; i < s; i++)
  {
    x = name[i];
    ascii += x;
  }

  return ascii;
}

int devolvekey(char *name)
{
  int ascii;
  int key;
  ascii = ASCII(name);
  key = ascii % 1997;
  return key;
}

jogo *criar_hash_jogo()
{
  int i;
  jogo *heads = malloc(1997 * (sizeof(struct jogo)));
  for (i = 0; i < 1997; i++)
    heads[i] = 0;

  return heads;
}

linked_list_jogo *criar_hash_lista_jogos()
{
  linked_list_jogo *heads = malloc(sizeof(struct linked_list_jogo));
  heads[0] = 0;
  return heads;
}

equipa *criar_hash_equipa()
{
  int i;
  equipa *heads = malloc(1997 * (sizeof(struct equipa)));
  for (i = 0; i < 1997; i++)
    heads[i] = 0;

  return heads;
}

equipa *criar_hash_equipa1()
{
  equipa *heads = malloc(sizeof(struct equipa));
  heads[0] = 0;
  return heads;
}

equipa NEW_equipa(char *text)
{
  equipa x = malloc(sizeof(struct equipa));
  x->nome = malloc((sizeof(char)) * (strlen(text) + 1));
  strcpy(x->nome, text);
  x->wins = 0;
  return x;
}

equipa NEW_equipa1(char *text)
{
  equipa x = malloc(sizeof(struct equipa));
  x->nome = malloc((sizeof(char)) * (strlen(text) + 1));
  strcpy(x->nome, text);
  x->wins = 0;
  x->next = 0;
  return x;
}

jogo NEW_jogo(char *text, char *equipa1_input, char *equipa2_input, int golos1_input, int golos2_input)
{
  jogo x = malloc(sizeof(struct jogo));
  x->nome = malloc((sizeof(char)) * (strlen(text) + 1));
  x->equipa1 = malloc((sizeof(char)) * (strlen(equipa1_input) + 1));
  x->equipa2 = malloc((sizeof(char)) * (strlen(equipa2_input) + 1));
  strcpy(x->nome, text);
  strcpy(x->equipa1, equipa1_input);
  strcpy(x->equipa2, equipa2_input);
  x->golos1 = golos1_input;
  x->golos2 = golos2_input;
  return x;
}

equipa insertbegin_equipa(equipa head, char *text)
{
  equipa x = NEW_equipa(text);
  x->next = head;
  head = x;
  return head;
}

jogo insertbegin_jogo_lista_jogos(jogo head, linked_list_jogo *lista_jogos, char *text, char *equipa1_input, char *equipa2_input, int golos1_input, int golos2_input)
{
  jogo x = NEW_jogo(text, equipa1_input, equipa2_input, golos1_input, golos2_input);
  linked_list_jogo y = malloc(sizeof(struct linked_list_jogo));
  x->next = head;
  head = x;
  y->ptr = x;
  y->next = lista_jogos[0];
  lista_jogos[0] = y;
  return head;
}

equipa insert_ordem_alfabetica(equipa head, char *text)
{
  equipa x;
  equipa t;
  t = malloc(sizeof(struct equipa));
  t->nome = malloc((sizeof(char)) * (strlen(text) + 1));
  strcpy(t->nome, text);
  t->wins = 0;
  if ((head == 0) || (strcmp(head->nome, text) > 0))
  {
    {
      t->next = head;
      head = t;
      return head;
    }
  }
  else
  {
    
  }

  for (x = head; x->next != 0; x = x->next)
  {
    if (strcmp(x->next->nome, t->nome) > 0)
    {
      {
        t->next = x->next;
        x->next = t;
        return head;
      }
    }
    else
    {
      
    }

  }

  free(t->nome);
  free(t);
  x->next = NEW_equipa1(text);
  return head;
}

jogo delete(jogo head, linked_list_jogo *lista_jogos, char *text)
{
  jogo x;
  jogo prev;
  linked_list_jogo x1;
  linked_list_jogo prev1;
  for (x1 = lista_jogos[0], prev1 = 0; x1 != 0; prev1 = x1, x1 = x1->next)
  {
    if (strcmp(x1->ptr->nome, text) == 0)
    {
      {
        if (x1 == lista_jogos[0])
        {
          lista_jogos[0] = x1->next;
        }
        else
        {
          prev1->next = x1->next;
        }

        free(x1);
        break;
      }
    }
    else
    {
      
    }

  }

  for (x = head, prev = 0; x != 0; prev = x, x = x->next)
  {
    if (strcmp(x->nome, text) == 0)
    {
      {
        if (x == head)
        {
          head = x->next;
        }
        else
        {
          prev->next = x->next;
        }

        free(x->nome);
        free(x->equipa1);
        free(x->equipa2);
        free(x);
        break;
      }
    }
    else
    {
      
    }

  }

  return head;
}

int verifica_equipa_existente(equipa head, char *equipa_x)
{
  equipa x;
  x = head;
  for (; x != 0; x = x->next)
  {
    if (strcmp(x->nome, equipa_x) == 0)
    {
      return 0;
    }
    else
    {
      
    }

  }

  return 1;
}

int verifica_jogo_existente(jogo head, char *text)
{
  jogo x;
  x = head;
  for (; x != 0; x = x->next)
  {
    if (strcmp(x->nome, text) == 0)
    {
      return 0;
    }
    else
    {
      
    }

  }

  return 1;
}

void adiciona_win(equipa head, char *text)
{
  equipa x;
  x = head;
  for (; x != 0; x = x->next)
  {
    if (strcmp(x->nome, text) == 0)
    {
      {
        x->wins = x->wins + 1;
        return;
      }
    }
    else
    {
      
    }

  }

}

void dimimui_win(equipa head, char *text)
{
  equipa x;
  x = head;
  for (; x != 0; x = x->next)
  {
    if (strcmp(x->nome, text) == 0)
    {
      {
        x->wins = x->wins - 1;
        return;
      }
    }
    else
    {
      
    }

  }

}

int encontra_max_wins(equipa *hash_table_equipa)
{
  int i;
  int max_wins = 0;
  equipa x;
  for (i = 0; i < 1997; i++)
  {
    x = hash_table_equipa[i];
    for (; x != 0; x = x->next)
    {
      if (x->wins > max_wins)
      {
        max_wins = x->wins;
      }
      else
      {
        
      }

    }

  }

  return max_wins;
}

void adiciona_jogo(jogo *hash_table_jogo, equipa *hash_table_equipa, linked_list_jogo *lista_jogos, char *jogo_input, char *equipa1_input, char *equipa2_input, int golos1_input, int golos2_input)
{
  int key = devolvekey(jogo_input);
  int key_equipa1 = devolvekey(equipa1_input);
  int key_equipa2 = devolvekey(equipa2_input);
  if (verifica_jogo_existente(hash_table_jogo[key], jogo_input) == 0)
  {
    {
      printf("%d Jogo existente.\n", NL);
    }
  }
  else
  {
    {
      if (verifica_equipa_existente(hash_table_equipa[key_equipa1], equipa1_input) || verifica_equipa_existente(hash_table_equipa[key_equipa2], equipa2_input))
      {
        {
          printf("%d Equipa inexistente.\n", NL);
          return;
        }
      }
      else
      {
        {
          hash_table_jogo[key] = insertbegin_jogo_lista_jogos(hash_table_jogo[key], lista_jogos, jogo_input, equipa1_input, equipa2_input, golos1_input, golos2_input);
          if (golos1_input > golos2_input)
          {
            {
              adiciona_win(hash_table_equipa[key_equipa1], equipa1_input);
            }
          }
          else
          {
            if (golos2_input > golos1_input)
            {
              {
                adiciona_win(hash_table_equipa[key_equipa2], equipa2_input);
              }
            }
            else
            {
              
            }

          }

        }
      }

    }
  }

}

void adiciona_equipa(char *equipa1_input, equipa *hash_table_equipa)
{
  int key = devolvekey(equipa1_input);
  if (verifica_equipa_existente(hash_table_equipa[key], equipa1_input))
  {
    {
      hash_table_equipa[key] = insertbegin_equipa(hash_table_equipa[key], equipa1_input);
      existe_equipas = 1;
    }
  }
  else
  {
    {
      printf("%d Equipa existente.\n", NL);
    }
  }

}

void procura_equipa(equipa *hash_table_equipa, char *equipa1_input)
{
  equipa x;
  int key = devolvekey(equipa1_input);
  x = hash_table_equipa[key];
  for (; x != 0; x = x->next)
  {
    if (strcmp(x->nome, equipa1_input) == 0)
    {
      {
        printf("%d %s %d\n", NL, x->nome, x->wins);
        return;
      }
    }
    else
    {
      
    }

  }

  printf("%d Equipa inexistente.\n", NL);
}

void procura_jogo(jogo *hash_table_jogo, char *jogo_input)
{
  jogo x;
  int key = devolvekey(jogo_input);
  x = hash_table_jogo[key];
  for (; x != 0; x = x->next)
  {
    if (strcmp(x->nome, jogo_input) == 0)
    {
      {
        printf("%d %s %s %s %d %d\n", NL, x->nome, x->equipa1, x->equipa2, x->golos1, x->golos2);
        return;
      }
    }
    else
    {
      
    }

  }

  printf("%d Jogo inexistente.\n", NL);
}

void lista_jogos_existentes(linked_list_jogo head)
{
  if (head != 0)
  {
    {
      lista_jogos_existentes(head->next);
      printf("%d %s %s %s %d %d\n", NL, head->ptr->nome, head->ptr->equipa1, head->ptr->equipa2, head->ptr->golos1, head->ptr->golos2);
    }
  }
  else
  {
    
  }

}

void altera_score(jogo *hash_table_jogo, linked_list_jogo *lista_jogos, equipa *hash_table_equipa, char *jogo_input, int golos1_input, int golos2_input)
{
  jogo x;
  linked_list_jogo aux;
  int key = devolvekey(jogo_input);
  int key_equipa;
  x = hash_table_jogo[key];
  aux = lista_jogos[0];
  if (verifica_jogo_existente(hash_table_jogo[key], jogo_input) == 1)
  {
    {
      printf("%d Jogo inexistente.\n", NL);
    }
  }
  else
  {
    {
      for (; x != 0; x = x->next)
      {
        if (strcmp(x->nome, jogo_input) == 0)
        {
          {
            if (x->golos1 > x->golos2)
            {
              {
                key_equipa = devolvekey(x->equipa1);
                dimimui_win(hash_table_equipa[key_equipa], x->equipa1);
              }
            }
            else
            {
              if (x->golos1 < x->golos2)
              {
                {
                  key_equipa = devolvekey(x->equipa2);
                  dimimui_win(hash_table_equipa[key_equipa], x->equipa2);
                }
              }
              else
              {
                
              }

            }

            x->golos1 = golos1_input;
            x->golos2 = golos2_input;
            if (x->golos1 > x->golos2)
            {
              {
                key_equipa = devolvekey(x->equipa1);
                adiciona_win(hash_table_equipa[key_equipa], x->equipa1);
              }
            }
            else
            {
              if (x->golos1 < x->golos2)
              {
                {
                  key_equipa = devolvekey(x->equipa2);
                  adiciona_win(hash_table_equipa[key_equipa], x->equipa2);
                }
              }
              else
              {
                
              }

            }

            break;
          }
        }
        else
        {
          
        }

      }

      for (; aux != 0; aux = aux->next)
      {
        if (strcmp(aux->ptr->nome, jogo_input) == 0)
        {
          {
            aux->ptr->golos1 = golos1_input;
            aux->ptr->golos2 = golos2_input;
            return;
          }
        }
        else
        {
          
        }

      }

    }
  }

}

void apaga_jogo(jogo *hash_table_jogo, linked_list_jogo *lista_jogos, equipa *hash_table_equipa, char *jogo_input)
{
  jogo x;
  int key = devolvekey(jogo_input);
  int key_equipa;
  x = hash_table_jogo[key];
  if (verifica_jogo_existente(hash_table_jogo[key], jogo_input) == 1)
  {
    {
      printf("%d Jogo inexistente.\n", NL);
    }
  }
  else
  {
    {
      for (; x != 0; x = x->next)
      {
        if (strcmp(x->nome, jogo_input) == 0)
        {
          {
            if (x->golos1 > x->golos2)
            {
              {
                key_equipa = devolvekey(x->equipa1);
                dimimui_win(hash_table_equipa[key_equipa], x->equipa1);
              }
            }
            else
            {
              if (x->golos1 < x->golos2)
              {
                {
                  key_equipa = devolvekey(x->equipa2);
                  dimimui_win(hash_table_equipa[key_equipa], x->equipa2);
                }
              }
              else
              {
                
              }

            }

            hash_table_jogo[key] = delete(hash_table_jogo[key], lista_jogos, jogo_input);
            return;
          }
        }
        else
        {
          
        }

      }

    }
  }

}

void encontra_equipa_wins(equipa *hash_table_equipa)
{
  int i;
  int max_wins = 0;
  equipa x;
  equipa *lista_equipas = criar_hash_equipa1();
  max_wins = encontra_max_wins(hash_table_equipa);
  if (existe_equipas == 0)
  {
    {
      liberta_equipas1(lista_equipas);
      return;
    }
  }
  else
  {
    
  }

  for (i = 0; i < 1997; i++)
  {
    x = hash_table_equipa[i];
    for (; x != 0; x = x->next)
    {
      if (x->wins == max_wins)
      {
        lista_equipas[0] = insert_ordem_alfabetica(lista_equipas[0], x->nome);
      }
      else
      {
        
      }

    }

  }

  printf("%d Melhores %d\n", NL, max_wins);
  x = lista_equipas[0];
  for (; x != 0; x = x->next)
  {
    printf("%d * %s\n", NL, x->nome);
  }

  liberta_equipas1(lista_equipas);
}

int main()
{
  int golos1_input;
  int golos2_input;
  char jogo_input[1023];
  char equipa1_input[1023];
  char equipa2_input[1023];
  char letra = 't';
  linked_list_jogo *lista_jogos = criar_hash_lista_jogos();
  jogo *hash_table_jogo = criar_hash_jogo();
  equipa *hash_table_equipa = criar_hash_equipa();
  while (letra != 'x')
  {
    letra = new_sym_var(sizeof(char) * 8);
    switch (letra)
    {
      case 'a':
        getchar();
        for (int jogo_input_index = 0; jogo_input_index < 10; jogo_input_index++)
      {
        jogo_input[jogo_input_index] = new_sym_var(sizeof(char) * 8);
      }

        jogo_input[10 - 1] = '\0';
        for (int equipa1_input_index = 0; equipa1_input_index < 10; equipa1_input_index++)
      {
        equipa1_input[equipa1_input_index] = new_sym_var(sizeof(char) * 8);
      }

        equipa1_input[10 - 1] = '\0';
        for (int equipa2_input_index = 0; equipa2_input_index < 10; equipa2_input_index++)
      {
        equipa2_input[equipa2_input_index] = new_sym_var(sizeof(char) * 8);
      }

        equipa2_input[10 - 1] = '\0';
        golos1_input = new_sym_var(sizeof(int) * 8);
        golos2_input = new_sym_var(sizeof(int) * 8);
        adiciona_jogo(hash_table_jogo, hash_table_equipa, lista_jogos, jogo_input, equipa1_input, equipa2_input, golos1_input, golos2_input);
        NL++;
        break;

      case 'A':
        getchar();
        for (int equipa1_input_index = 0; equipa1_input_index < 10; equipa1_input_index++)
      {
        equipa1_input[equipa1_input_index] = new_sym_var(sizeof(char) * 8);
      }

        equipa1_input[10 - 1] = '\0';
        adiciona_equipa(equipa1_input, hash_table_equipa);
        NL++;
        break;

      case 'l':
        lista_jogos_existentes(lista_jogos[0]);
        NL++;
        break;

      case 'p':
        getchar();
        for (int jogo_input_index = 0; jogo_input_index < 10; jogo_input_index++)
      {
        jogo_input[jogo_input_index] = new_sym_var(sizeof(char) * 8);
      }

        jogo_input[10 - 1] = '\0';
        procura_jogo(hash_table_jogo, jogo_input);
        NL++;
        break;

      case 'P':
        getchar();
        for (int equipa1_input_index = 0; equipa1_input_index < 10; equipa1_input_index++)
      {
        equipa1_input[equipa1_input_index] = new_sym_var(sizeof(char) * 8);
      }

        equipa1_input[10 - 1] = '\0';
        procura_equipa(hash_table_equipa, equipa1_input);
        NL++;
        break;

      case 'r':
        getchar();
        for (int jogo_input_index = 0; jogo_input_index < 10; jogo_input_index++)
      {
        jogo_input[jogo_input_index] = new_sym_var(sizeof(char) * 8);
      }

        jogo_input[10 - 1] = '\0';
        apaga_jogo(hash_table_jogo, lista_jogos, hash_table_equipa, jogo_input);
        NL++;
        break;

      case 's':
        getchar();
        for (int jogo_input_index = 0; jogo_input_index < 10; jogo_input_index++)
      {
        jogo_input[jogo_input_index] = new_sym_var(sizeof(char) * 8);
      }

        jogo_input[10 - 1] = '\0';
        golos1_input = new_sym_var(sizeof(int) * 8);
        golos2_input = new_sym_var(sizeof(int) * 8);
        altera_score(hash_table_jogo, lista_jogos, hash_table_equipa, jogo_input, golos1_input, golos2_input);
        NL++;
        break;

      case 'g':
        encontra_equipa_wins(hash_table_equipa);
        NL++;
        break;

      case 'x':
        break;

    }

  }

  liberta_jogos1(lista_jogos);
  liberta_jogos(hash_table_jogo);
  liberta_equipas(hash_table_equipa);
  return 0;
}

