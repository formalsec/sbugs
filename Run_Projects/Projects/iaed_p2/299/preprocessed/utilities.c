/*File generated by PreProcessor.py*/


#include <stdlib.h>
#include <string.h>
#include "utilities.h"
#include "structs_auxiliary.h"


int hash(char *name, int sz)
{
  int h;
  int a = 31415;
  int b = 27183;
  for (h = 0; (*name) != '\0'; name++, a = (a * b) % (sz - 1))
    h = ((a * h) + (*name)) % sz;

  return h;
}

teams *get_winner(games *game)
{
  teams *winner = 0;
  if (game->sc[0] > game->sc[1])
  {
    winner = game->team1;
  }
  else
  {
    if (game->sc[1] > game->sc[0])
    {
      winner = game->team2;
    }
    else
    {
      
    }

  }

  return winner;
}

games *search_game(char *name, games **games_ht)
{
  int hash_id = hash(name, 23269);
  games *curr = games_ht[hash_id];
  while ((curr != 0) && (strcmp(curr->name->name, name) != 0))
    curr = curr->next;

  return curr;
}

teams *search_team(char *name, teams **teams_ht)
{
  int hash_id = hash(name, 23269);
  teams *curr = teams_ht[hash_id];
  while ((curr != 0) && (strcmp(curr->name, name) != 0))
    curr = curr->next;

  return curr;
}

int count_wins(teams *team)
{
  return team->wins;
}

short int ab_ordered(int t1, int t2, teams **teams_contig)
{
  return strcmp(teams_contig[t1]->name, teams_contig[t2]->name) <= 0;
}

void merge_sort(int v[], teams **teams_contig, int l, int r, short int crit(int, int, teams **))
{
  int m = (l + r) / 2;
  if (((r - l) + 1) < 2)
  {
    return;
  }
  else
  {
    
  }

  merge_sort(v, teams_contig, l, m, crit);
  merge_sort(v, teams_contig, m + 1, r, crit);
  merge(v, teams_contig, l, m, r, crit);
}

void merge(int v[], teams **teams_contig, int l, int m, int r, short int crit(int, int, teams **))
{
  int i = l;
  int j = m + 1;
  int k = 0;
  int *aux = malloc(((r - l) + 1) * (sizeof(int)));
  for (; (i <= m) && (j <= r); k++)
  {
    if (crit(v[i], v[j], teams_contig))
    {
      aux[k] = v[i++];
    }
    else
    {
      aux[k] = v[j++];
    }

  }

  while (i <= m)
    aux[k++] = v[i++];

  while (j <= r)
    aux[k++] = v[j++];

  for (i = 0; i < ((r - l) + 1); i++)
    v[l + i] = aux[i];

  free(aux);
}

void clear_system(games **games_ht, game_names **names_pt, teams **teams_ht, teams **teams_contiguous, int *teamc)
{
  int i;
  if ((*names_pt) != 0)
  {
    int hash_id;
    games *curr_game;
    game_names *curr_name = (*names_pt)->last->prev;
    for (; curr_name != 0; curr_name = curr_name->prev)
    {
      hash_id = hash(curr_name->next->name, 23269);
      curr_game = curr_name->next->game;
      elim_game(curr_game, &games_ht[hash_id], names_pt);
    }

    hash_id = hash((*names_pt)->name, 23269);
    curr_game = (*names_pt)->game;
    elim_game(curr_game, &games_ht[hash_id], names_pt);
  }
  else
  {
    
  }

  for (i = 0; i < (*teamc); i++)
  {
    free(teams_contiguous[i]->name);
    free(teams_contiguous[i]);
  }

  free(games_ht);
  free(teams_ht);
  free(teams_contiguous);
}

