/*File generated by PreProcessor.py*/


#include "sistema.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>


Sistema *novoSistema()
{
  Sistema *sistema = malloc(sizeof(Sistema));
  sistema->jogos = init_jogos();
  sistema->equipas = init_equipas();
  sistema->ht = HTinit(10000, 10000);
  return sistema;
}

void destroy_sistema(Sistema *sistema)
{
  destroy_jogos(sistema->jogos);
  destroy_equipas(sistema->equipas);
  HTdestroy(sistema->ht);
  free(sistema);
}

void adiciona_jogo(Sistema *sistema, int NL)
{
  node_jogos *jogo = 0;
  node_equipas *equipa1 = 0;
  node_equipas *equipa2 = 0;
  char n[1023 + 1];
  char e1[1023 + 1];
  char e2[1023 + 1];
  int s1;
  int s2;
  for (int n_index = 0; n_index < (1023 + 1); n_index++)
  {
    n[n_index] = new_sym_var(sizeof(char) * 8);
  }

  n[(1023 + 1) - 1] = '\0';
  for (int e1_index = 0; e1_index < (1023 + 1); e1_index++)
  {
    e1[e1_index] = new_sym_var(sizeof(char) * 8);
  }

  e1[(1023 + 1) - 1] = '\0';
  for (int e2_index = 0; e2_index < (1023 + 1); e2_index++)
  {
    e2[e2_index] = new_sym_var(sizeof(char) * 8);
  }

  e2[(1023 + 1) - 1] = '\0';
  s1 = new_sym_var(sizeof(int) * 8);
  s2 = new_sym_var(sizeof(int) * 8);
  if (HTsearch_jogo(sistema->ht, n))
  {
    printf("%d Jogo existente.\n", NL);
  }
  else
  {
    equipa1 = HTsearch_equipa(sistema->ht, e1);
    equipa2 = HTsearch_equipa(sistema->ht, e2);
    if ((!equipa1) || (!equipa2))
    {
      printf("%d Equipa inexistente.\n", NL);
    }
    else
    {
      jogo = cria_jogo(n, equipa1, equipa2, s1, s2);
      add_jogo(sistema->jogos, jogo);
      HTinsert_jogo(sistema->ht, jogo);
    }

  }

}

void lista_jogos(Sistema *sistema, int NL)
{
  node_jogos *jogo = sistema->jogos->head;
  for (; jogo; jogo = jogo->next)
    printf("%d %s %s %s %d %d\n", NL, jogo->nome, jogo->equipa1->nome, jogo->equipa2->nome, jogo->score1, jogo->score2);

}

void procura_jogo(Sistema *sistema, int NL)
{
  node_jogos *jogo = 0;
  char n[1023 + 1];
  for (int n_index = 0; n_index < (1023 + 1); n_index++)
  {
    n[n_index] = new_sym_var(sizeof(char) * 8);
  }

  n[(1023 + 1) - 1] = '\0';
  jogo = HTsearch_jogo(sistema->ht, n);
  if (jogo)
  {
    printf("%d %s %s %s %d %d\n", NL, jogo->nome, jogo->equipa1->nome, jogo->equipa2->nome, jogo->score1, jogo->score2);
  }
  else
  {
    printf("%d Jogo inexistente.\n", NL);
  }

}

void apaga_jogo(Sistema *sistema, int NL)
{
  node_jogos *jogo = 0;
  char n[1023 + 1];
  for (int n_index = 0; n_index < (1023 + 1); n_index++)
  {
    n[n_index] = new_sym_var(sizeof(char) * 8);
  }

  n[(1023 + 1) - 1] = '\0';
  jogo = HTsearch_jogo(sistema->ht, n);
  if (jogo)
  {
    if (jogo->score1 > jogo->score2)
    {
      equipa_diminui_jogos_ganhos(jogo->equipa1);
    }
    else
    {
      if (jogo->score1 < jogo->score2)
      {
        equipa_diminui_jogos_ganhos(jogo->equipa2);
      }
      else
      {
        
      }

    }

    HTdelete_jogo(sistema->ht, jogo->nome);
    remove_node_jogos(sistema->jogos, jogo);
  }
  else
  {
    printf("%d Jogo inexistente.\n", NL);
  }

}

void altera_score(Sistema *sistema, int NL)
{
  node_jogos *jogo = 0;
  char n[1023 + 1];
  int s1;
  int s2;
  for (int n_index = 0; n_index < (1023 + 1); n_index++)
  {
    n[n_index] = new_sym_var(sizeof(char) * 8);
  }

  n[(1023 + 1) - 1] = '\0';
  s1 = new_sym_var(sizeof(int) * 8);
  s2 = new_sym_var(sizeof(int) * 8);
  jogo = HTsearch_jogo(sistema->ht, n);
  if (jogo)
  {
    atualiza_scores_jogo(jogo, s1, s2);
  }
  else
  {
    printf("%d Jogo inexistente.\n", NL);
  }

}

void adiciona_equipa(Sistema *sistema, int NL)
{
  node_equipas *equipa = 0;
  char n[1023 + 1];
  for (int n_index = 0; n_index < (1023 + 1); n_index++)
  {
    n[n_index] = new_sym_var(sizeof(char) * 8);
  }

  n[(1023 + 1) - 1] = '\0';
  if (HTsearch_equipa(sistema->ht, n))
  {
    printf("%d Equipa existente.\n", NL);
  }
  else
  {
    equipa = cria_equipa(n);
    sistema->equipas = push_equipa(sistema->equipas, equipa);
    HTinsert_equipa(sistema->ht, equipa);
  }

}

void procura_equipa(Sistema *sistema, int NL)
{
  node_equipas *equipa = 0;
  char n[1023 + 1];
  for (int n_index = 0; n_index < (1023 + 1); n_index++)
  {
    n[n_index] = new_sym_var(sizeof(char) * 8);
  }

  n[(1023 + 1) - 1] = '\0';
  equipa = HTsearch_equipa(sistema->ht, n);
  if (equipa)
  {
    printf("%d %s %d\n", NL, n, equipa->jogos_ganhos);
  }
  else
  {
    printf("%d Equipa inexistente.\n", NL);
  }

}

int compara(const void *a, const void *b)
{
  return strcmp((*((const node_equipas **) a))->nome, (*((const node_equipas **) b))->nome);
}

void ordena_equipas(node_equipas **melhores, int tamanho)
{
  qsort(melhores, tamanho, sizeof(node_equipas *), compara);
}

void encontra_equipas(Sistema *sistema, int NL)
{
  node_equipas **melhores = 0;
  long *numero_melhores = 0;
  long i = 0;
  if (sistema->equipas->head)
  {
    numero_melhores = malloc(sizeof(long));
    melhores = melhores_equipas(sistema->equipas, numero_melhores);
    printf("%d Melhores %d\n", NL, melhores[0]->jogos_ganhos);
    ordena_equipas(melhores, *numero_melhores);
    for (i = 0; i < (*numero_melhores); i++)
      printf("%d * %s\n", NL, melhores[i]->nome);

    free(numero_melhores);
    destroy_melhores(melhores);
  }
  else
  {
    
  }

}

