/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <assert.h>
#include "GAME.h"


void NewGame(int line)
{
  char *name = malloc((sizeof(char)) * 1024);
  char *name1 = malloc((sizeof(char)) * 1024);
  char *name2 = malloc((sizeof(char)) * 1024);
  int i;
  int i1;
  int i2;
  int score1;
  int score2;
  gamelink t;
  link t1;
  link t2;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  for (int name1_index = 0; name1_index < 10; name1_index++)
  {
    name1[name1_index] = new_sym_var(sizeof(char) * 8);
  }

  name1[10 - 1] = '\0';
  for (int name2_index = 0; name2_index < 10; name2_index++)
  {
    name2[name2_index] = new_sym_var(sizeof(char) * 8);
  }

  name2[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  getchar();
  i = hash_game(name);
  t = searchHashGame(name, g_heads[i]);
  if (!t)
  {
    i1 = hash_team(name1);
    i2 = hash_team(name2);
    t1 = searchHashTeam(name1, t_heads[i1]);
    t2 = searchHashTeam(name2, t_heads[i2]);
    if ((t1 == 0) || (t2 == 0))
    {
      printf("%d Equipa inexistente.\n", line);
    }
    else
    {
      g_heads[i] = insertHashGame(name, name1, name2, score1, score2, g_heads[i]);
      insertListGames(name);
      if (score1 > score2)
      {
        t1->team->wins++;
      }
      else
      {
        if (score1 < score2)
        {
          t2->team->wins++;
        }
        else
        {
          
        }

      }

      if ((teams_list != 0) && (teams_list->team->wins > 0))
      {
        freeTeamList(teams_list);
        TeamListInit();
      }
      else
      {
        
      }

    }

  }
  else
  {
    printf("%d Jogo existente.\n", line);
  }

  free(name);
  free(name1);
  free(name2);
}

void SearchGame(int line)
{
  char *name = malloc((sizeof(char)) * 1024);
  gamelink l;
  int i;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  getchar();
  i = hash_game(name);
  l = searchHashGame(name, g_heads[i]);
  if (l != 0)
  {
    printf("%d %s %s %s %d %d\n", line, name, l->game->team1, l->game->team2, l->game->score1, l->game->score2);
  }
  else
  {
    printf("%d Jogo inexistente.\n", line);
  }

  free(name);
}

void DeleteGame(int line)
{
  char *name = malloc((sizeof(char)) * 1024);
  gamelink l;
  int i;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  getchar();
  i = hash_game(name);
  l = searchHashGame(name, g_heads[i]);
  if (l != 0)
  {
    if (l->game->score1 > l->game->score2)
    {
      decreaseWins(l->game->team1);
    }
    else
    {
      if (l->game->score1 < l->game->score2)
      {
        decreaseWins(l->game->team2);
      }
      else
      {
        
      }

    }

    g_heads[i] = deleteHashGame(name, g_heads[i]);
    delete_gamelist(name);
    freeTeamList(teams_list);
    TeamListInit();
  }
  else
  {
    printf("%d Jogo inexistente.\n", line);
  }

  free(name);
}

void ListAllGames(int line)
{
  int i;
  GamesList a;
  gamelink link;
  getchar();
  for (a = list_head; a != 0; a = a->next)
  {
    i = hash_game(a->name);
    link = searchHashGame(a->name, g_heads[i]);
    printf("%d %s %s %s %d %d\n", line, link->game->name, link->game->team1, link->game->team2, link->game->score1, link->game->score2);
  }

}

void Change_Score(int line)
{
  char *name = malloc((sizeof(char)) * 1024);
  int i;
  int score1;
  int score2;
  gamelink l;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  getchar();
  i = hash_game(name);
  l = searchHashGame(name, g_heads[i]);
  if (l != 0)
  {
    if ((score1 > score2) && (l->game->score2 > l->game->score1))
    {
      increaseWins(l->game->team1);
      decreaseWins(l->game->team2);
    }
    else
    {
      if ((score1 < score2) && (l->game->score2 < l->game->score1))
      {
        increaseWins(l->game->team2);
        decreaseWins(l->game->team1);
      }
      else
      {
        if ((score1 > score2) && (l->game->score2 == l->game->score1))
        {
          increaseWins(l->game->team1);
        }
        else
        {
          if ((score1 < score2) && (l->game->score2 == l->game->score1))
          {
            increaseWins(l->game->team2);
          }
          else
          {
            if (score1 == score2)
            {
              if (l->game->score2 > l->game->score1)
              {
                decreaseWins(l->game->team2);
              }
              else
              {
                if (l->game->score1 > l->game->score2)
                {
                  decreaseWins(l->game->team1);
                }
                else
                {
                  
                }

              }

            }
            else
            {
              
            }

          }

        }

      }

    }

    l->game->score1 = score1;
    l->game->score2 = score2;
    free(name);
    freeTeamList(teams_list);
    TeamListInit();
  }
  else
  {
    printf("%d Jogo inexistente.\n", line);
    free(name);
  }

}

int hash_game(char *v)
{
  int h = 0;
  int a = 173;
  for (; (*v) != '\0'; v++)
    h = ((a * h) + (*v)) % 100000;

  return h;
}

void GameInit()
{
  int i;
  g_heads = (gamelink *) malloc((sizeof(gamelink)) * 100000);
  for (i = 0; i < 100000; i++)
    g_heads[i] = 0;

}

gamelink insertHashGame(char *name, char *name1, char *name2, int score1, int score2, gamelink head)
{
  gamelink aux;
  gamelink prev;
  for (aux = head, prev = 0; aux != 0; prev = aux, aux = aux->next)
    ;

  if (aux == head)
  {
    head = newGameLink(name, name1, name2, score1, score2);
  }
  else
  {
    prev->next = newGameLink(name, name1, name2, score1, score2);
  }

  return head;
}

gamelink searchHashGame(char *name, gamelink head)
{
  gamelink aux;
  for (aux = head; aux != 0; aux = aux->next)
  {
    if (strcmp(aux->game->name, name) == 0)
    {
      return aux;
    }
    else
    {
      
    }

  }

  return 0;
}

gamelink deleteHashGame(char *name, gamelink head)
{
  gamelink t;
  gamelink prev;
  for (t = head, prev = 0; t != 0; prev = t, t = t->next)
  {
    if (strcmp(t->game->name, name) == 0)
    {
      if (t == head)
      {
        head = t->next;
      }
      else
      {
        if (t->next == 0)
        {
          prev->next = 0;
        }
        else
        {
          prev->next = t->next;
        }

      }

      free(t->game->name);
      free(t->game->team1);
      free(t->game->team2);
      free(t->game);
      free(t);
      return head;
    }
    else
    {
      
    }

  }

  return 0;
}

void free_gamelist(gamelink head)
{
  if (head != 0)
  {
    free(head->game->name);
    free(head->game->team1);
    free(head->game->team2);
    free(head->game);
    free_gamelist(head->next);
    free(head);
  }
  else
  {
    
  }

}

void freeGameHash()
{
  int i;
  for (i = 0; i < 256; i++)
  {
    free_gamelist(g_heads[i]);
  }

}

gamelink newGameLink(char *name, char *name1, char *name2, int score1, int score2)
{
  size_t size;
  gamelink l = (gamelink) malloc(sizeof(struct GameNode));
  l->game = malloc(sizeof(struct game));
  size = strlen(name) + 1;
  l->game->name = malloc((sizeof(char)) * size);
  strncpy(l->game->name, name, size);
  size = strlen(name1) + 1;
  l->game->team1 = malloc((sizeof(char)) * size);
  strncpy(l->game->team1, name1, size);
  size = strlen(name2) + 1;
  l->game->team2 = malloc((sizeof(char)) * size);
  strncpy(l->game->team2, name2, size);
  l->game->score1 = score1;
  l->game->score2 = score2;
  l->next = 0;
  return l;
}

void insertListGames(char *name)
{
  if (list_head == 0)
  {
    list_head = (tail = new_game_node(name));
  }
  else
  {
    tail->next = new_game_node(name);
    tail = tail->next;
  }

}

GamesList new_game_node(char *name)
{
  size_t size;
  GamesList game = malloc(sizeof(struct names));
  size = strlen(name) + 1;
  game->name = malloc((sizeof(char *)) * size);
  strncpy(game->name, name, size);
  game->next = 0;
  return game;
}

void delete_gamelist(char *name)
{
  GamesList t;
  GamesList prev;
  for (t = list_head, prev = 0; t != 0; prev = t, t = t->next)
  {
    if (strcmp(t->name, name) == 0)
    {
      if (t == list_head)
      {
        list_head = t->next;
      }
      else
      {
        if (t == tail)
        {
          prev->next = 0;
          tail = prev;
        }
        else
        {
          prev->next = t->next;
        }

      }

      free(t->name);
      free(t);
      return;
    }
    else
    {
      
    }

  }

}

