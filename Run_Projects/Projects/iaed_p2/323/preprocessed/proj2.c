/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>


typedef struct game
{
  char *name;
  char *team1;
  char *team2;
  int score1;
  int score2;
} p_game;
typedef struct node_game
{
  p_game *g;
  struct node_game *prev;
  struct node_game *next;
} link_game;
typedef struct team
{
  char *name;
  int vict;
} p_team;
typedef struct node_team
{
  p_team *t;
  struct node_team *prev;
  struct node_team *next;
} link_team;
typedef struct ordered_games
{
  p_game *g;
  struct ordered_games *prev;
  struct ordered_games *next;
} link_ord_games;
typedef struct ordered_teams
{
  p_team *t;
  struct ordered_teams *prev;
  struct ordered_teams *next;
} link_ord_teams;
static link_game **head_game;
static link_team **head_team;
static link_ord_games *head_ord_games;
static link_ord_teams *head_ord_teams;
void Partition(link_ord_teams *source, link_ord_teams **frontRef, link_ord_teams **backRef)
{
  link_ord_teams *fast;
  link_ord_teams *slow;
  slow = source;
  fast = source->next;
  while (fast != 0)
  {
    fast = fast->next;
    if (fast != 0)
    {
      {
        slow = slow->next;
        fast = fast->next;
      }
    }
    else
    {
      
    }

  }

  *frontRef = source;
  *backRef = slow->next;
  slow->next = 0;
}

link_ord_teams *SortedMerge(link_ord_teams *a, link_ord_teams *b)
{
  link_ord_teams *result = 0;
  if (a == 0)
  {
    return b;
  }
  else
  {
    if (b == 0)
    {
      return a;
    }
    else
    {
      
    }

  }

  if ((b->t->vict < a->t->vict) || ((b->t->vict == a->t->vict) && (strcmp(a->t->name, b->t->name) < 0)))
  {
    {
      result = a;
      result->next = SortedMerge(a->next, b);
    }
  }
  else
  {
    {
      result = b;
      result->next = SortedMerge(a, b->next);
    }
  }

  return result;
}

void MergeSort(link_ord_teams **headRef)
{
  link_ord_teams *head = *headRef;
  link_ord_teams *a;
  link_ord_teams *b;
  if ((head == 0) || (head->next == 0))
  {
    {
      return;
    }
  }
  else
  {
    
  }

  Partition(head, &a, &b);
  MergeSort(&a);
  MergeSort(&b);
  *headRef = SortedMerge(a, b);
}

int hash(char *p)
{
  int key;
  int a = 31415;
  int b = 27183;
  for (key = 0; (*p) != '\0'; p++, a = (a * b) % (1571 - 1))
  {
    key = ((a * key) + (*p)) % 1571;
  }

  return key;
}

void Init_ht()
{
  int key;
  head_game = malloc(1571 * (sizeof(link_game)));
  head_team = malloc(1571 * (sizeof(link_team)));
  head_ord_games = 0;
  head_ord_teams = 0;
  for (key = 0; key < 1571; key++)
  {
    head_game[key] = 0;
    head_team[key] = 0;
  }

}

void ht_insert_game(p_game *g, int key)
{
  link_game *next_game = malloc(sizeof(link_game));
  next_game->g = g;
  next_game->next = head_game[key];
  next_game->prev = 0;
  if (head_game[key] != 0)
  {
    head_game[key]->prev = next_game;
  }
  else
  {
    
  }

  head_game[key] = next_game;
}

link_game *ht_find_game(char *name, int key)
{
  link_game *ptr = 0;
  if (head_game[key] != 0)
  {
    {
      ptr = head_game[key];
      while (ptr != 0)
      {
        if (strcmp(ptr->g->name, name) == 0)
        {
          return ptr;
        }
        else
        {
          
        }

        ptr = ptr->next;
      }

    }
  }
  else
  {
    
  }

  return 0;
}

void ht_insert_team(p_team *t, int key)
{
  link_team *next_team = malloc(sizeof(link_team));
  next_team->t = t;
  next_team->next = head_team[key];
  next_team->prev = 0;
  if (head_team[key] != 0)
  {
    head_team[key]->prev = next_team;
  }
  else
  {
    
  }

  head_team[key] = next_team;
}

link_team *ht_find_team(char *name, int key)
{
  link_team *ptr = 0;
  if (head_team[key] != 0)
  {
    {
      ptr = head_team[key];
      while (ptr != 0)
      {
        if (strcmp(ptr->t->name, name) == 0)
        {
          return ptr;
        }
        else
        {
          
        }

        ptr = ptr->next;
      }

    }
  }
  else
  {
    
  }

  return 0;
}

void insert_ord_games(p_game *g)
{
  link_ord_games *ptr = malloc(sizeof(link_ord_games));
  ptr->g = g;
  ptr->prev = 0;
  if (head_ord_games == 0)
  {
    {
      ptr->next = 0;
    }
  }
  else
  {
    {
      ptr->next = head_ord_games;
      head_ord_games->prev = ptr;
    }
  }

  head_ord_games = ptr;
}

void insert_ord_teams(p_team *t)
{
  link_ord_teams *ptr = malloc(sizeof(link_ord_teams));
  ptr->t = t;
  ptr->prev = 0;
  if (head_ord_teams == 0)
  {
    {
      ptr->next = 0;
    }
  }
  else
  {
    {
      ptr->next = head_ord_teams;
      head_ord_teams->prev = ptr;
    }
  }

  head_ord_teams = ptr;
}

void add_game(char *input, int nl)
{
  char game_name[1024];
  char team_1[1024];
  char team_2[1024];
  int score_1 = 0;
  int score_2 = 0;
  int key_game;
  int key_team_1;
  int key_team_2;
  p_game *game = malloc(sizeof(p_game));
  for (int game_name_index = 0; game_name_index < 10; game_name_index++)
  {
    game_name[game_name_index] = new_sym_var(sizeof(char) * 8);
  }

  game_name[10 - 1] = '\0';
  for (int team_1_index = 0; team_1_index < 10; team_1_index++)
  {
    team_1[team_1_index] = new_sym_var(sizeof(char) * 8);
  }

  team_1[10 - 1] = '\0';
  for (int team_2_index = 0; team_2_index < 10; team_2_index++)
  {
    team_2[team_2_index] = new_sym_var(sizeof(char) * 8);
  }

  team_2[10 - 1] = '\0';
  score_1 = new_sym_var(sizeof(int) * 8);
  score_2 = new_sym_var(sizeof(int) * 8);
  key_game = hash(game_name);
  key_team_1 = hash(team_1);
  key_team_2 = hash(team_2);
  if (ht_find_game(game_name, key_game) != 0)
  {
    printf("%d Jogo existente.\n", nl);
  }
  else
  {
    if ((ht_find_team(team_1, key_team_1) == 0) || (ht_find_team(team_2, key_team_2) == 0))
    {
      printf("%d Equipa inexistente.\n", nl);
    }
    else
    {
      {
        game->name = malloc((sizeof(char)) * (strlen(game_name) + 1));
        game->team1 = malloc((sizeof(char)) * (strlen(team_1) + 1));
        game->team2 = malloc((sizeof(char)) * (strlen(team_2) + 1));
        strcpy(game->name, game_name);
        strcpy(game->team1, team_1);
        strcpy(game->team2, team_2);
        game->score1 = score_1;
        game->score2 = score_2;
        if (score_1 > score_2)
        {
          ht_find_team(team_1, key_team_1)->t->vict++;
        }
        else
        {
          if (score_2 > score_1)
          {
            ht_find_team(team_2, key_team_2)->t->vict++;
          }
          else
          {
            
          }

        }

        ht_insert_game(game, key_game);
        insert_ord_games(game);
      }
    }

  }

}

void find_game(char input[3500], int nl)
{
  char game_name[1024];
  int key;
  link_game *node = 0;
  for (int game_name_index = 0; game_name_index < 10; game_name_index++)
  {
    game_name[game_name_index] = new_sym_var(sizeof(char) * 8);
  }

  game_name[10 - 1] = '\0';
  key = hash(game_name);
  node = ht_find_game(game_name, key);
  if (node == 0)
  {
    printf("%d Jogo inexistente.\n", nl);
  }
  else
  {
    {
      printf("%d %s %s %s %d %d\n", nl, node->g->name, node->g->team1, node->g->team2, node->g->score1, node->g->score2);
    }
  }

}

void list_games(int nl)
{
  link_ord_games *ptr = 0;
  ptr = head_ord_games;
  if (ptr != 0)
  {
    {
      while (ptr->next != 0)
        ptr = ptr->next;

      while (ptr != 0)
      {
        printf("%d %s %s %s %d %d\n", nl, ptr->g->name, ptr->g->team1, ptr->g->team2, ptr->g->score1, ptr->g->score2);
        ptr = ptr->prev;
      }

    }
  }
  else
  {
    
  }

}

void remove_game(char input[3500], int nl)
{
  char game_name[1024];
  int key;
  int key_t1;
  int key_t2;
  link_game *node = 0;
  link_ord_games *node_ord = 0;
  link_team *node_t1 = 0;
  link_team *node_t2 = 0;
  for (int game_name_index = 0; game_name_index < 10; game_name_index++)
  {
    game_name[game_name_index] = new_sym_var(sizeof(char) * 8);
  }

  game_name[10 - 1] = '\0';
  key = hash(game_name);
  if (ht_find_game(game_name, key) == 0)
  {
    printf("%d Jogo inexistente.\n", nl);
  }
  else
  {
    {
      node = ht_find_game(game_name, key);
      node_ord = head_ord_games;
      key_t1 = hash(node->g->team1);
      key_t2 = hash(node->g->team2);
      node_t1 = head_team[key_t1];
      node_t2 = head_team[key_t2];
      if (node->g->score1 > node->g->score2)
      {
        node_t1->t->vict--;
      }
      else
      {
        if (node->g->score1 < node->g->score2)
        {
          node_t2->t->vict--;
        }
        else
        {
          
        }

      }

      while (strcmp(node_ord->g->name, game_name) != 0)
        node_ord = node_ord->next;

      if ((node_ord->prev != 0) && (node_ord->next != 0))
      {
        {
          node_ord->prev->next = node_ord->next;
          node_ord->next->prev = node_ord->prev;
        }
      }
      else
      {
        if ((node_ord->prev == 0) && (node_ord->next != 0))
        {
          {
            head_ord_games = node_ord->next;
            head_ord_games->prev = 0;
          }
        }
        else
        {
          if ((node_ord->prev == 0) && (node_ord->next == 0))
          {
            head_ord_games = 0;
          }
          else
          {
            node_ord->prev->next = 0;
          }

        }

      }

      if ((node->prev != 0) && (node->next != 0))
      {
        {
          node->prev->next = node->next;
          node->next->prev = node->prev;
        }
      }
      else
      {
        if ((node == head_game[key]) && (node->next != 0))
        {
          {
            head_game[key] = node->next;
            head_game[key] = 0;
          }
        }
        else
        {
          if ((node == head_game[key]) && (node->next == 0))
          {
            head_game[key] = 0;
          }
          else
          {
            node->prev->next = 0;
          }

        }

      }

      free(node->g->name);
      free(node->g->team1);
      free(node->g->team2);
      free(node->g);
      free(node);
      node = 0;
      free(node_ord);
      node_ord = 0;
    }
  }

}

void change_score(char input[3500], int nl)
{
  char game_name[1024];
  int key;
  int score_1 = 0;
  int score_2 = 0;
  int key_t1;
  int key_t2;
  link_game *node = 0;
  link_team *node_t1 = 0;
  link_team *node_t2 = 0;
  for (int game_name_index = 0; game_name_index < 10; game_name_index++)
  {
    game_name[game_name_index] = new_sym_var(sizeof(char) * 8);
  }

  game_name[10 - 1] = '\0';
  score_1 = new_sym_var(sizeof(int) * 8);
  score_2 = new_sym_var(sizeof(int) * 8);
  key = hash(game_name);
  if (ht_find_game(game_name, key) == 0)
  {
    printf("%d Jogo inexistente.\n", nl);
  }
  else
  {
    {
      node = head_game[key];
      key_t1 = hash(node->g->team1);
      key_t2 = hash(node->g->team2);
      node_t1 = head_team[key_t1];
      node_t2 = head_team[key_t2];
      while (strcmp(node_t1->t->name, node->g->team1) != 0)
        node_t1 = node_t1->next;

      while (strcmp(node_t2->t->name, node->g->team2) != 0)
        node_t2 = node_t2->next;

      if ((node->g->score1 > node->g->score2) && (score_1 < score_2))
      {
        {
          node_t1->t->vict--;
          node_t2->t->vict++;
        }
      }
      else
      {
        if ((node->g->score1 < node->g->score2) && (score_1 > score_2))
        {
          {
            node_t1->t->vict++;
            node_t2->t->vict--;
          }
        }
        else
        {
          if ((node->g->score1 > node->g->score2) && (score_1 == score_2))
          {
            node_t1->t->vict--;
          }
          else
          {
            if ((node->g->score1 < node->g->score2) && (score_1 == score_2))
            {
              node_t2->t->vict--;
            }
            else
            {
              if ((node->g->score1 == node->g->score2) && (score_1 > score_2))
              {
                node_t1->t->vict++;
              }
              else
              {
                if ((node->g->score1 == node->g->score2) && (score_1 < score_2))
                {
                  node_t2->t->vict++;
                }
                else
                {
                  
                }

              }

            }

          }

        }

      }

      while (strcmp(node->g->name, game_name) != 0)
        node = node->next;

      node->g->score1 = score_1;
      node->g->score2 = score_2;
    }
  }

}

void add_team(char input[3500], int nl)
{
  char team_name[1024];
  int key;
  p_team *team = malloc(sizeof(p_team));
  for (int team_name_index = 0; team_name_index < 10; team_name_index++)
  {
    team_name[team_name_index] = new_sym_var(sizeof(char) * 8);
  }

  team_name[10 - 1] = '\0';
  key = hash(team_name);
  if (ht_find_team(team_name, key) != 0)
  {
    printf("%d Equipa existente.\n", nl);
  }
  else
  {
    {
      team->name = malloc((sizeof(char)) * (strlen(team_name) + 1));
      strcpy(team->name, team_name);
      team->vict = 0;
      ht_insert_team(team, key);
      insert_ord_teams(team);
    }
  }

}

void find_team(char input[3500], int nl)
{
  char team_name[1024];
  int key;
  link_team *node = 0;
  for (int team_name_index = 0; team_name_index < 10; team_name_index++)
  {
    team_name[team_name_index] = new_sym_var(sizeof(char) * 8);
  }

  team_name[10 - 1] = '\0';
  key = hash(team_name);
  node = ht_find_team(team_name, key);
  if (node == 0)
  {
    printf("%d Equipa inexistente.\n", nl);
  }
  else
  {
    {
      printf("%d %s %d\n", nl, node->t->name, node->t->vict);
    }
  }

}

void list_teams(int nl)
{
  link_ord_teams *ptr = 0;
  int score_max;
  if (head_ord_teams != 0)
  {
    {
      MergeSort(&head_ord_teams);
      ptr = head_ord_teams;
      printf("%d Melhores %d\n", nl, ptr->t->vict);
      score_max = ptr->t->vict;
      while ((ptr != 0) && (ptr->t->vict == score_max))
      {
        printf("%d * %s\n", nl, ptr->t->name);
        ptr = ptr->next;
      }

    }
  }
  else
  {
    
  }

}

void delete_all()
{
  int key;
  link_game *ptr_g;
  link_team *ptr_t;
  for (key = 0; key < 1571; key++)
  {
    ptr_g = head_game[key];
    while (ptr_g != 0)
    {
      free(ptr_g->g->name);
      free(ptr_g->g->team1);
      free(ptr_g->g->team2);
      free(ptr_g->g);
      ptr_g = ptr_g->next;
    }

    free(head_game[key]);
  }

  free(head_game);
  for (key = 0; key < 1571; key++)
  {
    ptr_t = head_team[key];
    while (ptr_t != 0)
    {
      free(ptr_t->t->name);
      free(ptr_t->t);
      ptr_t = ptr_t->next;
    }

    free(head_team[key]);
  }

  free(head_team);
}

int main()
{
  char input[3500];
  int nl = 1;
  Init_ht();
  while (1)
  {
    fgets(input, 3500, stdin);
    switch (input[0])
    {
      case 'a':
        add_game(&input[2], nl);
        nl++;
        break;

      case 'l':
        list_games(nl);
        nl++;
        break;

      case 'p':
        find_game(&input[2], nl);
        nl++;
        break;

      case 'r':
        remove_game(&input[2], nl);
        nl++;
        break;

      case 's':
        change_score(&input[2], nl);
        nl++;
        break;

      case 'A':
        add_team(&input[2], nl);
        nl++;
        break;

      case 'P':
        find_team(&input[2], nl);
        nl++;
        break;

      case 'g':
        list_teams(nl);
        nl++;
        break;

      case 'x':
        delete_all();
        return 0;

      default:
        break;

    }

  }

  return 0;
}

