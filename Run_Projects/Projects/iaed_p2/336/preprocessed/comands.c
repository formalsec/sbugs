/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "games_struct.h"
#include "teams_struct.h"
#include "comands.h"


d_b *init_data_base()
{
  d_b *data_base;
  data_base = malloc(sizeof(d_b));
  data_base->game_list = init_game_list();
  data_base->hash_games = init_hash_games();
  data_base->teams_pile = 0;
  data_base->hash_teams = init_hash_teams();
  data_base->NL = 0;
  return data_base;
}

void destroy_data(d_b *data_base)
{
  destroy_game_list(data_base->game_list);
  destroy_hash_game(data_base->hash_games);
  destroy_pile(data_base->teams_pile);
  destroy_hash_teams(data_base->hash_teams);
  free(data_base);
}

void add_new_game(d_b *data_base)
{
  game_node *game;
  t_node *first_team;
  t_node *second_team;
  char name[1024];
  char team1[1024];
  char team2[1024];
  int first_score;
  int second_score;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  for (int team1_index = 0; team1_index < 10; team1_index++)
  {
    team1[team1_index] = new_sym_var(sizeof(char) * 8);
  }

  team1[10 - 1] = '\0';
  for (int team2_index = 0; team2_index < 10; team2_index++)
  {
    team2[team2_index] = new_sym_var(sizeof(char) * 8);
  }

  team2[10 - 1] = '\0';
  first_score = new_sym_var(sizeof(int) * 8);
  second_score = new_sym_var(sizeof(int) * 8);
  game = search_game(data_base->hash_games, name);
  if (!game)
  {
    first_team = search_team(data_base->hash_teams, team1);
    second_team = search_team(data_base->hash_teams, team2);
    if (first_team && second_team)
    {
      game = insert_game(data_base->game_list, name, first_team, second_team, first_score, second_score);
      insert_hash_game(data_base->hash_games, game);
    }
    else
    {
      printf("%d Equipa inexistente.\n", data_base->NL);
    }

  }
  else
  {
    printf("%d Jogo existente.\n", data_base->NL);
  }

}

void list_games(d_b *data_base)
{
  game_node *game = data_base->game_list->head;
  while (game)
  {
    printf("%d %s %s %s %d %d\n", data_base->NL, game->game_name, game->team_one->team_name, game->team_two->team_name, game->score_one, game->score_two);
    game = game->next;
  }

}

void search_name_game(d_b *data_base)
{
  game_node *game;
  char name[1024];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  game = search_game(data_base->hash_games, name);
  if (game)
  {
    printf("%d %s %s %s %d %d\n", data_base->NL, game->game_name, game->team_one->team_name, game->team_two->team_name, game->score_one, game->score_two);
  }
  else
  {
    printf("%d Jogo inexistente.\n", data_base->NL);
  }

}

void remove_game(d_b *data_base)
{
  game_node *game;
  char name[1024];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  game = search_game(data_base->hash_games, name);
  if (game)
  {
    remove_win(game->team_one, game->team_two, game->score_one, game->score_two);
    delete_game_hash(data_base->hash_games, data_base->game_list, name);
  }
  else
  {
    printf("%d Jogo inexistente.\n", data_base->NL);
  }

}

void score_change(d_b *data_base)
{
  game_node *game;
  char name[1024];
  int first_score;
  int second_score;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  first_score = new_sym_var(sizeof(int) * 8);
  second_score = new_sym_var(sizeof(int) * 8);
  game = search_game(data_base->hash_games, name);
  if (game)
  {
    remove_win(game->team_one, game->team_two, game->score_one, game->score_two);
    game->score_one = first_score;
    game->score_two = second_score;
    record_update(game->team_one, game->team_two, game->score_one, game->score_two);
  }
  else
  {
    printf("%d Jogo inexistente.\n", data_base->NL);
  }

}

void add_new_team(d_b *data_base)
{
  char name[1024];
  t_node *team;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  team = search_team(data_base->hash_teams, name);
  if (!team)
  {
    data_base->teams_pile = push_team(data_base->teams_pile, name);
    insert_hash_team(data_base->hash_teams, data_base->teams_pile);
  }
  else
  {
    printf("%d Equipa existente.\n", data_base->NL);
  }

}

void search_name_team(d_b *data_base)
{
  t_node *team;
  char name[1024];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  team = search_team(data_base->hash_teams, name);
  if (team)
  {
    printf("%d %s %d\n", data_base->NL, name, team->wins);
  }
  else
  {
    printf("%d Equipa inexistente.\n", data_base->NL);
  }

}

void best_teams(d_b *data_base)
{
  int max = 0;
  int size = 0;
  t_node *new_pile = 0;
  t_node *head = data_base->teams_pile;
  while (head)
  {
    if (head->wins > max)
    {
      max = head->wins;
    }
    else
    {
      
    }

    head = head->next;
  }

  head = data_base->teams_pile;
  while (head)
  {
    if (head->wins == max)
    {
      new_pile = push_team(new_pile, head->team_name);
      size += 1;
    }
    else
    {
      
    }

    head = head->next;
  }

  if (new_pile)
  {
    new_pile = sort_teams_pile(new_pile, size);
    head = new_pile;
    printf("%d Melhores %d\n", data_base->NL, max);
    while (head)
    {
      printf("%d * %s\n", data_base->NL, head->team_name);
      head = head->next;
    }

    destroy_pile(new_pile);
  }
  else
  {
    
  }

}

void comand_list(char comand, d_b *data_base)
{
  data_base->NL += 1;
  switch (comand)
  {
    case 'a':
      add_new_game(data_base);
      break;

    case 'l':
      list_games(data_base);
      break;

    case 'p':
      search_name_game(data_base);
      break;

    case 'r':
      remove_game(data_base);
      break;

    case 's':
      score_change(data_base);
      break;

    case 'A':
      add_new_team(data_base);
      break;

    case 'P':
      search_name_team(data_base);
      break;

    case 'g':
      best_teams(data_base);
      break;

  }

}

