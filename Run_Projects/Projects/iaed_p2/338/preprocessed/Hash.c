/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "structs.h"
#include "LinkedList.h"
#include "Hash.h"


int hash(char *nome, int M)
{
  int h;
  int a = 31415;
  int b = 27183;
  for (h = 0; (*nome) != '\0'; nome++, a = (a * b) % (M - 1))
    h = ((a * h) + (*nome)) % M;

  return abs(h);
}

void ht_creat_jogo(int tblsz, jogo *st)
{
  int i;
  for (i = 0; i < tblsz; i++)
  {
    st[i] = 0;
  }

}

void ht_creat_eq(int tblsz, equipa *eq)
{
  int i;
  for (i = 0; i < tblsz; i++)
    eq[i] = 0;

}

void expand_jogo(int tblsz_jogo, jogo *st, int M);
void expand_equipa(int tblsz_equipa, equipa *eq, int N);
void insert_equipa(char *key, equipa value, int tblsz, equipa *eq, int N)
{
  int index;
  index = hash(key, tblsz);
  while (eq[index] != 0)
    index = index + (1 % tblsz);

  eq[index] = malloc(sizeof(struct equipas));
  eq[index]->nome_equipa = malloc((sizeof(char)) * (strlen(value->nome_equipa) + 1));
  strcpy(eq[index]->nome_equipa, value->nome_equipa);
  eq[index]->vitorias = value->vitorias;
  if (N > (tblsz / 2))
  {
    {
      expand_equipa(tblsz, eq, N);
    }
  }
  else
  {
    
  }

}

void expand_equipa(int tblsz_equipa, equipa *eq, int N)
{
  int i;
  equipa *t = eq;
  eq = realloc(eq, (2 * tblsz_equipa) * (sizeof(equipa)));
  ht_creat_eq(tblsz_equipa + tblsz_equipa, eq);
  for (i = 0; i < (tblsz_equipa / 2); i++)
  {
    if (t[i] != 0)
    {
      {
        insert_equipa(t[i]->nome_equipa, t[i], tblsz_equipa + tblsz_equipa, eq, N);
      }
    }
    else
    {
      
    }

  }

  free(t);
}

void insert_jogo(char *key, jogo value, int tblsz, jogo *st, int M)
{
  int index;
  index = hash(key, tblsz);
  while (st[index] != 0)
  {
    index = index + (1 % tblsz);
  }

  st[index] = malloc(sizeof(struct jogos));
  st[index]->nome = malloc((sizeof(char)) * (strlen(value->nome) + 1));
  strcpy(st[index]->nome, value->nome);
  st[index]->equipa1 = malloc((sizeof(char)) * (strlen(value->equipa1) + 1));
  strcpy(st[index]->equipa1, value->equipa1);
  st[index]->equipa2 = malloc((sizeof(char)) * (strlen(value->equipa2) + 1));
  strcpy(st[index]->equipa2, value->equipa2);
  st[index]->score1 = value->score1;
  st[index]->score2 = value->score2;
  if (M > (tblsz / 2))
  {
    {
      expand_jogo(tblsz, st, M);
    }
  }
  else
  {
    
  }

}

void expand_jogo(int tblsz_jogo, jogo *st, int M)
{
  int i;
  jogo *t = st;
  st = realloc(st, (2 * tblsz_jogo) * (sizeof(jogo)));
  ht_creat_jogo(tblsz_jogo + tblsz_jogo, st);
  for (i = 0; i < (tblsz_jogo / 2); i++)
  {
    if (t[i] != 0)
    {
      {
        insert_jogo(t[i]->nome, t[i], tblsz_jogo + tblsz_jogo, st, M);
      }
    }
    else
    {
      
    }

  }

  free(t);
}

equipa search_equipa(char *key, int tblsz, equipa *eq)
{
  int index;
  index = hash(key, tblsz);
  while (eq[index] != 0)
  {
    if (strcmp(eq[index]->nome_equipa, key) == 0)
    {
      {
        return eq[index];
      }
    }
    else
    {
      index = (index + 1) % tblsz;
    }

  }

  return 0;
}

jogo search_jogo(char *key, int tblsz, jogo *st)
{
  int index;
  index = hash(key, tblsz);
  while (st[index] != 0)
  {
    if (strcmp(st[index]->nome, key) == 0)
    {
      {
        return st[index];
      }
    }
    else
    {
      index = (index + 1) % tblsz;
    }

  }

  return 0;
}

void delete_jogo(char *key, int tblsz, jogo *st, int M)
{
  int index;
  int j;
  index = hash(key, tblsz);
  while (st[index] != 0)
  {
    if (strcmp(st[index]->nome, key) == 0)
    {
      {
        break;
      }
    }
    else
    {
      index = (index + 1) % tblsz;
    }

  }

  if (st[index] == 0)
  {
    {
      return;
    }
  }
  else
  {
    
  }

  free(st[index]->nome);
  free(st[index]->equipa1);
  free(st[index]->equipa2);
  free(st[index]);
  st[index] = 0;
  for (j = (index + 1) % tblsz; st[j] != 0; j = (j + 1) % tblsz)
  {
    insert_jogo(st[j]->nome, st[j], tblsz, st, M);
    free(st[j]->nome);
    free(st[j]->equipa1);
    free(st[j]->equipa2);
    free(st[j]);
    st[j] = 0;
  }

}

int get_vitorias(char *key, int tblsz, equipa *eq)
{
  int index;
  index = hash(key, tblsz);
  while (eq[index] != 0)
  {
    if (strcmp(eq[index]->nome_equipa, key) == 0)
    {
      {
        return eq[index]->vitorias;
      }
    }
    else
    {
      index = (index + 1) % tblsz;
    }

  }

  return 0;
}

char *quem_ganhou(char *key, int tblsz, jogo *st)
{
  int index;
  index = hash(key, tblsz);
  while (st[index] != 0)
  {
    if (strcmp(st[index]->nome, key) == 0)
    {
      {
        if (st[index]->score1 > st[index]->score2)
        {
          {
            return st[index]->equipa1;
          }
        }
        else
        {
          if (st[index]->score1 < st[index]->score2)
          {
            {
              return st[index]->equipa2;
            }
          }
          else
          {
            return 0;
          }

        }

      }
    }
    else
    {
      index = (index + 1) % tblsz;
    }

  }

  return 0;
}

int quem_ganhou_int(char *key, int tblsz, jogo *st)
{
  int index;
  index = hash(key, tblsz);
  while (st[index] != 0)
  {
    if (strcmp(st[index]->nome, key) == 0)
    {
      {
        if (st[index]->score1 > st[index]->score2)
        {
          {
            return 1;
          }
        }
        else
        {
          if (st[index]->score1 < st[index]->score2)
          {
            {
              return 2;
            }
          }
          else
          {
            return 0;
          }

        }

      }
    }
    else
    {
      index = (index + 1) % tblsz;
    }

  }

  return 0;
}

void altera_score(char *key, int tblsz, int score1, int score2, jogo *st)
{
  int index;
  index = hash(key, tblsz);
  while (st[index] != 0)
  {
    if (strcmp(st[index]->nome, key) == 0)
    {
      {
        st[index]->score1 = score1;
        st[index]->score2 = score2;
        return;
      }
    }
    else
    {
      index = (index + 1) % tblsz;
    }

  }

}

void altera_vitorias(char *key, int tblsz, int vit, equipa *eq)
{
  int index;
  index = hash(key, tblsz);
  while (eq[index] != 0)
  {
    if (strcmp(eq[index]->nome_equipa, key) == 0)
    {
      {
        eq[index]->vitorias += vit;
        return;
      }
    }
    else
    {
      index = (index + 1) % tblsz;
    }

  }

}

char *obtem_equipa1(char *key, int tblsz, jogo *st)
{
  int index;
  index = hash(key, tblsz);
  while (st[index] != 0)
  {
    if (strcmp(st[index]->nome, key) == 0)
    {
      {
        return st[index]->equipa1;
      }
    }
    else
    {
      index = (index + 1) % tblsz;
    }

  }

  return 0;
}

char *obtem_equipa2(char *key, int tblsz, jogo *st)
{
  int index;
  index = hash(key, tblsz);
  while (st[index] != 0)
  {
    if (strcmp(st[index]->nome, key) == 0)
    {
      {
        return st[index]->equipa2;
      }
    }
    else
    {
      index = (index + 1) % tblsz;
    }

  }

  return 0;
}

