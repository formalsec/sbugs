/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "structs.h"
#include "Hash.h"
#include "LinkedList.h"


int jogo_inexistente(char nome[], int tblsz_jogo, int contalinhas, jogo printado, jogo *st)
{
  char *aponta;
  aponta = malloc((sizeof(char)) * (strlen(nome) + 1));
  strcpy(aponta, nome);
  printado = search_jogo(aponta, tblsz_jogo, st);
  if (printado == 0)
  {
    {
      printf("%d Jogo inexistente.\n", contalinhas);
      free(aponta);
      return 1;
    }
  }
  else
  {
    
  }

  free(aponta);
  return 0;
}

int jogo_existente(char nome[], int tblsz_jogo, int contalinhas, jogo procura_jogo, jogo *st)
{
  char *aponta;
  aponta = malloc((sizeof(char)) * (strlen(nome) + 1));
  strcpy(aponta, nome);
  procura_jogo = search_jogo(aponta, tblsz_jogo, st);
  if (procura_jogo != 0)
  {
    {
      printf("%d Jogo existente.\n", contalinhas);
      free(aponta);
      return 1;
    }
  }
  else
  {
    
  }

  free(aponta);
  return 0;
}

int equipa_inexistente(char nome[], int tblsz_equipa, int contalinhas, equipa procura_equipa, equipa *eq)
{
  char *aponta;
  aponta = malloc((sizeof(char)) * (strlen(nome) + 1));
  strcpy(aponta, nome);
  procura_equipa = search_equipa(aponta, tblsz_equipa, eq);
  if (procura_equipa == 0)
  {
    {
      printf("%d Equipa inexistente.\n", contalinhas);
      free(aponta);
      return 1;
    }
  }
  else
  {
    
  }

  free(aponta);
  return 0;
}

int equipa_existente(char nome[], int tblsz_equipa, int contalinhas, equipa procura_equipa, equipa *eq)
{
  char *aponta;
  aponta = malloc((sizeof(char)) * (strlen(nome) + 1));
  strcpy(aponta, nome);
  procura_equipa = search_equipa(aponta, tblsz_equipa, eq);
  if (procura_equipa != 0)
  {
    {
      printf("%d Equipa existente.\n", contalinhas);
      free(aponta);
      return 1;
    }
  }
  else
  {
    
  }

  free(aponta);
  return 0;
}

int cmp_str(const void *a, const void *b)
{
  char **palavra1 = (char **) a;
  char **palavra2 = (char **) b;
  return strcmp(*palavra1, *palavra2);
}

void free_hash_eq(equipa *eq, int tblsz_equipa)
{
  int i;
  for (i = 0; i < tblsz_equipa; i++)
  {
    if (eq[i] != 0)
    {
      {
        free(eq[i]->nome_equipa);
        free(eq[i]);
      }
    }
    else
    {
      
    }

  }

  free(eq);
}

void free_hash_st(jogo *st, int tblsz_jogo)
{
  int i;
  for (i = 0; i < tblsz_jogo; i++)
  {
    if (st[i] != 0)
    {
      {
        free(st[i]->nome);
        free(st[i]->equipa1);
        free(st[i]->equipa2);
        free(st[i]);
      }
    }
    else
    {
      
    }

  }

  free(st);
}

void free_list_jogo(node Head)
{
  struct nodes *temp;
  struct nodes *help;
  temp = Head;
  while (temp != 0)
  {
    help = temp->link;
    free(temp->nome_jogo);
    free(temp);
    temp = help;
  }

}

void free_list_equipa(node Head_equipas)
{
  struct nodes *temp;
  struct nodes *help;
  temp = Head_equipas;
  while (temp != 0)
  {
    help = temp->link;
    free(temp->nome_jogo);
    free(temp);
    temp = help;
  }

}

void compara_resultados(int who_won_int, int score1, int score2, char nome[], int tblsz_jogo, jogo *st, int tblsz_equipa, equipa *eq, char team2[], char *aponta_nome_equipa, char team1[])
{
  if (who_won_int == 1)
  {
    {
      if (score1 > score2)
      {
        {
          altera_score(nome, tblsz_jogo, score1, score2, st);
        }
      }
      else
      {
        if (score2 > score1)
        {
          {
            altera_vitorias(quem_ganhou(nome, tblsz_jogo, st), tblsz_equipa, -1, eq);
            strcpy(team2, obtem_equipa2(nome, tblsz_jogo, st));
            altera_vitorias(team2, tblsz_equipa, 1, eq);
            altera_score(nome, tblsz_jogo, score1, score2, st);
            free(aponta_nome_equipa);
            return;
          }
        }
        else
        {
          if (score2 == score1)
          {
            {
              altera_vitorias(quem_ganhou(nome, tblsz_jogo, st), tblsz_equipa, -1, eq);
              altera_score(nome, tblsz_jogo, score1, score2, st);
            }
          }
          else
          {
            
          }

        }

      }

      free(aponta_nome_equipa);
    }
  }
  else
  {
    if (who_won_int == 2)
    {
      {
        if (score1 > score2)
        {
          {
            altera_vitorias(quem_ganhou(nome, tblsz_jogo, st), tblsz_equipa, -1, eq);
            strcpy(team1, obtem_equipa1(nome, tblsz_jogo, st));
            altera_vitorias(team1, tblsz_equipa, 1, eq);
            altera_score(nome, tblsz_jogo, score1, score2, st);
          }
        }
        else
        {
          if (score2 > score1)
          {
            {
              altera_score(nome, tblsz_jogo, score1, score2, st);
            }
          }
          else
          {
            if (score2 == score1)
            {
              {
                altera_vitorias(quem_ganhou(nome, tblsz_jogo, st), tblsz_equipa, -1, eq);
                altera_score(nome, tblsz_jogo, score1, score2, st);
              }
            }
            else
            {
              
            }

          }

        }

        free(aponta_nome_equipa);
      }
    }
    else
    {
      if (who_won_int == 0)
      {
        {
          if (score1 > score2)
          {
            {
              altera_score(nome, tblsz_jogo, score1, score2, st);
              strcpy(team1, obtem_equipa1(nome, tblsz_jogo, st));
              altera_vitorias(team1, tblsz_equipa, 1, eq);
            }
          }
          else
          {
            if (score2 > score1)
            {
              {
                altera_score(nome, tblsz_jogo, score1, score2, st);
                strcpy(team2, obtem_equipa2(nome, tblsz_jogo, st));
                altera_vitorias(team2, tblsz_equipa, 1, eq);
              }
            }
            else
            {
              if (score2 == score1)
              {
                {
                  altera_score(nome, tblsz_jogo, score1, score2, st);
                }
              }
              else
              {
                
              }

            }

          }

        }
      }
      else
      {
        
      }

    }

  }

}

int erros_a(int stop, jogo game, char equipa1[], int tblsz_equipa, int contalinhas, equipa procura_equipa, equipa *eq, char equipa2[], int tblsz_jogo, jogo *st, jogo procura_jogo)
{
  stop = jogo_existente(game->nome, tblsz_jogo, contalinhas, procura_jogo, st);
  if (stop == 1)
  {
    {
      free(game->equipa2);
      free(game->equipa1);
      free(game->nome);
      return 1;
    }
  }
  else
  {
    
  }

  stop = equipa_inexistente(equipa1, tblsz_equipa, contalinhas, procura_equipa, eq);
  if (stop == 1)
  {
    {
      free(game->equipa2);
      free(game->equipa1);
      free(game->nome);
      return 1;
    }
  }
  else
  {
    
  }

  stop = equipa_inexistente(equipa2, tblsz_equipa, contalinhas, procura_equipa, eq);
  if (stop == 1)
  {
    {
      free(game->equipa2);
      free(game->equipa1);
      free(game->nome);
      return 1;
    }
  }
  else
  {
    
  }

  return 0;
}

void compara_score(int score1, int score2, int tblsz_equipa, equipa *eq, char equipa1[], char equipa2[])
{
  if (score1 > score2)
  {
    {
      altera_vitorias(equipa1, tblsz_equipa, 1, eq);
    }
  }
  else
  {
    if (score2 > score1)
    {
      {
        altera_vitorias(equipa2, tblsz_equipa, 1, eq);
      }
    }
    else
    {
      
    }

  }

}

int main()
{
  char **equipas_c_vitorias;
  char c;
  char nome[1024];
  char equipa1[1024];
  char equipa2[1024];
  char team_name[1024];
  char who_won[1024];
  char team1[1024];
  char team2[1024];
  char *aponta;
  char *aponta_nome_equipa;
  int score1;
  int score2;
  int who_won_int;
  int count;
  int contalinhas = 0;
  int tblsz_jogo = 100000;
  int tblsz_equipa = 100000;
  int stop = 0;
  int i = 0;
  int M = 0;
  int N = 0;
  int erro_a = 0;
  struct jogos *game = malloc(sizeof(struct jogos));
  struct jogos *procura_jogo = malloc(sizeof(struct jogos));
  jogo *printado = malloc(sizeof(jogo));
  struct equipas *add_equipa = malloc(sizeof(struct equipas));
  struct equipas *procura_equipa;
  struct nodes *Head = 0;
  struct nodes *Head_equipas = 0;
  struct tuple *tuplo;
  jogo *st;
  equipa *eq;
  tuplo = (struct tuple *) malloc(sizeof(struct tuple));
  st = malloc(tblsz_jogo * (sizeof(jogo)));
  eq = malloc(tblsz_equipa * (sizeof(equipa)));
  ht_creat_eq(tblsz_equipa, eq);
  ht_creat_jogo(tblsz_jogo, st);
  while ((c = getchar()) != EOF)
  {
    switch (c)
    {
      case 'a':
        M++;
        contalinhas++;
        for (int nome_index = 0; nome_index < 10; nome_index++)
      {
        nome[nome_index] = new_sym_var(sizeof(char) * 8);
      }

        nome[10 - 1] = '\0';
        for (int equipa1_index = 0; equipa1_index < 10; equipa1_index++)
      {
        equipa1[equipa1_index] = new_sym_var(sizeof(char) * 8);
      }

        equipa1[10 - 1] = '\0';
        for (int equipa2_index = 0; equipa2_index < 10; equipa2_index++)
      {
        equipa2[equipa2_index] = new_sym_var(sizeof(char) * 8);
      }

        equipa2[10 - 1] = '\0';
        score1 = new_sym_var(sizeof(int) * 8);
        score2 = new_sym_var(sizeof(int) * 8);
        game->nome = malloc((sizeof(char)) * (strlen(nome) + 1));
        strcpy(game->nome, nome);
        game->equipa1 = malloc((sizeof(char)) * (strlen(equipa1) + 1));
        strcpy(game->equipa1, equipa1);
        game->equipa2 = malloc((sizeof(char)) * (strlen(equipa2) + 1));
        strcpy(game->equipa2, equipa2);
        game->score1 = score1;
        game->score2 = score2;
        erro_a = erros_a(stop, game, equipa1, tblsz_equipa, contalinhas, procura_equipa, eq, equipa2, tblsz_jogo, st, procura_jogo);
        if (erro_a == 1)
      {
        break;
      }
      else
      {
        
      }

        compara_score(score1, score2, tblsz_equipa, eq, equipa1, equipa2);
        Head = append(nome, Head);
        insert_jogo(game->nome, game, tblsz_jogo, st, M);
        free(game->equipa2);
        free(game->equipa1);
        free(game->nome);
        break;

      case 'l':
        contalinhas++;
        display(contalinhas, tblsz_jogo, Head, st);
        break;

      case 'A':
        N++;
        contalinhas++;
        for (int team_name_index = 0; team_name_index < 10; team_name_index++)
      {
        team_name[team_name_index] = new_sym_var(sizeof(char) * 8);
      }

        team_name[10 - 1] = '\0';
        getchar();
        aponta_nome_equipa = malloc((sizeof(char)) * (strlen(team_name) + 1));
        strcpy(aponta_nome_equipa, team_name);
        stop = equipa_existente(team_name, tblsz_equipa, contalinhas, procura_equipa, eq);
        if (stop == 1)
      {
        {
          free(aponta_nome_equipa);
          break;
        }
      }
      else
      {
        
      }

        add_equipa->nome_equipa = malloc((sizeof(char)) * (strlen(team_name) + 1));
        strcpy(add_equipa->nome_equipa, team_name);
        add_equipa->vitorias = 0;
        Head_equipas = append(team_name, Head_equipas);
        insert_equipa(aponta_nome_equipa, add_equipa, tblsz_equipa, eq, N);
        free(add_equipa->nome_equipa);
        free(aponta_nome_equipa);
        break;

      case 'p':
        contalinhas++;
        for (int nome_index = 0; nome_index < 10; nome_index++)
      {
        nome[nome_index] = new_sym_var(sizeof(char) * 8);
      }

        nome[10 - 1] = '\0';
        stop = jogo_inexistente(nome, tblsz_jogo, contalinhas, *printado, st);
        if (stop == 1)
      {
        break;
      }
      else
      {
        
      }

        aponta = malloc((sizeof(char)) * (strlen(nome) + 1));
        strcpy(aponta, nome);
        *printado = search_jogo(aponta, tblsz_jogo, st);
        printf("%d %s %s %s %d %d\n", contalinhas, (*printado)->nome, (*printado)->equipa1, (*printado)->equipa2, (*printado)->score1, (*printado)->score2);
        free(aponta);
        break;

      case 'r':
        M--;
        contalinhas++;
        for (int nome_index = 0; nome_index < 10; nome_index++)
      {
        nome[nome_index] = new_sym_var(sizeof(char) * 8);
      }

        nome[10 - 1] = '\0';
        stop = jogo_inexistente(nome, tblsz_jogo, contalinhas, *printado, st);
        if (stop == 1)
      {
        break;
      }
      else
      {
        
      }

        if (quem_ganhou(nome, tblsz_jogo, st) == 0)
      {
        {
          delete_jogo(nome, tblsz_jogo, st, M);
          Head = delete_node(nome, Head);
          break;
        }
      }
      else
      {
        
      }

        strcpy(who_won, quem_ganhou(nome, tblsz_jogo, st));
        if (who_won != 0)
      {
        {
          altera_vitorias(who_won, tblsz_equipa, -1, eq);
        }
      }
      else
      {
        
      }

        delete_jogo(nome, tblsz_jogo, st, M);
        Head = delete_node(nome, Head);
        break;

      case 'P':
        contalinhas++;
        for (int nome_index = 0; nome_index < 10; nome_index++)
      {
        nome[nome_index] = new_sym_var(sizeof(char) * 8);
      }

        nome[10 - 1] = '\0';
        getchar();
        stop = equipa_inexistente(nome, tblsz_equipa, contalinhas, procura_equipa, eq);
        if (stop == 1)
      {
        break;
      }
      else
      {
        
      }

        aponta = malloc((sizeof(char)) * (strlen(nome) + 1));
        strcpy(aponta, nome);
        procura_equipa = search_equipa(aponta, tblsz_equipa, eq);
        printf("%d %s %d\n", contalinhas, procura_equipa->nome_equipa, procura_equipa->vitorias);
        free(aponta);
        break;

      case 's':
        contalinhas++;
        for (int nome_index = 0; nome_index < 10; nome_index++)
      {
        nome[nome_index] = new_sym_var(sizeof(char) * 8);
      }

        nome[10 - 1] = '\0';
        score1 = new_sym_var(sizeof(int) * 8);
        score2 = new_sym_var(sizeof(int) * 8);
        stop = jogo_inexistente(nome, tblsz_jogo, contalinhas, *printado, st);
        if (stop == 1)
      {
        {
          break;
        }
      }
      else
      {
        
      }

        if (quem_ganhou(nome, tblsz_jogo, st) != 0)
      {
        {
          aponta_nome_equipa = malloc((sizeof(char)) * (strlen(quem_ganhou(nome, tblsz_jogo, st)) + 1));
          strcpy(aponta_nome_equipa, quem_ganhou(nome, tblsz_jogo, st));
        }
      }
      else
      {
        
      }

        who_won_int = quem_ganhou_int(nome, tblsz_jogo, st);
        compara_resultados(who_won_int, score1, score2, nome, tblsz_jogo, st, tblsz_equipa, eq, team2, aponta_nome_equipa, team1);
        break;

      case 'g':
        contalinhas++;
        count = 0;
        tuplo = get_max_vit(Head_equipas, tblsz_equipa, eq, tuplo);
        if (tuplo->conta_eq_c_max_vit != 0)
      {
        {
          printf("%d Melhores %d\n", contalinhas, tuplo->max_vitorias);
          equipas_c_vitorias = malloc((sizeof(char *)) * (tuplo->conta_eq_c_max_vit + 1));
          obtem_equipas_com_max_vit(Head_equipas, tuplo->max_vitorias, equipas_c_vitorias, tblsz_equipa, eq);
          qsort(equipas_c_vitorias, tuplo->conta_eq_c_max_vit, sizeof(char *), cmp_str);
          for (i = 0; i < tuplo->conta_eq_c_max_vit; i++)
          {
            count++;
            printf("%d * %s\n", contalinhas, *equipas_c_vitorias);
            free(*equipas_c_vitorias);
            equipas_c_vitorias++;
          }

          equipas_c_vitorias -= count;
          free(equipas_c_vitorias);
        }
      }
      else
      {
        
      }

        break;

      case 'x':
        free(tuplo);
        free(printado);
        free_hash_eq(eq, tblsz_equipa);
        free_hash_st(st, tblsz_jogo);
        free_list_jogo(Head);
        free_list_equipa(Head_equipas);
        free(game);
        free(procura_jogo);
        free(add_equipa);
        break;

    }

  }

  return 0;
}

