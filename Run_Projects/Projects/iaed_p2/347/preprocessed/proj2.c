/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "JogoLincado.h"
#include "EquipaLincada.h"


int casoa(int NL, htJ_t *htJ, htE_t *htE, lista_jogo *listaJogos, int indexJogos)
{
  char nome[1024];
  char equipa1nome[1024];
  char equipa2nome[1024];
  int pontuacao1;
  int pontuacao2;
  Jogo *jogo;
  Equipa *equipa1;
  Equipa *equipa2;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  for (int equipa1nome_index = 0; equipa1nome_index < 10; equipa1nome_index++)
  {
    equipa1nome[equipa1nome_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa1nome[10 - 1] = '\0';
  for (int equipa2nome_index = 0; equipa2nome_index < 10; equipa2nome_index++)
  {
    equipa2nome[equipa2nome_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa2nome[10 - 1] = '\0';
  pontuacao1 = new_sym_var(sizeof(int) * 8);
  pontuacao2 = new_sym_var(sizeof(int) * 8);
  equipa1 = obter_htE(htE, equipa1nome);
  equipa2 = obter_htE(htE, equipa2nome);
  if (obter_htJ(htJ, nome))
  {
    printf("%d Jogo existente.\n", NL);
  }
  else
  {
    if ((!equipa1) || (!equipa2))
    {
      printf("%d Equipa inexistente.\n", NL);
    }
    else
    {
      jogo = novoJogo(nome, equipa1, equipa2, pontuacao1, pontuacao2);
      if (pontuacao1 > pontuacao2)
      {
        equipa1->vitorias++;
        jogo->vitoriosa = equipa1;
      }
      else
      {
        if (pontuacao2 > pontuacao1)
        {
          equipa2->vitorias++;
          jogo->vitoriosa = equipa2;
        }
        else
        {
          jogo->vitoriosa = 0;
        }

      }

      adicionar_ultimo_jogo(listaJogos, jogo);
      apropriar_htJ(htJ, nome, jogo);
      return indexJogos + 1;
    }

  }

  return indexJogos;
}

int casoA(int NL, htE_t *htE, lista_equipa *listaEquipas, int indexEquipas)
{
  Equipa *equipa;
  char nome[1024];
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  if (obter_htE(htE, nome))
  {
    printf("%d Equipa existente.\n", NL);
  }
  else
  {
    equipa = novaEquipa(nome);
    adicionar_ultimo_equipa(listaEquipas, equipa);
    apropriar_htE(htE, nome, equipa);
    return indexEquipas + 1;
  }

  return indexEquipas;
}

void casol(int NL, lista_jogo *listaJogos)
{
  Jogo *jogo;
  no_jogo *no = listaJogos->cabeca;
  while (no != 0)
  {
    jogo = no->jogo;
    no = no->prox;
    printf("%d %s %s %s %d %d\n", NL, jogo->nome, jogo->equipa1->nome, jogo->equipa2->nome, jogo->pontuacao[0], jogo->pontuacao[1]);
  }

}

void casop(int NL, htJ_t *htJ)
{
  char nome[1024];
  Jogo *jogo;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  jogo = obter_htJ(htJ, nome);
  if (!jogo)
  {
    printf("%d Jogo inexistente.\n", NL);
  }
  else
  {
    printf("%d %s %s %s %d %d\n", NL, jogo->nome, jogo->equipa1->nome, jogo->equipa2->nome, jogo->pontuacao[0], jogo->pontuacao[1]);
  }

}

void casoP(int NL, htE_t *htE)
{
  char nome[1024];
  Equipa *equipa;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  equipa = obter_htE(htE, nome);
  if (!equipa)
  {
    printf("%d Equipa inexistente.\n", NL);
  }
  else
  {
    printf("%d %s %d\n", NL, equipa->nome, equipa->vitorias);
  }

}

int casor(int NL, htJ_t *htJ, htE_t *htE, lista_jogo *listaJogos, int indexJogos)
{
  char nome[1024];
  Jogo *jogo;
  Equipa *vitoriosa;
  no_jogo *no = listaJogos->cabeca;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  jogo = obter_htJ(htJ, nome);
  if (!jogo)
  {
    printf("%d Jogo inexistente.\n", NL);
    return indexJogos;
  }
  else
  {
    if (jogo->vitoriosa != 0)
    {
      vitoriosa = obter_htE(htE, jogo->vitoriosa->nome);
      vitoriosa->vitorias--;
    }
    else
    {
      
    }

    htJ_del(htJ, nome);
    while (strcmp(no->jogo->nome, jogo->nome) != 0)
      no = no->prox;

    remover_no_jogo(listaJogos, no);
    return indexJogos - 1;
  }

}

void casos(int NL, htJ_t *htJ, htE_t *htE)
{
  Jogo *jogo;
  Equipa *novaVitoriosa = 0;
  Equipa *antiga;
  Equipa *nova;
  char nome[1024];
  int pontuacao1;
  int pontuacao2;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  pontuacao1 = new_sym_var(sizeof(int) * 8);
  pontuacao2 = new_sym_var(sizeof(int) * 8);
  jogo = obter_htJ(htJ, nome);
  if (!jogo)
  {
    printf("%d Jogo inexistente.\n", NL);
  }
  else
  {
    if (pontuacao1 > pontuacao2)
    {
      novaVitoriosa = jogo->equipa1;
    }
    else
    {
      if (pontuacao2 > pontuacao1)
      {
        novaVitoriosa = jogo->equipa2;
      }
      else
      {
        if (pontuacao1 == pontuacao2)
        {
          novaVitoriosa = 0;
        }
        else
        {
          
        }

      }

    }

    jogo->pontuacao[0] = pontuacao1;
    jogo->pontuacao[1] = pontuacao2;
    if (novaVitoriosa != jogo->vitoriosa)
    {
      if (novaVitoriosa != 0)
      {
        nova = obter_htE(htE, novaVitoriosa->nome);
        nova->vitorias++;
      }
      else
      {
        
      }

      if (jogo->vitoriosa != 0)
      {
        antiga = obter_htE(htE, jogo->vitoriosa->nome);
        antiga->vitorias--;
      }
      else
      {
        
      }

      jogo->vitoriosa = novaVitoriosa;
    }
    else
    {
      
    }

  }

}

void casog(int NL, lista_equipa *listaEquipas, int indexEquipas)
{
  int i = 0;
  int j;
  int indexVitorioso = 0;
  int maiorVitorias = 0;
  char **melhores = malloc((sizeof(char *)) * indexEquipas);
  char *temp;
  Equipa *ponte;
  no_equipa *no;
  if (indexEquipas > 0)
  {
    no = listaEquipas->cabeca;
    while (no != 0)
    {
      ponte = no->equipa;
      if (ponte->vitorias > maiorVitorias)
      {
        maiorVitorias = ponte->vitorias;
      }
      else
      {
        no = no->prox;
      }

    }

    no = listaEquipas->cabeca;
    while (no != 0)
    {
      ponte = no->equipa;
      if (ponte->vitorias == maiorVitorias)
      {
        melhores[indexVitorioso++] = ponte->nome;
      }
      else
      {
        
      }

      no = no->prox;
    }

    for (i = 0; i < (indexVitorioso - 1); i++)
    {
      for (j = i + 1; j < indexVitorioso; j++)
      {
        if (strcmp(melhores[i], melhores[j]) > 0)
        {
          temp = melhores[i];
          melhores[i] = melhores[j];
          melhores[j] = temp;
        }
        else
        {
          
        }

      }

    }

    printf("%d Melhores %d\n", NL, maiorVitorias);
    for (i = 0; i < indexVitorioso; i++)
    {
      printf("%d * %s\n", NL, melhores[i]);
    }

  }
  else
  {
    
  }

  free(melhores);
}

void liberar_hash_jogo(htJ_t *ht)
{
  int i;
  entradaJ_t *tmp;
  entradaJ_t *aux;
  for (i = 0; i < 2000; i++)
    for (tmp = ht->entradas[i]; tmp != 0; tmp = aux)
  {
    aux = tmp->proxJ;
    free(tmp->chaveJ);
    free(tmp);
  }


  free(ht->entradas);
  free(ht);
}

void liberar_hash_equipa(htE_t *ht)
{
  int i;
  entradaE_t *tmp;
  entradaE_t *aux;
  for (i = 0; i < 2000; i++)
    for (tmp = ht->entradas[i]; tmp != 0; tmp = aux)
  {
    aux = tmp->proxE;
    free(tmp->chaveE);
    free(tmp);
  }


  free(ht->entradas);
  free(ht);
}

int main()
{
  int NL = 0;
  int indexJogos = 0;
  int indexEquipas = 0;
  char caso = '\0';
  htJ_t *htJogos = criar_htJ();
  htE_t *htEquipas = criar_htE();
  lista_jogo *listaJogos = gerar_lista_jogo();
  lista_equipa *listaEquipas = gerar_lista_equipa();
  caso = new_sym_var(sizeof(char) * 8);
  while (caso != 'x')
  {
    NL++;
    switch (caso)
    {
      case 'a':
        indexJogos = casoa(NL, htJogos, htEquipas, listaJogos, indexJogos);
        break;

      case 'A':
        indexEquipas = casoA(NL, htEquipas, listaEquipas, indexEquipas);
        break;

      case 'l':
        casol(NL, listaJogos);
        break;

      case 'p':
        casop(NL, htJogos);
        break;

      case 'P':
        casoP(NL, htEquipas);
        break;

      case 'r':
        indexJogos = casor(NL, htJogos, htEquipas, listaJogos, indexJogos);
        break;

      case 's':
        casos(NL, htJogos, htEquipas);
        break;

      case 'g':
        casog(NL, listaEquipas, indexEquipas);
        break;

    }

    caso = new_sym_var(sizeof(char) * 8);
  }

  liberar_lista_jogo(listaJogos, indexJogos);
  liberar_lista_equipa(listaEquipas);
  liberar_hash_jogo(htJogos);
  liberar_hash_equipa(htEquipas);
  return 0;
}

