/*File generated by PreProcessor.py*/


#include <stdlib.h>
#include "hash_table.h"


hash_table *create_ht()
{
  hash_table *ptr = calloc(1, sizeof(hash_table));
  return ptr;
}

ht_node *create_ht_node()
{
  ht_node *ptr = calloc(1, sizeof(ht_node));
  return ptr;
}

void ht_insert_node(hash_table *ht, ht_node *node, ulong key)
{
  ht_node *next_node;
  next_node = ht->bucket[key];
  ht->bucket[key] = node;
  node->next = next_node;
}

void ht_delete_node(hash_table *ht, ht_node *node, ulong key)
{
  ht_node *curr;
  ht_node *prev = 0;
  for (curr = ht->bucket[key]; curr != 0; prev = curr, curr = curr->next)
  {
    if ((curr->info_struct == node->info_struct) && (curr->next == node->next))
    {
      {
        if (prev != 0)
        {
          {
            prev->next = curr->next;
          }
        }
        else
        {
          {
            ht->bucket[key] = curr->next;
          }
        }

        free(curr);
        return;
      }
    }
    else
    {
      
    }

  }

  return;
}

void ht_delete_node_and_info(hash_table *ht, ht_node *node, ulong key, free_info_struct func)
{
  ht_node *curr;
  ht_node *prev = 0;
  for (curr = ht->bucket[key]; curr != 0; prev = curr, curr = curr->next)
  {
    if ((curr->info_struct == node->info_struct) && (curr->next == node->next))
    {
      {
        if (prev != 0)
        {
          {
            prev->next = curr->next;
          }
        }
        else
        {
          {
            ht->bucket[key] = curr->next;
          }
        }

        func(curr->info_struct);
        free(curr);
        return;
      }
    }
    else
    {
      
    }

  }

  return;
}

void ht_delete_ht(hash_table *ht)
{
  int i;
  for (i = 0; i < 131072; i++)
  {
    while (ht->bucket[i] != 0)
    {
      ht_delete_node(ht, ht->bucket[i], i);
    }

  }

  free(ht);
  return;
}

void ht_delete_ht_and_info(hash_table *ht, free_info_struct func)
{
  int i;
  for (i = 0; i < 131072; i++)
  {
    while (ht->bucket[i] != 0)
    {
      ht_delete_node_and_info(ht, ht->bucket[i], i, func);
    }

  }

  free(ht);
  return;
}

ht_node *ht_get_base_node(hash_table *ht, ulong key)
{
  return ht->bucket[key];
}

ulong ht_key_from_str(char *str)
{
  ulong key = fnv_1a(str);
  key = key % 131072;
  return key;
}

ulong fnv_1a(char *str)
{
  ulong hash = 2166136261UL;
  ulong prime = 16777619UL;
  for (; (*str) != '\0'; str++)
  {
    hash = hash ^ (*str);
    hash = hash * prime;
  }

  return hash;
}

