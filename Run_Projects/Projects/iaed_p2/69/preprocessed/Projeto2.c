/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "estruturas.h"
#include "hashtable.h"
#include "ordena_aux.h"


void adiciona_novo_jogo(lista_jogos *heads_jg, lista_equipas *heads_eq, lista *lst, int count);
void adiciona_nova_equipa(lista_equipas *heads_eq, int count);
void procura_jogo(lista_jogos *heads_jg, int count);
void procura_equipa(lista_equipas *heads_eq, int count);
void apagar_jogo(lista_jogos *heads_jg, lista_equipas *heads_eq, lista *lst, int count);
void alterar_score(lista_jogos *heads_jg, lista_equipas *heads_eq, int count);
void lista_melhores(lista_equipas *heads_eq, int count);
int main()
{
  char c;
  int count = 1;
  lista_jogos *heads_jg = 0;
  lista_equipas *heads_eq = 0;
  lista *lst = lista_por_ordem_inicializar();
  heads_jg = lst_inicializar_jg(heads_jg);
  heads_eq = lst_inicializar_eq(heads_eq);
  while ((c = getchar()) != 'x')
  {
    switch (c)
    {
      case 'a':
        adiciona_novo_jogo(heads_jg, heads_eq, lst, count);
        count++;
        break;

      case 'A':
        adiciona_nova_equipa(heads_eq, count);
        count++;
        break;

      case 'l':
        listar_jogos(lst, count);
        count++;
        break;

      case 'p':
        procura_jogo(heads_jg, count);
        count++;
        break;

      case 'P':
        procura_equipa(heads_eq, count);
        count++;
        break;

      case 'r':
        apagar_jogo(heads_jg, heads_eq, lst, count);
        count++;
        break;

      case 's':
        alterar_score(heads_jg, heads_eq, count);
        count++;
        break;

      case 'g':
        lista_melhores(heads_eq, count);
        count++;
        break;

    }

  }

  free_heads_jg(heads_jg);
  free_heads_eq(heads_eq);
  free_head(lst);
  return 0;
}

void adiciona_novo_jogo(lista_jogos *heads_jg, lista_equipas *heads_eq, lista *lst, int count)
{
  char *nome;
  char *eq1;
  char *eq2;
  int sc1;
  int sc2;
  Jogo jogo;
  lista_equipas eq_1;
  lista_equipas eq_2;
  nome = malloc(1024 * (sizeof(char)));
  eq1 = malloc(1024 * (sizeof(char)));
  eq2 = malloc(1024 * (sizeof(char)));
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  for (int eq1_index = 0; eq1_index < 10; eq1_index++)
  {
    eq1[eq1_index] = new_sym_var(sizeof(char) * 8);
  }

  eq1[10 - 1] = '\0';
  for (int eq2_index = 0; eq2_index < 10; eq2_index++)
  {
    eq2[eq2_index] = new_sym_var(sizeof(char) * 8);
  }

  eq2[10 - 1] = '\0';
  sc1 = new_sym_var(sizeof(int) * 8);
  sc2 = new_sym_var(sizeof(int) * 8);
  eq_1 = EQprocurar(heads_eq, eq1);
  eq_2 = EQprocurar(heads_eq, eq2);
  if (JGprocurar(heads_jg, nome) != 0)
  {
    printf("%d Jogo existente.\n", count);
  }
  else
  {
    if ((eq_1 == 0) || (eq_2 == 0))
    {
      printf("%d Equipa inexistente.\n", count);
    }
    else
    {
      jogo = novo_jogo(nome, eq1, eq2, sc1, sc2);
      lista_por_ordem_add(lst, jogo);
      JGinserir(heads_jg, jogo);
      if (sc1 > sc2)
      {
        eq_1->equipa->vitorias += 1;
      }
      else
      {
        if (sc2 > sc1)
        {
          eq_2->equipa->vitorias += 1;
        }
        else
        {
          
        }

      }

    }

  }

  free(nome);
  free(eq1);
  free(eq2);
}

void adiciona_nova_equipa(lista_equipas *heads_eq, int count)
{
  Equipa equipa;
  char *nome;
  nome = malloc(1024 * (sizeof(char)));
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  if (EQprocurar(heads_eq, nome) == 0)
  {
    equipa = nova_equipa(nome);
    EQinserir(heads_eq, equipa);
  }
  else
  {
    printf("%d Equipa existente.\n", count);
  }

  free(nome);
}

void procura_jogo(lista_jogos *heads_jg, int count)
{
  char *nome;
  lista_jogos jogo_procurado;
  nome = malloc(1024 * (sizeof(char)));
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  jogo_procurado = JGprocurar(heads_jg, nome);
  if (jogo_procurado == 0)
  {
    printf("%d Jogo inexistente.\n", count);
  }
  else
  {
    printf("%d %s %s %s %d %d\n", count, jogo_procurado->jogo->nome_jogo, jogo_procurado->jogo->equipa1, jogo_procurado->jogo->equipa2, jogo_procurado->jogo->sc1, jogo_procurado->jogo->sc2);
  }

  free(nome);
}

void procura_equipa(lista_equipas *heads_eq, int count)
{
  char *nome;
  lista_equipas equipa_procurada;
  nome = malloc(1024 * (sizeof(char)));
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  equipa_procurada = EQprocurar(heads_eq, nome);
  if (equipa_procurada == 0)
  {
    printf("%d Equipa inexistente.\n", count);
  }
  else
  {
    printf("%d %s %d\n", count, equipa_procurada->equipa->nome, equipa_procurada->equipa->vitorias);
  }

  free(nome);
}

void apagar_jogo(lista_jogos *heads_jg, lista_equipas *heads_eq, lista *lst, int count)
{
  char *nome;
  lista_jogos jogo_el;
  lista_equipas equipa_procurada;
  nome = malloc(1024 * (sizeof(char)));
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  jogo_el = JGprocurar(heads_jg, nome);
  if (jogo_el == 0)
  {
    printf("%d Jogo inexistente.\n", count);
  }
  else
  {
    if (jogo_el->jogo->sc1 > jogo_el->jogo->sc2)
    {
      equipa_procurada = EQprocurar(heads_eq, jogo_el->jogo->equipa1);
      equipa_procurada->equipa->vitorias -= 1;
    }
    else
    {
      if (jogo_el->jogo->sc1 < jogo_el->jogo->sc2)
      {
        equipa_procurada = EQprocurar(heads_eq, jogo_el->jogo->equipa2);
        equipa_procurada->equipa->vitorias -= 1;
      }
      else
      {
        
      }

    }

    apagar_jogo_lista_por_ordem(lst, nome);
    Elimina_jogo(heads_jg, nome);
  }

  free(nome);
}

void alterar_score(lista_jogos *heads_jg, lista_equipas *heads_eq, int count)
{
  char *nome;
  int novo_sc1;
  int novo_sc2;
  lista_jogos jogo_el;
  lista_equipas eq_procurada;
  nome = malloc(1024 * (sizeof(char)));
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  novo_sc1 = new_sym_var(sizeof(int) * 8);
  novo_sc2 = new_sym_var(sizeof(int) * 8);
  jogo_el = JGprocurar(heads_jg, nome);
  if (jogo_el == 0)
  {
    printf("%d Jogo inexistente.\n", count);
  }
  else
  {
    if (jogo_el->jogo->sc1 > jogo_el->jogo->sc2)
    {
      eq_procurada = EQprocurar(heads_eq, jogo_el->jogo->equipa1);
      eq_procurada->equipa->vitorias -= 1;
    }
    else
    {
      if (jogo_el->jogo->sc1 < jogo_el->jogo->sc2)
      {
        eq_procurada = EQprocurar(heads_eq, jogo_el->jogo->equipa2);
        eq_procurada->equipa->vitorias -= 1;
      }
      else
      {
        
      }

    }

    jogo_el->jogo->sc1 = novo_sc1;
    jogo_el->jogo->sc2 = novo_sc2;
    if (novo_sc1 > novo_sc2)
    {
      eq_procurada = EQprocurar(heads_eq, jogo_el->jogo->equipa1);
      eq_procurada->equipa->vitorias += 1;
    }
    else
    {
      if (novo_sc2 > novo_sc1)
      {
        eq_procurada = EQprocurar(heads_eq, jogo_el->jogo->equipa2);
        eq_procurada->equipa->vitorias += 1;
      }
      else
      {
        
      }

    }

  }

  free(nome);
}

void lista_melhores(lista_equipas *heads_eq, int count)
{
  int i = 0;
  int mais_vitorias = 0;
  int tamanho = 0;
  lista_equipas aux;
  for (i = 0; i < 997; i++)
  {
    aux = heads_eq[i];
    while (aux != 0)
    {
      if (aux->equipa->vitorias > mais_vitorias)
      {
        mais_vitorias = aux->equipa->vitorias;
        tamanho = 1;
      }
      else
      {
        if (aux->equipa->vitorias == mais_vitorias)
        {
          tamanho++;
        }
        else
        {
          
        }

      }

      aux = aux->next;
    }

  }

  if (tamanho > 0)
  {
    lista_melhores_aux(heads_eq, mais_vitorias, tamanho, count);
  }
  else
  {
    
  }

}

