/*File generated by PreProcessor.py*/


#include <string.h>
#include <stdlib.h>
#include <stdio.h>
#include "Game.h"
#include "Game_Hash.h"
#include "Team.h"
#include "Team_Hash.h"


lnk_dblist add_game(int nl, lnk_dblist p_auxlist, link_game *head_ghash, link_team *head_thash, char *gm_name, char *t1_name, char *t2_name, int t1_score, int t2_score);
void list_games(int nl, lnk_dblist ptr_auxlist);
void search_game(int nl, link_game *head_ghash, char *g_name);
lnk_dblist delete_game(int nl, lnk_dblist p_auxlist, link_game *head_ghash, char *g_name);
void change_game(int nl, link_game *head_ghash, char *g_name, int score_t1, int score_t2);
void add_team(int nl, link_team *head, char *name);
void search_team(int nl, link_team *head, char *name);
void most_win(int nl, int size, link_team *head);
int compare(const void *a, const void *b);
int main()
{
  char command;
  char game_name[1024];
  char team1_name[1024];
  char team2_name[1024];
  int score_t1;
  int score_t2;
  int line_nr = 0;
  lnk_dblist pauxlist_games = initGHash_auxList();
  link_game *phash_games = initGame_Hash(4789);
  link_team *phash_teams = initTeam_Hash(13997);
  command = new_sym_var(sizeof(char) * 8);
  while (command != 'x')
  {
    switch (command)
    {
      case 'a':
        for (int game_name_index = 0; game_name_index < 10; game_name_index++)
      {
        game_name[game_name_index] = new_sym_var(sizeof(char) * 8);
      }

        game_name[10 - 1] = '\0';
        for (int team1_name_index = 0; team1_name_index < 10; team1_name_index++)
      {
        team1_name[team1_name_index] = new_sym_var(sizeof(char) * 8);
      }

        team1_name[10 - 1] = '\0';
        for (int team2_name_index = 0; team2_name_index < 10; team2_name_index++)
      {
        team2_name[team2_name_index] = new_sym_var(sizeof(char) * 8);
      }

        team2_name[10 - 1] = '\0';
        score_t1 = new_sym_var(sizeof(int) * 8);
        score_t2 = new_sym_var(sizeof(int) * 8);
        pauxlist_games = add_game(++line_nr, pauxlist_games, phash_games, phash_teams, game_name, team1_name, team2_name, score_t1, score_t2);
        break;

      case 'l':
        list_games(++line_nr, pauxlist_games);
        break;

      case 'p':
        for (int game_name_index = 0; game_name_index < 10; game_name_index++)
      {
        game_name[game_name_index] = new_sym_var(sizeof(char) * 8);
      }

        game_name[10 - 1] = '\0';
        search_game(++line_nr, phash_games, game_name);
        break;

      case 'r':
        for (int game_name_index = 0; game_name_index < 10; game_name_index++)
      {
        game_name[game_name_index] = new_sym_var(sizeof(char) * 8);
      }

        game_name[10 - 1] = '\0';
        pauxlist_games = delete_game(++line_nr, pauxlist_games, phash_games, game_name);
        break;

      case 's':
        for (int game_name_index = 0; game_name_index < 10; game_name_index++)
      {
        game_name[game_name_index] = new_sym_var(sizeof(char) * 8);
      }

        game_name[10 - 1] = '\0';
        score_t1 = new_sym_var(sizeof(int) * 8);
        score_t2 = new_sym_var(sizeof(int) * 8);
        change_game(++line_nr, phash_games, game_name, score_t1, score_t2);
        break;

      case 'A':
        for (int team1_name_index = 0; team1_name_index < 10; team1_name_index++)
      {
        team1_name[team1_name_index] = new_sym_var(sizeof(char) * 8);
      }

        team1_name[10 - 1] = '\0';
        add_team(++line_nr, phash_teams, team1_name);
        break;

      case 'P':
        for (int team1_name_index = 0; team1_name_index < 10; team1_name_index++)
      {
        team1_name[team1_name_index] = new_sym_var(sizeof(char) * 8);
      }

        team1_name[10 - 1] = '\0';
        search_team(++line_nr, phash_teams, team1_name);
        break;

      case 'g':
        most_win(++line_nr, 13997, phash_teams);
        break;

    }

    command = new_sym_var(sizeof(char) * 8);
  }

  destroyTeam_Hash(13997, phash_teams);
  destroyGame_Hash(4789, phash_games);
  destroyAux_List(pauxlist_games);
  return 0;
}

lnk_dblist add_game(int nl, lnk_dblist p_auxlist, link_game *head_ghash, link_team *head_thash, char *gm_name, char *t1_name, char *t2_name, int t1_score, int t2_score)
{
  Team *paux_team1 = searchTeam_Hash(13997, head_thash, t1_name);
  Team *paux_team2 = searchTeam_Hash(13997, head_thash, t2_name);
  if (searchGame_Hash(4789, head_ghash, gm_name) != 0)
  {
    {
      printf("%d Jogo existente.\n", nl);
      return p_auxlist;
    }
  }
  else
  {
    if ((paux_team1 == 0) || (paux_team2 == 0))
    {
      {
        printf("%d Equipa inexistente.\n", nl);
        return p_auxlist;
      }
    }
    else
    {
      {
        Game *ptr_ng = newGame(gm_name, paux_team1, paux_team2, t1_score, t2_score);
        Team *ptr_winner = who_won(ptr_ng);
        insertGame_Hash(4789, head_ghash, ptr_ng);
        if (ptr_winner != 0)
        {
          change_victory(ptr_winner, 1);
        }
        else
        {
          
        }

        return insrtGHash_auxList(p_auxlist, ptr_ng);
      }
    }

  }

}

void list_games(int nl, lnk_dblist ptr_auxlist)
{
  for (; ptr_auxlist != 0; ptr_auxlist = ptr_auxlist->next)
  {
    printf("%d %s %s %s %d %d\n", nl, ptr_auxlist->pgame->pname, ptr_auxlist->pgame->pteam1->name, ptr_auxlist->pgame->pteam2->name, ptr_auxlist->pgame->score1, ptr_auxlist->pgame->score2);
  }

}

void search_game(int nl, link_game *head_ghash, char *g_name)
{
  Game *p_game = searchGame_Hash(4789, head_ghash, g_name);
  if (p_game == 0)
  {
    printf("%d Jogo inexistente.\n", nl);
  }
  else
  {
    printf("%d %s %s %s %d %d\n", nl, p_game->pname, p_game->pteam1->name, p_game->pteam2->name, p_game->score1, p_game->score2);
  }

}

lnk_dblist delete_game(int nl, lnk_dblist p_auxlist, link_game *head_ghash, char *g_name)
{
  lnk_dblist new_head;
  Game *p_game = searchGame_Hash(4789, head_ghash, g_name);
  if (p_game == 0)
  {
    {
      printf("%d Jogo inexistente.\n", nl);
      return p_auxlist;
    }
  }
  else
  {
    {
      Team *ptr_winner = who_won(p_game);
      if (ptr_winner != 0)
      {
        change_victory(ptr_winner, -1);
      }
      else
      {
        
      }

      new_head = removGHash_auxList(p_auxlist, p_game);
      deleteGame_Hash(4789, head_ghash, g_name);
      return new_head;
    }
  }

}

void change_game(int nl, link_game *head_ghash, char *g_name, int score_t1, int score_t2)
{
  Game *p_game = searchGame_Hash(4789, head_ghash, g_name);
  if (p_game == 0)
  {
    printf("%d Jogo inexistente.\n", nl);
  }
  else
  {
    {
      Team *ptr_winner = who_won(p_game);
      if (ptr_winner != 0)
      {
        {
          change_victory(ptr_winner, -1);
        }
      }
      else
      {
        
      }

      p_game->score1 = score_t1;
      p_game->score2 = score_t2;
      ptr_winner = who_won(p_game);
      if (ptr_winner != 0)
      {
        {
          change_victory(ptr_winner, 1);
        }
      }
      else
      {
        
      }

    }
  }

}

void add_team(int nl, link_team *head, char *name)
{
  Team *p_team = searchTeam_Hash(13997, head, name);
  if (p_team != 0)
  {
    printf("%d Equipa existente.\n", nl);
  }
  else
  {
    {
      p_team = newTeam(name);
      insertTeam_Hash(13997, head, p_team);
    }
  }

}

void search_team(int nl, link_team *head, char *name)
{
  Team *p_team = searchTeam_Hash(13997, head, name);
  if (p_team == 0)
  {
    printf("%d Equipa inexistente.\n", nl);
  }
  else
  {
    printf("%d %s %d\n", nl, p_team->name, p_team->victories);
  }

}

void most_win(int nl, int size, link_team *head)
{
  int i;
  int max = 0;
  int nr_teams = 0;
  link_team p_aux;
  for (i = 0; i < size; i++)
  {
    p_aux = head[i];
    while (p_aux != 0)
    {
      if (p_aux->pteam->victories == max)
      {
        {
          nr_teams++;
        }
      }
      else
      {
        if (p_aux->pteam->victories > max)
        {
          {
            max = p_aux->pteam->victories;
            nr_teams = 1;
          }
        }
        else
        {
          
        }

      }

      p_aux = p_aux->next;
    }

  }

  if (nr_teams > 0)
  {
    {
      Team **vector = (Team **) malloc((sizeof(Team *)) * nr_teams);
      int count = 0;
      for (i = 0; i < size; i++)
      {
        p_aux = head[i];
        while (p_aux != 0)
        {
          if (p_aux->pteam->victories == max)
          {
            {
              vector[count] = p_aux->pteam;
              count++;
            }
          }
          else
          {
            
          }

          p_aux = p_aux->next;
        }

        if (count == nr_teams)
        {
          break;
        }
        else
        {
          
        }

      }

      qsort(vector, nr_teams, sizeof(Team *), compare);
      printf("%d Melhores %d\n", nl, max);
      for (i = 0; i < nr_teams; i++)
      {
        printf("%d * %s\n", nl, vector[i]->name);
      }

      free(vector);
    }
  }
  else
  {
    
  }

}

int compare(const void *a, const void *b)
{
  Team **t1 = (Team **) a;
  Team **t2 = (Team **) b;
  return strcmp((*t1)->name, (*t2)->name);
}

