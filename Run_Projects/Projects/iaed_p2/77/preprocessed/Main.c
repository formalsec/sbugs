/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "Estruturas.h"
#include "Hash.h"
#include "FuncoesAux.h"


void novo_jogo(int linha, p_jogo *cab_j, p_jogo *fim_j, p_jogo *tab_j, p_equipa *tab_e);
void lista_jogos(int linha, p_jogo *cab_j);
void apaga_jogo(int linha, p_jogo *tab_j, p_equipa *tab_e, p_jogo *fim_j, p_jogo *cab_j);
void procura_jogo(int linha, p_jogo *tab_j);
void procura_equipa(int linha, p_equipa *tab_e);
void nova_equipa(int linha, p_equipa *tab_e, p_equipa *cab_e, p_equipa *fim_e, int *equipas);
void muda_resultado(int linha, p_jogo *tab_j, p_equipa *tab_e);
void melhores_equipas(int linha, p_equipa *cab_e, int *equipas);
int main()
{
  int comando;
  p_jogo *tab_j;
  p_jogo *cab_j;
  p_jogo *fim_j;
  p_equipa *tab_e;
  p_equipa *cab_e;
  p_equipa *fim_e;
  int linha = 0;
  int *equipas;
  tab_j = inicializa_jogos();
  tab_e = inicializa_equipas();
  cab_j = (p_jogo *) malloc(sizeof(p_jogo));
  *cab_j = 0;
  fim_j = (p_jogo *) malloc(sizeof(p_jogo));
  *fim_j = 0;
  cab_e = (p_equipa *) malloc(sizeof(p_equipa));
  *cab_e = 0;
  fim_e = (p_equipa *) malloc(sizeof(p_equipa));
  *fim_e = 0;
  equipas = (int *) malloc(sizeof(int));
  *equipas = 0;
  while ((comando = getchar()) != 'x')
  {
    switch (comando)
    {
      case 'a':
        novo_jogo(++linha, cab_j, fim_j, tab_j, tab_e);
        break;

      case 'A':
        nova_equipa(++linha, tab_e, cab_e, fim_e, equipas);
        break;

      case 'l':
        lista_jogos(++linha, cab_j);
        break;

      case 'p':
        procura_jogo(++linha, tab_j);
        break;

      case 'P':
        procura_equipa(++linha, tab_e);
        break;

      case 'r':
        apaga_jogo(++linha, tab_j, tab_e, fim_j, cab_j);
        break;

      case 's':
        muda_resultado(++linha, tab_j, tab_e);
        break;

      case 'g':
        melhores_equipas(++linha, cab_e, equipas);
        break;

      default:
        break;

    }

  }

  free_tabela_jogos(tab_j, cab_j);
  free_tabela_equipas(tab_e, cab_e);
  free(cab_j);
  free(fim_j);
  free(cab_e);
  free(fim_e);
  free(equipas);
  return 0;
}

void novo_jogo(int linha, p_jogo *cab_j, p_jogo *fim_j, p_jogo *tab_j, p_equipa *tab_e)
{
  p_jogo jogo;
  char nome1[1024];
  char nome2[1024];
  char nome3[1024];
  int pontos1;
  int pontos2;
  for (int nome1_index = 0; nome1_index < 10; nome1_index++)
  {
    nome1[nome1_index] = new_sym_var(sizeof(char) * 8);
  }

  nome1[10 - 1] = '\0';
  for (int nome2_index = 0; nome2_index < 10; nome2_index++)
  {
    nome2[nome2_index] = new_sym_var(sizeof(char) * 8);
  }

  nome2[10 - 1] = '\0';
  for (int nome3_index = 0; nome3_index < 10; nome3_index++)
  {
    nome3[nome3_index] = new_sym_var(sizeof(char) * 8);
  }

  nome3[10 - 1] = '\0';
  pontos1 = new_sym_var(sizeof(int) * 8);
  pontos2 = new_sym_var(sizeof(int) * 8);
  if (existe_jogo(nome1, tab_j))
  {
    {
      printf("%d Jogo existente.\n", linha);
    }
  }
  else
  {
    if ((!encontra_equipa(nome2, tab_e)) || (!encontra_equipa(nome3, tab_e)))
    {
      {
        printf("%d Equipa inexistente.\n", linha);
      }
    }
    else
    {
      {
        jogo = (p_jogo) malloc(sizeof(struct jogo));
        jogo->nome = novo_nome(nome1);
        jogo->equipa1 = novo_nome(nome2);
        jogo->equipa2 = novo_nome(nome3);
        jogo->pontos1 = pontos1;
        jogo->pontos2 = pontos2;
        if ((*cab_j) == 0)
        {
          {
            *cab_j = jogo;
          }
        }
        else
        {
          {
            (*fim_j)->prox = jogo;
            jogo->ant = *fim_j;
          }
        }

        *fim_j = jogo;
        jogo->prox = 0;
        ve_vitoria(jogo, tab_e);
        insere_jogo(jogo, tab_j);
      }
    }

  }

}

void lista_jogos(int linha, p_jogo *cab_j)
{
  p_jogo i;
  for (i = *cab_j; i != 0; i = i->prox)
  {
    printf("%d %s %s %s %d %d\n", linha, i->nome, i->equipa1, i->equipa2, i->pontos1, i->pontos2);
  }

}

void procura_jogo(int linha, p_jogo *tab_j)
{
  p_jogo jogo;
  char nome[1024];
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  jogo = existe_jogo(nome, tab_j);
  if (jogo)
  {
    {
      printf("%d %s %s %s %d %d\n", linha, jogo->nome, jogo->equipa1, jogo->equipa2, jogo->pontos1, jogo->pontos2);
    }
  }
  else
  {
    {
      printf("%d Jogo inexistente.\n", linha);
    }
  }

}

void apaga_jogo(int linha, p_jogo *tab_j, p_equipa *tab_e, p_jogo *fim_j, p_jogo *cab_j)
{
  p_jogo jogo;
  char nome[1024];
  int *posicao;
  posicao = (int *) malloc(sizeof(int));
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  jogo = encontra_jogo(nome, tab_j, posicao);
  if (jogo)
  {
    {
      remove_jogo(tab_j, posicao);
      acerta_jogos(jogo, tab_e, cab_j, fim_j);
    }
  }
  else
  {
    {
      printf("%d Jogo inexistente.\n", linha);
    }
  }

  free(posicao);
}

void muda_resultado(int linha, p_jogo *tab_j, p_equipa *tab_e)
{
  int new_pontos1;
  int new_pontos2;
  char nome[1024];
  p_jogo jogo;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  new_pontos1 = new_sym_var(sizeof(int) * 8);
  new_pontos2 = new_sym_var(sizeof(int) * 8);
  jogo = existe_jogo(nome, tab_j);
  if (jogo)
  {
    {
      ve_derrota(jogo, tab_e);
      jogo->pontos1 = new_pontos1;
      jogo->pontos2 = new_pontos2;
      ve_vitoria(jogo, tab_e);
    }
  }
  else
  {
    {
      printf("%d Jogo inexistente.\n", linha);
    }
  }

}

void nova_equipa(int linha, p_equipa *tab_e, p_equipa *cab_e, p_equipa *fim_e, int *equipas)
{
  p_equipa equipa;
  char nome[1024];
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  if (encontra_equipa(nome, tab_e))
  {
    {
      printf("%d Equipa existente.\n", linha);
    }
  }
  else
  {
    {
      equipa = (p_equipa) malloc(sizeof(struct equipa));
      equipa->nome = novo_nome(nome);
      equipa->vitorias = 0;
      equipa->prox = 0;
      if ((*cab_e) == 0)
      {
        {
          *cab_e = equipa;
        }
      }
      else
      {
        {
          (*fim_e)->prox = equipa;
        }
      }

      *fim_e = equipa;
      insere_equipa(equipa, tab_e);
      (*equipas)++;
    }
  }

}

void procura_equipa(int linha, p_equipa *tab_e)
{
  p_equipa equipa;
  char nome[1024];
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  equipa = encontra_equipa(nome, tab_e);
  if (equipa)
  {
    {
      printf("%d %s %d\n", linha, equipa->nome, equipa->vitorias);
    }
  }
  else
  {
    {
      printf("%d Equipa inexistente.\n", linha);
    }
  }

}

void melhores_equipas(int linha, p_equipa *cab_e, int *equipas)
{
  int i = 0;
  int j;
  int vitorias_max = 0;
  int n_melhores = 0;
  p_equipa equipa;
  char **melhores;
  melhores = (char **) malloc((*equipas) * (sizeof(char *)));
  for (equipa = *cab_e; equipa != 0; equipa = equipa->prox)
  {
    if (equipa->vitorias == vitorias_max)
    {
      {
        melhores[i++] = equipa->nome;
        n_melhores++;
      }
    }
    else
    {
      if (equipa->vitorias > vitorias_max)
      {
        {
          vitorias_max = equipa->vitorias;
          n_melhores = 1;
          i = 0;
          memset(melhores, 0, (sizeof(char *)) * n_melhores);
          melhores[i++] = equipa->nome;
        }
      }
      else
      {
        
      }

    }

  }

  if (n_melhores)
  {
    {
      qsort(melhores, n_melhores, sizeof(char *), alfabetico_equipas);
      printf("%d Melhores %d\n", linha, vitorias_max);
      for (j = 0; j != n_melhores; j++)
      {
        printf("%d * %s\n", linha, melhores[j]);
      }

    }
  }
  else
  {
    
  }

  free(melhores);
}

