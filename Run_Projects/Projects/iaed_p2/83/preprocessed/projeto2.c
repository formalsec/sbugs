/*File generated by PreProcessor.py*/


#include "JogoEquipa.h"
#include "hashtable.h"
#include "lista.h"
#include <string.h>
#include <stdlib.h>
#include <stdio.h>


void atribui_vitoria(Equipa Equipa)
{
  Equipa->vitorias = Equipa->vitorias + 1;
}

void retira_vitoria(Equipa Equipa)
{
  Equipa->vitorias = Equipa->vitorias - 1;
}

int cstring_cmp(const void *a, const void *b)
{
  const char **ia = (const char **) a;
  const char **ib = (const char **) b;
  return strcmp(*ia, *ib);
}

void comando_a(int *max_jogos, int *max_equipas, int *N_jogos, Jogo *TabJogos, Equipa *TabEquipas, int *N_linhas, link *head, link *tail)
{
  char *nome;
  char *equipa1;
  char *equipa2;
  int score1;
  int score2;
  Equipa Equipa1;
  Equipa Equipa2;
  Jogo Jogo;
  nome = (char *) malloc((sizeof(char)) * 1023);
  equipa1 = (char *) malloc((sizeof(char)) * 1023);
  equipa2 = (char *) malloc((sizeof(char)) * 1023);
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  for (int equipa1_index = 0; equipa1_index < 10; equipa1_index++)
  {
    equipa1[equipa1_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa1[10 - 1] = '\0';
  for (int equipa2_index = 0; equipa2_index < 10; equipa2_index++)
  {
    equipa2[equipa2_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa2[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  Jogo = TabJogossearch(max_jogos, TabJogos, nome);
  if (Jogo == 0)
  {
    Equipa1 = TabEquipassearch(max_equipas, TabEquipas, equipa1);
    if (Equipa1 == 0)
    {
      printf("%d Equipa inexistente.\n", *N_linhas);
    }
    else
    {
      Equipa2 = TabEquipassearch(max_equipas, TabEquipas, equipa2);
      if (Equipa2 == 0)
      {
        printf("%d Equipa inexistente.\n", *N_linhas);
      }
      else
      {
        if (score2 > score1)
        {
          atribui_vitoria(Equipa2);
        }
        else
        {
          if (score1 > score2)
          {
            atribui_vitoria(Equipa1);
          }
          else
          {
            
          }

        }

        Jogo = newJogo(nome, equipa1, equipa2, score1, score2);
        insertEnd(head, tail, Jogo);
        TabJogosinsert(max_jogos, N_jogos, TabJogos, Jogo);
      }

    }

  }
  else
  {
    printf("%d Jogo existente.\n", *N_linhas);
  }

  free(nome);
  free(equipa1);
  free(equipa2);
}

void comando_A(int *max_equipas, int *N_equipas, Equipa *TabEquipas, int *N_linhas)
{
  char *nome;
  Equipa Equipa;
  nome = (char *) malloc((sizeof(char)) * 1023);
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  Equipa = TabEquipassearch(max_equipas, TabEquipas, nome);
  if (Equipa == 0)
  {
    Equipa = newEquipa(nome, 0);
    TabEquipasinsert(max_equipas, N_equipas, TabEquipas, Equipa);
  }
  else
  {
    printf("%d Equipa existente.\n", *N_linhas);
  }

  free(nome);
}

void comando_p(int *max_jogos, Jogo *TabJogos, int *N_linhas)
{
  char *nome;
  Jogo Jogo;
  nome = (char *) malloc((sizeof(char)) * 1023);
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  Jogo = TabJogossearch(max_jogos, TabJogos, nome);
  if (Jogo != 0)
  {
    printf("%d ", *N_linhas);
    printJogo(Jogo);
  }
  else
  {
    printf("%d Jogo inexistente.\n", *N_linhas);
  }

  free(nome);
}

void comando_P(int *max_equipas, Equipa *TabEquipas, int *N_linhas)
{
  char *nome;
  Equipa Equipa;
  nome = (char *) malloc((sizeof(char)) * 1023);
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  Equipa = TabEquipassearch(max_equipas, TabEquipas, nome);
  if (Equipa != 0)
  {
    printf("%d ", *N_linhas);
    printEquipa(Equipa);
  }
  else
  {
    printf("%d Equipa inexistente.\n", *N_linhas);
  }

  free(nome);
}

void comando_r(int *max_jogos, int *max_equipas, int *N_jogos, Jogo *TabJogos, Equipa *TabEquipas, link *head, link *tail, int *N_linhas)
{
  char *nome;
  Jogo Jogo;
  Equipa Equipa;
  nome = (char *) malloc((sizeof(char)) * 1023);
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  Jogo = TabJogossearch(max_jogos, TabJogos, nome);
  if (Jogo != 0)
  {
    if (Jogo->score1 > Jogo->score2)
    {
      Equipa = TabEquipassearch(max_equipas, TabEquipas, Jogo->equipa1);
      retira_vitoria(Equipa);
    }
    else
    {
      if (Jogo->score1 < Jogo->score2)
      {
        Equipa = TabEquipassearch(max_equipas, TabEquipas, Jogo->equipa2);
        retira_vitoria(Equipa);
      }
      else
      {
        
      }

    }

    delete(head, tail, Jogo);
    TabJogosdelete(max_jogos, N_jogos, TabJogos, nome);
  }
  else
  {
    printf("%d Jogo inexistente.\n", *N_linhas);
  }

  free(nome);
}

void comando_s(int *max_jogos, int *max_equipas, Jogo *TabJogos, Equipa *TabEquipas, int *N_linhas)
{
  char *nome;
  int novo_score1;
  int novo_score2;
  Jogo Jogo;
  Equipa Equipa;
  nome = (char *) malloc((sizeof(char)) * 1023);
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  novo_score1 = new_sym_var(sizeof(int) * 8);
  novo_score2 = new_sym_var(sizeof(int) * 8);
  Jogo = TabJogossearch(max_jogos, TabJogos, nome);
  if (Jogo != 0)
  {
    if (Jogo->score1 > Jogo->score2)
    {
      Equipa = TabEquipassearch(max_equipas, TabEquipas, Jogo->equipa1);
      if (novo_score1 < novo_score2)
      {
        retira_vitoria(Equipa);
        Equipa = TabEquipassearch(max_equipas, TabEquipas, Jogo->equipa2);
        atribui_vitoria(Equipa);
      }
      else
      {
        if (novo_score1 == novo_score2)
        {
          retira_vitoria(Equipa);
        }
        else
        {
          
        }

      }

    }
    else
    {
      if (Jogo->score1 < Jogo->score2)
      {
        Equipa = TabEquipassearch(max_equipas, TabEquipas, Jogo->equipa2);
        if (novo_score1 > novo_score2)
        {
          retira_vitoria(Equipa);
          Equipa = TabEquipassearch(max_equipas, TabEquipas, Jogo->equipa1);
          atribui_vitoria(Equipa);
        }
        else
        {
          if (novo_score1 == novo_score2)
          {
            retira_vitoria(Equipa);
          }
          else
          {
            
          }

        }

      }
      else
      {
        if (Jogo->score1 == Jogo->score2)
        {
          if (novo_score1 > novo_score2)
          {
            Equipa = TabEquipassearch(max_equipas, TabEquipas, Jogo->equipa1);
            atribui_vitoria(Equipa);
          }
          else
          {
            if (novo_score1 < novo_score2)
            {
              Equipa = TabEquipassearch(max_equipas, TabEquipas, Jogo->equipa2);
              atribui_vitoria(Equipa);
            }
            else
            {
              
            }

          }

        }
        else
        {
          
        }

      }

    }

    Jogo->score1 = novo_score1;
    Jogo->score2 = novo_score2;
  }
  else
  {
    printf("%d Jogo inexistente.\n", *N_linhas);
  }

  free(nome);
}

void comando_l(link head, int *N_linhas)
{
  printLista(head, N_linhas);
}

void comando_g(int *max_equipas, Equipa *TabEquipas, int *N_linhas)
{
  int maior = 0;
  int acumulador = 0;
  int contador = 0;
  int i = 0;
  char **Tabela;
  while (i < (*max_equipas))
  {
    if (TabEquipas[i] != 0)
    {
      if (TabEquipas[i]->vitorias > maior)
      {
        maior = TabEquipas[i]->vitorias;
        acumulador = 1;
      }
      else
      {
        if (TabEquipas[i]->vitorias == maior)
        {
          acumulador++;
        }
        else
        {
          
        }

      }

    }
    else
    {
      
    }

    i++;
  }

  i = 0;
  if (acumulador > 0)
  {
    Tabela = (char **) malloc(acumulador * 1023);
    while ((i < (*max_equipas)) && (contador < acumulador))
    {
      if (TabEquipas[i] != 0)
      {
        if (TabEquipas[i]->vitorias == maior)
        {
          Tabela[contador] = TabEquipas[i]->nome;
          contador++;
        }
        else
        {
          
        }

      }
      else
      {
        
      }

      i++;
    }

    contador = 0;
    qsort(Tabela, acumulador, sizeof(char *), cstring_cmp);
    printf("%d Melhores %d\n", *N_linhas, maior);
    while (contador < acumulador)
    {
      printf("%d * %s\n", *N_linhas, Tabela[contador]);
      contador++;
    }

    free(Tabela);
  }
  else
  {
    
  }

}

int main()
{
  char c;
  int *max_jogos;
  int *max_equipas;
  Jogo *TabJogos;
  Equipa *TabEquipas;
  link *head;
  link *tail;
  int N_jogos = 0;
  int N_equipas = 0;
  int N_linhas = 1;
  max_jogos = (int *) malloc(sizeof(int));
  max_equipas = (int *) malloc(sizeof(int));
  head = (link *) malloc(sizeof(link));
  tail = (link *) malloc(sizeof(link));
  *max_jogos = 997;
  *max_equipas = 997;
  *head = 0;
  *tail = 0;
  TabJogos = (Jogo *) malloc((*max_jogos) * (sizeof(Jogo)));
  TabEquipas = (Equipa *) malloc((*max_equipas) * (sizeof(Equipa)));
  TabJogosinit(max_jogos, &N_jogos, TabJogos);
  TabEquipasinit(max_equipas, &N_equipas, TabEquipas);
  c = getchar();
  while (c != 'x')
  {
    if (c == 'a')
    {
      comando_a(max_jogos, max_equipas, &N_jogos, TabJogos, TabEquipas, &N_linhas, head, tail);
      if (N_jogos == ((*max_jogos) / 2))
      {
        TabJogos = expand_jogos(max_jogos, &N_jogos, TabJogos);
      }
      else
      {
        
      }

    }
    else
    {
      if (c == 'A')
      {
        comando_A(max_equipas, &N_equipas, TabEquipas, &N_linhas);
        if (N_equipas == ((*max_equipas) / 2))
        {
          TabEquipas = expand_equipas(max_equipas, &N_equipas, TabEquipas);
        }
        else
        {
          
        }

      }
      else
      {
        if (c == 'p')
        {
          comando_p(max_jogos, TabJogos, &N_linhas);
        }
        else
        {
          if (c == 'P')
          {
            comando_P(max_equipas, TabEquipas, &N_linhas);
          }
          else
          {
            if (c == 'r')
            {
              comando_r(max_jogos, max_equipas, &N_jogos, TabJogos, TabEquipas, head, tail, &N_linhas);
            }
            else
            {
              if (c == 's')
              {
                comando_s(max_jogos, max_equipas, TabJogos, TabEquipas, &N_linhas);
              }
              else
              {
                if (c == 'l')
                {
                  comando_l(*head, &N_linhas);
                }
                else
                {
                  if (c == 'g')
                  {
                    comando_g(max_equipas, TabEquipas, &N_linhas);
                  }
                  else
                  {
                    
                  }

                }

              }

            }

          }

        }

      }

    }

    c = getchar();
    c = getchar();
    N_linhas++;
  }

  freeTabJogos(max_jogos, TabJogos);
  freeTabEquipas(max_equipas, TabEquipas);
  freeLista(*head);
  free(max_jogos);
  free(max_equipas);
  free(head);
  free(tail);
  return 0;
}

