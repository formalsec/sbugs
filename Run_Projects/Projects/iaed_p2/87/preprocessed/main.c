/*File generated by PreProcessor.py*/


#include "jogos.h"
#include "equipas.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdbool.h>


void add_jogo(int NL, hashtable_jogos *hash_jogos, hashtable_equipas *hash_equipas, lista *ls);
void lista_jogo(int NL, lista *ls);
void procura_jogo(int NL, hashtable_jogos *hash_jogos);
void remove_jogo(int NL, hashtable_jogos *hash_jogos, hashtable_equipas *hash_equipas, lista *ls);
void altera_score(int NL, hashtable_jogos *hash_jogos, hashtable_equipas *hash_equipas);
void add_equipa(int NL, hashtable_equipas *hash_equipas);
void procura_equipa(int NL, hashtable_equipas *hash_equipas);
int compnome(const void *nome1, const void *nome2);
void equipas_maior_vitorias(int NL, hashtable_equipas *hash_equipas);
int main()
{
  int NL = 1;
  int estado = true;
  lista *ls = init_lista();
  hashtable_jogos *hash_jogos = init_hash_jogos(31);
  hashtable_equipas *hash_equipas = init_hash_equipas(31);
  while (estado)
  {
    switch (getchar())
    {
      case 'a':
        add_jogo(NL, hash_jogos, hash_equipas, ls);
        NL++;
        break;

      case 'l':
        lista_jogo(NL, ls);
        NL++;
        break;

      case 'p':
        procura_jogo(NL, hash_jogos);
        NL++;
        break;

      case 'r':
        remove_jogo(NL, hash_jogos, hash_equipas, ls);
        NL++;
        break;

      case 's':
        altera_score(NL, hash_jogos, hash_equipas);
        NL++;
        break;

      case 'A':
        add_equipa(NL, hash_equipas);
        NL++;
        break;

      case 'P':
        procura_equipa(NL, hash_equipas);
        NL++;
        break;

      case 'g':
        equipas_maior_vitorias(NL, hash_equipas);
        NL++;
        break;

      case 'x':
        estado = false;
        free_lista(ls);
        free_hash_jogos(hash_jogos);
        free_hash_equipas(hash_equipas);

    }

  }

  return 0;
}

void add_jogo(int NL, hashtable_jogos *hash_jogos, hashtable_equipas *hash_equipas, lista *ls)
{
  equipas *equipa;
  jogos *novo_jogo;
  int score1;
  int score2;
  char nome[1024];
  char equipa1[1024];
  char equipa2[1024];
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  for (int equipa1_index = 0; equipa1_index < 10; equipa1_index++)
  {
    equipa1[equipa1_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa1[10 - 1] = '\0';
  for (int equipa2_index = 0; equipa2_index < 10; equipa2_index++)
  {
    equipa2[equipa2_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa2[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  if (procura_hash_jogos(hash_jogos, nome) != 0)
  {
    printf("%d Jogo existente.\n", NL);
    return;
  }
  else
  {
    if (procura_hash_equipas(hash_equipas, equipa1) == 0)
    {
      printf("%d Equipa inexistente.\n", NL);
      return;
    }
    else
    {
      if (procura_hash_equipas(hash_equipas, equipa2) == 0)
      {
        printf("%d Equipa inexistente.\n", NL);
        return;
      }
      else
      {
        
      }

    }

  }

  novo_jogo = (jogos *) malloc(sizeof(jogos));
  novo_jogo->score1 = score1;
  novo_jogo->score2 = score2;
  novo_jogo->nome = (char *) malloc((sizeof(char)) * (strlen(nome) + 1));
  strcpy(novo_jogo->nome, nome);
  novo_jogo->equipa1 = (char *) malloc((sizeof(char)) * (strlen(equipa1) + 1));
  strcpy(novo_jogo->equipa1, equipa1);
  novo_jogo->equipa2 = (char *) malloc((sizeof(char)) * (strlen(equipa2) + 1));
  strcpy(novo_jogo->equipa2, equipa2);
  insere_hash_jogos(hash_jogos, novo_jogo);
  insere_lista_ult(ls, novo_jogo);
  if (score1 > score2)
  {
    equipa = procura_hash_equipas(hash_equipas, equipa1);
    equipa->vitorias++;
  }
  else
  {
    if (score1 < score2)
    {
      equipa = procura_hash_equipas(hash_equipas, equipa2);
      equipa->vitorias++;
    }
    else
    {
      
    }

  }

}

void lista_jogo(int NL, lista *ls)
{
  node *aux = ls->head;
  while (aux != 0)
  {
    printf("%d ", NL);
    printf("%s ", aux->jogo->nome);
    printf("%s ", aux->jogo->equipa1);
    printf("%s ", aux->jogo->equipa2);
    printf("%d ", aux->jogo->score1);
    printf("%d\n", aux->jogo->score2);
    aux = aux->next;
  }

}

void procura_jogo(int NL, hashtable_jogos *hash_jogos)
{
  jogos *jogo;
  char nome[1024];
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  if ((jogo = procura_hash_jogos(hash_jogos, nome)) == 0)
  {
    printf("%d Jogo inexistente.\n", NL);
    return;
  }
  else
  {
    
  }

  printf("%d ", NL);
  printf("%s ", jogo->nome);
  printf("%s ", jogo->equipa1);
  printf("%s ", jogo->equipa2);
  printf("%d ", jogo->score1);
  printf("%d\n", jogo->score2);
}

void remove_jogo(int NL, hashtable_jogos *hash_jogos, hashtable_equipas *hash_equipas, lista *ls)
{
  jogos *jogo;
  equipas *equipa;
  char nome[1024];
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  if ((jogo = procura_hash_jogos(hash_jogos, nome)) == 0)
  {
    printf("%d Jogo inexistente.\n", NL);
    return;
  }
  else
  {
    
  }

  if (jogo->score1 > jogo->score2)
  {
    equipa = procura_hash_equipas(hash_equipas, jogo->equipa1);
    equipa->vitorias--;
  }
  else
  {
    if (jogo->score1 < jogo->score2)
    {
      equipa = procura_hash_equipas(hash_equipas, jogo->equipa2);
      equipa->vitorias--;
    }
    else
    {
      
    }

  }

  remove_lista(ls, nome);
  remove_hash_jogos(hash_jogos, nome);
}

void altera_score(int NL, hashtable_jogos *hash_jogos, hashtable_equipas *hash_equipas)
{
  jogos *jogo;
  int score1;
  int score2;
  char nome[1024];
  equipas *equipa1;
  equipas *equipa2;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  if ((jogo = procura_hash_jogos(hash_jogos, nome)) == 0)
  {
    printf("%d Jogo inexistente.\n", NL);
    return;
  }
  else
  {
    
  }

  equipa1 = procura_hash_equipas(hash_equipas, jogo->equipa1);
  equipa2 = procura_hash_equipas(hash_equipas, jogo->equipa2);
  if (jogo->score1 > jogo->score2)
  {
    if (score1 < score2)
    {
      equipa1->vitorias--;
      equipa2->vitorias++;
    }
    else
    {
      if (score1 == score2)
      {
        equipa1->vitorias--;
      }
      else
      {
        
      }

    }

  }
  else
  {
    if (jogo->score1 < jogo->score2)
    {
      if (score1 > score2)
      {
        equipa1->vitorias++;
        equipa2->vitorias--;
      }
      else
      {
        if (score1 == score2)
        {
          equipa2->vitorias--;
        }
        else
        {
          
        }

      }

    }
    else
    {
      if (jogo->score1 == jogo->score2)
      {
        if (score1 > score2)
        {
          equipa1->vitorias++;
        }
        else
        {
          if (score1 < score2)
          {
            equipa2->vitorias++;
          }
          else
          {
            
          }

        }

      }
      else
      {
        
      }

    }

  }

  jogo->score1 = score1;
  jogo->score2 = score2;
}

void add_equipa(int NL, hashtable_equipas *hash_equipas)
{
  char nome[1024];
  equipas *nova_equipa;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  if (procura_hash_equipas(hash_equipas, nome) != 0)
  {
    printf("%d Equipa existente.\n", NL);
    return;
  }
  else
  {
    
  }

  nova_equipa = (equipas *) malloc(sizeof(equipas));
  nova_equipa->nome = (char *) malloc((sizeof(char)) * (strlen(nome) + 1));
  strcpy(nova_equipa->nome, nome);
  nova_equipa->vitorias = 0;
  insere_hash_equipas(hash_equipas, nova_equipa);
}

void procura_equipa(int NL, hashtable_equipas *hash_equipas)
{
  equipas *equipa;
  char nome[1024];
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  if ((equipa = procura_hash_equipas(hash_equipas, nome)) == 0)
  {
    printf("%d Equipa inexistente.\n", NL);
    return;
  }
  else
  {
    
  }

  printf("%d ", NL);
  printf("%s ", equipa->nome);
  printf("%d\n", equipa->vitorias);
}

void equipas_maior_vitorias(int NL, hashtable_equipas *hash_equipas)
{
  int i = 0;
  int j = 0;
  int vitorias = 0;
  int numero_equipas = 0;
  char **vitorias_equipas;
  if (hash_equipas->n_elem == 0)
  {
    return;
  }
  else
  {
    
  }

  for (; i < hash_equipas->tamanho; i++)
  {
    if (hash_equipas->hash[i] != 0)
    {
      if (hash_equipas->hash[i]->vitorias > vitorias)
      {
        vitorias = hash_equipas->hash[i]->vitorias;
        numero_equipas = 1;
      }
      else
      {
        if (hash_equipas->hash[i]->vitorias == vitorias)
        {
          numero_equipas++;
        }
        else
        {
          
        }

      }

    }
    else
    {
      
    }

  }

  vitorias_equipas = (char **) malloc((sizeof(char *)) * numero_equipas);
  for (i = 0; i < hash_equipas->tamanho; i++)
  {
    if (hash_equipas->hash[i] != 0)
    {
      if ((hash_equipas->hash[i]->vitorias == vitorias) && (j < numero_equipas))
      {
        vitorias_equipas[j] = hash_equipas->hash[i]->nome;
        j++;
      }
      else
      {
        
      }

    }
    else
    {
      
    }

  }

  qsort(vitorias_equipas, numero_equipas, sizeof(char *), compnome);
  printf("%d Melhores %d\n", NL, vitorias);
  for (i = 0; i < j; i++)
  {
    printf("%d * %s\n", NL, vitorias_equipas[i]);
  }

  free(vitorias_equipas);
}

int compnome(const void *nome1, const void *nome2)
{
  return strcmp(*((const char **) nome1), *((const char **) nome2));
}

