/*File generated by PreProcessor.py*/


#include <stdlib.h>
#include <stdio.h>
#include <assert.h>
#include <getopt.h>
#include <string.h>
#include <fcntl.h>
#include <unistd.h>
#include <pthread.h>


char *inputFile = 0;
typedef struct RouterR RouterR;
typedef struct NodeR NodeR;
typedef struct Problem Problem;
void printProblem(Problem *problem);
int *countSubnets(Problem *problem);
int isAllVisited(int visited[], int size);
int getFirstNotVisited(int visited[], int size);
void visit(RouterR **listaRouters, RouterR *router, int visited[], int size, int cycle);
int *getSubNets(int *visited, int size, int nnets);
int getNumSubnets(int *visited, int size);
int countMaxRoutersInSubnet(int *visited, int size);
int contains(int array[], int size, int elem);
int *visitDFS(Problem *problem, int *visited);
void getBreakSubnets(Problem *problem, int nnets, int breakSubNets[]);
void printVisited(int visited[], int size);
typedef struct NodeR
{
  int link;
  NodeR *next;
} NodeR;
typedef struct RouterR
{
  int id;
  NodeR *adj;
} RouterR;
typedef struct Problem
{
  int numRouters;
  RouterR **routerList;
  int *visited;
} Problem;
static Problem *parseArgs(long argc, char * const argv[])
{
  int numRouters;
  int numConnections;
  int u;
  int v;
  int i;
  numRouters = new_sym_var(sizeof(int) * 8);
  numConnections = new_sym_var(sizeof(int) * 8);
  RouterR **routersR;
  routersR = malloc(numRouters * (sizeof(RouterR *)));
  for (i = 0; i < numRouters; i++)
  {
    routersR[i] = (RouterR *) malloc(sizeof(RouterR));
    routersR[i]->id = i;
    routersR[i]->adj = 0;
  }

  for (i = 0; i < numConnections; i++)
  {
    u = new_sym_var(sizeof(int) * 8);
    v = new_sym_var(sizeof(int) * 8);
    --u;
    --v;
    NodeR *newAdj = malloc(sizeof(NodeR));
    newAdj->next = routersR[u]->adj;
    newAdj->link = v;
    routersR[u]->adj = newAdj;
    newAdj = malloc(sizeof(NodeR));
    newAdj->next = routersR[v]->adj;
    newAdj->link = u;
    routersR[v]->adj = newAdj;
  }

  Problem *problem = malloc(sizeof(Problem));
  problem->routerList = routersR;
  problem->numRouters = numRouters;
  return problem;
}

int main(int argc, char **argv)
{
  Problem *problem = parseArgs(argc, argv);
  int i;
  int *visited = malloc((sizeof(int)) * problem->numRouters);
  for (i = 0; i < problem->numRouters; i++)
  {
    visited[i] = -1;
  }

  visitDFS(problem, visited);
  int nnets = getNumSubnets(visited, problem->numRouters);
  printf("%d\n", nnets);
  int *subNets = getSubNets(visited, problem->numRouters, nnets);
  for (i = nnets - 1; i > 0; i--)
  {
    printf("%d ", subNets[i] + 1);
  }

  printf("%d\n", subNets[0] + 1);
  int *breaksSubnets = malloc((sizeof(int)) * problem->numRouters);
  getBreakSubnets(problem, nnets, breaksSubnets);
  int numRoutersThatBreakSubnet = 0;
  for (i = 0; i < problem->numRouters; i++)
  {
    if (breaksSubnets[i])
    {
      ++numRoutersThatBreakSubnet;
    }
    else
    {
      
    }

  }

  printf("%d\n", numRoutersThatBreakSubnet);
  for (i = 0; i < problem->numRouters; i++)
  {
    visited[i] = (breaksSubnets[i]) ? (-10) : (-1);
  }

  visitDFS(problem, visited);
  int maxInSubnet = countMaxRoutersInSubnet(visited, problem->numRouters);
  printf("%d\n", maxInSubnet);
  for (i = 0; i < problem->numRouters; i++)
  {
    NodeR *adj = problem->routerList[i]->adj;
    while (adj != 0)
    {
      NodeR *temp = adj->next;
      free(adj);
      adj = temp;
    }

    free(problem->routerList[i]);
  }

  free(problem->routerList);
  free(problem);
  free(breaksSubnets);
  free(subNets);
  free(visited);
  return 0;
}

void getBreakSubnets(Problem *problem, int nnets, int breaksSubnets[])
{
  int i;
  int j;
  for (i = 0; i < problem->numRouters; i++)
  {
    breaksSubnets[i] = 0;
  }

  int *visited = malloc((sizeof(int)) * problem->numRouters);
  for (j = 0; j < problem->numRouters; j++)
  {
    for (i = 0; i < problem->numRouters; i++)
    {
      visited[i] = -1;
    }

    visited[j] = -10;
    visitDFS(problem, visited);
    if (getNumSubnets(visited, problem->numRouters) > nnets)
    {
      breaksSubnets[j] = 1;
    }
    else
    {
      
    }

  }

  free(visited);
}

void printVisited(int visited[], int size)
{
  printf("VISITED: ");
  int i;
  for (i = 0; i < size; i++)
  {
    printf("%d ", visited[i]);
  }

  printf("\n");
}

int *getSubNets(int *visited, int size, int nnets)
{
  int array[nnets];
  int i;
  int j;
  int *subNets = malloc((sizeof(int)) * nnets);
  for (i = 0; i < nnets; i++)
  {
    array[i] = -1;
  }

  for (j = 0; j < nnets; j++)
  {
    for (i = size - 1; i >= 0; i--)
    {
      if (contains(array, nnets, visited[i]) == 0)
      {
        subNets[j] = i;
        array[j] = visited[i];
        break;
      }
      else
      {
        
      }

    }

  }

  return subNets;
}

int contains(int array[], int size, int elem)
{
  int i;
  for (i = 0; i < size; i++)
  {
    if (array[i] == elem)
    {
      return 1;
    }
    else
    {
      
    }

  }

  return 0;
}

int getNumSubnets(int *visited, int size)
{
  int max = 0;
  int i;
  for (i = 0; i < size; i++)
  {
    if (max < visited[i])
    {
      max = visited[i];
    }
    else
    {
      
    }

  }

  ++max;
  return max;
}

int countMaxRoutersInSubnet(int *visited, int size)
{
  int maxOcc = 0;
  int i;
  int array[size];
  for (i = 0; i < size; i++)
  {
    array[i] = 0;
  }

  for (i = 0; i < size; i++)
  {
    array[visited[i]]++;
  }

  for (i = 0; i < size; i++)
  {
    if (array[i] > maxOcc)
    {
      maxOcc = array[i];
    }
    else
    {
      
    }

  }

  return maxOcc;
}

int *visitDFS(Problem *problem, int *visited)
{
  int i;
  for (i = 0; (!isAllVisited(visited, problem->numRouters)) && (i < problem->numRouters); i++)
  {
    RouterR *next = problem->routerList[getFirstNotVisited(visited, problem->numRouters)];
    visit(problem->routerList, next, visited, problem->numRouters, i);
  }

  return visited;
}

void visit(RouterR **listaRouters, RouterR *router, int visited[], int size, int cycle)
{
  NodeR *adj = router->adj;
  visited[router->id] = cycle;
  while (adj != 0)
  {
    if (visited[adj->link] == (-1))
    {
      visit(listaRouters, listaRouters[adj->link], visited, size, cycle);
    }
    else
    {
      
    }

    adj = adj->next;
  }

}

int getFirstNotVisited(int visited[], int size)
{
  int i;
  for (i = 0; i < size; i++)
  {
    if (visited[i] == (-1))
    {
      return i;
    }
    else
    {
      
    }

  }

  return -1;
}

int isAllVisited(int visited[], int size)
{
  int isAll = 1;
  int i;
  for (i = 0; i < size; i++)
  {
    if (visited[i] == (-1))
    {
      isAll = 0;
      break;
    }
    else
    {
      
    }

  }

  return isAll;
}

void printProblem(Problem *problem)
{
  printf("Problem\n");
  printf("Num of routers: %d\n", problem->numRouters);
  int i;
  for (i = 0; i < problem->numRouters; i++)
  {
    printf("Router %d links: ", i);
    NodeR *no = problem->routerList[i]->adj;
    while (no != 0)
    {
      printf("%d ", no->link);
      no = no->next;
    }

    printf("\n");
  }

}

