/*File generated by PreProcessor.py*/


#include <stdio.h>
#include "products.h"
#include "misc.h"
#include "orders.h"
#include <string.h>


Product order[500][200] = {0};
int order_counter = 0;
void new_order()
{
  printf("Nova encomenda %d.\n", order_counter);
  order_counter++;
}

int ord_exists(int ide)
{
  if ((ide >= 0) && (ide < order_counter))
  {
    {
      return 1;
    }
  }
  else
  {
    
  }

  return 0;
}

int order_weight(int ide)
{
  int i;
  int weight_counter = 0;
  for (i = 0; i < 200; i++)
  {
    if (strlen(order[ide][i].description) != 0)
    {
      {
        weight_counter += order[ide][i].weight * order[ide][i].quantity;
      }
    }
    else
    {
      
    }

  }

  return weight_counter;
}

void add_to_order()
{
  int ide;
  int idp;
  int quantity;
  int j = 0;
  int i = 0;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  quantity = new_sym_var(sizeof(int) * 8);
  if (!ord_exists(ide))
  {
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
    }
  }
  else
  {
    if (!prod_exists(idp))
    {
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
      }
    }
    else
    {
      if (stock[idp].quantity < quantity)
      {
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
        }
      }
      else
      {
        if ((order_weight(ide) + (stock[idp].weight * quantity)) > 200)
        {
          {
            printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
          }
        }
        else
        {
          {
            stock[idp].quantity -= quantity;
            for (i = 0; i < 200; i++)
            {
              if ((strlen(order[ide][i].description) != 0) && (order[ide][i].id == idp))
              {
                {
                  order[ide][i].quantity += quantity;
                  j++;
                  break;
                }
              }
              else
              {
                
              }

            }

            if (j == 0)
            {
              {
                for (i = 0; i < 200; i++)
                {
                  if (strlen(order[ide][i].description) == 0)
                  {
                    {
                      order[ide][i] = stock[idp];
                      order[ide][i].quantity = quantity;
                      break;
                    }
                  }
                  else
                  {
                    
                  }

                }

              }
            }
            else
            {
              
            }

          }
        }

      }

    }

  }

}

void order_price()
{
  int ide;
  int i = 0;
  int total_price = 0;
  ide = new_sym_var(sizeof(int) * 8);
  if (!ord_exists(ide))
  {
    {
      printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
    }
  }
  else
  {
    {
      for (i = 0; i < 200; i++)
      {
        if (strlen(order[ide][i].description) != 0)
        {
          {
            total_price += stock[order[ide][i].id].price * order[ide][i].quantity;
          }
        }
        else
        {
          
        }

      }

      printf("Custo da encomenda %d %d.\n", ide, total_price);
    }
  }

}

void order_desc_quantity()
{
  int ide;
  int idp;
  int i = 0;
  int quantity = 0;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (!ord_exists(ide))
  {
    {
      printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
    }
  }
  else
  {
    if (!prod_exists(idp))
    {
      {
        printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
      }
    }
    else
    {
      {
        for (i = 0; i < 200; i++)
        {
          if ((strlen(order[ide][i].description) != 0) && (order[ide][i].id == idp))
          {
            {
              quantity = order[ide][i].quantity;
              break;
            }
          }
          else
          {
            
          }

        }

        printf("%s %d.\n", stock[idp].description, quantity);
      }
    }

  }

}

void compare_orders()
{
  int idp;
  int highest_ide;
  int highest_ide_quantity = 0;
  int i;
  int j;
  idp = new_sym_var(sizeof(int) * 8);
  if (!prod_exists(idp))
  {
    {
      printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
    }
  }
  else
  {
    {
      for (i = 0; i < order_counter; i++)
      {
        for (j = 0; j < 200; j++)
        {
          if (((strlen(order[i][j].description) != 0) && (order[i][j].id == idp)) && (order[i][j].quantity > highest_ide_quantity))
          {
            {
              highest_ide_quantity = order[i][j].quantity;
              highest_ide = i;
            }
          }
          else
          {
            
          }

        }

      }

      if (highest_ide_quantity != 0)
      {
        {
          printf("Maximo produto %d %d %d.\n", idp, highest_ide, highest_ide_quantity);
        }
      }
      else
      {
        
      }

    }
  }

}

void sort_orders()
{
  int ide;
  int i;
  int j;
  ide = new_sym_var(sizeof(int) * 8);
  if (!ord_exists(ide))
  {
    {
      printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
    }
  }
  else
  {
    {
      for (j = 0; j < 200; j++)
      {
        if (strlen(order[ide][j].description) == 0)
        {
          {
            break;
          }
        }
        else
        {
          
        }

      }

      alphabet_sort(order[ide], 0, j - 1);
      printf("Encomenda %d\n", ide);
      for (i = 0; i < j; i++)
      {
        printf("* %s %d %d\n", order[ide][i].description, stock[order[ide][i].id].price, order[ide][i].quantity);
      }

    }
  }

}

void remove_from_order()
{
  int ide;
  int idp;
  int j = -1;
  int i = 0;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (!ord_exists(ide))
  {
    {
      printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
    }
  }
  else
  {
    if (!prod_exists(idp))
    {
      {
        printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
      }
    }
    else
    {
      {
        for (i = 0; i < 200; i++)
        {
          if (strlen(order[ide][i].description) != 0)
          {
            {
              if (order[ide][i].id == idp)
              {
                {
                  stock[order[ide][i].id].quantity += order[ide][i].quantity;
                  j = i;
                }
              }
              else
              {
                
              }

            }
          }
          else
          {
            {
              break;
            }
          }

        }

        if ((i > 0) && (j >= 0))
        {
          {
            order[ide][j] = order[ide][i - 1];
            order[ide][i - 1].id = 0;
            order[ide][i - 1].description[0] = '\0';
          }
        }
        else
        {
          
        }

      }
    }

  }

}

