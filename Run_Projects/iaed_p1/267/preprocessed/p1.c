/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>


typedef struct products
{
  char description[64];
  int price;
  int weight;
  int quantity;
  int id;
  int orderQuantity;
} Product;
typedef struct orderInfo
{
  int index;
  int quantity;
} orderInfo;
typedef struct orders
{
  int ide;
  int weight;
  int index;
  int quantity;
  orderInfo products[10000];
} Order;
Product products[10000];
Order orders[500];
char arg1[64];
int arg2;
int arg3;
int arg4;
int productCount = 0;
int orderCount = 0;
void init()
{
  int i;
  int j;
  for (i = 0; i < 10000; i++)
  {
    products[i].price = (products[i].weight = (products[i].quantity = 0));
    products[i].id = -1;
  }

  for (i = 0; i < 500; i++)
  {
    orders[i].ide = -1;
    orders[i].weight = (orders[i].index = (orders[i].quantity = 0));
    for (j = 0; j < 10000; j++)
    {
      orders[i].products[j].index = -1;
      orders[i].products[j].quantity = 0;
    }

  }

}

int searchProduct(int id)
{
  int i;
  for (i = 0; i < 10000; i++)
  {
    if (products[i].id == id)
    {
      return i;
    }
    else
    {
      
    }

  }

  return -1;
}

int searchOrder(int id)
{
  int i;
  for (i = 0; i < 500; i++)
  {
    if (orders[i].ide == id)
    {
      return i;
    }
    else
    {
      
    }

  }

  return -1;
}

void addProduct()
{
  if (productCount < 10000)
  {
    {
      strcpy(products[productCount].description, arg1);
      products[productCount].price = arg2;
      products[productCount].weight = arg3;
      products[productCount].quantity = arg4;
      products[productCount].id = productCount;
      printf("Novo produto %d.\n", productCount);
      productCount++;
    }
  }
  else
  {
    return;
  }

}

void addStock()
{
  int iProduct;
  iProduct = searchProduct(arg2);
  if (iProduct != (-1))
  {
    products[iProduct].quantity += arg3;
  }
  else
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", arg2);
  }

}

int searchProductInOrder(int iOrder, int idp)
{
  int i = 0;
  while (orders[iOrder].products[i].index != (-1))
  {
    if (products[orders[iOrder].products[i].index].id == idp)
    {
      return i;
    }
    else
    {
      
    }

    i++;
  }

  return -1;
}

void addProductToOrder()
{
  int iProduct;
  int iOrder;
  int weight;
  int aux;
  int idp = arg3;
  int ide = arg2;
  int qtd = arg4;
  iProduct = searchProduct(idp);
  iOrder = searchOrder(ide);
  if (iProduct != (-1))
  {
    {
      if (iOrder != (-1))
      {
        {
          if (products[iProduct].quantity >= qtd)
          {
            {
              weight = qtd * products[idp].weight;
              if ((orders[ide].weight + weight) <= 200)
              {
                {
                  aux = searchProductInOrder(iOrder, idp);
                  if (aux != (-1))
                  {
                    {
                      orders[iOrder].products[aux].quantity += qtd;
                    }
                  }
                  else
                  {
                    {
                      orders[iOrder].quantity++;
                      orders[iOrder].products[orders[iOrder].index].index = iProduct;
                      orders[iOrder].products[orders[iOrder].index++].quantity += qtd;
                    }
                  }

                  orders[iOrder].weight += weight;
                  products[iProduct].quantity -= qtd;
                }
              }
              else
              {
                printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
              }

            }
          }
          else
          {
            printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
          }

        }
      }
      else
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
      }

    }
  }
  else
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
  }

}

void removeProductFromOrder()
{
  int ide = arg2;
  int idp = arg3;
  int iProduct = searchProduct(idp);
  int iOrder = searchOrder(ide);
  int aux = 0;
  if (iOrder != (-1))
  {
    {
      if (iProduct != (-1))
      {
        {
          aux = searchProductInOrder(iOrder, idp);
          if (aux != (-1))
          {
            {
              orders[iOrder].weight = orders[iOrder].weight - (orders[iOrder].products[aux].quantity * products[iProduct].weight);
              products[iProduct].quantity += orders[iOrder].products[aux].quantity;
              orders[iOrder].products[aux].quantity = 0;
            }
          }
          else
          {
            
          }

        }
      }
      else
      {
        printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
      }

    }
  }
  else
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }

}

void orderPrice()
{
  int iOrder;
  int total;
  int ide = arg2;
  int i = total = 0;
  iOrder = searchOrder(ide);
  if (iOrder != (-1))
  {
    {
      while (orders[iOrder].products[i].index != (-1))
      {
        total += products[orders[iOrder].products[i].index].price * orders[iOrder].products[i].quantity;
        i++;
      }

      printf("Custo da encomenda %d %d.\n", iOrder, total);
    }
  }
  else
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }

}

void returnInfo()
{
  int iOrder;
  int iProduct;
  int ide = arg2;
  int idp = arg3;
  iOrder = searchOrder(ide);
  iProduct = searchProduct(idp);
  if (iOrder != (-1))
  {
    {
      if (iProduct != (-1))
      {
        {
          iProduct = searchProductInOrder(iOrder, idp);
          if (iProduct != (-1))
          {
            printf("%s %d.\n", products[orders[iOrder].products[iProduct].index].description, orders[iOrder].products[iProduct].quantity);
          }
          else
          {
            printf("%s %d.\n", products[idp].description, 0);
          }

        }
      }
      else
      {
        printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
      }

    }
  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }

}

void createOrder()
{
  if (orderCount < 500)
  {
    {
      orders[orderCount].ide = orderCount;
      printf("Nova encomenda %d.\n", orderCount);
      orderCount++;
    }
  }
  else
  {
    
  }

}

void mostFrequentProduct()
{
  int i = 0;
  int freq;
  int ide;
  int iProduct;
  int j = 0;
  int idp = arg2;
  iProduct = searchProduct(idp);
  freq = 0;
  if (iProduct != (-1))
  {
    {
      while ((orders[i].ide != (-1)) && (i < 500))
      {
        j = 0;
        while ((orders[i].products[j].index != (-1)) && (j < 10000))
        {
          if (products[orders[i].products[j].index].id == idp)
          {
            {
              if (freq < orders[i].products[j].quantity)
              {
                {
                  freq = orders[i].products[j].quantity;
                  ide = i;
                }
              }
              else
              {
                
              }

              break;
            }
          }
          else
          {
            
          }

          j++;
        }

        i++;
      }

      if (freq != 0)
      {
        printf("Maximo produto %d %d %d.\n", idp, ide, freq);
      }
      else
      {
        
      }

    }
  }
  else
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
  }

}

void removeStock()
{
  int iProduct;
  int id = arg2;
  int qtd = arg3;
  iProduct = searchProduct(id);
  if (iProduct == (-1))
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", id);
  }
  else
  {
    {
      if (products[iProduct].quantity < qtd)
      {
        printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, id);
      }
      else
      {
        {
          products[iProduct].quantity -= qtd;
        }
      }

    }
  }

}

void changePrice()
{
  int i = 0;
  int id = arg2;
  int price = arg3;
  while (products[i].id != id)
  {
    if (i < 10000)
    {
      i++;
    }
    else
    {
      {
        printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", id);
        return;
      }
    }

  }

  products[i].price = price;
}

void printArray(int arr[], int n)
{
  int i;
  printf("Produtos\n");
  for (i = 0; i < n; i++)
  {
    if (arr[i] != (-1))
    {
      printf("* %s %d %d\n", products[arr[i]].description, products[arr[i]].price, products[arr[i]].quantity);
    }
    else
    {
      
    }

  }

}

void insertionSortPrice(int arr[], int n)
{
  int i;
  int key;
  int j;
  for (i = 1; i < n; i++)
  {
    if (arr[i] != (-1))
    {
      {
        key = arr[i];
        j = i - 1;
        while ((j >= 0) && (products[arr[j]].price > products[key].price))
        {
          arr[j + 1] = arr[j];
          j = j - 1;
        }

        arr[j + 1] = key;
      }
    }
    else
    {
      
    }

  }

}

void listProducts()
{
  int arr[10000];
  int i = 0;
  int n = (sizeof(arr)) / (sizeof(arr[0]));
  for (i = 0; i < n; i++)
    arr[i] = products[i].id;

  insertionSortPrice(arr, n);
  printArray(arr, n);
}

int searchPrice(char descr[], int iOrder)
{
  int i;
  int price;
  for (i = 0; i < 10000; i++)
  {
    if (!strcmp(descr, products[orders[iOrder].products[i].index].description))
    {
      {
        price = products[orders[iOrder].products[i].index].price;
        return price;
      }
    }
    else
    {
      
    }

  }

  return -1;
}

int searchQuantity(char descr[], int iOrder)
{
  int i;
  int quantity;
  for (i = 0; i < 10000; i++)
  {
    if (!strcmp(descr, products[orders[iOrder].products[i].index].description))
    {
      {
        quantity = orders[iOrder].products[i].quantity;
        return quantity;
      }
    }
    else
    {
      
    }

  }

  return -1;
}

void listProductsFromOrder()
{
  int ii = 0;
  int j = 0;
  int ide = arg2;
  int iOrder;
  int idp;
  Product ev[10000];
  Product eve_aux;
  iOrder = searchOrder(ide);
  if (iOrder == (-1))
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    {
      for (ii = 0; ii < orders[iOrder].quantity; ii++)
      {
        ev[ii] = products[orders[iOrder].products[ii].index];
      }

      for (ii = 1; ii < orders[iOrder].quantity; ii++)
      {
        eve_aux = ev[ii], j = ii - 1;
        while ((j >= 0) && (strcmp(ev[j].description, eve_aux.description) > 0))
        {
          ev[j + 1] = ev[j];
          j--;
        }

        ev[j + 1] = eve_aux;
      }

      printf("Encomenda %d\n", iOrder);
      for (ii = 0; ii < orders[iOrder].quantity; ii++)
      {
        idp = searchProductInOrder(iOrder, ev[ii].id);
        if ((idp != (-1)) && (orders[iOrder].products[idp].quantity > 0))
        {
          {
            printf("* %s %d %d\n", ev[ii].description, ev[ii].price, orders[iOrder].products[idp].quantity);
          }
        }
        else
        {
          
        }

      }

    }
  }

}

int main()
{
  char choice;
  init();
  while (((choice = getchar()) != 'x') && (choice != EOF))
  {
    switch (choice)
    {
      case 'a':
        for (int arg1_index = 0; arg1_index < 10; arg1_index++)
      {
        arg1[arg1_index] = new_sym_var(sizeof(char) * 8);
      }

        arg1[10 - 1] = '\0';
        arg2 = new_sym_var(sizeof(int) * 8);
        arg3 = new_sym_var(sizeof(int) * 8);
        arg4 = new_sym_var(sizeof(int) * 8);
        addProduct();
        break;

      case 'q':
        arg2 = new_sym_var(sizeof(int) * 8);
        arg3 = new_sym_var(sizeof(int) * 8);
        addStock();
        break;

      case 'N':
        createOrder();
        break;

      case 'A':
        arg2 = new_sym_var(sizeof(int) * 8);
        arg3 = new_sym_var(sizeof(int) * 8);
        arg4 = new_sym_var(sizeof(int) * 8);
        addProductToOrder();
        break;

      case 'r':
        arg2 = new_sym_var(sizeof(int) * 8);
        arg3 = new_sym_var(sizeof(int) * 8);
        removeStock();
        break;

      case 'R':
        arg2 = new_sym_var(sizeof(int) * 8);
        arg3 = new_sym_var(sizeof(int) * 8);
        removeProductFromOrder();
        break;

      case 'C':
        arg2 = new_sym_var(sizeof(int) * 8);
        orderPrice();
        break;

      case 'p':
        arg2 = new_sym_var(sizeof(int) * 8);
        arg3 = new_sym_var(sizeof(int) * 8);
        changePrice();
        break;

      case 'E':
        arg2 = new_sym_var(sizeof(int) * 8);
        arg3 = new_sym_var(sizeof(int) * 8);
        returnInfo();
        break;

      case 'm':
        arg2 = new_sym_var(sizeof(int) * 8);
        mostFrequentProduct();
        break;

      case 'l':
        listProducts();
        break;

      case 'L':
        arg2 = new_sym_var(sizeof(int) * 8);
        listProductsFromOrder();
        break;

    }

  }

  return 0;
}

