/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


typedef struct produto
{
  int idp;
  int preco;
  int peso;
  int qtd;
  char descricao[64];
} produto;
typedef struct produto_em_encomenda
{
  int idp;
  int qtd;
} produto_em_e;
typedef struct encomenda
{
  int ide;
  int peso_e;
  int n_produtos;
  produto_em_e prods[200];
} encomenda;
produto lista_prod[10000];
encomenda lista_e[500];
void criaProduto(int idp);
void adicionaStock(int idp);
void novaEncomenda(int ide);
void adicionapEncomenda(int idp, int ide);
void removeStock(int idp);
void removeProdEncomenda(int idp, int ide);
void custoEncomenda(int ide);
void alteraPreco(int idp);
void descQtdProdInEncomenda(int idp, int ide);
void encomendaMaisOcorr(int idp, int ide);
int indiceProdEmEncomenda(int idp_dado, int ide_dado);
void reOrdVetorProds(int ide_dado, int indice);
void listaProdutospPreco(int idp);
void listaPEncomendaAlfabet(int ide);
void quicksort(produto a[], int l, int r, char sort_metodo);
int partition(produto a[], int l, int r, char sort_metodo);
void troca(produto a[], int i, int j);
int menor(produto x, produto y, char sort_metodo);
int main()
{
  int terminar = 0;
  int idp = -1;
  int ide = -1;
  char c;
  while (terminar != 1)
  {
    switch (c = getchar())
    {
      case 'a':
        criaProduto(++idp);
        break;

      case 'q':
        adicionaStock(idp);
        break;

      case 'N':
        novaEncomenda(++ide);
        break;

      case 'A':
        adicionapEncomenda(idp, ide);
        break;

      case 'r':
        removeStock(idp);
        break;

      case 'R':
        removeProdEncomenda(idp, ide);
        break;

      case 'C':
        custoEncomenda(ide);
        break;

      case 'p':
        alteraPreco(idp);
        break;

      case 'E':
        descQtdProdInEncomenda(idp, ide);
        break;

      case 'm':
        encomendaMaisOcorr(idp, ide);
        break;

      case 'l':
        listaProdutospPreco(idp);
        break;

      case 'L':
        listaPEncomendaAlfabet(ide);
        break;

      case 'x':
        terminar = 1;
        break;

    }

  }

  return 0;
}

void criaProduto(int idp)
{
  produto p;
  for (int p_index = 0; p_index < 10; p_index++)
  {
    p.descricao[p_index] = new_sym_var(sizeof(char) * 8);
  }

  p.descricao[10 - 1] = '\0';
  p.preco = new_sym_var(sizeof(int) * 8);
  p.peso = new_sym_var(sizeof(int) * 8);
  p.qtd = new_sym_var(sizeof(int) * 8);
  p.idp = idp;
  lista_prod[idp] = p;
  printf("Novo produto %d.\n", p.idp);
}

void adicionaStock(int idp)
{
  int idp_dado;
  int qtd_add;
  idp_dado = new_sym_var(sizeof(int) * 8);
  qtd_add = new_sym_var(sizeof(int) * 8);
  if (idp_dado <= idp)
  {
    lista_prod[idp_dado].qtd += qtd_add;
  }
  else
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp_dado);
  }

}

void novaEncomenda(int ide)
{
  encomenda e = {0};
  e.ide = ide;
  lista_e[ide] = e;
  printf("Nova encomenda %d.\n", e.ide);
}

void adicionapEncomenda(int idp, int ide)
{
  int idp_dado;
  int ide_dado;
  int qtd_add;
  int indice;
  ide_dado = new_sym_var(sizeof(int) * 8);
  idp_dado = new_sym_var(sizeof(int) * 8);
  qtd_add = new_sym_var(sizeof(int) * 8);
  if (ide_dado <= ide)
  {
    {
      if (idp_dado <= idp)
      {
        {
          if (lista_prod[idp_dado].qtd >= qtd_add)
          {
            {
              if (lista_e[ide_dado].peso_e <= (200 - (lista_prod[idp_dado].peso * qtd_add)))
              {
                {
                  lista_e[ide_dado].peso_e += lista_prod[idp_dado].peso * qtd_add;
                  indice = indiceProdEmEncomenda(idp_dado, ide_dado);
                  if (indice == lista_e[ide_dado].n_produtos)
                  {
                    {
                      lista_e[ide_dado].n_produtos += 1;
                      lista_e[ide_dado].prods[indice].idp = idp_dado;
                    }
                  }
                  else
                  {
                    
                  }

                  lista_e[ide_dado].prods[indice].qtd += qtd_add;
                  lista_prod[idp_dado].qtd -= qtd_add;
                }
              }
              else
              {
                printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp_dado, ide_dado);
              }

            }
          }
          else
          {
            printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp_dado, ide_dado);
          }

        }
      }
      else
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp_dado, ide_dado);
      }

    }
  }
  else
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp_dado, ide_dado);
  }

}

void removeStock(int idp)
{
  int idp_dado;
  int qtd_rem;
  idp_dado = new_sym_var(sizeof(int) * 8);
  qtd_rem = new_sym_var(sizeof(int) * 8);
  if (idp_dado <= idp)
  {
    {
      if (qtd_rem <= lista_prod[idp_dado].qtd)
      {
        lista_prod[idp_dado].qtd -= qtd_rem;
      }
      else
      {
        printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd_rem, idp_dado);
      }

    }
  }
  else
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp_dado);
  }

}

void removeProdEncomenda(int idp, int ide)
{
  int indice;
  int idp_dado;
  int ide_dado;
  ide_dado = new_sym_var(sizeof(int) * 8);
  idp_dado = new_sym_var(sizeof(int) * 8);
  if (ide_dado <= ide)
  {
    {
      if (idp_dado <= idp)
      {
        {
          indice = indiceProdEmEncomenda(idp_dado, ide_dado);
          if (indice == lista_e[ide_dado].n_produtos)
          {
            return;
          }
          else
          {
            
          }

          lista_prod[idp_dado].qtd += lista_e[ide_dado].prods[indice].qtd;
          lista_e[ide_dado].peso_e -= lista_prod[idp_dado].peso * lista_e[ide_dado].prods[indice].qtd;
          reOrdVetorProds(ide_dado, indice);
          lista_e[ide_dado].n_produtos -= 1;
        }
      }
      else
      {
        printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp_dado, ide_dado);
      }

    }
  }
  else
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp_dado, ide_dado);
  }

}

void custoEncomenda(int ide)
{
  int i;
  int ide_dado;
  int custo = 0;
  int idp_a_consultar;
  ide_dado = new_sym_var(sizeof(int) * 8);
  if (ide_dado <= ide)
  {
    {
      for (i = 0; i < lista_e[ide_dado].n_produtos; i++)
      {
        idp_a_consultar = lista_e[ide_dado].prods[i].idp;
        custo += lista_e[ide_dado].prods[i].qtd * lista_prod[idp_a_consultar].preco;
      }

      printf("Custo da encomenda %d %d.\n", ide_dado, custo);
    }
  }
  else
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide_dado);
  }

}

void alteraPreco(int idp)
{
  int idp_dado;
  int novo_preco;
  idp_dado = new_sym_var(sizeof(int) * 8);
  novo_preco = new_sym_var(sizeof(int) * 8);
  if (idp_dado <= idp)
  {
    lista_prod[idp_dado].preco = novo_preco;
  }
  else
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp_dado);
  }

}

void descQtdProdInEncomenda(int idp, int ide)
{
  int idp_dado;
  int ide_dado;
  int indice;
  ide_dado = new_sym_var(sizeof(int) * 8);
  idp_dado = new_sym_var(sizeof(int) * 8);
  if (ide_dado <= ide)
  {
    {
      if (idp_dado <= idp)
      {
        {
          indice = indiceProdEmEncomenda(idp_dado, ide_dado);
          printf("%s %d.\n", lista_prod[idp_dado].descricao, lista_e[ide_dado].prods[indice].qtd);
        }
      }
      else
      {
        printf("Impossivel listar produto %d. Produto inexistente.\n", idp_dado);
      }

    }
  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide_dado);
  }

}

void encomendaMaisOcorr(int idp, int ide)
{
  int i;
  int indice;
  int idp_dado;
  int e_max_occ;
  int max_occ = 0;
  idp_dado = new_sym_var(sizeof(int) * 8);
  if (idp_dado <= idp)
  {
    {
      for (i = 0; i <= ide; i++)
      {
        indice = indiceProdEmEncomenda(idp_dado, i);
        if ((indice != lista_e[i].n_produtos) && (lista_e[i].prods[indice].qtd > max_occ))
        {
          {
            e_max_occ = i;
            max_occ = lista_e[i].prods[indice].qtd;
          }
        }
        else
        {
          
        }

      }

      if (max_occ != 0)
      {
        printf("Maximo produto %d %d %d.\n", idp_dado, e_max_occ, max_occ);
      }
      else
      {
        
      }

    }
  }
  else
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp_dado);
  }

}

void listaProdutospPreco(int idp)
{
  int i;
  produto prods_ordenar[10000] = {0};
  for (i = 0; i <= idp; i++)
    prods_ordenar[i] = lista_prod[i];

  quicksort(prods_ordenar, 0, idp, 'p');
  printf("Produtos\n");
  for (i = 0; i <= idp; i++)
    printf("* %s %d %d\n", prods_ordenar[i].descricao, prods_ordenar[i].preco, prods_ordenar[i].qtd);

}

void listaPEncomendaAlfabet(int ide)
{
  int i;
  int ide_dado;
  int idp_a_consultar;
  produto prods_ordenar[200] = {0};
  ide_dado = new_sym_var(sizeof(int) * 8);
  if (ide_dado <= ide)
  {
    {
      for (i = 0; i < lista_e[ide_dado].n_produtos; i++)
      {
        idp_a_consultar = lista_e[ide_dado].prods[i].idp;
        prods_ordenar[i] = lista_prod[idp_a_consultar];
        prods_ordenar[i].qtd = lista_e[ide_dado].prods[i].qtd;
      }

      quicksort(prods_ordenar, 0, lista_e[ide_dado].n_produtos - 1, 'a');
      printf("Encomenda %d\n", ide_dado);
      for (i = 0; i < lista_e[ide_dado].n_produtos; i++)
        printf("* %s %d %d\n", prods_ordenar[i].descricao, prods_ordenar[i].preco, prods_ordenar[i].qtd);

    }
  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide_dado);
  }

}

int indiceProdEmEncomenda(int idp_dado, int ide_dado)
{
  int i;
  for (i = 0; i < lista_e[ide_dado].n_produtos; i++)
  {
    if (lista_e[ide_dado].prods[i].idp == idp_dado)
    {
      return i;
    }
    else
    {
      
    }

  }

  return i;
}

void reOrdVetorProds(int ide_dado, int indice)
{
  int i;
  for (i = indice; i < lista_e[ide_dado].n_produtos; i++)
    lista_e[ide_dado].prods[i] = lista_e[ide_dado].prods[i + 1];

}

void quicksort(produto a[], int min, int max, char sort_metodo)
{
  int i;
  if (max <= min)
  {
    return;
  }
  else
  {
    
  }

  i = partition(a, min, max, sort_metodo);
  quicksort(a, min, i - 1, sort_metodo);
  quicksort(a, i + 1, max, sort_metodo);
}

int partition(produto a[], int min, int max, char sort_metodo)
{
  int i = min - 1;
  int j = max;
  produto v = a[max];
  while (i < j)
  {
    while (menor(a[++i], v, sort_metodo))
      ;

    while (menor(v, a[--j], sort_metodo))
    {
      if (j == min)
      {
        break;
      }
      else
      {
        
      }

    }

    if (i < j)
    {
      troca(a, i, j);
    }
    else
    {
      
    }

  }

  troca(a, i, max);
  return i;
}

void troca(produto a[], int i, int j)
{
  produto p = a[i];
  a[i] = a[j];
  a[j] = p;
}

int menor(produto x, produto y, char sort_metodo)
{
  int res;
  if (sort_metodo == 'p')
  {
    res = x.preco - y.preco;
  }
  else
  {
    res = strcmp(x.descricao, y.descricao);
  }

  if (res == 0)
  {
    return x.idp < y.idp;
  }
  else
  {
    
  }

  return res < 0;
}

