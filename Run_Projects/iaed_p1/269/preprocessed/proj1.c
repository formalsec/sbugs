/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include "proj1.h"


int main(void)
{
  PRODUTO produtos[10000];
  ENCOMENDA encomendas[500];
  char descricao[63];
  int numero_produtos = 0;
  int peso;
  int preco;
  int qtd;
  int idp = 0;
  int ide = 0;
  char comando;
  int flag = 0;
  int i;
  int j;
  int numero_encomendas = 0;
  for (i = 0; i < 10000; i++)
    produtos[i].idp = -1;

  for (i = 0; i < 500; i++)
    encomendas[i].ide = -1;

  while (1)
  {
    comando = getchar();
    switch (comando)
    {
      case 'a':
        getchar();
        for (int descricao_index = 0; descricao_index < 10; descricao_index++)
      {
        descricao[descricao_index] = new_sym_var(sizeof(char) * 8);
      }

        descricao[10 - 1] = '\0';
        preco = new_sym_var(sizeof(int) * 8);
        peso = new_sym_var(sizeof(int) * 8);
        qtd = new_sym_var(sizeof(int) * 8);
        produtos[numero_produtos] = add_produto(descricao, preco, peso, qtd, numero_produtos);
        numero_produtos++;
        break;

      case 'q':
        getchar();
        idp = new_sym_var(sizeof(int) * 8);
        qtd = new_sym_var(sizeof(int) * 8);
        if (produtos[idp].idp == (-1))
      {
        printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
      }
      else
      {
        produtos[idp] = add_stock(produtos[idp], qtd);
      }

        break;

      case 'N':
        getchar();
        encomendas[numero_encomendas] = create_encomenda(numero_encomendas);
        numero_encomendas++;
        break;

      case 'A':
        getchar();
        ide = new_sym_var(sizeof(int) * 8);
        idp = new_sym_var(sizeof(int) * 8);
        qtd = new_sym_var(sizeof(int) * 8);
        if ((produtos[idp].idp == (-1)) || (encomendas[ide].ide == (-1)))
      {
        {
          if (encomendas[ide].ide == (-1))
          {
            printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
          }
          else
          {
            printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
          }

          flag = 1;
        }
      }
      else
      {
        encomendas[ide] = add_encomenda(encomendas[ide], qtd, produtos[idp], &flag, &j);
      }

        if (flag == 0)
      {
        produtos[idp] = remove_stock(produtos[idp], qtd);
      }
      else
      {
        
      }

        flag = 0;
        break;

      case 'r':
        getchar();
        idp = new_sym_var(sizeof(int) * 8);
        qtd = new_sym_var(sizeof(int) * 8);
        if (produtos[idp].idp == (-1))
      {
        printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
      }
      else
      {
        produtos[idp] = remove_stock(produtos[idp], qtd);
      }

        break;

      case 'R':
        getchar();
        ide = new_sym_var(sizeof(int) * 8);
        idp = new_sym_var(sizeof(int) * 8);
        if ((produtos[idp].idp == (-1)) || (encomendas[ide].ide == (-1)))
      {
        {
          if (encomendas[ide].ide == (-1))
          {
            printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
          }
          else
          {
            printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
          }

          flag = 1;
        }
      }
      else
      {
        encomendas[ide] = retira_produto(encomendas[ide], produtos[idp], &flag, &qtd);
      }

        if (flag == 0)
      {
        produtos[idp] = add_stock(produtos[idp], qtd);
      }
      else
      {
        
      }

        flag = 0;
        break;

      case 'C':
        getchar();
        ide = new_sym_var(sizeof(int) * 8);
        if (encomendas[ide].ide == (-1))
      {
        printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
      }
      else
      {
        calcula_custo(encomendas[ide], produtos);
      }

        break;

      case 'p':
        getchar();
        idp = new_sym_var(sizeof(int) * 8);
        preco = new_sym_var(sizeof(int) * 8);
        if (produtos[idp].idp == (-1))
      {
        printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
      }
      else
      {
        produtos[idp] = altera_preco(produtos[idp], preco);
      }

        break;

      case 'E':
        getchar();
        ide = new_sym_var(sizeof(int) * 8);
        idp = new_sym_var(sizeof(int) * 8);
        if ((produtos[idp].idp == (-1)) || (encomendas[ide].ide == (-1)))
      {
        {
          if (encomendas[ide].ide == (-1))
          {
            printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
          }
          else
          {
            printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
          }

        }
      }
      else
      {
        {
          for (j = 0; (j < 200) || (encomendas[ide].produto[j] != idp); j++)
            ;

          if (encomendas[ide].produto[j] == idp)
          {
            listar_encomenda(encomendas[ide], j, produtos);
          }
          else
          {
            
          }

        }
      }

        break;

      case 'm':
        getchar();
        idp = new_sym_var(sizeof(int) * 8);
        if (produtos[idp].idp == (-1))
      {
        printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
      }
      else
      {
        encomenda_maior_produto(encomendas, idp);
      }

        break;

      case 'x':
        return 0;
        break;

    }

  }

  return 0;
}

PRODUTO add_produto(char descricao[63], int preco, int peso, int qtd, int numero_produto)
{
  PRODUTO item;
  strcpy(item.descricao, descricao);
  item.preco = preco;
  item.peso = peso;
  item.qtd = qtd;
  item.idp = numero_produto;
  printf("Novo produto %d.\n", numero_produto);
  return item;
}

PRODUTO add_stock(PRODUTO item, int stock)
{
  item.qtd = item.qtd + stock;
  return item;
}

ENCOMENDA create_encomenda(int numero_encomenda)
{
  ENCOMENDA encomenda;
  int i;
  encomenda.ide = numero_encomenda;
  encomenda.peso = 0;
  for (i = 0; i < 200; i++)
  {
    encomenda.qtd[i] = 0;
    encomenda.produto[i] = -1;
  }

  printf("Nova encomenda %d.\n", encomenda.ide);
  return encomenda;
}

ENCOMENDA add_encomenda(ENCOMENDA encomenda, int qtd, PRODUTO produto, int *flag, int *i)
{
  if (produto.qtd < qtd)
  {
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", produto.idp, encomenda.ide);
      *flag = 1;
    }
  }
  else
  {
    if ((encomenda.peso + (produto.peso * qtd)) > 200)
    {
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", produto.idp, encomenda.ide);
        *flag = 1;
      }
    }
    else
    {
      {
        for (*i = 0; (*i) < 200; *i += 1)
        {
          if ((encomenda.produto[*i] == (-1)) || (encomenda.produto[*i] == produto.idp))
          {
            {
              encomenda.produto[*i] = produto.idp;
              encomenda.qtd[*i] += qtd;
              encomenda.peso += qtd * produto.peso;
              break;
            }
          }
          else
          {
            
          }

        }

      }
    }

  }

  return encomenda;
}

PRODUTO remove_stock(PRODUTO item, int stock)
{
  if (item.qtd < stock)
  {
    printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", stock, item.idp);
  }
  else
  {
    item.qtd -= stock;
  }

  return item;
}

ENCOMENDA retira_produto(ENCOMENDA encomenda, PRODUTO produto, int *flag, int *qtd)
{
  int i;
  for (i = 0; i < 200; i++)
    if (encomenda.produto[i] == produto.idp)
  {
    {
      encomenda.produto[i] = -1;
      encomenda.peso -= encomenda.qtd[i] * produto.peso;
      *qtd = encomenda.qtd[i];
      encomenda.qtd[i] = 0;
      return encomenda;
    }
  }
  else
  {
    
  }


  *flag = 1;
  return encomenda;
}

void calcula_custo(ENCOMENDA encomenda, PRODUTO produtos[10000])
{
  int preco = 0;
  int i;
  for (i = 0; i < 200; i++)
  {
    preco = preco + (encomenda.qtd[i] * produtos[encomenda.produto[i]].preco);
  }

  printf("Custo da encomenda %d %d.\n", encomenda.ide, preco);
  return;
}

PRODUTO altera_preco(PRODUTO item, int novo_preco)
{
  item.preco = novo_preco;
  return item;
}

void listar_encomenda(ENCOMENDA encomenda, int idp, PRODUTO produtos[10000])
{
  printf("%s %d.\n", produtos[encomenda.produto[idp]].descricao, encomenda.qtd[idp]);
  return;
}

void encomenda_maior_produto(ENCOMENDA encomendas[500], int idp)
{
  int i;
  int j;
  int ide;
  int qtd = 0;
  for (i = 0; i < 500; i++)
  {
    for (j = 0; j < 200; j++)
    {
      if (encomendas[i].produto[j] == idp)
      {
        {
          if (encomendas[i].qtd[j] > qtd)
          {
            {
              qtd = encomendas[i].qtd[j];
              ide = i;
            }
          }
          else
          {
            
          }

          break;
        }
      }
      else
      {
        
      }

    }

  }

  printf("Maximo produto %d %d %d.\n", idp, ide, qtd);
  return;
}

