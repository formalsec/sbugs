/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


typedef int Item;
typedef struct 
{
  int idproduto;
  char desc[63];
  int preco;
  int peso;
  int quantidade;
} produto;
typedef struct 
{
  int idproduto;
  int preco;
} copia;
produto sistema[10000];
produto encomendas[500][10000];
int indice[500];
int enccounter;
int sistcounter;
copia aux[10000];
copia sistema_sort[10000];
void le_linha_caracteres(char v[], int max);
int le_linhas_numeros();
void adiciona_produto();
void adiciona_stock();
void cria_nova_encomenda();
int peso_encomenda(int num_encomenda);
void indice_inicio();
int verifica_encomenda(produto v[], int idp, int ide);
void adiciona_produto_encomenda();
void remove_stock();
void remove_produto();
void calcula_custo();
void altera_preco();
void lista_desc_quantidade();
void indentificador_encomenda();
void merge(copia a[], int l, int m, int r);
void mergesort(copia a[], int l, int r);
void insertionSort(copia v[], int n);
void lista_produtos();
void lista_produtos_encomenda();
int main()
{
  int cmd;
  indice_inicio();
  while ((cmd = getchar()) != 'x')
  {
    switch (cmd)
    {
      case 'a':
        adiciona_produto();
        break;

      case 'q':
        adiciona_stock();
        break;

      case 'N':
        cria_nova_encomenda();
        break;

      case 'A':
        adiciona_produto_encomenda();
        break;

      case 'r':
        remove_stock();
        break;

      case 'R':
        remove_produto();
        break;

      case 'C':
        calcula_custo();
        break;

      case 'p':
        altera_preco();
        break;

      case 'E':
        lista_desc_quantidade();
        break;

      case 'm':
        indentificador_encomenda();
        break;

      case 'l':
        lista_produtos();
        break;

      case 'L':
        lista_produtos_encomenda();
        break;

    }

  }

  return 0;
}

void le_linha_caracteres(char v[], int max)
{
  char c;
  int i = 0;
  while (((((c = getchar()) != '\n') && (c != EOF)) && (i < (max - 1))) && (c != ':'))
  {
    if (c == ' ')
    {
      continue;
    }
    else
    {
      v[i] = c;
    }

    i++;
  }

  v[i] = '\0';
}

int le_linhas_numeros()
{
  char c;
  int res = 0;
  while ((((c = getchar()) != '\n') && (c != EOF)) && (c != ':'))
    if (c == ' ')
  {
    continue;
  }
  else
  {
    res = (res * 10) + (c - '0');
  }


  return res;
}

void adiciona_produto()
{
  le_linha_caracteres(sistema[sistcounter].desc, 63);
  sistema[sistcounter].preco = le_linhas_numeros();
  sistema[sistcounter].peso = le_linhas_numeros();
  sistema[sistcounter].quantidade = le_linhas_numeros();
  printf("Novo produto %d.\n", sistcounter);
  sistcounter++;
}

void adiciona_stock()
{
  int idp;
  int qtd;
  idp = le_linhas_numeros();
  if (idp < sistcounter)
  {
    {
      qtd = le_linhas_numeros();
      sistema[idp].quantidade = sistema[idp].quantidade + qtd;
    }
  }
  else
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
  }

}

void cria_nova_encomenda()
{
  printf("Nova encomenda %d.\n", enccounter);
  enccounter++;
}

int peso_encomenda(int num_encomenda)
{
  int i;
  int res = 0;
  for (i = 0; i < indice[num_encomenda]; i++)
  {
    res = res + (encomendas[num_encomenda][i].peso * encomendas[num_encomenda][i].quantidade);
  }

  return res;
}

void indice_inicio()
{
  int i = 0;
  for (i = 0; i < 500; i++)
    indice[i] = 0;

}

int verifica_encomenda(produto v[], int idp, int ide)
{
  int i;
  for (i = 0; i < indice[ide]; i++)
  {
    if (((v[i].idproduto == idp) && (v[i].peso == sistema[idp].peso)) && (v[i].preco == sistema[idp].preco))
    {
      break;
    }
    else
    {
      
    }

  }

  return i;
}

void adiciona_produto_encomenda()
{
  int ide;
  int idp;
  int qtd;
  int i1;
  int peso;
  ide = le_linhas_numeros();
  idp = le_linhas_numeros();
  qtd = le_linhas_numeros();
  if (ide < enccounter)
  {
    {
      if (idp < sistcounter)
      {
        {
          if (qtd <= sistema[idp].quantidade)
          {
            {
              peso = peso_encomenda(ide);
              if ((peso + (qtd * sistema[idp].peso)) <= 200)
              {
                {
                  i1 = verifica_encomenda(encomendas[ide], idp, ide);
                  if (indice[ide] == i1)
                  {
                    {
                      encomendas[ide][indice[ide]].quantidade = qtd;
                      encomendas[ide][indice[ide]].idproduto = idp;
                      encomendas[ide][indice[ide]].peso = sistema[idp].peso;
                      encomendas[ide][indice[ide]].preco = sistema[idp].preco;
                      strcpy(encomendas[ide][indice[ide]].desc, sistema[idp].desc);
                      indice[ide]++;
                    }
                  }
                  else
                  {
                    encomendas[ide][i1].quantidade = encomendas[ide][i1].quantidade + qtd;
                  }

                  sistema[idp].quantidade = sistema[idp].quantidade - qtd;
                }
              }
              else
              {
                printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
              }

            }
          }
          else
          {
            printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
          }

        }
      }
      else
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
      }

    }
  }
  else
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }

}

void remove_stock()
{
  int idp;
  int qtd;
  idp = le_linhas_numeros();
  qtd = le_linhas_numeros();
  if (idp < sistcounter)
  {
    {
      if ((sistema[idp].quantidade - qtd) >= 0)
      {
        sistema[idp].quantidade = sistema[idp].quantidade - qtd;
      }
      else
      {
        printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, idp);
      }

    }
  }
  else
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
  }

}

void remove_produto()
{
  int ide;
  int idp;
  int i;
  ide = le_linhas_numeros();
  idp = le_linhas_numeros();
  if (ide < enccounter)
  {
    {
      if (idp < sistcounter)
      {
        {
          i = verifica_encomenda(encomendas[ide], idp, ide);
          if ((i >= 0) && (i < indice[ide]))
          {
            {
              indice[ide]--;
              if (i != indice[ide])
              {
                {
                  sistema[idp].quantidade = sistema[idp].quantidade + encomendas[ide][i].quantidade;
                  encomendas[ide][i].idproduto = encomendas[ide][indice[ide]].idproduto;
                  strcpy(encomendas[ide][i].desc, encomendas[ide][indice[ide]].desc);
                  encomendas[ide][i].preco = encomendas[ide][indice[ide]].preco;
                  encomendas[ide][i].peso = encomendas[ide][indice[ide]].peso;
                  encomendas[ide][i].quantidade = encomendas[ide][indice[ide]].quantidade;
                }
              }
              else
              {
                if (i == indice[ide])
                {
                  sistema[idp].quantidade = sistema[idp].quantidade + encomendas[ide][i].quantidade;
                }
                else
                {
                  
                }

              }

            }
          }
          else
          {
            
          }

        }
      }
      else
      {
        printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
      }

    }
  }
  else
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }

}

void calcula_custo()
{
  int ide;
  int total = 0;
  int i;
  ide = le_linhas_numeros();
  if (ide < enccounter)
  {
    {
      for (i = 0; i < indice[ide]; i++)
      {
        total = total + (encomendas[ide][i].preco * encomendas[ide][i].quantidade);
      }

      printf("Custo da encomenda %d %d.\n", ide, total);
    }
  }
  else
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }

}

void altera_preco()
{
  int idp;
  int preco;
  int i;
  int j;
  idp = le_linhas_numeros();
  preco = le_linhas_numeros();
  if (idp < sistcounter)
  {
    {
      sistema[idp].preco = preco;
      for (i = 0; i < enccounter; i++)
      {
        for (j = 0; j < indice[i]; j++)
          if (encomendas[i][j].idproduto == idp)
        {
          encomendas[i][j].preco = preco;
        }
        else
        {
          
        }


      }

    }
  }
  else
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
  }

}

void lista_desc_quantidade()
{
  int ide;
  int idp;
  int i;
  ide = le_linhas_numeros();
  idp = le_linhas_numeros();
  if (ide < enccounter)
  {
    {
      if (idp < sistcounter)
      {
        {
          i = verifica_encomenda(encomendas[ide], idp, ide);
          if ((i >= 0) && (i < indice[ide]))
          {
            printf("%s %d.\n", encomendas[ide][i].desc, encomendas[ide][i].quantidade);
          }
          else
          {
            printf("%s 0.\n", sistema[idp].desc);
          }

        }
      }
      else
      {
        printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
      }

    }
  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }

}

void indentificador_encomenda()
{
  int idp;
  int ide;
  int i;
  int j;
  int max = -1;
  int counter = 0;
  idp = le_linhas_numeros();
  if (idp < sistcounter)
  {
    {
      for (i = 0; i < enccounter; i++)
      {
        for (j = 0; j < indice[i]; j++)
        {
          if ((encomendas[i][j].idproduto == idp) && (encomendas[i][j].quantidade > max))
          {
            {
              max = encomendas[i][j].quantidade;
              ide = i;
              counter++;
            }
          }
          else
          {
            
          }

        }

      }

      if (counter > 0)
      {
        printf("Maximo produto %d %d %d.\n", idp, ide, max);
      }
      else
      {
        
      }

    }
  }
  else
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
  }

}

void merge(copia a[], int l, int m, int r)
{
  int i;
  int j;
  int k;
  for (i = m + 1; i > l; i--)
  {
    aux[i - 1].preco = a[i - 1].preco;
    aux[i - 1].idproduto = a[i - 1].idproduto;
  }

  for (j = m; j < r; j++)
  {
    aux[(r + m) - j].preco = a[j + 1].preco;
    aux[(r + m) - j].idproduto = a[j + 1].idproduto;
  }

  for (k = l; k <= r; k++)
  {
    if ((aux[j].preco < aux[i].preco) || (i > m))
    {
      {
        a[k].preco = aux[j].preco;
        a[k].idproduto = aux[j].idproduto;
        j--;
      }
    }
    else
    {
      if (aux[j].preco >= aux[i].preco)
      {
        {
          a[k].preco = aux[i].preco;
          a[k].idproduto = aux[i].idproduto;
          i++;
        }
      }
      else
      {
        
      }

    }

  }

}

void mergesort(copia a[], int l, int r)
{
  int m = (r + l) / 2;
  if (r <= l)
  {
    return;
  }
  else
  {
    
  }

  mergesort(a, l, m);
  mergesort(a, m + 1, r);
  merge(a, l, m, r);
}

void lista_produtos()
{
  int i;
  for (i = 0; i < sistcounter; i++)
  {
    sistema_sort[i].idproduto = i;
    sistema_sort[i].preco = sistema[i].preco;
  }

  mergesort(sistema_sort, 0, sistcounter - 1);
  printf("Produtos\n");
  for (i = 0; i < sistcounter; i++)
  {
    printf("* %s %d %d\n", sistema[sistema_sort[i].idproduto].desc, sistema[sistema_sort[i].idproduto].preco, sistema[sistema_sort[i].idproduto].quantidade);
  }

}

void lista_produtos_encomenda()
{
  int ide;
  int i;
  int j;
  int x;
  int menor;
  char descricao[10000][63];
  char aux[10000];
  ide = le_linhas_numeros();
  if (ide < enccounter)
  {
    {
      for (i = 0; i < indice[ide]; i++)
      {
        strcpy(descricao[i], encomendas[ide][i].desc);
      }

      printf("Encomenda %d\n", ide);
      for (i = 0; i < (indice[ide] - 1); i++)
      {
        x = 0;
        menor = i;
        for (j = i + 1; j < indice[ide]; j++)
        {
          x = 0;
          while (descricao[menor][x] == descricao[j][x])
          {
            x++;
          }

          if (descricao[menor][x] > descricao[j][x])
          {
            {
              menor = j;
            }
          }
          else
          {
            
          }

        }

        if (menor != i)
        {
          {
            strcpy(aux, descricao[menor]);
            strcpy(descricao[menor], descricao[i]);
            strcpy(descricao[i], aux);
          }
        }
        else
        {
          
        }

      }

      for (i = 0; i < indice[ide]; i++)
      {
        for (j = 0; j < indice[ide]; j++)
        {
          if (strcmp(descricao[i], encomendas[ide][j].desc) == 0)
          {
            printf("* %s %d %d\n", encomendas[ide][j].desc, encomendas[ide][j].preco, encomendas[ide][j].quantidade);
          }
          else
          {
            
          }

        }

      }

    }
  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }

}

