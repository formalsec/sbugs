/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>


typedef struct produto
{
  int id;
  int preco;
  int peso;
  int quantidade;
  char descricao[64];
} produto;
produto produtos[10000];
int nr_produtos;
typedef struct produto_enc
{
  int id;
  char descricao[64];
} produto_enc;
typedef struct encomenda
{
  int nr_produtos;
  int peso;
  produto_enc produtos[200];
  int quantidades[10000];
} encomenda;
encomenda encomendas[500];
int nr_encomendas;
int indice_produto_encomenda(int ide, int idp)
{
  int i;
  int indice = -1;
  for (i = 0; i < encomendas[ide].nr_produtos; i++)
    if (idp == encomendas[ide].produtos[i].id)
  {
    indice = i;
  }
  else
  {
    
  }


  return indice;
}

void a(char descricao[64], int preco, int peso, int quantidade)
{
  strcpy(produtos[nr_produtos].descricao, descricao);
  produtos[nr_produtos].preco = preco;
  produtos[nr_produtos].peso = peso;
  produtos[nr_produtos].quantidade = quantidade;
  produtos[nr_produtos].id = nr_produtos;
  printf("Novo produto %d.\n", nr_produtos);
  nr_produtos++;
}

void q(int idp, int quantidade)
{
  if (nr_produtos > idp)
  {
    produtos[idp].quantidade += quantidade;
  }
  else
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
  }

}

void N()
{
  printf("Nova encomenda %d.\n", nr_encomendas);
  nr_encomendas++;
}

void A(int ide, int idp, int quantidade)
{
  int indice;
  int novo_indice = -1;
  int i;
  produto_enc p;
  produto_enc p2;
  char descricao[64];
  if (nr_encomendas > ide)
  {
    {
      if (nr_produtos > idp)
      {
        {
          if (produtos[idp].quantidade >= quantidade)
          {
            {
              if (200 >= ((quantidade * produtos[idp].peso) + encomendas[ide].peso))
              {
                {
                  indice = indice_produto_encomenda(ide, idp);
                  if (indice == (-1))
                  {
                    {
                      strcpy(descricao, produtos[idp].descricao);
                      for (i = 0; i < encomendas[ide].nr_produtos; i++)
                        if (strcmp(descricao, encomendas[ide].produtos[i].descricao) < 0)
                      {
                        {
                          novo_indice = i;
                          break;
                        }
                      }
                      else
                      {
                        
                      }


                      if (novo_indice != (-1))
                      {
                        {
                          for (i = novo_indice; i < encomendas[ide].nr_produtos; i++)
                          {
                            p2 = encomendas[ide].produtos[i];
                            encomendas[ide].produtos[i] = p;
                            p = p2;
                          }

                          encomendas[ide].produtos[i] = p;
                          encomendas[ide].produtos[novo_indice].id = idp;
                          strcpy(encomendas[ide].produtos[novo_indice].descricao, produtos[idp].descricao);
                          encomendas[ide].quantidades[idp] = quantidade;
                        }
                      }
                      else
                      {
                        {
                          encomendas[ide].produtos[encomendas[ide].nr_produtos].id = idp;
                          strcpy(encomendas[ide].produtos[encomendas[ide].nr_produtos].descricao, produtos[idp].descricao);
                          encomendas[ide].quantidades[idp] = quantidade;
                        }
                      }

                      encomendas[ide].nr_produtos++;
                    }
                  }
                  else
                  {
                    encomendas[ide].quantidades[idp] += quantidade;
                  }

                  encomendas[ide].peso += quantidade * produtos[idp].peso;
                  produtos[idp].quantidade -= quantidade;
                }
              }
              else
              {
                printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
              }

            }
          }
          else
          {
            printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
          }

        }
      }
      else
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
      }

    }
  }
  else
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }

}

void r(int idp, int quantidade)
{
  if (nr_produtos > idp)
  {
    {
      if ((produtos[idp].quantidade - quantidade) >= 0)
      {
        produtos[idp].quantidade -= quantidade;
      }
      else
      {
        printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", quantidade, idp);
      }

    }
  }
  else
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
  }

}

void R(int ide, int idp)
{
  int indice;
  int i;
  produto_enc p;
  produto_enc p2;
  if (nr_encomendas > ide)
  {
    {
      if (nr_produtos > idp)
      {
        {
          indice = indice_produto_encomenda(ide, idp);
          if (indice == (-1))
          {
            return;
          }
          else
          {
            {
              produtos[idp].quantidade += encomendas[ide].quantidades[idp];
              encomendas[ide].peso -= encomendas[ide].quantidades[idp] * produtos[idp].peso;
              encomendas[ide].quantidades[idp] = 0;
              for (i = encomendas[ide].nr_produtos - 1; i > indice; i--)
              {
                p2 = encomendas[ide].produtos[i];
                encomendas[ide].produtos[i] = p;
                p = p2;
              }

              encomendas[ide].produtos[i] = p;
              encomendas[ide].nr_produtos--;
            }
          }

        }
      }
      else
      {
        printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
      }

    }
  }
  else
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }

}

void C(int ide)
{
  int i;
  int preco_total = 0;
  if (nr_encomendas > ide)
  {
    {
      for (i = 0; i < encomendas[ide].nr_produtos; i++)
        preco_total += encomendas[ide].quantidades[encomendas[ide].produtos[i].id] * produtos[encomendas[ide].produtos[i].id].preco;

      printf("Custo da encomenda %d %d.\n", ide, preco_total);
    }
  }
  else
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }

}

void p(int idp, int novo)
{
  if (nr_produtos > idp)
  {
    produtos[idp].preco = novo;
  }
  else
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
  }

}

void E(int ide, int idp)
{
  if (nr_encomendas > ide)
  {
    {
      if (nr_produtos > idp)
      {
        {
          if (indice_produto_encomenda(ide, idp) == (-1))
          {
            printf("%s 0.\n", produtos[idp].descricao);
          }
          else
          {
            printf("%s %d.\n", produtos[idp].descricao, encomendas[ide].quantidades[idp]);
          }

        }
      }
      else
      {
        printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
      }

    }
  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }

}

void m(int idp)
{
  int i;
  int max_quantidade = 0;
  int max_encomenda = 0;
  if (nr_produtos > idp)
  {
    {
      for (i = 0; i < nr_encomendas; i++)
      {
        if (encomendas[i].quantidades[idp] > 0)
        {
          if (max_quantidade < encomendas[i].quantidades[idp])
          {
            {
              max_encomenda = i;
              max_quantidade = encomendas[i].quantidades[idp];
            }
          }
          else
          {
            
          }

        }
        else
        {
          
        }

      }

      if (max_quantidade)
      {
        printf("Maximo produto %d %d %d.\n", idp, max_encomenda, max_quantidade);
      }
      else
      {
        
      }

    }
  }
  else
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
  }

}

void merge(produto arr[], int l, int m, int r)
{
  int i;
  int j;
  int k;
  int n1 = (m - l) + 1;
  int n2 = r - m;
  produto L[10000];
  produto R[10000];
  for (i = 0; i < n1; i++)
    L[i] = arr[l + i];

  for (j = 0; j < n2; j++)
    R[j] = arr[(m + 1) + j];

  i = 0;
  j = 0;
  k = l;
  while ((i < n1) && (j < n2))
  {
    if (L[i].preco <= R[j].preco)
    {
      {
        arr[k] = L[i];
        i++;
      }
    }
    else
    {
      {
        arr[k] = R[j];
        j++;
      }
    }

    k++;
  }

  while (j < n2)
  {
    arr[k] = R[j];
    j++;
    k++;
  }

  while (i < n1)
  {
    arr[k] = L[i];
    i++;
    k++;
  }

}

void mergeSort(produto arr[], int l, int r)
{
  int m;
  if (l < r)
  {
    {
      m = l + ((r - l) / 2);
      mergeSort(arr, l, m);
      mergeSort(arr, m + 1, r);
      merge(arr, l, m, r);
    }
  }
  else
  {
    
  }

}

void l()
{
  int i;
  produto produtos_copia[10000];
  for (i = 0; i < nr_produtos; i++)
  {
    produtos_copia[i].id = produtos[i].id;
    produtos_copia[i].preco = produtos[i].preco;
    produtos_copia[i].quantidade = produtos[i].quantidade;
    produtos_copia[i].peso = produtos[i].peso;
    strcpy(produtos_copia[i].descricao, produtos[i].descricao);
  }

  mergeSort(produtos_copia, 0, nr_produtos - 1);
  printf("Produtos\n");
  for (i = 0; i < nr_produtos; i++)
    printf("* %s %d %d\n", produtos_copia[i].descricao, produtos_copia[i].preco, produtos_copia[i].quantidade);

}

void L(int ide)
{
  int i;
  if (nr_encomendas > ide)
  {
    {
      printf("Encomenda %d\n", ide);
      for (i = 0; i < encomendas[ide].nr_produtos; i++)
        printf("* %s %d %d\n", encomendas[ide].produtos[i].descricao, produtos[encomendas[ide].produtos[i].id].preco, encomendas[ide].quantidades[encomendas[ide].produtos[i].id]);

    }
  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }

}

int main()
{
  char comando;
  char input[80];
  char descricao[64];
  const char corte[2] = ":";
  int idp;
  int ide;
  int preco;
  int peso;
  int quantidade;
  nr_produtos = 0;
  nr_encomendas = 0;
  while (comando != 'x')
  {
    comando = getchar();
    fgets(input, sizeof(input), stdin);
    switch (comando)
    {
      case 'a':
        strcpy(descricao, strtok(&input[1], corte));
        preco = atoi(strtok(0, corte));
        peso = atoi(strtok(0, corte));
        quantidade = atoi(strtok(0, corte));
        a(descricao, preco, peso, quantidade);
        break;

      case 'q':
        idp = atoi(strtok(input, corte));
        quantidade = atoi(strtok(0, corte));
        q(idp, quantidade);
        break;

      case 'N':
        N();
        break;

      case 'A':
        ide = atoi(strtok(input, corte));
        idp = atoi(strtok(0, corte));
        quantidade = atoi(strtok(0, corte));
        A(ide, idp, quantidade);
        break;

      case 'r':
        idp = atoi(strtok(input, corte));
        quantidade = atoi(strtok(0, corte));
        r(idp, quantidade);
        break;

      case 'R':
        ide = atoi(strtok(input, corte));
        idp = atoi(strtok(0, corte));
        R(ide, idp);
        break;

      case 'C':
        ide = atoi(input);
        C(ide);
        break;

      case 'p':
        idp = atoi(strtok(input, corte));
        preco = atoi(strtok(0, corte));
        p(idp, preco);
        break;

      case 'E':
        ide = atoi(strtok(input, corte));
        idp = atoi(strtok(0, corte));
        E(ide, idp);
        break;

      case 'm':
        idp = atoi(input);
        m(idp);
        break;

      case 'l':
        l();
        break;

      case 'L':
        ide = atoi(input);
        L(ide);
        break;

      default:
        break;

    }

  }

  return 0;
}

