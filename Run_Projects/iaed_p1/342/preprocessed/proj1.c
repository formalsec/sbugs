/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>


typedef struct 
{
  int idp;
  char desc[63];
  int preco_prdt;
  int peso_prdt;
  int qtd_stock;
  int qtd_enc[500];
} prdt;
typedef struct 
{
  int ide;
  int nxt_prdt;
  int peso_enc;
  int produtos[200];
} enc;
prdt stock[10000];
enc encomendas[500];
int nxt_idp = 0;
int nxt_ide = 0;
void add_prd_stock(char dados[])
{
  strcpy(stock[nxt_idp].desc, strtok(dados, ":"));
  stock[nxt_idp].preco_prdt = atoi(strtok(0, ":"));
  stock[nxt_idp].peso_prdt = atoi(strtok(0, ":"));
  stock[nxt_idp].qtd_stock = atoi(strtok(0, ":"));
  stock[nxt_idp].idp = nxt_idp;
  printf("Novo produto %d.\n", stock[nxt_idp].idp);
  nxt_idp += 1;
}

void add_qtd_stock(char dados[])
{
  int idp_in;
  int qtd_in;
  idp_in = atoi(strtok(dados, ":"));
  qtd_in = atoi(strtok(0, ":"));
  if (idp_in >= nxt_idp)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp_in);
  }
  else
  {
    stock[idp_in].qtd_stock += qtd_in;
  }

}

void cria_enc()
{
  encomendas[nxt_ide].ide = nxt_ide;
  encomendas[nxt_ide].nxt_prdt = 0;
  encomendas[nxt_ide].peso_enc = 0;
  printf("Nova encomenda %d.\n", encomendas[nxt_ide].ide);
  nxt_ide += 1;
}

void add_prd_enc(char dados[])
{
  int ide_in;
  int idp_in;
  int qtd_in;
  int i;
  int flag_n_exst = 1;
  ide_in = atoi(strtok(dados, ":"));
  idp_in = atoi(strtok(0, ":"));
  qtd_in = atoi(strtok(0, ":"));
  if (ide_in >= nxt_ide)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp_in, ide_in);
  }
  else
  {
    if (idp_in >= nxt_idp)
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp_in, ide_in);
    }
    else
    {
      if (stock[idp_in].qtd_stock < qtd_in)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp_in, ide_in);
      }
      else
      {
        if ((encomendas[ide_in].peso_enc + (qtd_in * stock[idp_in].peso_prdt)) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp_in, ide_in);
        }
        else
        {
          {
            for (i = 0; i < encomendas[ide_in].nxt_prdt; i++)
            {
              if (encomendas[ide_in].produtos[i] == idp_in)
              {
                {
                  stock[idp_in].qtd_enc[ide_in] += qtd_in;
                  encomendas[ide_in].peso_enc += qtd_in * stock[idp_in].peso_prdt;
                  stock[idp_in].qtd_stock -= qtd_in;
                  flag_n_exst = 0;
                }
              }
              else
              {
                
              }

            }

            if (flag_n_exst)
            {
              {
                encomendas[ide_in].produtos[encomendas[ide_in].nxt_prdt] = idp_in;
                stock[idp_in].qtd_enc[ide_in] = qtd_in;
                encomendas[ide_in].peso_enc += qtd_in * stock[idp_in].peso_prdt;
                stock[idp_in].qtd_stock -= qtd_in;
                encomendas[ide_in].nxt_prdt += 1;
              }
            }
            else
            {
              
            }

          }
        }

      }

    }

  }

}

void rmv_qtd_stock(char dados[])
{
  int idp_in;
  int qtd_in;
  idp_in = atoi(strtok(dados, ":"));
  qtd_in = atoi(strtok(0, ":"));
  if (idp_in >= nxt_idp)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp_in);
  }
  else
  {
    if (qtd_in > stock[idp_in].qtd_stock)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd_in, idp_in);
    }
    else
    {
      stock[idp_in].qtd_stock -= qtd_in;
    }

  }

}

void rmv_prdt_enc(char dados[])
{
  int ide_in;
  int idp_in;
  int i;
  int prdt_a_rmv_encontrd = 0;
  ide_in = atoi(strtok(dados, ":"));
  idp_in = atoi(strtok(0, ":"));
  if (ide_in >= nxt_ide)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp_in, ide_in);
  }
  else
  {
    if (idp_in >= nxt_idp)
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp_in, ide_in);
    }
    else
    {
      {
        for (i = 0; i < encomendas[ide_in].nxt_prdt; i++)
        {
          if (encomendas[ide_in].produtos[i] == idp_in)
          {
            {
              prdt_a_rmv_encontrd = 1;
              encomendas[ide_in].peso_enc -= stock[idp_in].qtd_enc[ide_in] * stock[idp_in].peso_prdt;
              stock[idp_in].qtd_stock += stock[idp_in].qtd_enc[ide_in];
              stock[idp_in].qtd_enc[ide_in] = 0;
            }
          }
          else
          {
            
          }

          if (prdt_a_rmv_encontrd)
          {
            encomendas[ide_in].produtos[i] = encomendas[ide_in].produtos[i + 1];
          }
          else
          {
            
          }

        }

        if (prdt_a_rmv_encontrd)
        {
          encomendas[ide_in].nxt_prdt -= 1;
        }
        else
        {
          
        }

      }
    }

  }

}

void get_preco_enc(char dados[])
{
  int ide_in;
  int i;
  int preco_enc = 0;
  ide_in = atoi(strtok(dados, ":"));
  if (ide_in >= nxt_ide)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide_in);
  }
  else
  {
    {
      for (i = 0; i < encomendas[ide_in].nxt_prdt; i++)
        preco_enc += stock[encomendas[ide_in].produtos[i]].qtd_enc[ide_in] * stock[encomendas[ide_in].produtos[i]].preco_prdt;

      printf("Custo da encomenda %d %d.\n", ide_in, preco_enc);
    }
  }

}

void alt_preco_prdt(char dados[])
{
  int idp_in;
  int preco_in;
  idp_in = atoi(strtok(dados, ":"));
  preco_in = atoi(strtok(0, ":"));
  if (idp_in >= nxt_idp)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp_in);
  }
  else
  {
    stock[idp_in].preco_prdt = preco_in;
  }

}

void get_desc_qtd_prdt_enc(char dados[])
{
  int ide_in;
  int idp_in;
  int i;
  int prdt_inxst = 1;
  ide_in = atoi(strtok(dados, ":"));
  idp_in = atoi(strtok(0, ":"));
  if (ide_in >= nxt_ide)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide_in);
  }
  else
  {
    if (idp_in >= nxt_idp)
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", idp_in);
    }
    else
    {
      {
        for (i = 0; i < encomendas[ide_in].nxt_prdt; i++)
        {
          if (encomendas[ide_in].produtos[i] == idp_in)
          {
            {
              printf("%s %d.\n", stock[idp_in].desc, stock[idp_in].qtd_enc[ide_in]);
              prdt_inxst = 0;
            }
          }
          else
          {
            
          }

        }

        if (prdt_inxst)
        {
          printf("%s %d.\n", stock[idp_in].desc, 0);
        }
        else
        {
          
        }

      }
    }

  }

}

void get_enc_max_prdt(char dados[])
{
  int idp_in;
  int i;
  int flag_prdt_exst = 0;
  int max_qtd_enc = 0;
  int ide_max_qtd;
  idp_in = atoi(strtok(dados, ":"));
  if (idp_in >= nxt_idp)
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp_in);
  }
  else
  {
    
  }

  for (i = 0; i < nxt_ide; i++)
  {
    if (stock[idp_in].qtd_enc[i] > max_qtd_enc)
    {
      {
        max_qtd_enc = stock[idp_in].qtd_enc[i];
        ide_max_qtd = i;
        flag_prdt_exst = 1;
      }
    }
    else
    {
      
    }

  }

  if (flag_prdt_exst && (nxt_ide != 0))
  {
    printf("Maximo produto %d %d %d.\n", idp_in, ide_max_qtd, max_qtd_enc);
  }
  else
  {
    
  }

}

void merge(int arr[], int i_l, int i_r, int i_m, char mode)
{
  int l;
  int r;
  int i;
  int aux[10000];
  for (l = i_m + 1; l > i_l; l--)
    aux[l - 1] = arr[l - 1];

  for (r = i_m; r < i_r; r++)
    aux[(i_r + i_m) - r] = arr[r + 1];

  for (i = i_l; i <= i_r; i++)
  {
    if (mode == 'l')
    {
      {
        if (stock[aux[l]].preco_prdt == stock[aux[r]].preco_prdt)
        {
          {
            if (aux[l] > aux[r])
            {
              arr[i] = aux[r--];
            }
            else
            {
              arr[i] = aux[l++];
            }

          }
        }
        else
        {
          if (stock[aux[l]].preco_prdt > stock[aux[r]].preco_prdt)
          {
            arr[i] = aux[r--];
          }
          else
          {
            arr[i] = aux[l++];
          }

        }

      }
    }
    else
    {
      {
        if (strcmp(stock[aux[l]].desc, stock[aux[r]].desc) == 0)
        {
          {
            if (stock[aux[l]].idp > stock[aux[r]].idp)
            {
              arr[i] = aux[r--];
            }
            else
            {
              arr[i] = aux[l++];
            }

          }
        }
        else
        {
          if (strcmp(stock[aux[l]].desc, stock[aux[r]].desc) > 0)
          {
            arr[i] = aux[r--];
          }
          else
          {
            arr[i] = aux[l++];
          }

        }

      }
    }

  }

}

void mrg_srt(int arr[], int lim_l, int lim_r, char mode)
{
  int lim_m = (lim_l + lim_r) / 2;
  if (lim_l >= lim_r)
  {
    return;
  }
  else
  {
    
  }

  mrg_srt(arr, lim_l, lim_m, mode);
  mrg_srt(arr, lim_m + 1, lim_r, mode);
  merge(arr, lim_l, lim_r, lim_m, mode);
}

void get_prdts_stock_ord_preco()
{
  int i;
  int prdts_ord[10000];
  for (i = 0; i < nxt_idp; i++)
    prdts_ord[i] = i;

  mrg_srt(prdts_ord, 0, nxt_idp - 1, 'l');
  printf("Produtos\n");
  for (i = 0; i < nxt_idp; i++)
    printf("* %s %d %d\n", stock[prdts_ord[i]].desc, stock[prdts_ord[i]].preco_prdt, stock[prdts_ord[i]].qtd_stock);

}

void get_prdts_enc_ord_alph(char dados[])
{
  int i;
  int ide_in;
  int prdts_ord[10000];
  ide_in = atoi(strtok(dados, ":"));
  if (ide_in >= nxt_ide)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide_in);
  }
  else
  {
    {
      for (i = 0; i < encomendas[ide_in].nxt_prdt; i++)
        prdts_ord[i] = encomendas[ide_in].produtos[i];

      mrg_srt(prdts_ord, 0, encomendas[ide_in].nxt_prdt - 1, 'L');
      printf("Encomenda %d\n", ide_in);
      for (i = 0; i < encomendas[ide_in].nxt_prdt; i++)
        printf("* %s %d %d\n", stock[prdts_ord[i]].desc, stock[prdts_ord[i]].preco_prdt, stock[prdts_ord[i]].qtd_enc[ide_in]);

    }
  }

}

int main()
{
  char instr[1024];
  while (1)
  {
    fgets(instr, 1024, stdin);
    switch (instr[0])
    {
      case 'a':
        add_prd_stock(&instr[2]);
        break;

      case 'q':
        add_qtd_stock(&instr[2]);
        break;

      case 'N':
        cria_enc();
        break;

      case 'A':
        add_prd_enc(&instr[2]);
        break;

      case 'r':
        rmv_qtd_stock(&instr[2]);
        break;

      case 'R':
        rmv_prdt_enc(&instr[2]);
        break;

      case 'C':
        get_preco_enc(&instr[2]);
        break;

      case 'p':
        alt_preco_prdt(&instr[2]);
        break;

      case 'E':
        get_desc_qtd_prdt_enc(&instr[2]);
        break;

      case 'm':
        get_enc_max_prdt(&instr[2]);
        break;

      case 'l':
        get_prdts_stock_ord_preco();
        break;

      case 'L':
        get_prdts_enc_ord_alph(&instr[2]);
        break;

      case 'x':
        exit(0);

    }

  }

  return 0;
}

