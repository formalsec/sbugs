/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>


typedef struct produto
{
  char desc[64];
  int preco;
  int peso;
  int qtd;
  int id;
} Produto;
typedef struct encomenda
{
  int preco;
  int peso;
  int id;
  int conj_prod[10001];
  int conj_qtds[10001];
} Encomenda;
Produto prods[10001];
Encomenda encom[501];
int idp;
int ide;
int qtd_prod[200];
int flag;
void merge(int arr[], int l, int m, int r)
{
  int i;
  int j;
  int k;
  int aux[10001];
  for (i = m + 1; i > l; i--)
    aux[i - 1] = arr[i - 1];

  for (j = m; j < r; j++)
    aux[(r + m) - j] = arr[j + 1];

  if (flag == 0)
  {
    {
      for (k = l; k <= r; k++)
      {
        if ((prods[aux[j]].preco < prods[aux[i]].preco) || (i > m))
        {
          arr[k] = aux[j--];
        }
        else
        {
          arr[k] = aux[i++];
        }

      }

    }
  }
  else
  {
    {
      for (k = l; k <= r; k++)
      {
        if ((strcmp(prods[aux[j]].desc, prods[aux[i]].desc) < 0) || (i > m))
        {
          arr[k] = aux[j--];
        }
        else
        {
          arr[k] = aux[i++];
        }

      }

    }
  }

}

void merge_sort(int arr[], int l, int r)
{
  int m = (r + l) / 2;
  if (r <= l)
  {
    return;
  }
  else
  {
    
  }

  merge_sort(arr, l, m);
  merge_sort(arr, m + 1, r);
  merge(arr, l, m, r);
}

void add_prod(char input[1024])
{
  Produto p;
  strcpy(p.desc, strtok(input, ":"));
  p.preco = atoi(strtok(0, ":"));
  p.peso = atoi(strtok(0, ":"));
  p.qtd = atoi(strtok(0, ":"));
  p.id = idp;
  printf("Novo produto %d.\n", idp);
  prods[idp] = p;
  idp++;
}

void add_stock(char input[1024])
{
  int id_p;
  int quant;
  id_p = atoi(strtok(input, ":"));
  quant = atoi(strtok(0, ":"));
  if (id_p >= idp)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", id_p);
  }
  else
  {
    prods[id_p].qtd += quant;
  }

}

void add_enc()
{
  Encomenda e;
  e.preco = 0;
  e.peso = 0;
  e.id = ide;
  printf("Nova encomenda %d.\n", ide);
  encom[ide] = e;
  ide++;
}

void add_prod_enc(char input[1024])
{
  int id_e;
  int id_p;
  int quant;
  int i;
  int j = 0;
  Produto p;
  Encomenda e;
  id_e = atoi(strtok(input, ":"));
  id_p = atoi(strtok(0, ":"));
  quant = atoi(strtok(0, ":"));
  p = prods[id_p];
  e = encom[id_e];
  if (id_e > (ide - 1))
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", id_p, id_e);
  }
  else
  {
    if (id_p > (idp - 1))
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", id_p, id_e);
    }
    else
    {
      if (quant > p.qtd)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", id_p, id_e);
      }
      else
      {
        if ((e.peso + (p.peso * quant)) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", id_p, id_e);
        }
        else
        {
          {
            for (i = 0; (i < qtd_prod[id_e]) && (j == 0); i++)
            {
              if (id_p == e.conj_prod[i])
              {
                {
                  e.conj_qtds[i] += quant;
                  j++;
                }
              }
              else
              {
                
              }

            }

            if (j == 0)
            {
              {
                e.conj_prod[qtd_prod[id_e]] = id_p;
                e.conj_qtds[qtd_prod[id_e]] = quant;
                qtd_prod[id_e]++;
              }
            }
            else
            {
              
            }

            e.preco += p.preco * quant;
            e.peso += p.peso * quant;
            e.id = id_e;
            prods[id_p].qtd -= quant;
          }
        }

      }

    }

  }

  encom[id_e] = e;
}

void remove_stock(char input[1024])
{
  int id_p;
  int quant;
  id_p = atoi(strtok(input, ":"));
  quant = atoi(strtok(0, ":"));
  if (id_p > (idp - 1))
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", id_p);
  }
  else
  {
    if (prods[id_p].qtd < quant)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", quant, id_p);
    }
    else
    {
      prods[id_p].qtd -= quant;
    }

  }

}

void remove_produto_enc(char input[1024])
{
  int id_e;
  int id_p;
  int i = 0;
  int j;
  Encomenda e;
  id_e = atoi(strtok(input, ":"));
  id_p = atoi(strtok(0, ":"));
  e = encom[id_e];
  if (id_e > (ide - 1))
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", id_p, id_e);
  }
  else
  {
    if (id_p > (idp - 1))
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", id_p, id_e);
    }
    else
    {
      {
        while ((e.conj_prod[i] != id_p) && (i < qtd_prod[id_e]))
          i++;

        if (i != qtd_prod[id_e])
        {
          {
            e.preco -= prods[id_p].preco * e.conj_qtds[i];
            e.peso -= prods[id_p].peso * e.conj_qtds[i];
            prods[id_p].qtd += e.conj_qtds[i];
            for (j = i; j < qtd_prod[id_e]; j++)
            {
              e.conj_prod[j] = e.conj_prod[j + 1];
              e.conj_qtds[j] = e.conj_qtds[j + 1];
            }

            qtd_prod[id_e]--;
          }
        }
        else
        {
          
        }

      }
    }

  }

  encom[id_e] = e;
}

void custo_enc(char input[1024])
{
  int id_e;
  Encomenda e;
  id_e = atoi(strtok(input, ":"));
  e = encom[id_e];
  if (id_e > (ide - 1))
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", id_e);
  }
  else
  {
    printf("Custo da encomenda %d %d.\n", id_e, e.preco);
  }

}

void altera_preco(char input[1024])
{
  int id_p;
  int preco_novo;
  int i;
  int j;
  int preco_antigo;
  Encomenda e;
  id_p = atoi(strtok(input, ":"));
  preco_novo = atoi(strtok(0, ":"));
  preco_antigo = prods[id_p].preco;
  if (id_p > (idp - 1))
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", id_p);
  }
  else
  {
    {
      prods[id_p].preco = preco_novo;
      for (i = 0; i < ide; i++)
      {
        e = encom[i];
        for (j = 0; j < qtd_prod[i]; j++)
        {
          if (id_p == e.conj_prod[j])
          {
            {
              e.preco -= preco_antigo * e.conj_qtds[j];
              e.preco += preco_novo * e.conj_qtds[j];
            }
          }
          else
          {
            
          }

        }

        encom[i] = e;
      }

    }
  }

}

void desc_qtd_enc(char input[1024])
{
  int id_e;
  int id_p;
  int i;
  int j = 0;
  Encomenda e;
  id_e = atoi(strtok(input, ":"));
  id_p = atoi(strtok(0, ":"));
  e = encom[id_e];
  if (id_e > (ide - 1))
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", id_e);
  }
  else
  {
    if (id_p > (idp - 1))
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", id_p);
    }
    else
    {
      {
        for (i = 0; i < qtd_prod[id_e]; i++)
        {
          if (e.conj_prod[i] == id_p)
          {
            {
              printf("%s %d.\n", prods[id_p].desc, e.conj_qtds[i]);
              j++;
            }
          }
          else
          {
            
          }

        }

        if (j == 0)
        {
          printf("%s %d.\n", prods[id_p].desc, 0);
        }
        else
        {
          
        }

      }
    }

  }

}

void prod_ocorre_enc(char input[1024])
{
  int id_p;
  int id_e;
  int medidor = 0;
  int maior = 0;
  int i;
  int j;
  Encomenda e;
  id_p = atoi(strtok(input, ":"));
  if (id_p > (idp - 1))
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", id_p);
  }
  else
  {
    
  }

  for (i = 0; i < ide; i++)
  {
    e = encom[i];
    for (j = 0; j < qtd_prod[i]; j++)
    {
      if (e.conj_prod[j] == id_p)
      {
        medidor = e.conj_qtds[j];
      }
      else
      {
        
      }

    }

    if (medidor > maior)
    {
      {
        maior = medidor;
        id_e = i;
      }
    }
    else
    {
      
    }

  }

  if (medidor != 0)
  {
    printf("Maximo produto %d %d %d.\n", id_p, id_e, maior);
  }
  else
  {
    
  }

}

void ordena_prod_preco()
{
  int i;
  int j;
  int lista_aux[10001];
  flag = 0;
  for (i = 0; i < idp; i++)
    lista_aux[i] = prods[i].id;

  merge_sort(lista_aux, 0, idp - 1);
  printf("Produtos\n");
  for (j = 0; j < idp; j++)
    printf("* %s %d %d\n", prods[lista_aux[j]].desc, prods[lista_aux[j]].preco, prods[lista_aux[j]].qtd);

}

void ordena_enc_alf(char input[1024])
{
  int id_e;
  int i;
  int k;
  int aux1[10001];
  int aux2[10001];
  Encomenda e;
  flag = 1;
  id_e = atoi(strtok(input, ":"));
  e = encom[id_e];
  if (id_e > (ide - 1))
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", id_e);
  }
  else
  {
    {
      for (i = 0; i < qtd_prod[id_e]; i++)
      {
        aux1[i] = e.conj_prod[i];
        aux2[e.conj_prod[i]] = e.conj_qtds[i];
      }

      merge_sort(aux1, 0, qtd_prod[id_e] - 1);
      printf("Encomenda %d\n", id_e);
      for (k = 0; k < qtd_prod[id_e]; k++)
        printf("* %s %d %d\n", prods[aux1[k]].desc, prods[aux1[k]].preco, aux2[aux1[k]]);

    }
  }

}

int main()
{
  char input[1024];
  while (fgets(input, 1024, stdin))
  {
    switch (input[0])
    {
      case 'a':
        add_prod(&input[2]);
        break;

      case 'q':
        add_stock(&input[2]);
        break;

      case 'N':
        add_enc();
        break;

      case 'A':
        add_prod_enc(&input[2]);
        break;

      case 'r':
        remove_stock(&input[2]);
        break;

      case 'R':
        remove_produto_enc(&input[2]);
        break;

      case 'C':
        custo_enc(&input[2]);
        break;

      case 'p':
        altera_preco(&input[2]);
        break;

      case 'E':
        desc_qtd_enc(&input[2]);
        break;

      case 'm':
        prod_ocorre_enc(&input[2]);
        break;

      case 'l':
        ordena_prod_preco();
        break;

      case 'L':
        ordena_enc_alf(&input[2]);
        break;

      case 'x':
        return 0;

      default:
        break;

    }

  }

  return 0;
}

