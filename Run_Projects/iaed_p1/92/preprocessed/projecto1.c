/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


typedef struct 
{
  int idp;
  char descricao[63];
  int preco;
  int peso;
  int qtd;
} Produto;
void novo_produto();
void adiciona_stock();
void remove_stock();
void altera_preco();
void cria_encomenda();
void adiciona_produto_encomenda();
void remove_produto_encomenda();
void custo_encomenda();
void lista_descricao_qtd();
void lista_ide();
void lista_sistema();
void quick_sort_sistema(Produto arr[], int low, int high);
int particao(Produto arr[], int low, int high);
void troca(Produto arr[], int a, int b);
int lim_sup(Produto arr[]);
void lista_encomenda();
Produto encomendas[500][200];
Produto sistema[10000];
Produto produto_vazio = {-1, "vazio", 0, 0, 0};
int main()
{
  char comando;
  int i;
  int e;
  for (i = 0; i < 10000; i++)
  {
    sistema[i] = produto_vazio;
  }

  for (i = 0; i < 500; i++)
  {
    for (e = 0; e < 200; e++)
    {
      encomendas[i][e] = produto_vazio;
    }

  }

  do
  {
    switch (comando = getchar())
    {
      case 'a':
        novo_produto();
        break;

      case 'q':
        adiciona_stock();
        break;

      case 'r':
        remove_stock();
        break;

      case 'p':
        altera_preco();
        break;

      case 'N':
        cria_encomenda();
        break;

      case 'A':
        adiciona_produto_encomenda();
        break;

      case 'R':
        remove_produto_encomenda();
        break;

      case 'C':
        custo_encomenda();
        break;

      case 'E':
        lista_descricao_qtd();
        break;

      case 'm':
        lista_ide();
        break;

      case 'l':
        lista_sistema();
        break;

      case 'L':
        lista_encomenda();
        break;

    }

  }
  while (comando != 'x');
  return 0;
}

void novo_produto()
{
  Produto novo_produto;
  int i;
  for (int novo_produto_index = 0; novo_produto_index < 10; novo_produto_index++)
  {
    novo_produto.descricao[novo_produto_index] = new_sym_var(sizeof(char) * 8);
  }

  novo_produto.descricao[10 - 1] = '\0';
  novo_produto.preco = new_sym_var(sizeof(int) * 8);
  novo_produto.peso = new_sym_var(sizeof(int) * 8);
  novo_produto.qtd = new_sym_var(sizeof(int) * 8);
  for (i = 0; i < 10000; i++)
  {
    if (sistema[i].idp == produto_vazio.idp)
    {
      {
        novo_produto.idp = i;
        sistema[i] = novo_produto;
        break;
      }
    }
    else
    {
      
    }

  }

  printf("Novo produto %d.\n", i);
}

void adiciona_stock()
{
  int idp;
  int qtd;
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (sistema[idp].idp == produto_vazio.idp)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
  }
  else
  {
    sistema[idp].qtd = sistema[idp].qtd + qtd;
  }

}

void remove_stock()
{
  int idp;
  int qtd;
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (sistema[idp].idp == produto_vazio.idp)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    if (sistema[idp].qtd < qtd)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, idp);
    }
    else
    {
      sistema[idp].qtd -= qtd;
    }

  }

}

void altera_preco()
{
  int idp;
  int preco;
  int i;
  int e;
  idp = new_sym_var(sizeof(int) * 8);
  preco = new_sym_var(sizeof(int) * 8);
  if (sistema[idp].idp == produto_vazio.idp)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    {
      sistema[idp].preco = preco;
      for (i = 0; encomendas[i][0].idp >= 0; i++)
      {
        for (e = 0; encomendas[i][e].idp >= 0; e++)
        {
          if (encomendas[i][e].idp == idp)
          {
            {
              encomendas[i][e].preco = preco;
            }
          }
          else
          {
            
          }

        }

      }

    }
  }

}

void cria_encomenda()
{
  int i;
  for (i = 0; i < 500; i++)
  {
    if (encomendas[i][0].idp == produto_vazio.idp)
    {
      {
        encomendas[i][0].idp = -2;
        break;
      }
    }
    else
    {
      
    }

  }

  printf("Nova encomenda %d.\n", i);
}

void adiciona_produto_encomenda()
{
  int ide;
  int idp;
  int qtd;
  int peso_encomenda = 0;
  int i;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (encomendas[ide][0].idp != produto_vazio.idp)
  {
    {
      for (i = 0; encomendas[ide][i].idp >= 0; i++)
      {
        peso_encomenda += encomendas[ide][i].peso * encomendas[ide][i].qtd;
      }

    }
  }
  else
  {
    
  }

  if (encomendas[ide][0].idp == produto_vazio.idp)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (sistema[idp].idp == produto_vazio.idp)
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      if (sistema[idp].qtd < qtd)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
      }
      else
      {
        if ((peso_encomenda + (sistema[idp].peso * qtd)) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
        }
        else
        {
          {
            for (i = 0; i < 200; i++)
            {
              if (encomendas[ide][i].idp == idp)
              {
                {
                  encomendas[ide][i].qtd += qtd;
                  sistema[idp].qtd -= qtd;
                  break;
                }
              }
              else
              {
                
              }

              if (encomendas[ide][i].idp < 0)
              {
                {
                  encomendas[ide][i] = sistema[idp];
                  encomendas[ide][i].qtd = qtd;
                  sistema[idp].qtd -= qtd;
                  break;
                }
              }
              else
              {
                
              }

            }

          }
        }

      }

    }

  }

}

void remove_produto_encomenda()
{
  int ide;
  int idp;
  int i;
  int e;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (encomendas[ide][0].idp == produto_vazio.idp)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (sistema[idp].idp == produto_vazio.idp)
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      {
        for (i = 0; i < 200; i++)
        {
          if (encomendas[ide][i].idp == idp)
          {
            {
              sistema[idp].qtd += encomendas[ide][i].qtd;
              for (e = i; encomendas[ide][e].idp != produto_vazio.idp; e++)
              {
                encomendas[ide][e] = encomendas[ide][e + 1];
              }

              break;
            }
          }
          else
          {
            
          }

        }

        if (encomendas[ide][0].idp == (-1))
        {
          encomendas[ide][0].idp = -2;
        }
        else
        {
          
        }

      }
    }

  }

}

void custo_encomenda()
{
  int ide;
  int i;
  int total = 0;
  ide = new_sym_var(sizeof(int) * 8);
  if (encomendas[ide][0].idp == produto_vazio.idp)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    {
      for (i = 0; encomendas[ide][i].idp >= 0; i++)
      {
        total += encomendas[ide][i].preco * encomendas[ide][i].qtd;
      }

      printf("Custo da encomenda %d %d.\n", ide, total);
    }
  }

}

void lista_descricao_qtd()
{
  int ide;
  int idp;
  int i;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (encomendas[ide][0].idp == produto_vazio.idp)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    if (sistema[idp].idp == produto_vazio.idp)
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
    }
    else
    {
      {
        for (i = 0; encomendas[ide][i].idp >= 0; i++)
        {
          if (encomendas[ide][i].idp == idp)
          {
            {
              printf("%s %d.\n", encomendas[ide][i].descricao, encomendas[ide][i].qtd);
              break;
            }
          }
          else
          {
            
          }

        }

        if (encomendas[ide][i].idp != idp)
        {
          printf("%s %d.\n", sistema[idp].descricao, 0);
        }
        else
        {
          
        }

      }
    }

  }

}

void lista_ide()
{
  int idp;
  int ide = -1;
  int qtd = 0;
  int i;
  int e;
  idp = new_sym_var(sizeof(int) * 8);
  if (sistema[idp].idp == produto_vazio.idp)
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    {
      for (i = 0; encomendas[i][0].idp != (-1); i++)
      {
        for (e = 0; (encomendas[i][e].idp >= 0) || (encomendas[i][e].idp == (-2)); e++)
        {
          if ((encomendas[i][e].idp == idp) && (encomendas[i][e].qtd > qtd))
          {
            {
              qtd = encomendas[i][e].qtd;
              ide = i;
              break;
            }
          }
          else
          {
            
          }

        }

      }

      if (ide >= 0)
      {
        printf("Maximo produto %d %d %d.\n", idp, ide, qtd);
      }
      else
      {
        
      }

    }
  }

}

int lim_sup(Produto arr[])
{
  int i = 0;
  while (arr[i].idp != produto_vazio.idp)
    i++;

  return i - 1;
}

void troca(Produto arr[], int a, int b)
{
  Produto temp;
  temp = arr[a];
  arr[a] = arr[b];
  arr[b] = temp;
}

int particao(Produto arr[], int inf, int sup)
{
  Produto pivot = arr[sup];
  int i = inf - 1;
  int j;
  for (j = inf; j <= (sup - 1); j++)
  {
    if (arr[j].preco < pivot.preco)
    {
      {
        i++;
        troca(arr, i, j);
      }
    }
    else
    {
      
    }

  }

  troca(arr, i + 1, sup);
  return i + 1;
}

void quick_sort_sistema(Produto arr[], int inf, int sup)
{
  int ip;
  if (inf < sup)
  {
    {
      ip = particao(arr, inf, sup);
      quick_sort_sistema(arr, inf, ip - 1);
      quick_sort_sistema(arr, ip + 1, sup);
    }
  }
  else
  {
    
  }

}

void lista_sistema()
{
  Produto lista[10000];
  int i;
  for (i = 0; i < 10000; i++)
    lista[i] = sistema[i];

  quick_sort_sistema(lista, 0, lim_sup(lista));
  for (i = 0; i < lim_sup(lista); i++)
    if ((lista[i].preco == lista[i + 1].preco) && (lista[i].idp > lista[i + 1].idp))
  {
    troca(lista, i, i + 1);
  }
  else
  {
    
  }


  printf("Produtos\n");
  for (i = 0; lista[i].idp != produto_vazio.idp; i++)
    printf("* %s %d %d\n", lista[i].descricao, lista[i].preco, lista[i].qtd);

}

void lista_encomenda()
{
  int ide;
  int i;
  int j;
  Produto listaencm[200];
  ide = new_sym_var(sizeof(int) * 8);
  if (encomendas[ide][0].idp == produto_vazio.idp)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    {
      for (i = 0; i < 200; i++)
        listaencm[i] = encomendas[ide][i];

      for (i = 0; encomendas[ide][i].idp >= 0; i++)
      {
        for (j = i + 1; encomendas[ide][j].idp >= 0; j++)
        {
          if (strcmp(listaencm[i].descricao, listaencm[j].descricao) > 0)
          {
            {
              troca(listaencm, i, j);
            }
          }
          else
          {
            
          }

        }

      }

      printf("Encomenda %d\n", ide);
      for (i = 0; listaencm[i].idp >= 0; i++)
        printf("* %s %d %d\n", listaencm[i].descricao, listaencm[i].preco, listaencm[i].qtd);

    }
  }

}

