/*File generated by PreProcessor.py*/


#include "teams.h"
#include "games.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>


char *strManip(char *string);
gLink addGame(gLink *hashGame, gLink gHead, tLink *hashTeam, int NL);
void listGames(gLink gHead, int NL);
void findGame(gLink *hashGame, int NL);
gLink delGame(gLink *hashGame, gLink gHead, tLink *hashTeam, int NL);
void changeScore(gLink *hashGame, tLink *hashTeam, int NL);
void addTeam(tLink *hashTeam, int NL);
void findTeam(tLink *hashTeam, int NL);
void winningTeams(tLink *hashTeam, int NL);
void freeEverything(gLink *hashGame, tLink *hashTeam, gLink gHead);
int main()
{
  char in;
  int NL = 1;
  gLink gHead = 0;
  gLink *hashGame = 0;
  tLink *hashTeam = 0;
  hashTeam = tInit(hashTeam);
  hashGame = gInit(hashGame);
  while ((in = getchar()) != 'x')
  {
    switch (in)
    {
      case 'a':
        gHead = addGame(hashGame, gHead, hashTeam, NL);
        NL++;
        break;

      case 'l':
        listGames(gHead, NL);
        NL++;
        break;

      case 'p':
        findGame(hashGame, NL);
        NL++;
        break;

      case 'r':
        gHead = delGame(hashGame, gHead, hashTeam, NL);
        NL++;
        break;

      case 's':
        changeScore(hashGame, hashTeam, NL);
        NL++;
        break;

      case 'A':
        addTeam(hashTeam, NL);
        NL++;
        break;

      case 'P':
        findTeam(hashTeam, NL);
        NL++;
        break;

      case 'g':
        winningTeams(hashTeam, NL);
        NL++;
        break;

    }

  }

  freeEverything(hashGame, hashTeam, gHead);
  return 0;
}

char *strManip(char *string)
{
  char *dest;
  int len;
  len = strlen(string);
  dest = (char *) malloc((sizeof(char)) * (len + 1));
  dest = strcpy(dest, string);
  return dest;
}

gLink addGame(gLink *hashGame, gLink gHead, tLink *hashTeam, int NL)
{
  pGame g;
  pTeam winnTeam;
  char name[1024];
  char team1[1024];
  char team2[1024];
  int score1;
  int score2;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  for (int team1_index = 0; team1_index < 10; team1_index++)
  {
    team1[team1_index] = new_sym_var(sizeof(char) * 8);
  }

  team1[10 - 1] = '\0';
  for (int team2_index = 0; team2_index < 10; team2_index++)
  {
    team2[team2_index] = new_sym_var(sizeof(char) * 8);
  }

  team2[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  if (gHTsearch(hashGame, name) != 0)
  {
    {
      printf("%d Jogo existente.\n", NL);
    }
  }
  else
  {
    if ((tHTsearch(hashTeam, team1) == 0) || (tHTsearch(hashTeam, team2) == 0))
    {
      {
        printf("%d Equipa inexistente.\n", NL);
      }
    }
    else
    {
      {
        g = (pGame) malloc(sizeof(struct game));
        g->name = strManip(name);
        g->team1 = strManip(team1);
        g->team2 = strManip(team2);
        g->score1 = score1;
        g->score2 = score2;
        gHTinsert(hashGame, g);
        gHead = gInsert_begin(gHead, g);
        if (score1 > score2)
        {
          {
            winnTeam = tHTsearch(hashTeam, team1);
            winnTeam->wins++;
          }
        }
        else
        {
          if (score2 > score1)
          {
            {
              winnTeam = tHTsearch(hashTeam, team2);
              winnTeam->wins++;
            }
          }
          else
          {
            
          }

        }

      }
    }

  }

  return gHead;
}

void listGames(gLink gHead, int NL)
{
  if (gHead == 0)
  {
    return;
  }
  else
  {
    {
      while (gHead->next != 0)
      {
        gHead = gHead->next;
      }

      do
      {
        printf("%d %s %s %s %d %d\n", NL, gHead->game->name, gHead->game->team1, gHead->game->team2, gHead->game->score1, gHead->game->score2);
        gHead = gHead->prev;
      }
      while (gHead != 0);
    }
  }

}

void findGame(gLink *hashGame, int NL)
{
  pGame g;
  char name[1024];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  if ((g = gHTsearch(hashGame, name)) != 0)
  {
    printf("%d %s %s %s %d %d\n", NL, g->name, g->team1, g->team2, g->score1, g->score2);
  }
  else
  {
    printf("%d Jogo inexistente.\n", NL);
  }

}

gLink delGame(gLink *hashGame, gLink gHead, tLink *hashTeam, int NL)
{
  pGame g;
  pTeam t1;
  pTeam t2;
  char name[1024];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  g = gHTsearch(hashGame, name);
  if (g == 0)
  {
    printf("%d Jogo inexistente.\n", NL);
  }
  else
  {
    {
      t1 = tHTsearch(hashTeam, g->team1);
      t2 = tHTsearch(hashTeam, g->team2);
      if (g->score1 > g->score2)
      {
        t1->wins--;
      }
      else
      {
        if (g->score1 < g->score2)
        {
          t2->wins--;
        }
        else
        {
          
        }

      }

      gHead = gRemove(gHead, name);
      gHTdelete(hashGame, name);
      freeGame(g);
    }
  }

  return gHead;
}

void changeScore(gLink *hashGame, tLink *hashTeam, int NL)
{
  pGame g;
  pTeam t1;
  pTeam t2;
  int score1;
  int score2;
  char name[1024];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  if (gHTsearch(hashGame, name) == 0)
  {
    printf("%d Jogo inexistente.\n", NL);
  }
  else
  {
    {
      g = gHTsearch(hashGame, name);
      t1 = tHTsearch(hashTeam, g->team1);
      t2 = tHTsearch(hashTeam, g->team2);
      if ((g->score1 > g->score2) && (score1 < score2))
      {
        {
          t1->wins--;
          t2->wins++;
        }
      }
      else
      {
        if ((g->score1 < g->score2) && (score1 > score2))
        {
          {
            t1->wins++;
            t2->wins--;
          }
        }
        else
        {
          if (g->score1 == g->score2)
          {
            {
              if (score1 > score2)
              {
                t1->wins++;
              }
              else
              {
                if (score1 < score2)
                {
                  t2->wins++;
                }
                else
                {
                  
                }

              }

            }
          }
          else
          {
            if (score1 == score2)
            {
              {
                if (g->score1 > g->score2)
                {
                  t1->wins--;
                }
                else
                {
                  if (g->score1 < g->score2)
                  {
                    t2->wins--;
                  }
                  else
                  {
                    
                  }

                }

              }
            }
            else
            {
              
            }

          }

        }

      }

      g->score1 = score1;
      g->score2 = score2;
    }
  }

}

void addTeam(tLink *hashTeam, int NL)
{
  pTeam t;
  char name[1024];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  if (tHTsearch(hashTeam, name) == 0)
  {
    {
      t = (pTeam) malloc(sizeof(struct team));
      t->name = strManip(name);
      t->wins = 0;
      tHTinsert(hashTeam, t);
    }
  }
  else
  {
    {
      printf("%d Equipa existente.\n", NL);
    }
  }

}

void findTeam(tLink *hashTeam, int NL)
{
  pTeam team;
  char name[1024];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  if ((team = tHTsearch(hashTeam, name)) != 0)
  {
    printf("%d %s %d\n", NL, team->name, team->wins);
  }
  else
  {
    printf("%d Equipa inexistente.\n", NL);
  }

}

void winningTeams(tLink *hashTeam, int NL)
{
  tLink tHead = 0;
  tLink aux;
  int i;
  int max = max_wins(hashTeam);
  for (i = 0; i != 1009; i++)
  {
    aux = hashTeam[i];
    while (aux != 0)
    {
      if (aux->team->wins == max)
      {
        {
          tHead = alphInsert(tHead, aux->team);
        }
      }
      else
      {
        
      }

      aux = aux->next;
    }

  }

  if (tHead != 0)
  {
    {
      printf("%d Melhores %d\n", NL, max);
      while (tHead != 0)
      {
        printf("%d * %s\n", NL, tHead->team->name);
        aux = tHead;
        tHead = tHead->next;
        free(aux);
      }

    }
  }
  else
  {
    
  }

}

void freeEverything(gLink *hashGame, tLink *hashTeam, gLink gHead)
{
  int i;
  tLink aux_team;
  tLink aux_team2;
  gLink aux_game;
  gLink aux_game2;
  for (i = 0; i != 1009; i++)
  {
    aux_team = hashTeam[i];
    aux_game = hashGame[i];
    while (aux_team != 0)
    {
      aux_team2 = aux_team;
      aux_team = aux_team->next;
      freeTeam(aux_team2->team);
      free(aux_team2);
    }

    while (aux_game != 0)
    {
      aux_game2 = aux_game;
      aux_game = aux_game->next;
      freeGame(aux_game2->game);
      free(aux_game2);
    }

  }

  while (gHead != 0)
  {
    aux_game = gHead;
    gHead = gHead->next;
    free(aux_game);
  }

  free(hashGame);
  free(hashTeam);
}

