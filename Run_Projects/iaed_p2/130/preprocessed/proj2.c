/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "JOGOS.h"
#include "EQUIPAS.h"


typedef unsigned int uint;
void Adiciona_Equipa(Elink *Eheads, uint *Cont_Ln, uint *Cont_Eq);
void Adiciona_Jogo(Elink *Eheads, Jlink *Jheads, Q Todos_Jogos, uint *Cont_Ln);
void Imprime_Jogos(Q q, uint *Cont_Ln);
void Procura_Jogo(Jlink *Jheads, uint *Cont_Ln);
void Procura_Equipa(Elink *Eheads, uint *Cont_Ln);
void Remove_Jogo(Elink *Eheads, Jlink *Jheads, Q Todos_Jogos, uint *Cont_Ln);
void Altera_Score(Elink *Eheads, Jlink *Jheads, uint *Cont_Ln);
void Mostra_Melhores_Equipas(Elink *Eheads, uint *Cont_Ln, uint Cont_Eq);
void Limpa(Jlink *Jheads, Elink *Eheads, Q Todos_Jogos);
int main()
{
  Q Todos_Jogos = QUEUEinit();
  Elink *Eheads = E_Init();
  Jlink *Jheads = J_Init();
  int car = getchar();
  uint Cont_Ln = 1;
  uint Cont_Eq = 0;
  while (car != 'x')
  {
    switch (car)
    {
      case 'a':
        Adiciona_Jogo(Eheads, Jheads, Todos_Jogos, &Cont_Ln);
        break;

      case 'A':
        Adiciona_Equipa(Eheads, &Cont_Ln, &Cont_Eq);
        break;

      case 'l':
        Imprime_Jogos(Todos_Jogos, &Cont_Ln);
        break;

      case 'p':
        Procura_Jogo(Jheads, &Cont_Ln);
        break;

      case 'P':
        Procura_Equipa(Eheads, &Cont_Ln);
        break;

      case 'r':
        Remove_Jogo(Eheads, Jheads, Todos_Jogos, &Cont_Ln);
        break;

      case 's':
        Altera_Score(Eheads, Jheads, &Cont_Ln);
        break;

      case 'g':
        Mostra_Melhores_Equipas(Eheads, &Cont_Ln, Cont_Eq);
        break;

    }

    car = getchar();
  }

  Limpa(Jheads, Eheads, Todos_Jogos);
  return 0;
}

void Adiciona_Jogo(Elink *Eheads, Jlink *Jheads, Q Todos_Jogos, uint *Cont_Ln)
{
  char nome[1023];
  char equipa1[1023];
  char equipa2[1023];
  uint score1;
  uint score2;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  for (int equipa1_index = 0; equipa1_index < 10; equipa1_index++)
  {
    equipa1[equipa1_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa1[10 - 1] = '\0';
  for (int equipa2_index = 0; equipa2_index < 10; equipa2_index++)
  {
    equipa2[equipa2_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa2[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(uint) * 8);
  score2 = new_sym_var(sizeof(uint) * 8);
  if (J_STSearch(Jheads, nome) != 0)
  {
    printf("%u Jogo existente.\n", *Cont_Ln);
  }
  else
  {
    if ((!E_STSearch(Eheads, equipa1)) || (!E_STSearch(Eheads, equipa2)))
    {
      printf("%u Equipa inexistente.\n", *Cont_Ln);
    }
    else
    {
      {
        pJogo j;
        j = (pJogo) malloc(sizeof(struct Jogo));
        j->score1 = score1;
        j->score2 = score2;
        j->nome = (char *) malloc((sizeof(char)) * (strlen(nome) + 1));
        strcpy(j->nome, nome);
        j->equipa1 = (char *) malloc((sizeof(char)) * (strlen(equipa1) + 1));
        strcpy(j->equipa1, equipa1);
        j->equipa2 = (char *) malloc((sizeof(char)) * (strlen(equipa2) + 1));
        strcpy(j->equipa2, equipa2);
        J_STinsert(Todos_Jogos, Jheads, j);
        if (score1 > score2)
        {
          {
            pEquipa e = E_STSearch(Eheads, equipa1);
            e->vit++;
          }
        }
        else
        {
          if (score1 < score2)
          {
            {
              pEquipa e = E_STSearch(Eheads, equipa2);
              e->vit++;
            }
          }
          else
          {
            
          }

        }

      }
    }

  }

  (*Cont_Ln)++;
}

void Imprime_Jogos(Q q, uint *Cont_Ln)
{
  Qlink ptr = q->head;
  for (; ptr; ptr = ptr->next)
  {
    printf("%u ", *Cont_Ln);
    printf("%s ", ptr->j->nome);
    printf("%s ", ptr->j->equipa1);
    printf("%s ", ptr->j->equipa2);
    printf("%u %u\n", ptr->j->score1, ptr->j->score2);
  }

  (*Cont_Ln)++;
}

void Procura_Jogo(Jlink *Jheads, uint *Cont_Ln)
{
  pJogo ptrJogo;
  char buffer[1023];
  for (int buffer_index = 0; buffer_index < 10; buffer_index++)
  {
    buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer[10 - 1] = '\0';
  ptrJogo = J_STSearch(Jheads, buffer);
  if (!ptrJogo)
  {
    printf("%u Jogo inexistente.\n", *Cont_Ln);
  }
  else
  {
    {
      printf("%u %s %s %s ", *Cont_Ln, ptrJogo->nome, ptrJogo->equipa1, ptrJogo->equipa2);
      printf("%u %u\n", ptrJogo->score1, ptrJogo->score2);
    }
  }

  (*Cont_Ln)++;
}

void Adiciona_Equipa(Elink *Eheads, uint *Cont_Ln, uint *Cont_Eq)
{
  char buffer[1023];
  for (int buffer_index = 0; buffer_index < 10; buffer_index++)
  {
    buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer[10 - 1] = '\0';
  if (E_STSearch(Eheads, buffer) != 0)
  {
    printf("%u Equipa existente.\n", *Cont_Ln);
  }
  else
  {
    {
      pEquipa e;
      e = (pEquipa) malloc(sizeof(struct Equipa));
      e->nome = (char *) malloc((sizeof(char)) * (strlen(buffer) + 1));
      strcpy(e->nome, buffer);
      e->vit = 0;
      E_STinsert(Eheads, e);
      (*Cont_Eq)++;
    }
  }

  (*Cont_Ln)++;
}

void Procura_Equipa(Elink *Eheads, uint *Cont_Ln)
{
  pEquipa ptrEquipa;
  char buffer[1023];
  for (int buffer_index = 0; buffer_index < 10; buffer_index++)
  {
    buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer[10 - 1] = '\0';
  ptrEquipa = E_STSearch(Eheads, buffer);
  if (!ptrEquipa)
  {
    printf("%u Equipa inexistente.\n", *Cont_Ln);
  }
  else
  {
    printf("%u %s %d\n", *Cont_Ln, ptrEquipa->nome, ptrEquipa->vit);
  }

  (*Cont_Ln)++;
}

void Remove_Jogo(Elink *Eheads, Jlink *Jheads, Q Todos_Jogos, uint *Cont_Ln)
{
  pJogo ptrJogo;
  char buffer[1023];
  for (int buffer_index = 0; buffer_index < 10; buffer_index++)
  {
    buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer[10 - 1] = '\0';
  ptrJogo = J_STSearch(Jheads, buffer);
  if (!ptrJogo)
  {
    printf("%u Jogo inexistente.\n", *Cont_Ln);
  }
  else
  {
    {
      uint score1 = ptrJogo->score1;
      uint score2 = ptrJogo->score2;
      if (score1 > score2)
      {
        {
          pEquipa e = E_STSearch(Eheads, ptrJogo->equipa1);
          e->vit--;
        }
      }
      else
      {
        if (score1 < score2)
        {
          {
            pEquipa e = E_STSearch(Eheads, ptrJogo->equipa2);
            e->vit--;
          }
        }
        else
        {
          
        }

      }

      J_STdelete(Jheads, Todos_Jogos, ptrJogo);
    }
  }

  (*Cont_Ln)++;
}

void Altera_Score(Elink *Eheads, Jlink *Jheads, uint *Cont_Ln)
{
  pJogo ptrJogo;
  char buffer[1023];
  uint new_sc1;
  uint new_sc2;
  for (int buffer_index = 0; buffer_index < 10; buffer_index++)
  {
    buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer[10 - 1] = '\0';
  new_sc1 = new_sym_var(sizeof(uint) * 8);
  new_sc2 = new_sym_var(sizeof(uint) * 8);
  ptrJogo = J_STSearch(Jheads, buffer);
  if (!ptrJogo)
  {
    printf("%u Jogo inexistente.\n", *Cont_Ln);
  }
  else
  {
    {
      uint ant_sc1 = ptrJogo->score1;
      uint ant_sc2 = ptrJogo->score2;
      pEquipa e1 = E_STSearch(Eheads, ptrJogo->equipa1);
      pEquipa e2 = E_STSearch(Eheads, ptrJogo->equipa2);
      if ((ant_sc1 > ant_sc2) && (new_sc1 == new_sc2))
      {
        e1->vit--;
      }
      else
      {
        if ((ant_sc1 < ant_sc2) && (new_sc1 == new_sc2))
        {
          e2->vit--;
        }
        else
        {
          if ((ant_sc1 == ant_sc2) && (new_sc1 > new_sc2))
          {
            e1->vit++;
          }
          else
          {
            if ((ant_sc1 == ant_sc2) && (new_sc1 < new_sc2))
            {
              e2->vit++;
            }
            else
            {
              if ((ant_sc1 > ant_sc2) && (new_sc1 < new_sc2))
              {
                {
                  e1->vit--;
                  e2->vit++;
                }
              }
              else
              {
                if ((ant_sc1 < ant_sc2) && (new_sc1 > new_sc2))
                {
                  {
                    e1->vit++;
                    e2->vit--;
                  }
                }
                else
                {
                  
                }

              }

            }

          }

        }

      }

      ptrJogo->score1 = new_sc1;
      ptrJogo->score2 = new_sc2;
    }
  }

  (*Cont_Ln)++;
}

void Mostra_Melhores_Equipas(Elink *Eheads, uint *Cont_Ln, uint Cont_Eq)
{
  if (Cont_Eq)
  {
    {
      int i;
      int m_vit = 0;
      int Lim_equipas = 0;
      char **equipas = (char **) malloc((sizeof(char *)) * Cont_Eq);
      for (i = 0; i < 1637; i++)
      {
        Elink ptr = Eheads[i];
        for (; ptr; ptr = ptr->next)
        {
          if (ptr->e->vit > m_vit)
          {
            m_vit = ptr->e->vit;
          }
          else
          {
            
          }

        }

      }

      for (i = 0; i < 1637; i++)
      {
        Elink ptr = Eheads[i];
        for (; ptr; ptr = ptr->next)
        {
          if (ptr->e->vit == m_vit)
          {
            {
              equipas[Lim_equipas] = (char *) malloc((sizeof(char)) * (strlen(ptr->e->nome) + 1));
              strcpy(equipas[Lim_equipas], ptr->e->nome);
              Lim_equipas++;
            }
          }
          else
          {
            
          }

        }

      }

      qsort(equipas, Lim_equipas, sizeof(char *), Compara_strcmp);
      printf("%u Melhores %u\n", *Cont_Ln, m_vit);
      for (i = 0; i < Lim_equipas; i++)
      {
        printf("%u * %s\n", *Cont_Ln, equipas[i]);
        free(equipas[i]);
      }

      free(equipas);
    }
  }
  else
  {
    
  }

  (*Cont_Ln)++;
}

void Limpa(Jlink *Jheads, Elink *Eheads, Q Todos_Jogos)
{
  Limpa_Jheads(Jheads);
  Limpa_Eheads(Eheads);
  Limpa_QUEUE(Todos_Jogos);
}

