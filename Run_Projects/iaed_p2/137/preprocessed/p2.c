/*File generated by PreProcessor.py*/


#include "includes.h"


void adicionaEquipa(TabEquipas *tab, int *nl);
void adicionaJogo(TabJogos *tabjogos, TabEquipas *tabeq, int *nl);
void procuraEquipa(TabEquipas *tab, int *nl);
void procuraJogo(TabJogos *tabjogos, int *nl);
void listaEquipas(TabEquipas *tabeq, int *nl);
void listaJogos(TabJogos *tabjogos, int *nl);
void alteraScore(TabJogos *tabjogos, TabEquipas *tabeq, int *nl);
void apagaJogo(TabJogos *tabjogos, TabEquipas *tabeq, int *nl);
int main()
{
  char c;
  int num_linha = 0;
  TabEquipas *tab_eq = novaTabEq();
  TabJogos *tab_j = novaTabJogos();
  while ((c = getchar()) != 'x')
  {
    switch (c)
    {
      case 'a':
        adicionaJogo(tab_j, tab_eq, &num_linha);
        break;

      case 'A':
        adicionaEquipa(tab_eq, &num_linha);
        break;

      case 'l':
        listaJogos(tab_j, &num_linha);
        break;

      case 'p':
        procuraJogo(tab_j, &num_linha);
        break;

      case 'P':
        procuraEquipa(tab_eq, &num_linha);
        break;

      case 'r':
        apagaJogo(tab_j, tab_eq, &num_linha);
        break;

      case 's':
        alteraScore(tab_j, tab_eq, &num_linha);
        break;

      case 'g':
        listaEquipas(tab_eq, &num_linha);
        break;

      default:
        break;

    }

    getchar();
  }

  destroiTabEq(tab_eq);
  destroiTabJogos(tab_j);
  return 0;
}

void adicionaEquipa(TabEquipas *tab, int *nl)
{
  Equipa *eq;
  char nome[1023];
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  (*nl)++;
  eq = procuraTabEq(tab, nome);
  if (eq)
  {
    printf("%d Equipa existente.\n", *nl);
  }
  else
  {
    pushTabEq(tab, novaEquipa(novastring(nome)));
  }

}

void adicionaJogo(TabJogos *tabjogos, TabEquipas *tabeq, int *nl)
{
  char nome[1023];
  char eq1[1023];
  char eq2[1023];
  int sc1;
  int sc2;
  Equipa *vencedor = 0;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  for (int eq1_index = 0; eq1_index < 10; eq1_index++)
  {
    eq1[eq1_index] = new_sym_var(sizeof(char) * 8);
  }

  eq1[10 - 1] = '\0';
  for (int eq2_index = 0; eq2_index < 10; eq2_index++)
  {
    eq2[eq2_index] = new_sym_var(sizeof(char) * 8);
  }

  eq2[10 - 1] = '\0';
  sc1 = new_sym_var(sizeof(int) * 8);
  sc2 = new_sym_var(sizeof(int) * 8);
  (*nl)++;
  if (procuraTabJogos(tabjogos, nome))
  {
    {
      printf("%d Jogo existente.\n", *nl);
      return;
    }
  }
  else
  {
    
  }

  if ((!procuraTabEq(tabeq, eq1)) || (!procuraTabEq(tabeq, eq2)))
  {
    {
      printf("%d Equipa inexistente.\n", *nl);
      return;
    }
  }
  else
  {
    
  }

  pushTabJogos(tabjogos, novoJogo(novastring(nome), novastring(eq1), novastring(eq2), sc1, sc2, *nl));
  if (sc1 > sc2)
  {
    vencedor = procuraTabEq(tabeq, eq1);
  }
  else
  {
    
  }

  if (sc1 < sc2)
  {
    vencedor = procuraTabEq(tabeq, eq2);
  }
  else
  {
    
  }

  if (vencedor)
  {
    vencedor->vitorias++;
  }
  else
  {
    
  }

}

void procuraEquipa(TabEquipas *tab, int *nl)
{
  char nome[1023];
  Equipa *e;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  (*nl)++;
  e = procuraTabEq(tab, nome);
  if (e)
  {
    printf("%d %s %d\n", *nl, e->nome, e->vitorias);
  }
  else
  {
    printf("%d Equipa inexistente.\n", *nl);
  }

}

void procuraJogo(TabJogos *tabjogos, int *nl)
{
  char nome[1023];
  Jogo *j;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  (*nl)++;
  j = procuraTabJogos(tabjogos, nome);
  if (j)
  {
    printf("%d %s %s %s %d %d\n", *nl, j->nome, j->equipa1, j->equipa2, j->score1, j->score2);
  }
  else
  {
    printf("%d Jogo inexistente.\n", *nl);
  }

}

void listaEquipas(TabEquipas *tabeq, int *nl)
{
  int i;
  Equipa *arr;
  (*nl)++;
  arr = copiaTabEq(tabeq);
  qsort(arr, tabeq->n_eqs, sizeof(Equipa), comparaEq);
  if (tabeq->n_eqs > 0)
  {
    printf("%d Melhores %d\n", *nl, arr[0].vitorias);
  }
  else
  {
    
  }

  for (i = 0; i < tabeq->n_eqs; i++)
    if (arr[i].vitorias != arr[0].vitorias)
  {
    break;
  }
  else
  {
    printf("%d * %s\n", *nl, arr[i].nome);
  }


  free(arr);
}

void listaJogos(TabJogos *tabjogos, int *nl)
{
  int i;
  Jogo *arr;
  (*nl)++;
  arr = copiaTabJogos(tabjogos);
  qsort(arr, tabjogos->n_jogos, sizeof(Jogo), comparaJogos);
  for (i = 0; i < tabjogos->n_jogos; i++)
    printf("%d %s %s %s %d %d\n", *nl, arr[i].nome, arr[i].equipa1, arr[i].equipa2, arr[i].score1, arr[i].score2);

  free(arr);
}

void alteraScore(TabJogos *tabjogos, TabEquipas *tabeq, int *nl)
{
  char nome[1023];
  int sc1;
  int sc2;
  int res_antes;
  int res_depois;
  Equipa *eq1;
  Equipa *eq2;
  Jogo *j;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  sc1 = new_sym_var(sizeof(int) * 8);
  sc2 = new_sym_var(sizeof(int) * 8);
  (*nl)++;
  j = procuraTabJogos(tabjogos, nome);
  if (!j)
  {
    {
      printf("%d Jogo inexistente.\n", *nl);
      return;
    }
  }
  else
  {
    
  }

  res_antes = (j->score1 == j->score2) ? (0) : ((j->score1 > j->score2) ? (1) : (-1));
  res_depois = (sc1 == sc2) ? (0) : ((sc1 > sc2) ? (1) : (-1));
  j->score1 = sc1;
  j->score2 = sc2;
  if (res_antes == res_depois)
  {
    return;
  }
  else
  {
    
  }

  eq1 = procuraTabEq(tabeq, j->equipa1);
  eq2 = procuraTabEq(tabeq, j->equipa2);
  if (res_antes == 1)
  {
    {
      eq1->vitorias--;
      if (res_depois == (-1))
      {
        eq2->vitorias++;
      }
      else
      {
        
      }

    }
  }
  else
  {
    if (res_antes == (-1))
    {
      {
        eq2->vitorias--;
        if (res_depois == 1)
        {
          eq1->vitorias++;
        }
        else
        {
          
        }

      }
    }
    else
    {
      if (res_depois == 1)
      {
        eq1->vitorias++;
      }
      else
      {
        if (res_depois == (-1))
        {
          eq2->vitorias++;
        }
        else
        {
          
        }

      }

    }

  }

}

void apagaJogo(TabJogos *tabjogos, TabEquipas *tabeq, int *nl)
{
  char nome[1023];
  Jogo *j;
  Equipa *eq;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  (*nl)++;
  j = procuraTabJogos(tabjogos, nome);
  if (!j)
  {
    {
      printf("%d Jogo inexistente.\n", *nl);
      return;
    }
  }
  else
  {
    
  }

  if ((j->score1 == j->score2) ? (0) : (((j->score1 > j->score2) ? (1) : (-1)) == 1))
  {
    {
      eq = procuraTabEq(tabeq, j->equipa1);
      eq->vitorias--;
    }
  }
  else
  {
    
  }

  if ((j->score1 == j->score2) ? (0) : (((j->score1 > j->score2) ? (1) : (-1)) == (-1)))
  {
    {
      eq = procuraTabEq(tabeq, j->equipa2);
      eq->vitorias--;
    }
  }
  else
  {
    
  }

  popTabJogos(tabjogos, nome);
}

