/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "funcoes.h"


int funcao_comparacao(const void *equipa1, const void *equipa2);
int obtem_resultado(int score1, int score2);
void free_hashequipas(linkeq *hash_equipas);
void free_listajogos(lista l);
void free_hash_jogos(item_hash_jg *hash_jogos);
void adiciona_jogo(item_hash_jg *hash_jogos, linkeq *hash_equipas, lista lista_jogos, int linha);
void lista_todos_jogos(lista lista_jogos, int linha);
void procura_jogo(item_hash_jg *hash_jogos, int linha);
void apaga_jogo(item_hash_jg *hash_jogos, linkeq *hash_equipas, lista lista, int linha);
void altera_score(item_hash_jg *hash_jogos, linkeq *hash_equipas, int linha);
void adiciona_equipa(linkeq *hash_equipas, int linha);
void procura_equipa(linkeq *hash_equipas, int linha);
void lista_melhores_equipas(linkeq *hash_equipas, int linha);
void adiciona_jogo(item_hash_jg *hash_jogos, linkeq *hash_equipas, lista lista_jogos, int linha)
{
  char nome[1023];
  char equipa1[1023];
  char equipa2[1023];
  int score1;
  int score2;
  jogo *novo_jogo;
  linkjg new;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  for (int equipa1_index = 0; equipa1_index < 10; equipa1_index++)
  {
    equipa1[equipa1_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa1[10 - 1] = '\0';
  for (int equipa2_index = 0; equipa2_index < 10; equipa2_index++)
  {
    equipa2[equipa2_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa2[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  if (encontra_jogo(hash_jogos, nome) != 0)
  {
    {
      printf("%d Jogo existente.\n", linha);
      return;
    }
  }
  else
  {
    
  }

  if ((encontra_equipa(hash_equipas, equipa1) == 0) || (encontra_equipa(hash_equipas, equipa2) == 0))
  {
    {
      printf("%d Equipa inexistente.\n", linha);
      return;
    }
  }
  else
  {
    
  }

  novo_jogo = (jogo *) malloc(sizeof(jogo));
  novo_jogo->nome = (char *) malloc((sizeof(char)) * (strlen(nome) + 1));
  strcpy(novo_jogo->nome, nome);
  novo_jogo->equipa1 = (char *) malloc((sizeof(char)) * (strlen(equipa1) + 1));
  strcpy(novo_jogo->equipa1, equipa1);
  novo_jogo->equipa2 = (char *) malloc((sizeof(char)) * (strlen(equipa2) + 1));
  strcpy(novo_jogo->equipa2, equipa2);
  novo_jogo->score1 = score1;
  novo_jogo->score2 = score2;
  if (score1 > score2)
  {
    encontra_equipa(hash_equipas, equipa1)->pequipa->vitorias++;
  }
  else
  {
    if (score2 > score1)
    {
      encontra_equipa(hash_equipas, equipa2)->pequipa->vitorias++;
    }
    else
    {
      
    }

  }

  new = add_lista(lista_jogos, novo_jogo);
  HashJogos_insere(hash_jogos, new);
}

void lista_todos_jogos(lista lista_jogos, int linha)
{
  linkjg aux = lista_jogos->head;
  while (aux != 0)
  {
    printf("%d %s %s %s %d %d\n", linha, aux->jogo->nome, aux->jogo->equipa1, aux->jogo->equipa2, aux->jogo->score1, aux->jogo->score2);
    aux = aux->next;
  }

}

void procura_jogo(item_hash_jg *hash_jogos, int linha)
{
  char nome[1023];
  item_hash_jg aux;
  jogo *jogo_procurado;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  aux = encontra_jogo(hash_jogos, nome);
  if (aux != 0)
  {
    {
      jogo_procurado = aux->pno->jogo;
      printf("%d %s %s %s %d %d\n", linha, jogo_procurado->nome, jogo_procurado->equipa1, jogo_procurado->equipa2, jogo_procurado->score1, jogo_procurado->score2);
    }
  }
  else
  {
    printf("%d Jogo inexistente.\n", linha);
  }

}

void apaga_jogo(item_hash_jg *hash_jogos, linkeq *hash_equipas, lista lista, int linha)
{
  char nome[1023];
  item_hash_jg aux;
  int key;
  int resultado_jogo;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  aux = encontra_jogo(hash_jogos, nome);
  key = hashfunc(nome);
  if (aux == 0)
  {
    {
      printf("%d Jogo inexistente.\n", linha);
      return;
    }
  }
  else
  {
    
  }

  resultado_jogo = obtem_resultado(aux->pno->jogo->score1, aux->pno->jogo->score2);
  if (resultado_jogo == 1)
  {
    encontra_equipa(hash_equipas, aux->pno->jogo->equipa1)->pequipa->vitorias--;
  }
  else
  {
    if (resultado_jogo == 2)
    {
      encontra_equipa(hash_equipas, aux->pno->jogo->equipa2)->pequipa->vitorias--;
    }
    else
    {
      
    }

  }

  if (aux->prev == 0)
  {
    {
      remove_lista(aux->pno, lista);
      if (aux->next != 0)
      {
        hash_jogos[key]->next->prev = 0;
      }
      else
      {
        
      }

      hash_jogos[key] = hash_jogos[key]->next;
    }
  }
  else
  {
    if (aux->next == 0)
    {
      {
        remove_lista(aux->pno, lista);
        aux->prev->next = 0;
      }
    }
    else
    {
      {
        remove_lista(aux->pno, lista);
        aux->prev->next = aux->next;
        aux->next->prev = aux->prev;
      }
    }

  }

  free(aux);
}

void altera_score(item_hash_jg *hash_jogos, linkeq *hash_equipas, int linha)
{
  char nome_jogo[1023];
  char equipa1[1023];
  char equipa2[1023];
  int score1;
  int score2;
  int resultado_antigo;
  int resultado_novo;
  item_hash_jg aux;
  for (int nome_jogo_index = 0; nome_jogo_index < 10; nome_jogo_index++)
  {
    nome_jogo[nome_jogo_index] = new_sym_var(sizeof(char) * 8);
  }

  nome_jogo[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  aux = encontra_jogo(hash_jogos, nome_jogo);
  if (aux == 0)
  {
    {
      printf("%d Jogo inexistente.\n", linha);
      return;
    }
  }
  else
  {
    
  }

  strcpy(equipa1, aux->pno->jogo->equipa1);
  strcpy(equipa2, aux->pno->jogo->equipa2);
  resultado_antigo = obtem_resultado(aux->pno->jogo->score1, aux->pno->jogo->score2);
  aux->pno->jogo->score1 = score1;
  aux->pno->jogo->score2 = score2;
  resultado_novo = obtem_resultado(score1, score2);
  if (resultado_antigo == 0)
  {
    {
      if (resultado_novo == 1)
      {
        encontra_equipa(hash_equipas, equipa1)->pequipa->vitorias++;
      }
      else
      {
        if (resultado_novo == 2)
        {
          encontra_equipa(hash_equipas, equipa2)->pequipa->vitorias++;
        }
        else
        {
          
        }

      }

    }
  }
  else
  {
    if (resultado_antigo == 1)
    {
      {
        if (resultado_novo == 2)
        {
          {
            encontra_equipa(hash_equipas, equipa2)->pequipa->vitorias++;
            encontra_equipa(hash_equipas, equipa1)->pequipa->vitorias--;
          }
        }
        else
        {
          
        }

        if (resultado_novo == 0)
        {
          encontra_equipa(hash_equipas, equipa1)->pequipa->vitorias--;
        }
        else
        {
          
        }

      }
    }
    else
    {
      {
        if (resultado_novo == 1)
        {
          {
            encontra_equipa(hash_equipas, equipa1)->pequipa->vitorias++;
            encontra_equipa(hash_equipas, equipa2)->pequipa->vitorias--;
          }
        }
        else
        {
          
        }

        if (resultado_novo == 0)
        {
          encontra_equipa(hash_equipas, equipa2)->pequipa->vitorias--;
        }
        else
        {
          
        }

      }
    }

  }

}

void adiciona_equipa(linkeq *hash_equipas, int linha)
{
  char nome[1023];
  int key;
  equipa *pequipa;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  key = hashfunc(nome);
  if (encontra_equipa(hash_equipas, nome) != 0)
  {
    {
      printf("%d Equipa existente.\n", linha);
      return;
    }
  }
  else
  {
    
  }

  pequipa = malloc(sizeof(equipa));
  pequipa->nome = (char *) malloc((sizeof(char)) * (strlen(nome) + 1));
  strcpy(pequipa->nome, nome);
  pequipa->vitorias = 0;
  HashEquipas_insere(hash_equipas, pequipa, key);
}

void procura_equipa(linkeq *hash_equipas, int linha)
{
  char nome[1023];
  linkeq aux;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  aux = encontra_equipa(hash_equipas, nome);
  if (aux != 0)
  {
    {
      printf("%d %s %d\n", linha, nome, aux->pequipa->vitorias);
      return;
    }
  }
  else
  {
    printf("%d Equipa inexistente.\n", linha);
  }

}

void lista_melhores_equipas(linkeq *hash_equipas, int linha)
{
  int i;
  int max_vitorias = 0;
  int tamanho_lista = 0;
  linkeq aux;
  equipa **l = malloc(sizeof(equipa *));
  l[0] = 0;
  for (i = 0; i < 1091; i++)
  {
    aux = hash_equipas[i];
    while (aux != 0)
    {
      if (aux->pequipa->vitorias > max_vitorias)
      {
        {
          max_vitorias = aux->pequipa->vitorias;
          tamanho_lista = 1;
          l = realloc(l, sizeof(equipa *));
          l[0] = aux->pequipa;
        }
      }
      else
      {
        if (aux->pequipa->vitorias == max_vitorias)
        {
          {
            tamanho_lista++;
            l = realloc(l, tamanho_lista * (sizeof(equipa *)));
            l[tamanho_lista - 1] = aux->pequipa;
          }
        }
        else
        {
          
        }

      }

      aux = aux->next;
    }

  }

  if (l[0] == 0)
  {
    {
      free(l);
      return;
    }
  }
  else
  {
    
  }

  qsort(l, tamanho_lista, sizeof(equipa *), funcao_comparacao);
  printf("%d Melhores %d\n", linha, max_vitorias);
  for (i = 0; i < tamanho_lista; i++)
  {
    printf("%d * %s\n", linha, l[i]->nome);
  }

  free(l);
}

int funcao_comparacao(const void *equipa1, const void *equipa2)
{
  const char *nome1 = (*((equipa **) equipa1))->nome;
  const char *nome2 = (*((equipa **) equipa2))->nome;
  return strcmp(nome1, nome2);
}

int obtem_resultado(int score1, int score2)
{
  int resultado;
  if (score1 > score2)
  {
    resultado = 1;
  }
  else
  {
    if (score2 > score1)
    {
      resultado = 2;
    }
    else
    {
      resultado = 0;
    }

  }

  return resultado;
}

void free_hashequipas(linkeq *hash_equipas)
{
  int i;
  linkeq next;
  for (i = 0; i < 1091; i++)
  {
    while (hash_equipas[i] != 0)
    {
      next = hash_equipas[i]->next;
      free(hash_equipas[i]->pequipa->nome);
      free(hash_equipas[i]->pequipa);
      free(hash_equipas[i]);
      hash_equipas[i] = next;
    }

  }

  free(hash_equipas);
}

void free_listajogos(lista l)
{
  linkjg next;
  while (l->head != 0)
  {
    next = l->head->next;
    free(l->head->jogo->nome);
    free(l->head->jogo->equipa1);
    free(l->head->jogo->equipa2);
    free(l->head->jogo);
    free(l->head);
    l->head = next;
  }

  free(l);
}

void free_hash_jogos(item_hash_jg *hash_jogos)
{
  int i;
  item_hash_jg next;
  for (i = 0; i < 1091; i++)
  {
    while (hash_jogos[i] != 0)
    {
      next = hash_jogos[i]->next;
      free(hash_jogos[i]);
      hash_jogos[i] = next;
    }

  }

  free(hash_jogos);
}

