/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "linkedlist.h"
#include "hashtable.h"
#include "strdup.h"


node *AddGameLL(node *head, char *name, char *team1, char *team2, int score1, int score2);
p_game *AddGameHT(p_game *p, char *name, char *team1, char *team2, int score1, int score2, int N, int M);
p_team *AddTeamHT(p_team *t, char *team, int N, int M);
void ListsGames(node *head, int NL);
void SearchesGame(p_game *games, int M, int NL);
void SearchesTeam(p_team *t, int M, int NL);
int ChecksNameGame(p_game *p, char *name, int NL, int M);
int ChangesScore(p_team *teams, int score1, int score2, int M_T, char *name, p_game game_test);
void ListsWinningTeams(p_team *t, int M, int NL);
p_game ObtainsGame();
int ChecksGame(int M1, int M2, char *name, char *team1, char *team2, p_team *t, p_game *p, int NL);
int ChecksTeam(p_team *t, char *team, int NL, int M);
int ObtainsArguments(p_game *p, char *name, int M, int NL);
int StringCompare(const void *A, const void *B);
int main()
{
  char command;
  char string1[1024];
  char string2[1024];
  char name[1024];
  char team1[1024];
  char team2[1024];
  int NL = 1;
  int M_G = 100000;
  int M_T = 100000;
  int output = 0;
  int El_G = 0;
  int El_T = 0;
  int score1i;
  int score2i;
  node *head = 0;
  p_game game_test;
  p_game *game_test_p;
  p_game *games = Init(M_G);
  p_team *team_test_p;
  p_team *teams = Init_T(M_T);
  do
  {
    command = new_sym_var(sizeof(char) * 8);
    switch (command)
    {
      case 'a':
        for (int name_index = 0; name_index < 10; name_index++)
      {
        name[name_index] = new_sym_var(sizeof(char) * 8);
      }

        name[10 - 1] = '\0';
        for (int team1_index = 0; team1_index < 10; team1_index++)
      {
        team1[team1_index] = new_sym_var(sizeof(char) * 8);
      }

        team1[10 - 1] = '\0';
        for (int team2_index = 0; team2_index < 10; team2_index++)
      {
        team2[team2_index] = new_sym_var(sizeof(char) * 8);
      }

        team2[10 - 1] = '\0';
        score1i = new_sym_var(sizeof(int) * 8);
        score2i = new_sym_var(sizeof(int) * 8);
        if (ChecksGame(M_G, M_T, name, team1, team2, teams, games, NL) == 1)
      {
        {
          head = AddGameLL(head, name, team1, team2, score1i, score2i);
          if ((game_test_p = AddGameHT(games, name, team1, team2, score1i, score2i, El_G, M_G)) == 0)
          {
            {
              games = Expand(games, El_G, M_G);
              M_G = M_G + M_G;
              games = AddGameHT(games, name, team1, team2, score1i, score2i, El_G, M_G);
            }
          }
          else
          {
            {
              games = game_test_p;
            }
          }

          if (score1i > score2i)
          {
            {
              Search_T(teams, team1, M_T)->wins++;
            }
          }
          else
          {
            if (score1i < score2i)
            {
              {
                Search_T(teams, team2, M_T)->wins++;
              }
            }
            else
            {
              
            }

          }

          El_G++;
        }
      }
      else
      {
        
      }

        NL++;
        break;

      case 'A':
        for (int string1_index = 0; string1_index < 10; string1_index++)
      {
        string1[string1_index] = new_sym_var(sizeof(char) * 8);
      }

        string1[10 - 1] = '\0';
        if (ChecksTeam(teams, string1, NL, M_T) == 1)
      {
        {
          if ((team_test_p = AddTeamHT(teams, string1, El_T, M_T)) == 0)
          {
            {
              teams = Expand_T(teams, El_T, M_T);
              M_T = M_T + M_T;
              teams = AddTeamHT(teams, string1, El_T, M_T);
            }
          }
          else
          {
            
          }

          El_T++;
        }
      }
      else
      {
        
      }

        NL++;
        break;

      case 'l':
        ListsGames(head, NL);
        NL++;
        break;

      case 'p':
        SearchesGame(games, M_G, NL);
        NL++;
        break;

      case 'P':
        SearchesTeam(teams, M_T, NL);
        NL++;
        break;

      case 'r':
        for (int string2_index = 0; string2_index < 10; string2_index++)
      {
        string2[string2_index] = new_sym_var(sizeof(char) * 8);
      }

        string2[10 - 1] = '\0';
        if (ChecksNameGame(games, string2, NL, M_G) == 1)
      {
        {
          if (Search(games, string2, M_G)->score1 > Search(games, string2, M_G)->score2)
          {
            {
              --Search_T(teams, Search(games, string2, M_G)->team1, M_G)->wins;
            }
          }
          else
          {
            if (Search(games, string2, M_G)->score1 < Search(games, string2, M_G)->score2)
            {
              {
                --Search_T(teams, Search(games, string2, M_G)->team2, M_G)->wins;
              }
            }
            else
            {
              
            }

          }

          head = ListDelete(head, string2);
          games = HTRemoveElement(games, string2, El_G, M_G);
          El_G--;
        }
      }
      else
      {
        
      }

        NL++;
        break;

      case 's':
        for (int string1_index = 0; string1_index < 10; string1_index++)
      {
        string1[string1_index] = new_sym_var(sizeof(char) * 8);
      }

        string1[10 - 1] = '\0';
        score1i = new_sym_var(sizeof(int) * 8);
        score2i = new_sym_var(sizeof(int) * 8);
        if (ObtainsArguments(games, string1, M_G, NL) == 1)
      {
        {
          game_test = Search(games, string1, M_G);
          Search_T(teams, game_test->team1, M_G)->wins = ChangesScore(teams, score1i, score2i, M_T, game_test->team1, game_test);
          Search_T(teams, game_test->team2, M_G)->wins = ChangesScore(teams, score1i, score2i, M_T, game_test->team2, game_test);
          Search(games, game_test->name, M_G)->score1 = score1i;
          Search(games, game_test->name, M_G)->score2 = score2i;
          SearchLL(head, game_test->name)->score1 = score1i;
          SearchLL(head, game_test->name)->score2 = score2i;
        }
      }
      else
      {
        
      }

        NL++;
        break;

      case 'g':
        ListsWinningTeams(teams, M_T, NL);
        NL++;
        break;

      case 'x':
        output = 1;
        break;

      default:
        break;

    }

  }
  while (output != 1);
  head = DestroyList(head);
  games = FreeAllHT(games, M_G);
  teams = FreeAllHT_T(teams, M_T);
  free(head);
  free(games);
  free(teams);
  return 0;
}

node *AddGameLL(node *head, char *name, char *team1, char *team2, int score1, int score2)
{
  node *new_head;
  new_head = AddElement(head, name, team1, team2, score1, score2);
  return new_head;
}

p_game *AddGameHT(p_game *p, char *name, char *team1, char *team2, int score1, int score2, int N, int M)
{
  p_game *new_game;
  new_game = HTInsertElement(p, name, team1, team2, score1, score2, N, M);
  return new_game;
}

p_team *AddTeamHT(p_team *t, char *team, int N, int M)
{
  p_team *new_team;
  new_team = HTInsertElement_T(t, team, 0, N, M);
  return new_team;
}

void ListsGames(node *head, int NL)
{
  if (head == 0)
  {
    {
      return;
    }
  }
  else
  {
    
  }

  ListsGames(head->next, NL);
  printf("%d %s %s %s %d %d\n", NL, head->name, head->team1, head->team2, head->score1, head->score2);
}

void SearchesGame(p_game *games, int M, int NL)
{
  char name[1024];
  p_game game;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  game = Search(games, name, M);
  if (game != 0)
  {
    {
      printf("%d %s %s %s %d %d\n", NL, game->name, game->team1, game->team2, game->score1, game->score2);
    }
  }
  else
  {
    {
      printf("%d Jogo inexistente.\n", NL);
    }
  }

}

void SearchesTeam(p_team *t, int M, int NL)
{
  char name[1024];
  p_team team;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  team = Search_T(t, name, M);
  if (team != 0)
  {
    {
      printf("%d %s %d\n", NL, team->name, team->wins);
    }
  }
  else
  {
    {
      printf("%d Equipa inexistente.\n", NL);
    }
  }

}

int ChecksNameGame(p_game *p, char *name, int NL, int M)
{
  p_game game_aux;
  if ((game_aux = Search(p, name, M)) == 0)
  {
    {
      printf("%d Jogo inexistente.\n", NL);
      return 0;
    }
  }
  else
  {
    
  }

  return 1;
}

int ChangesScore(p_team *teams, int score1, int score2, int M_T, char *name, p_game game_test)
{
  int final_value;
  if (game_test->score1 > game_test->score2)
  {
    {
      if (score1 < score2)
      {
        {
          if (strcmp(name, game_test->team1) == 0)
          {
            {
              final_value = Search_T(teams, game_test->team1, M_T)->wins - 1;
              return final_value;
            }
          }
          else
          {
            {
              final_value = Search_T(teams, game_test->team2, M_T)->wins + 1;
              return final_value;
            }
          }

        }
      }
      else
      {
        if (score1 == score2)
        {
          {
            if (strcmp(name, game_test->team1) == 0)
            {
              {
                final_value = Search_T(teams, game_test->team1, M_T)->wins - 1;
                return final_value;
              }
            }
            else
            {
              {
                final_value = Search_T(teams, game_test->team2, M_T)->wins;
                return final_value;
              }
            }

          }
        }
        else
        {
          {
            if (strcmp(name, game_test->team1) == 0)
            {
              {
                final_value = Search_T(teams, game_test->team1, M_T)->wins;
                return final_value;
              }
            }
            else
            {
              {
                final_value = Search_T(teams, game_test->team2, M_T)->wins;
                return final_value;
              }
            }

          }
        }

      }

    }
  }
  else
  {
    if (game_test->score1 < game_test->score2)
    {
      {
        if (score1 > score2)
        {
          {
            if (strcmp(name, game_test->team1) == 0)
            {
              {
                final_value = Search_T(teams, game_test->team1, M_T)->wins + 1;
                return final_value;
              }
            }
            else
            {
              {
                final_value = Search_T(teams, game_test->team2, M_T)->wins - 1;
                return final_value;
              }
            }

          }
        }
        else
        {
          if (score1 == score2)
          {
            {
              if (strcmp(name, game_test->team1) == 0)
              {
                {
                  final_value = Search_T(teams, game_test->team1, M_T)->wins;
                  return final_value;
                }
              }
              else
              {
                {
                  final_value = Search_T(teams, game_test->team2, M_T)->wins - 1;
                  return final_value;
                }
              }

            }
          }
          else
          {
            {
              if (strcmp(name, game_test->team1) == 0)
              {
                {
                  final_value = Search_T(teams, game_test->team1, M_T)->wins;
                  return final_value;
                }
              }
              else
              {
                {
                  final_value = Search_T(teams, game_test->team2, M_T)->wins;
                  return final_value;
                }
              }

            }
          }

        }

      }
    }
    else
    {
      {
        if (score1 > score2)
        {
          {
            if (strcmp(name, game_test->team1) == 0)
            {
              {
                final_value = Search_T(teams, game_test->team1, M_T)->wins + 1;
                return final_value;
              }
            }
            else
            {
              {
                final_value = Search_T(teams, game_test->team2, M_T)->wins;
                return final_value;
              }
            }

          }
        }
        else
        {
          if (score1 < score2)
          {
            {
              if (strcmp(name, game_test->team1) == 0)
              {
                {
                  final_value = Search_T(teams, game_test->team1, M_T)->wins;
                  return final_value;
                }
              }
              else
              {
                {
                  final_value = Search_T(teams, game_test->team2, M_T)->wins + 1;
                  return final_value;
                }
              }

            }
          }
          else
          {
            {
              if (strcmp(name, game_test->team1) == 0)
              {
                {
                  final_value = Search_T(teams, game_test->team1, M_T)->wins;
                  return final_value;
                }
              }
              else
              {
                {
                  final_value = Search_T(teams, game_test->team2, M_T)->wins;
                  return final_value;
                }
              }

            }
          }

        }

      }
    }

  }

  return 0;
}

void ListsWinningTeams(p_team *t, int M, int NL)
{
  int i;
  int j = 0;
  int max = -1;
  char *vector[1024];
  for (i = 0; i < M; i++)
  {
    if ((t[i] != 0) && (t[i]->wins > max))
    {
      {
        max = t[i]->wins;
      }
    }
    else
    {
      
    }

  }

  if (max == (-1))
  {
    {
      return;
    }
  }
  else
  {
    
  }

  for (i = 0; i < M; i++)
  {
    if ((t[i] != 0) && (t[i]->wins == max))
    {
      {
        vector[j] = d_strdup(t[i]->name);
        j++;
      }
    }
    else
    {
      
    }

  }

  qsort(vector, j, sizeof(char *), StringCompare);
  printf("%d Melhores %d\n", NL, max);
  for (i = 0; i < j; i++)
  {
    printf("%d * %s\n", NL, vector[i]);
    free(vector[i]);
  }

  return;
}

int ChecksGame(int M1, int M2, char *name, char *team1, char *team2, p_team *t, p_game *p, int NL)
{
  if (Search(p, name, M1) != 0)
  {
    {
      printf("%d Jogo existente.\n", NL);
      return 0;
    }
  }
  else
  {
    if (Search_T(t, team1, M2) == 0)
    {
      {
        printf("%d Equipa inexistente.\n", NL);
        return 0;
      }
    }
    else
    {
      if (Search_T(t, team2, M2) == 0)
      {
        {
          printf("%d Equipa inexistente.\n", NL);
          return 0;
        }
      }
      else
      {
        
      }

    }

  }

  return 1;
}

int ChecksTeam(p_team *t, char *team, int NL, int M)
{
  if (Search_T(t, team, M) != 0)
  {
    {
      printf("%d Equipa existente.\n", NL);
      return 0;
    }
  }
  else
  {
    
  }

  return 1;
}

int ObtainsArguments(p_game *p, char *name, int M, int NL)
{
  if (Search(p, name, M) != 0)
  {
    {
      return 1;
    }
  }
  else
  {
    {
      printf("%d Jogo inexistente.\n", NL);
      return 0;
    }
  }

}

int StringCompare(const void *A, const void *B)
{
  char **s_1;
  char **s_2;
  s_1 = (char **) A;
  s_2 = (char **) B;
  return strcmp(*s_1, *s_2);
}

