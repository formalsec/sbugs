/*File generated by PreProcessor.py*/


#include "commands.h"
#include "items.h"


int num_ln = 0;
void incrementa_linha()
{
  num_ln++;
}

int jgs_ins = 0;
linkJogo *heads_jogos = 0;
linkEquipa *heads_equipas = 0;
int hash_eq(char *str)
{
  int h = 0;
  int a = 127;
  for (; (*str) != '\0'; str++)
    h = ((a * h) + (*str)) % 20261;

  return h;
}

int hash_jg(char *str)
{
  int h = 0;
  int a = 127;
  for (; (*str) != '\0'; str++)
    h = ((a * h) + (*str)) % 41603;

  return h;
}

void inicializar_hash_equipas()
{
  int i;
  heads_equipas = (linkEquipa *) malloc(20261 * (sizeof(linkEquipa)));
  for (i = 0; i < 20261; i++)
    heads_equipas[i] = 0;

}

void inicializar_hash_jogos()
{
  int i;
  heads_jogos = (linkJogo *) malloc(41603 * (sizeof(linkJogo)));
  for (i = 0; i < 41603; i++)
    heads_jogos[i] = 0;

}

void liberta_memoria()
{
  int i;
  linkJogo j;
  linkJogo j_aux;
  linkEquipa e;
  linkEquipa e_aux;
  for (i = 0; i < 41603; i++)
  {
    if ((heads_jogos != 0) && (heads_jogos[i] != 0))
    {
      {
        for (j = heads_jogos[i]; j != 0;)
        {
          heads_jogos[i] = j->next;
          if (j != 0)
          {
            {
              j_aux = j;
              j = j->next;
              liberta_mem_jogo(j_aux);
            }
          }
          else
          {
            
          }

        }

      }
    }
    else
    {
      
    }

  }

  for (i = 0; i < 20261; i++)
  {
    if ((heads_equipas != 0) && (heads_equipas[i] != 0))
    {
      {
        for (e = heads_equipas[i]; e != 0;)
        {
          heads_equipas[i] = e->next;
          if (e != 0)
          {
            {
              e_aux = e;
              e = e->next;
              liberta_mem_equipa(e_aux);
            }
          }
          else
          {
            
          }

        }

      }
    }
    else
    {
      
    }

  }

}

void adiciona_novo_jogo(char *nome, char *eq1, char *eq2, int s1, int s2)
{
  int cdg;
  int cdg_eq1;
  int cdg_eq2;
  cdg = hash_jg(nome);
  cdg_eq1 = hash_eq(eq1);
  cdg_eq2 = hash_eq(eq2);
  incrementa_linha();
  if ((heads_jogos != 0) && (procura_jogo_item(heads_jogos[cdg], nome) != 0))
  {
    printf("%d Jogo existente.\n", num_ln);
  }
  else
  {
    if (((heads_equipas == 0) || (procura_equipa_item(heads_equipas[cdg_eq1], eq1) == 0)) || (procura_equipa_item(heads_equipas[cdg_eq2], eq2) == 0))
    {
      printf("%d Equipa inexistente.\n", num_ln);
    }
    else
    {
      {
        if (heads_jogos == 0)
        {
          inicializar_hash_jogos();
        }
        else
        {
          
        }

        heads_jogos[cdg] = coloca_jogo(heads_jogos[cdg], nome, eq1, eq2, s1, s2);
        altera_vitorias_equipa(eq1, eq2, s1, s2, 1);
        heads_jogos[cdg]->ord = jgs_ins;
        jgs_ins++;
      }
    }

  }

}

void adiciona_nova_equipa(char *nome)
{
  int cdg = hash_eq(nome);
  incrementa_linha();
  if (heads_equipas == 0)
  {
    inicializar_hash_equipas();
  }
  else
  {
    
  }

  if (procura_equipa_item(heads_equipas[cdg], nome) != 0)
  {
    printf("%d Equipa existente.\n", num_ln);
  }
  else
  {
    {
      heads_equipas[cdg] = coloca_equipa(heads_equipas[cdg], nome);
    }
  }

}

void lista_jogos()
{
  int i;
  incrementa_linha();
  if (heads_jogos != 0)
  {
    {
      for (i = 0; i < jgs_ins; i++)
      {
        print_jogo(i);
      }

    }
  }
  else
  {
    
  }

}

void procura_jogo(char *nome)
{
  int cdg = hash_jg(nome);
  linkJogo jg;
  incrementa_linha();
  if (heads_jogos == 0)
  {
    {
      printf("%d Jogo inexistente.\n", num_ln);
    }
  }
  else
  {
    {
      jg = procura_jogo_item(heads_jogos[cdg], nome);
      if (jg == 0)
      {
        printf("%d Jogo inexistente.\n", num_ln);
      }
      else
      {
        printf("%d %s %s %s %d %d\n", num_ln, jg->nome, jg->eq1, jg->eq2, jg->s1, jg->s2);
      }

    }
  }

}

void procura_equipa(char *nome)
{
  int cdg = hash_eq(nome);
  linkEquipa equipa;
  incrementa_linha();
  if (heads_equipas == 0)
  {
    {
      printf("%d Equipa inexistente.\n", num_ln);
    }
  }
  else
  {
    {
      equipa = procura_equipa_item(heads_equipas[cdg], nome);
      if (equipa == 0)
      {
        printf("%d Equipa inexistente.\n", num_ln);
      }
      else
      {
        printf("%d %s %d\n", num_ln, equipa->nome, equipa->vitorias);
      }

    }
  }

}

void apaga_jogo(char *nome)
{
  int cdg = hash_jg(nome);
  linkJogo jg;
  incrementa_linha();
  if ((heads_jogos == 0) || (procura_jogo_item(heads_jogos[cdg], nome) == 0))
  {
    printf("%d Jogo inexistente.\n", num_ln);
  }
  else
  {
    {
      jg = procura_jogo_item(heads_jogos[cdg], nome);
      altera_vitorias_equipa(jg->eq1, jg->eq2, jg->s1, jg->s2, 0);
      heads_jogos[cdg] = remove_jogo(heads_jogos[cdg], nome);
    }
  }

}

void altera_score(char *nome, int s1, int s2)
{
  linkJogo jg;
  int cdg = hash_jg(nome);
  incrementa_linha();
  if ((heads_jogos == 0) || (procura_jogo_item(heads_jogos[cdg], nome) == 0))
  {
    printf("%d Jogo inexistente.\n", num_ln);
  }
  else
  {
    {
      jg = procura_jogo_item(heads_jogos[cdg], nome);
      altera_vitorias_equipa(jg->eq1, jg->eq2, jg->s1, jg->s2, 0);
      altera_vitorias_equipa(jg->eq1, jg->eq2, s1, s2, 1);
      jg->s1 = s1;
      jg->s2 = s2;
    }
  }

}

void lista_vencedores()
{
  linkEquipa e;
  char *equipas_vencedoras[20261];
  int i;
  int num_eq = 0;
  unsigned int max_vit = 0;
  incrementa_linha();
  if (heads_equipas != 0)
  {
    {
      for (i = 0; i < 20261; i++)
      {
        if (heads_equipas != 0)
        {
          {
            for (e = heads_equipas[i]; e != 0; e = e->next)
            {
              if (e->vitorias > max_vit)
              {
                max_vit = e->vitorias;
              }
              else
              {
                
              }

            }

          }
        }
        else
        {
          
        }

      }

      printf("%d Melhores %d\n", num_ln, max_vit);
      for (i = 0; i < 20261; i++)
      {
        if (heads_equipas != 0)
        {
          {
            for (e = heads_equipas[i]; e != 0; e = e->next)
            {
              if (e->vitorias == max_vit)
              {
                {
                  equipas_vencedoras[num_eq] = e->nome;
                  num_eq++;
                }
              }
              else
              {
                
              }

            }

          }
        }
        else
        {
          
        }

      }

      qsort(equipas_vencedoras, num_eq, sizeof(char *), cstrcmp);
      for (i = 0; i < num_eq; i++)
        printf("%d * %s\n", num_ln, equipas_vencedoras[i]);

    }
  }
  else
  {
    
  }

}

int cstrcmp(const void *str1, const void *str2)
{
  const char **resa = (const char **) str1;
  const char **resb = (const char **) str2;
  return strcmp(*resa, *resb);
}

void print_jogo(int ord)
{
  int i;
  linkJogo jg;
  for (i = 0; i < 41603; i++)
  {
    if (heads_jogos[i] != 0)
    {
      {
        for (jg = heads_jogos[i]; jg != 0; jg = jg->next)
        {
          if (jg->ord == ord)
          {
            {
              printf("%d %s %s %s %d %d\n", num_ln, jg->nome, jg->eq1, jg->eq2, jg->s1, jg->s2);
              return;
            }
          }
          else
          {
            
          }

        }

      }
    }
    else
    {
      
    }

  }

}

void altera_vitorias_equipa(char *eq1, char *eq2, int s1, int s2, int est)
{
  int cdg_venc = -1;
  linkEquipa vencedor;
  if (s1 > s2)
  {
    {
      cdg_venc = hash_eq(eq1);
      vencedor = procura_equipa_item(heads_equipas[cdg_venc], eq1);
    }
  }
  else
  {
    if (s1 < s2)
    {
      {
        cdg_venc = hash_eq(eq2);
        vencedor = procura_equipa_item(heads_equipas[cdg_venc], eq2);
      }
    }
    else
    {
      
    }

  }

  if (cdg_venc != (-1))
  {
    {
      if (est)
      {
        vencedor->vitorias++;
      }
      else
      {
        vencedor->vitorias--;
      }

    }
  }
  else
  {
    
  }

}

