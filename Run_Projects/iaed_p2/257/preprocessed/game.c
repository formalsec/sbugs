/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h> 
#include "game.h"
#include "hash_table.h"


Game_list *__a__(int nl, Game_node **head_game, Team_node **head_team, Game_list *game_list, int *max_victories)
{
  Game new_game;
  char aux[1024];
  char c;
  Team_node *team1;
  Team_node *team2;
  for (int aux_index = 0; aux_index < 10; aux_index++)
  {
    aux[aux_index] = new_sym_var(sizeof(char) * 8);
  }

  aux[10 - 1] = '\0';
  if (search_game(aux, head_game) != 0)
  {
    {
      printf("%d Jogo existente.\n", nl);
      while ((c = getchar()) != '\n')
        ;

      return game_list;
    }
  }
  else
  {
    
  }

  new_game.name = malloc((sizeof(char)) * (strlen(aux) + 1));
  strcpy(new_game.name, aux);
  for (int aux_index = 0; aux_index < 10; aux_index++)
  {
    aux[aux_index] = new_sym_var(sizeof(char) * 8);
  }

  aux[10 - 1] = '\0';
  if ((team1 = search_team(aux, head_team)) == 0)
  {
    {
      printf("%d Equipa inexistente.\n", nl);
      free(new_game.name);
      while ((c = getchar()) != '\n')
        ;

      return game_list;
    }
  }
  else
  {
    
  }

  new_game.team1 = team1;
  for (int aux_index = 0; aux_index < 10; aux_index++)
  {
    aux[aux_index] = new_sym_var(sizeof(char) * 8);
  }

  aux[10 - 1] = '\0';
  new_game.score[0] = new_sym_var(sizeof(int) * 8);
  new_game.score[1] = new_sym_var(sizeof(int) * 8);
  if ((team2 = search_team(aux, head_team)) == 0)
  {
    {
      printf("%d Equipa inexistente.\n", nl);
      free(new_game.name);
      return game_list;
    }
  }
  else
  {
    
  }

  new_game.team2 = team2;
  if (new_game.score[0] < new_game.score[1])
  {
    {
      increase_vic(team2, max_victories);
      new_game.winner = 2;
    }
  }
  else
  {
    if (new_game.score[0] > new_game.score[1])
    {
      {
        increase_vic(team1, max_victories);
        new_game.winner = 1;
      }
    }
    else
    {
      new_game.winner = 0;
    }

  }

  return insert_game_list(insert_game_table(new_game, head_game), game_list);
}

Game_list *__r__(int nl, Game_node **head_game, Game_list *game_list, Team_list_node *team_list, int *max_victories)
{
  char aux[1024];
  Game_node *game;
  for (int aux_index = 0; aux_index < 10; aux_index++)
  {
    aux[aux_index] = new_sym_var(sizeof(char) * 8);
  }

  aux[10 - 1] = '\0';
  if (search_game(aux, head_game) == 0)
  {
    {
      printf("%d Jogo inexistente.\n", nl);
      return game_list;
    }
  }
  else
  {
    
  }

  game = search_game(aux, head_game);
  if (game->g.winner == 1)
  {
    decrease_vic(game->g.team1, max_victories, team_list);
  }
  else
  {
    if (game->g.winner == 2)
    {
      decrease_vic(game->g.team2, max_victories, team_list);
    }
    else
    {
      
    }

  }

  game_list = delete_game_list(aux, game_list, head_game);
  delete_game_table(aux, head_game);
  return game_list;
}

void __s__(int nl, Game_node **head_game, Team_list_node *team_list, int *max_victories)
{
  char aux[1024];
  char c;
  Game_node *game_to_change;
  for (int aux_index = 0; aux_index < 10; aux_index++)
  {
    aux[aux_index] = new_sym_var(sizeof(char) * 8);
  }

  aux[10 - 1] = '\0';
  if ((game_to_change = search_game(aux, head_game)) == 0)
  {
    {
      printf("%d Jogo inexistente.\n", nl);
      while ((c = getchar()) != '\n')
        ;

      return;
    }
  }
  else
  {
    
  }

  game_to_change->g.score[0] = new_sym_var(sizeof(int) * 8);
  game_to_change->g.score[1] = new_sym_var(sizeof(int) * 8);
  if (game_to_change->g.winner == 1)
  {
    {
      if (game_to_change->g.score[0] < game_to_change->g.score[1])
      {
        {
          game_to_change->g.winner = 2;
          increase_vic(game_to_change->g.team2, max_victories);
          decrease_vic(game_to_change->g.team1, max_victories, team_list);
        }
      }
      else
      {
        if (game_to_change->g.score[0] == game_to_change->g.score[1])
        {
          {
            game_to_change->g.winner = 0;
            decrease_vic(game_to_change->g.team1, max_victories, team_list);
          }
        }
        else
        {
          
        }

      }

    }
  }
  else
  {
    if (game_to_change->g.winner == 2)
    {
      {
        if (game_to_change->g.score[0] > game_to_change->g.score[1])
        {
          {
            game_to_change->g.winner = 1;
            increase_vic(game_to_change->g.team1, max_victories);
            decrease_vic(game_to_change->g.team2, max_victories, team_list);
          }
        }
        else
        {
          if (game_to_change->g.score[0] == game_to_change->g.score[1])
          {
            {
              game_to_change->g.winner = 0;
              decrease_vic(game_to_change->g.team2, max_victories, team_list);
            }
          }
          else
          {
            
          }

        }

      }
    }
    else
    {
      {
        if (game_to_change->g.score[0] > game_to_change->g.score[1])
        {
          {
            game_to_change->g.winner = 1;
            increase_vic(game_to_change->g.team1, max_victories);
          }
        }
        else
        {
          if (game_to_change->g.score[0] < game_to_change->g.score[1])
          {
            {
              game_to_change->g.winner = 2;
              increase_vic(game_to_change->g.team2, max_victories);
            }
          }
          else
          {
            
          }

        }

      }
    }

  }

}

void __p__(int nl, Game_node **head)
{
  char aux[1024];
  Game_node *node;
  for (int aux_index = 0; aux_index < 10; aux_index++)
  {
    aux[aux_index] = new_sym_var(sizeof(char) * 8);
  }

  aux[10 - 1] = '\0';
  if ((node = search_game(aux, head)) == 0)
  {
    printf("%d Jogo inexistente.\n", nl);
  }
  else
  {
    printf("%d %s %s %s %d %d\n", nl, node->g.name, node->g.team1->t.name, node->g.team2->t.name, node->g.score[0], node->g.score[1]);
  }

}

void __l__(int nl, Game_list *game_list)
{
  Game_list_node *aux;
  if (game_list->last == 0)
  {
    return;
  }
  else
  {
    
  }

  for (aux = game_list->last; aux != 0; aux = aux->next)
  {
    printf("%d %s %s %s %d %d\n", nl, aux->g->g.name, aux->g->g.team1->t.name, aux->g->g.team2->t.name, aux->g->g.score[0], aux->g->g.score[1]);
  }

}

void increase_vic(Team_node *team, int *max_victories)
{
  int i;
  if ((i = (team->t.victories++) + 1) == max_victories[0])
  {
    max_victories[1]++;
  }
  else
  {
    if (i > max_victories[0])
    {
      {
        max_victories[0] = i;
        max_victories[1] = 1;
      }
    }
    else
    {
      
    }

  }

}

void decrease_vic(Team_node *team, int *max_victories, Team_list_node *team_list)
{
  int i;
  if ((i = team->t.victories--) == max_victories[0])
  {
    {
      if (max_victories[1] == 1)
      {
        {
          max_victories[0]--;
          max_victories[1] = search_i_victories(i - 1, team_list);
        }
      }
      else
      {
        max_victories[1]--;
      }

    }
  }
  else
  {
    
  }

}

Game_list_node *new_game_list_node(Game_node *g)
{
  Game_list_node *x = malloc(sizeof(Game_list_node));
  x->g = g;
  x->next = 0;
  return x;
}

Game_list *insert_game_list(Game_node *g, Game_list *game_list)
{
  if (game_list->head == 0)
  {
    {
      game_list->head = (game_list->last = new_game_list_node(g));
      return game_list;
    }
  }
  else
  {
    
  }

  game_list->head->next = new_game_list_node(g);
  game_list->head = game_list->head->next;
  return game_list;
}

Game_list *delete_game_list(char *name, Game_list *game_list, Game_node **games_table)
{
  Game_node *node = search_game(name, games_table);
  Game_list_node *prev;
  Game_list_node *aux;
  for (aux = game_list->last, prev = 0; aux != 0; prev = aux, aux = aux->next)
  {
    if (aux->g == node)
    {
      {
        if (aux == game_list->last)
        {
          if (aux == game_list->head)
          {
            game_list->head = (game_list->last = 0);
          }
          else
          {
            game_list->last = aux->next;
          }

        }
        else
        {
          if (aux == game_list->head)
          {
            {
              prev->next = 0;
              game_list->head = prev;
            }
          }
          else
          {
            prev->next = aux->next;
          }

        }

        free(aux);
        return game_list;
      }
    }
    else
    {
      
    }

  }

  return game_list;
}

int search_i_victories(int n_victories, Team_list_node *team_list)
{
  int count = 0;
  Team_list_node *aux = team_list;
  for (; aux != 0; aux = aux->next)
  {
    if (aux->t->t.victories == n_victories)
    {
      count++;
    }
    else
    {
      
    }

  }

  return count;
}

