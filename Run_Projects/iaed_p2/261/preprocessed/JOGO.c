/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "JOGO.h"


list *mk_list()
{
  int i;
  list *lista = malloc(sizeof(list));
  lista->head = 0;
  lista->last = 0;
  lista->hashtable = malloc((sizeof(jogo)) * 1009);
  for (i = 0; i < 1009; i++)
  {
    *(lista->hashtable + i) = 0;
  }

  return lista;
}

void freeLista(list *l)
{
  jogo *next_jogo;
  while (l->head != 0)
  {
    next_jogo = l->head->next;
    free(l->head->nome);
    free(l->head->equipa1);
    free(l->head->equipa2);
    l->head->resultado1 = 0;
    l->head->resultado2 = 0;
    free(l->head);
    l->head = next_jogo;
  }

  free(l->hashtable);
  free(l);
  return;
}

jogo *encontrarJogo(list *l, char buffer[1024])
{
  jogo *Procurar;
  int jogoHash = hash(buffer) % 1009;
  for (Procurar = *(l->hashtable + jogoHash); Procurar && (strcmp(Procurar->nome, buffer) != 0); Procurar = Procurar->collision)
    ;

  return Procurar;
}

void merge(int tab_final[], int start, int mid, int end, char *tab_equipa[503])
{
  int i;
  int j;
  int k;
  int tab_aux[503];
  for (i = mid + 1; i > start; i--)
    tab_aux[i - 1] = tab_final[i - 1];

  for (j = mid; j < end; j++)
    tab_aux[(end + mid) - j] = tab_final[j + 1];

  for (k = start; k <= end; k++)
  {
    if ((strcmp(tab_equipa[tab_aux[j]], tab_equipa[tab_aux[i]]) < 0) || (i > mid))
    {
      tab_final[k] = tab_aux[j--];
    }
    else
    {
      tab_final[k] = tab_aux[i++];
    }

  }

}

void mergeSort(int tab_final[503], int start, int end, char *tab_equipa[503])
{
  int mid = (start + end) / 2;
  if (end <= start)
  {
    return;
  }
  else
  {
    
  }

  mergeSort(tab_final, start, mid, tab_equipa);
  mergeSort(tab_final, mid + 1, end, tab_equipa);
  merge(tab_final, start, mid, end, tab_equipa);
}

list *adicionaJogo(list *l, equipaHash **equipaTable, char *buffer, int n)
{
  int jogoHash;
  jogo *novo_jogo;
  char *nome = strtok(buffer, ":");
  char *eq1 = strtok(0, ":");
  char *eq2 = strtok(0, ":");
  char *res1 = strtok(0, ":");
  char *res2 = strtok(0, ":");
  if (encontrarJogo(l, buffer))
  {
    {
      printf("%d Jogo existente.\n", n);
      return l;
    }
  }
  else
  {
    
  }

  if (encontraEquipa(equipaTable, eq1))
  {
    {
      if (encontraEquipa(equipaTable, eq2))
      {
        {
          novo_jogo = malloc(sizeof(jogo));
          novo_jogo->nome = malloc((sizeof(char)) * (strlen(nome) + 1));
          strcpy(novo_jogo->nome, nome);
          novo_jogo->equipa1 = malloc((sizeof(char)) * (strlen(eq1) + 1));
          strcpy(novo_jogo->equipa1, eq1);
          novo_jogo->equipa2 = malloc((sizeof(char)) * (strlen(eq2) + 1));
          strcpy(novo_jogo->equipa2, eq2);
          novo_jogo->resultado1 = atoi(res1);
          novo_jogo->resultado2 = atoi(res2);
          if (novo_jogo->resultado1 > novo_jogo->resultado2)
          {
            {
              adicionaVitoria(equipaTable, eq1);
            }
          }
          else
          {
            
          }

          if (novo_jogo->resultado1 < novo_jogo->resultado2)
          {
            {
              adicionaVitoria(equipaTable, eq2);
            }
          }
          else
          {
            
          }

          novo_jogo->next = 0;
          novo_jogo->previous = l->last;
          novo_jogo->collision = 0;
          jogoHash = hash(novo_jogo->nome) % 1009;
          if ((*(l->hashtable + jogoHash)) == 0)
          {
            {
              *(l->hashtable + jogoHash) = novo_jogo;
            }
          }
          else
          {
            {
              novo_jogo->collision = *(l->hashtable + jogoHash);
              *(l->hashtable + jogoHash) = novo_jogo;
            }
          }

          if (l->head == 0)
          {
            {
              l->head = novo_jogo;
            }
          }
          else
          {
            {
              l->last->next = novo_jogo;
            }
          }

          l->last = novo_jogo;
          return l;
        }
      }
      else
      {
        
      }

    }
  }
  else
  {
    
  }

  printf("%d Equipa inexistente.\n", n);
  return l;
}

void listaJogos(list *l, int n)
{
  jogo *x = l->head;
  if (x == 0)
  {
    return;
  }
  else
  {
    
  }

  while (x != 0)
  {
    printf("%d %s %s %s %d %d\n", n, x->nome, x->equipa1, x->equipa2, x->resultado1, x->resultado2);
    x = x->next;
  }

  return;
}

void procuraJogo(list *l, char buffer[1024], int n)
{
  jogo *x;
  buffer = strtok(buffer, "\n");
  if (x = encontrarJogo(l, buffer))
  {
    {
      printf("%d %s %s %s %d %d\n", n, x->nome, x->equipa1, x->equipa2, x->resultado1, x->resultado2);
      return;
    }
  }
  else
  {
    
  }

  printf("%d Jogo inexistente.\n", n);
  return;
}

list *apagarJogo(list *l, equipaHash **equipaTable, char buffer[1024], int n)
{
  int jogoHash;
  jogo *paraApagar;
  jogo *jogoCollision;
  paraApagar = l->head;
  buffer = strtok(buffer, "\n");
  if (paraApagar = encontrarJogo(l, buffer))
  {
    {
      if (paraApagar->resultado1 > paraApagar->resultado2)
      {
        {
          removeVitoria(equipaTable, paraApagar->equipa1);
        }
      }
      else
      {
        
      }

      if (paraApagar->resultado1 < paraApagar->resultado2)
      {
        {
          removeVitoria(equipaTable, paraApagar->equipa2);
        }
      }
      else
      {
        
      }

      if (paraApagar->next != 0)
      {
        {
          paraApagar->next->previous = paraApagar->previous;
        }
      }
      else
      {
        
      }

      if (paraApagar->previous != 0)
      {
        {
          paraApagar->previous->next = paraApagar->next;
        }
      }
      else
      {
        
      }

      if (paraApagar == l->head)
      {
        {
          l->head = paraApagar->next;
        }
      }
      else
      {
        
      }

      if (paraApagar == l->last)
      {
        {
          l->last = paraApagar->previous;
        }
      }
      else
      {
        
      }

      jogoHash = hash(buffer) % 1009;
      jogoCollision = *(l->hashtable + jogoHash);
      if (strcmp(jogoCollision->nome, buffer) == 0)
      {
        {
          *(l->hashtable + jogoHash) = jogoCollision->collision;
        }
      }
      else
      {
        {
          for (; strcmp(jogoCollision->collision->nome, buffer) != 0; jogoCollision = jogoCollision->collision)
            ;

          jogoCollision->collision = jogoCollision->collision->collision;
        }
      }

      free(paraApagar->nome);
      free(paraApagar->equipa1);
      free(paraApagar->equipa2);
      paraApagar->resultado1 = 0;
      paraApagar->resultado2 = 0;
      free(paraApagar);
      return l;
    }
  }
  else
  {
    
  }

  printf("%d Jogo inexistente.\n", n);
  return l;
}

list *alteraResultado(list *l, equipaHash **equipaTable, char buffer[1024], int n)
{
  jogo *paraMudar;
  buffer = strtok(buffer, ":");
  if (paraMudar = encontrarJogo(l, buffer))
  {
    {
      if (paraMudar->resultado1 > paraMudar->resultado2)
      {
        {
          removeVitoria(equipaTable, paraMudar->equipa1);
        }
      }
      else
      {
        
      }

      if (paraMudar->resultado1 < paraMudar->resultado2)
      {
        {
          removeVitoria(equipaTable, paraMudar->equipa2);
        }
      }
      else
      {
        
      }

      buffer = strtok(0, ":");
      paraMudar->resultado1 = atoi(buffer);
      buffer = strtok(0, ":");
      paraMudar->resultado2 = atoi(buffer);
      if (paraMudar->resultado1 > paraMudar->resultado2)
      {
        {
          adicionaVitoria(equipaTable, paraMudar->equipa1);
        }
      }
      else
      {
        
      }

      if (paraMudar->resultado1 < paraMudar->resultado2)
      {
        {
          adicionaVitoria(equipaTable, paraMudar->equipa2);
        }
      }
      else
      {
        
      }

      return l;
    }
  }
  else
  {
    
  }

  printf("%d Jogo inexistente.\n", n);
  return l;
}

void adicionaEquipa(equipaHash **equipaTable, char buffer[1024], int n)
{
  buffer = strtok(buffer, "\n");
  if (encontraEquipa(equipaTable, buffer))
  {
    {
      printf("%d Equipa existente.\n", n);
      return;
    }
  }
  else
  {
    
  }

  AddEquipa(equipaTable, buffer);
  return;
}

void procuraEquipa(equipaHash **equipaTable, char buffer[1024], int n)
{
  buffer = strtok(buffer, "\n");
  if (encontraEquipa(equipaTable, buffer))
  {
    {
      printf("%d %s %d\n", n, buffer, jogosGanhos(equipaTable, buffer));
      return;
    }
  }
  else
  {
    
  }

  printf("%d Equipa inexistente.\n", n);
  return;
}

void melhoresEquipas(equipaHash **equipaTable, int n)
{
  int i;
  int counter = 0;
  int e = 0;
  int tab_final[503];
  char *tab_equipas[503];
  e = equipasMaisJogos(equipaTable, tab_equipas);
  if (e > 0)
  {
    {
      for (i = 0; i < e; i++)
      {
        tab_final[counter] = i;
        counter++;
      }

      printf("%d Melhores %d\n", n, jogosGanhos(equipaTable, tab_equipas[0]));
      mergeSort(tab_final, 0, counter - 1, tab_equipas);
      for (i = 0; i < counter; i++)
      {
        printf("%d * %s\n", n, tab_equipas[tab_final[i]]);
      }

      i = 0;
      while (i < e)
      {
        free(tab_equipas[i]);
        i++;
      }

    }
  }
  else
  {
    
  }

  return;
}

