/*File generated by PreProcessor.py*/


#include "List.h"
#include "constants.h"
#include <stdlib.h>
#include <string.h>


long int hash(const char *s)
{
  long int h;
  long int a = 124991;
  long int b = 24989;
  for (h = 0; *s; s++, a = (a * b) % (30011 - 1))
    h = ((a * h) + (*s)) % 30011;

  return h;
}

void STinsert(link **heads, node *n);
void STdelete(link **heads, node *n);
void STfree(link **heads);
void free_game(game *g)
{
  free(g->name);
  free(g);
}

void free_team(team *t)
{
  free(t->name);
  free(t);
}

list *create_list()
{
  list *lst = malloc(sizeof(list));
  lst->head = 0;
  lst->last = 0;
  lst->table = calloc(30011, sizeof(link *));
  return lst;
}

void append(list *lst, node *n)
{
  n->next = 0;
  if (lst->head)
  {
    {
      lst->last->next = n;
      n->prev = lst->last;
    }
  }
  else
  {
    {
      lst->head = n;
      n->prev = 0;
    }
  }

  lst->last = n;
  STinsert(lst->table, n);
}

void delete(list *lst, node *n)
{
  if (n->prev)
  {
    n->prev->next = n->next;
  }
  else
  {
    lst->head = n->next;
  }

  if (n->next)
  {
    n->next->prev = n->prev;
  }
  else
  {
    lst->last = n->prev;
  }

  STdelete(lst->table, n);
  if (n->type == TEAM)
  {
    free_team(n->d.t);
  }
  else
  {
    free_game(n->d.g);
  }

  free(n);
}

void free_list(list *lst)
{
  node *aux;
  node *head = lst->head;
  STfree(lst->table);
  if (head)
  {
    {
      if (head->type == TEAM)
      {
        while (head)
        {
          aux = head;
          head = head->next;
          free_team(aux->d.t);
          free(aux);
        }

      }
      else
      {
        while (head)
        {
          aux = head;
          head = head->next;
          free_game(aux->d.g);
          free(aux);
        }

      }

    }
  }
  else
  {
    
  }

  free(lst);
}

node *STsearch(link **heads, char *text)
{
  long int i = hash(text);
  link *head = heads[i];
  if (!head)
  {
    return 0;
  }
  else
  {
    
  }

  if (head->n->type == TEAM)
  {
    {
      while (head)
        if (!strcmp(head->n->d.t->name, text))
      {
        return head->n;
      }
      else
      {
        head = head->next;
      }


    }
  }
  else
  {
    {
      while (head)
        if (!strcmp(head->n->d.g->name, text))
      {
        return head->n;
      }
      else
      {
        head = head->next;
      }


    }
  }

  return 0;
}

void STinsert(link **heads, node *n)
{
  long int i;
  link *new_node = malloc(sizeof(link));
  if (n->type == TEAM)
  {
    i = hash(n->d.t->name);
  }
  else
  {
    i = hash(n->d.g->name);
  }

  new_node->n = n;
  new_node->next = heads[i];
  heads[i] = new_node;
}

void STdelete(link **heads, node *n)
{
  long int i;
  link *head;
  link *aux;
  if (n->type == TEAM)
  {
    i = hash(n->d.t->name);
  }
  else
  {
    i = hash(n->d.g->name);
  }

  head = heads[i];
  if (head->n == n)
  {
    {
      aux = head;
      heads[i] = head->next;
    }
  }
  else
  {
    {
      while (head->next->n != n)
        head = head->next;

      aux = head->next;
      head->next = head->next->next;
    }
  }

  free(aux);
}

void STfree(link **heads)
{
  int i;
  link *head;
  link *aux;
  for (i = 0; i < 30011; i++)
  {
    head = heads[i];
    while (head)
    {
      aux = head;
      head = head->next;
      free(aux);
    }

  }

  free(heads);
}

