/*File generated by PreProcessor.py*/


#include "all.h"
#include "constants.h"
#include "Team.h"
#include "Game.h"
#include "List.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>


int cmp_func(const void *a, const void *b)
{
  return strcmp(*((char **) a), *((char **) b));
}

int in_list(char *name, list *lst)
{
  return !(!STsearch(lst->table, name));
}

node *create_game(char *name, team *t1, team *t2, int s1, int s2)
{
  node *n = malloc(sizeof(node));
  game *g = malloc(sizeof(game));
  g->name = malloc((strlen(name) + 1) * (sizeof(char)));
  strcpy(g->name, name);
  g->t1 = t1;
  g->t2 = t2;
  g->s1 = s1;
  g->s2 = s2;
  if (s1 > s2)
  {
    g->t1->wins++;
  }
  else
  {
    if (s2 > s1)
    {
      g->t2->wins++;
    }
    else
    {
      
    }

  }

  n->type = GAME;
  n->d.g = g;
  return n;
}

node *create_team(char *name)
{
  node *n = malloc(sizeof(node));
  team *t = malloc(sizeof(team));
  t->name = malloc((strlen(name) + 1) * (sizeof(char)));
  strcpy(t->name, name);
  t->wins = 0;
  n->type = TEAM;
  n->d.t = t;
  return n;
}

void add_game(long int NL, list *game_list, list *team_list)
{
  char name[1024];
  char t1[1024];
  char t2[1024];
  int s1;
  int s2;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  for (int t1_index = 0; t1_index < 10; t1_index++)
  {
    t1[t1_index] = new_sym_var(sizeof(char) * 8);
  }

  t1[10 - 1] = '\0';
  for (int t2_index = 0; t2_index < 10; t2_index++)
  {
    t2[t2_index] = new_sym_var(sizeof(char) * 8);
  }

  t2[10 - 1] = '\0';
  s1 = new_sym_var(sizeof(int) * 8);
  s2 = new_sym_var(sizeof(int) * 8);
  if (in_list(name, game_list))
  {
    printf("%ld Jogo existente.\n", NL);
  }
  else
  {
    if (in_list(t1, team_list) && in_list(t2, team_list))
    {
      {
        node *n1;
        node *n2;
        n1 = STsearch(team_list->table, t1);
        n2 = STsearch(team_list->table, t2);
        n1 = create_game(name, n1->d.t, n2->d.t, s1, s2);
        append(game_list, n1);
      }
    }
    else
    {
      printf("%ld Equipa inexistente.\n", NL);
    }

  }

}

void add_team(long int NL, list *team_list)
{
  char name[1024];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  if (in_list(name, team_list))
  {
    printf("%ld Equipa existente.\n", NL);
  }
  else
  {
    {
      node *n;
      n = create_team(name);
      append(team_list, n);
    }
  }

}

void list_games(long int NL, list *game_list)
{
  node *n = game_list->head;
  game *g;
  while (n)
  {
    g = n->d.g;
    printf("%ld %s %s %s %d %d\n", NL, g->name, g->t1->name, g->t2->name, g->s1, g->s2);
    n = n->next;
  }

}

void find_game(long int NL, list *game_list)
{
  char name[1024];
  node *n;
  game *g;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  n = STsearch(game_list->table, name);
  if (n)
  {
    {
      g = n->d.g;
      printf("%ld %s %s %s %d %d", NL, g->name, g->t1->name, g->t2->name, g->s1, g->s2);
    }
  }
  else
  {
    printf("%ld Jogo inexistente.", NL);
  }

  printf("\n");
}

void find_team(long int NL, list *team_list)
{
  char name[1024];
  node *n;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  n = STsearch(team_list->table, name);
  if (n)
  {
    printf("%ld %s %d\n", NL, name, n->d.t->wins);
  }
  else
  {
    printf("%ld Equipa inexistente.\n", NL);
  }

}

void remove_game(long int NL, list *game_list)
{
  char name[1024];
  node *n;
  game *g;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  n = STsearch(game_list->table, name);
  if (n)
  {
    {
      g = n->d.g;
      if (g->s1 > g->s2)
      {
        g->t1->wins--;
      }
      else
      {
        if (g->s1 < g->s2)
        {
          g->t2->wins--;
        }
        else
        {
          
        }

      }

      delete(game_list, n);
    }
  }
  else
  {
    printf("%ld Jogo inexistente.\n", NL);
  }

}

void change_game(long int NL, list *game_list)
{
  char name[1024];
  int s1;
  int s2;
  node *n;
  game *g;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  s1 = new_sym_var(sizeof(int) * 8);
  s2 = new_sym_var(sizeof(int) * 8);
  n = STsearch(game_list->table, name);
  if (n)
  {
    {
      g = n->d.g;
      if ((g->s1 > g->s2) && (s1 <= s2))
      {
        {
          g->t1->wins--;
          if (s1 < s2)
          {
            g->t2->wins++;
          }
          else
          {
            
          }

        }
      }
      else
      {
        if ((g->s1 < g->s2) && (s1 >= s2))
        {
          {
            g->t2->wins--;
            if (s1 > s2)
            {
              g->t1->wins++;
            }
            else
            {
              
            }

          }
        }
        else
        {
          if (g->s1 == g->s2)
          {
            {
              if (s1 > s2)
              {
                g->t1->wins++;
              }
              else
              {
                if (s1 < s2)
                {
                  g->t2->wins++;
                }
                else
                {
                  
                }

              }

            }
          }
          else
          {
            
          }

        }

      }

      n->d.g->s1 = s1;
      n->d.g->s2 = s2;
    }
  }
  else
  {
    printf("%ld Jogo inexistente.\n", NL);
  }

}

void get_winners(long int NL, list *team_list)
{
  int wins = 0;
  int j;
  int i = 0;
  int size = 32;
  char **lst = (char **) malloc(size * (sizeof(char *)));
  node *head = team_list->head;
  if (head)
  {
    {
      while (head)
      {
        if (head->d.t->wins > wins)
        {
          {
            wins = head->d.t->wins;
            lst[0] = head->d.t->name;
            i = 1;
          }
        }
        else
        {
          if (head->d.t->wins == wins)
          {
            {
              if (i >= size)
              {
                {
                  size *= 2;
                  lst = (char **) realloc(lst, size);
                }
              }
              else
              {
                
              }

              lst[i++] = head->d.t->name;
            }
          }
          else
          {
            
          }

        }

        head = head->next;
      }

      printf("%ld Melhores %d\n", NL, wins);
      qsort(lst, i, sizeof(char *), cmp_func);
      for (j = 0; j < i; j++)
        printf("%ld * %s\n", NL, lst[j]);

    }
  }
  else
  {
    
  }

  free(lst);
}

