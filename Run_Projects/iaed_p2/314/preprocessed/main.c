/*File generated by PreProcessor.py*/


#include "hashtableequipas.h"
#include "hashtablejogo.h"
#include "listae.h"
#include "listaj.h"
#include "quicksort.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>


void adiciona_jogo(int NL, listj *listajogo, linkj *headsj, linke *headse)
{
  jogo *j;
  char buffer1[1023 + 1];
  char buffer2[1023 + 1];
  char buffer3[1023 + 1];
  int sc1;
  int sc2;
  for (int buffer1_index = 0; buffer1_index < (1023 + 1); buffer1_index++)
  {
    buffer1[buffer1_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer1[(1023 + 1) - 1] = '\0';
  for (int buffer2_index = 0; buffer2_index < (1023 + 1); buffer2_index++)
  {
    buffer2[buffer2_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer2[(1023 + 1) - 1] = '\0';
  for (int buffer3_index = 0; buffer3_index < (1023 + 1); buffer3_index++)
  {
    buffer3[buffer3_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer3[(1023 + 1) - 1] = '\0';
  sc1 = new_sym_var(sizeof(int) * 8);
  sc2 = new_sym_var(sizeof(int) * 8);
  getchar();
  if (STprocuraj(buffer1, 1483, headsj) != 0)
  {
    {
      printf("%d Jogo existente.\n", NL);
    }
  }
  else
  {
    if ((STprocurae(buffer2, 1483, headse) == 0) || (STprocurae(buffer3, 1483, headse) == 0))
    {
      {
        printf("%d Equipa inexistente.\n", NL);
      }
    }
    else
    {
      {
        j = malloc(sizeof(jogo));
        j->nome = malloc((sizeof(char)) * (strlen(buffer1) + 1));
        strcpy(j->nome, buffer1);
        j->equipa1 = STprocurae(buffer2, 1483, headse);
        j->equipa2 = STprocurae(buffer3, 1483, headse);
        j->score1 = sc1;
        j->score2 = sc2;
        STinserej(j, 1483, headsj);
        adiciona_j(listajogo, j);
        if (j->score1 > j->score2)
        {
          {
            j->equipa1->jogosg++;
          }
        }
        else
        {
          
        }

        if (j->score2 > j->score1)
        {
          {
            j->equipa2->jogosg++;
          }
        }
        else
        {
          
        }

      }
    }

  }

}

void adiciona_equipa(int NL, liste *listaequipas, linke *headse)
{
  equipa *eq;
  char buffer[1023 + 1];
  for (int buffer_index = 0; buffer_index < (1023 + 1); buffer_index++)
  {
    buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer[(1023 + 1) - 1] = '\0';
  getchar();
  if (STprocurae(buffer, 1483, headse) != 0)
  {
    {
      printf("%d Equipa existente.\n", NL);
    }
  }
  else
  {
    {
      eq = malloc(sizeof(equipa));
      eq->nomeeq = malloc((sizeof(char)) * (strlen(buffer) + 1));
      strcpy(eq->nomeeq, buffer);
      eq->jogosg = 0;
      adiciona_e(listaequipas, eq);
      STinsertee(eq, 1483, headse);
    }
  }

}

void procura_jogo(int NL, linkj *headsj)
{
  char nome[1023 + 1];
  for (int nome_index = 0; nome_index < (1023 + 1); nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[(1023 + 1) - 1] = '\0';
  getchar();
  if (STprocuraj(nome, 1483, headsj) == 0)
  {
    {
      printf("%d Jogo inexistente.\n", NL);
    }
  }
  else
  {
    {
      jogo *jg = STprocuraj(nome, 1483, headsj);
      printf("%d %s %s %s %d %d\n", NL, jg->nome, jg->equipa1->nomeeq, jg->equipa2->nomeeq, jg->score1, jg->score2);
    }
  }

}

void procura_equipa(int NL, linke *headse)
{
  equipa *eq;
  char nequipa[1023 + 1];
  for (int nequipa_index = 0; nequipa_index < (1023 + 1); nequipa_index++)
  {
    nequipa[nequipa_index] = new_sym_var(sizeof(char) * 8);
  }

  nequipa[(1023 + 1) - 1] = '\0';
  getchar();
  if (STprocurae(nequipa, 1483, headse) == 0)
  {
    {
      printf("%d Equipa inexistente.\n", NL);
    }
  }
  else
  {
    {
      eq = STprocurae(nequipa, 1483, headse);
      printf("%d %s %d\n", NL, eq->nomeeq, eq->jogosg);
    }
  }

}

void altera_pontuacao(int NL, linkj *headsj)
{
  jogo *jg;
  int score1;
  int score2;
  char nome[1023 + 1];
  for (int nome_index = 0; nome_index < (1023 + 1); nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[(1023 + 1) - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  getchar();
  if (STprocuraj(nome, 1483, headsj) == 0)
  {
    {
      printf("%d Jogo inexistente.\n", NL);
    }
  }
  else
  {
    {
      jg = STprocuraj(nome, 1483, headsj);
      if (jg->score1 > jg->score2)
      {
        {
          jg->equipa1->jogosg--;
        }
      }
      else
      {
        
      }

      if (jg->score2 > jg->score1)
      {
        {
          jg->equipa2->jogosg--;
        }
      }
      else
      {
        
      }

      jg->score1 = score1;
      jg->score2 = score2;
      if (jg->score1 > jg->score2)
      {
        {
          jg->equipa1->jogosg++;
        }
      }
      else
      {
        
      }

      if (jg->score2 > jg->score1)
      {
        {
          jg->equipa2->jogosg++;
        }
      }
      else
      {
        
      }

    }
  }

}

void remove_jogo(int NL, listj *listajogo, linkj *headsj)
{
  jogo *jg;
  nodej *aux;
  char nome[1023 + 1];
  for (int nome_index = 0; nome_index < (1023 + 1); nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[(1023 + 1) - 1] = '\0';
  getchar();
  if (STprocuraj(nome, 1483, headsj) == 0)
  {
    {
      printf("%d Jogo inexistente.\n", NL);
    }
  }
  else
  {
    {
      aux = listajogo->head;
      while (aux)
      {
        if (strcmp(aux->j->nome, nome) == 0)
        {
          {
            apaga_nodej(listajogo, aux);
            break;
          }
        }
        else
        {
          
        }

        aux = aux->next;
      }

      jg = STprocuraj(nome, 1483, headsj);
      if (jg->score1 > jg->score2)
      {
        {
          jg->equipa1->jogosg--;
        }
      }
      else
      {
        
      }

      if (jg->score2 > jg->score1)
      {
        {
          jg->equipa2->jogosg--;
        }
      }
      else
      {
        
      }

      STapagaj(jg, 1483, headsj);
    }
  }

}

void listajogos(int NL, listj *listajogo)
{
  nodej *tmp;
  getchar();
  tmp = listajogo->head;
  while (tmp)
  {
    printf("%d %s %s %s %d %d\n", NL, tmp->j->nome, tmp->j->equipa1->nomeeq, tmp->j->equipa2->nomeeq, tmp->j->score1, tmp->j->score2);
    tmp = tmp->next;
  }

}

void equipasvencedoras(int NL, liste *listaequipas)
{
  nodee *aux;
  int tam = 2;
  int i = 0;
  int l;
  char **vitoriosos = malloc((sizeof(char *)) * 2);
  int max = 0;
  getchar();
  aux = listaequipas->head;
  if (aux == 0)
  {
    {
      free(vitoriosos);
      return;
    }
  }
  else
  {
    
  }

  while (aux)
  {
    if (aux->e->jogosg == max)
    {
      {
        if (i >= tam)
        {
          {
            tam = 2 * tam;
            vitoriosos = realloc(vitoriosos, (sizeof(char *)) * tam);
          }
        }
        else
        {
          
        }

        vitoriosos[i] = aux->e->nomeeq;
        i++;
      }
    }
    else
    {
      if (aux->e->jogosg > max)
      {
        {
          max = aux->e->jogosg;
          vitoriosos[0] = aux->e->nomeeq;
          i = 1;
        }
      }
      else
      {
        
      }

    }

    aux = aux->next;
  }

  quicksort(vitoriosos, 0, i - 1);
  printf("%d Melhores %d\n", NL, max);
  for (l = 0; l < i; l++)
  {
    printf("%d * %s\n", NL, vitoriosos[l]);
  }

  free(vitoriosos);
}

int main()
{
  int NL = 0;
  listj *listajogo = mk_listj();
  liste *listaequipas = mk_liste();
  linkj *headsj = STiniciaj(1483);
  linke *headse = STiniciae(1483);
  char tecla;
  while (((tecla = getchar()) != 'x') && (tecla != EOF))
  {
    NL++;
    switch (tecla)
    {
      case 'a':
        adiciona_jogo(NL, listajogo, headsj, headse);
        break;

      case 'A':
        adiciona_equipa(NL, listaequipas, headse);
        break;

      case 'l':
        listajogos(NL, listajogo);
        break;

      case 'p':
        procura_jogo(NL, headsj);
        break;

      case 'P':
        procura_equipa(NL, headse);
        break;

      case 'r':
        remove_jogo(NL, listajogo, headsj);
        break;

      case 's':
        altera_pontuacao(NL, headsj);
        break;

      case 'g':
        equipasvencedoras(NL, listaequipas);
        break;

    }

  }

  free_listj(listajogo);
  free_liste(listaequipas);
  STfree_hte(1483, headse);
  STfree_htj(1483, headsj);
  return 0;
}

