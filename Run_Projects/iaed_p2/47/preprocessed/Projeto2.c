/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "hashGame.h"
#include "hashTeam.h"
#include "doublelinked.h"


void add_Game(gamelink *headgame, teamlink *headteam, GameLinkedList list, int NL);
void add_Team(teamlink *head, int NL, int *teamcounter);
void print_Game(gamelink *head, int NL);
void delete_Game(gamelink *head, int NL, GameLinkedList list);
void print_Team(teamlink *head, int NL);
void edit_Score(gamelink *headgame, int NL);
void print_Games(GameLinkedList list, int NL);
void best_Teams(teamlink *head, int NL, int *teamcounter);
int compare(TEAM i, TEAM j);
int main()
{
  int NL = 1;
  int teamcounter = 0;
  gamelink *headgame = HASHinit_game(2371);
  teamlink *headteam = HASHinit_team(2371);
  GameLinkedList listGames = list_init();
  char comando = ' ';
  while (comando != 'x')
  {
    comando = new_sym_var(sizeof(char) * 8);
    switch (comando)
    {
      case 'a':
        add_Game(headgame, headteam, listGames, NL);
        break;

      case 'A':
        add_Team(headteam, NL, &teamcounter);
        break;

      case 'r':
        delete_Game(headgame, NL, listGames);
        break;

      case 'p':
        print_Game(headgame, NL);
        break;

      case 'P':
        print_Team(headteam, NL);
        break;

      case 's':
        edit_Score(headgame, NL);
        break;

      case 'l':
        print_Games(listGames, NL);
        break;

      case 'g':
        best_Teams(headteam, NL, &teamcounter);
        break;

      case 'x':
        destroy_hash_game(headgame);
        destroy_hash_team(headteam);
        destroy_list(listGames);
        break;

    }

    NL++;
  }

  return 0;
}

void add_Game(gamelink *headgame, teamlink *headteam, GameLinkedList list, int NL)
{
  char name[1024];
  char team1[1024];
  char team2[1024];
  int away;
  int home;
  GAME i;
  TEAM A;
  TEAM B;
  TEAM w;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  for (int team1_index = 0; team1_index < 10; team1_index++)
  {
    team1[team1_index] = new_sym_var(sizeof(char) * 8);
  }

  team1[10 - 1] = '\0';
  for (int team2_index = 0; team2_index < 10; team2_index++)
  {
    team2[team2_index] = new_sym_var(sizeof(char) * 8);
  }

  team2[10 - 1] = '\0';
  home = new_sym_var(sizeof(int) * 8);
  away = new_sym_var(sizeof(int) * 8);
  getchar();
  A = search_team(headteam, team1);
  B = search_team(headteam, team2);
  i = search_game(headgame, name);
  if (i)
  {
    printf("%d Jogo existente.\n", NL);
  }
  else
  {
    if ((!A) || (!B))
    {
      printf("%d Equipa inexistente.\n", NL);
    }
    else
    {
      {
        i = newGame(name, A, B, home, away);
        insert_game(headgame, i);
        append(list, i);
        w = winner(i);
        if (w)
        {
          w->wongames++;
        }
        else
        {
          
        }

      }
    }

  }

}

void add_Team(teamlink *head, int NL, int *teamcounter)
{
  char name[1024];
  TEAM i;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  getchar();
  i = search_team(head, name);
  if (i != 0)
  {
    printf("%d Equipa existente.\n", NL);
  }
  else
  {
    {
      insert_team(head, newTeam(name));
      (*teamcounter)++;
    }
  }

}

void print_Game(gamelink *head, int NL)
{
  char name[1024];
  GAME i;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  getchar();
  i = search_game(head, name);
  if (i == 0)
  {
    printf("%d Jogo inexistente.\n", NL);
  }
  else
  {
    {
      printf("%d ", NL);
      seeGame(i);
    }
  }

}

void print_Team(teamlink *head, int NL)
{
  char name[1024];
  TEAM i;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  getchar();
  i = search_team(head, name);
  if (!i)
  {
    printf("%d Equipa inexistente.\n", NL);
  }
  else
  {
    {
      printf("%d ", NL);
      seeTeam(i);
      printf(" %d\n", i->wongames);
    }
  }

}

void delete_Game(gamelink *head, int NL, GameLinkedList list)
{
  char name[1024];
  GAME i;
  TEAM t;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  getchar();
  i = search_game(head, name);
  if (!i)
  {
    printf("%d Jogo inexistente.\n", NL);
  }
  else
  {
    {
      t = winner(i);
      if (t)
      {
        t->wongames--;
      }
      else
      {
        
      }

      remove_Game_list(list, name);
      delete_game(head, name);
    }
  }

}

void edit_Score(gamelink *headgame, int NL)
{
  char name[1024];
  int home;
  int away;
  GAME i;
  TEAM old;
  TEAM new;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  home = new_sym_var(sizeof(int) * 8);
  away = new_sym_var(sizeof(int) * 8);
  getchar();
  i = search_game(headgame, name);
  if (!i)
  {
    {
      printf("%d Jogo inexistente.\n", NL);
      return;
    }
  }
  else
  {
    
  }

  old = winner(i);
  i->scoreHome = home;
  i->scoreAway = away;
  new = winner(i);
  if (old)
  {
    old->wongames--;
  }
  else
  {
    
  }

  if (new)
  {
    new->wongames++;
  }
  else
  {
    
  }

}

void print_Games(GameLinkedList list, int NL)
{
  Link current;
  getchar();
  for (current = list->head; current != 0; current = current->next)
  {
    printf("%d ", NL);
    seeGame(current->Game);
  }

}

int cmp_TEAM(const void *v, const void *w)
{
  const TEAM t1 = *((const TEAM *) v);
  const TEAM t2 = *((const TEAM *) w);
  return strcmp(t1->Teamname, t2->Teamname);
}

void best_Teams(teamlink *head, int NL, int *teamcounter)
{
  TEAM *TEAMARRAY;
  int max = -1;
  int n = 0;
  int nmax = 0;
  int index = 0;
  int i;
  teamlink aux;
  getchar();
  if ((*teamcounter) == 0)
  {
    return;
  }
  else
  {
    
  }

  for (i = 0; (i < 2371) && (n < (*teamcounter)); i++)
  {
    for (aux = head[i]; aux; aux = aux->next)
    {
      if (max < aux->TEAM->wongames)
      {
        {
          max = aux->TEAM->wongames;
        }
      }
      else
      {
        
      }

      n++;
    }

  }

  for (i = 0; i < 2371; i++)
  {
    for (aux = head[i]; aux; aux = aux->next)
    {
      if (aux->TEAM->wongames == max)
      {
        {
          nmax++;
        }
      }
      else
      {
        
      }

    }

  }

  TEAMARRAY = malloc((sizeof(TEAM)) * nmax);
  for (i = 0; i < 2371; i++)
  {
    for (aux = head[i]; aux; aux = aux->next)
    {
      if (aux->TEAM->wongames == max)
      {
        {
          TEAMARRAY[index] = aux->TEAM;
          index++;
        }
      }
      else
      {
        
      }

    }

  }

  qsort(TEAMARRAY, nmax, sizeof(TEAM), cmp_TEAM);
  printf("%d Melhores %d\n", NL, max);
  for (i = 0; i < nmax; i++)
  {
    printf("%d * ", NL);
    seeTeam(TEAMARRAY[i]);
    printf("\n");
  }

  free(TEAMARRAY);
}

