/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdbool.h>


typedef enum 
{
  ADD_MATCH = 'a',
  ADD_TEAM = 'A',
  LIST_MATCH = 'l',
  MATCH_SEARCH = 'p',
  TEAM_SEARCH = 'P',
  CHANGE_SCORE = 's',
  DELETE_MATCH = 'r',
  CHANGE_PRICE = 'p',
  LIST_TEAM = 'g',
  END_PROG = 'x',
  UNKNOWN_COMMAND = '\0'
} Command;
typedef struct team
{
  char *team_name;
  struct team *next;
} teamNode;
typedef struct match
{
  char *name;
  char *team_1;
  char *team_2;
  int score_1;
  int score_2;
  struct match *next;
} matchNode;
char buffer[100];
static teamNode *teamList;
static matchNode *matchList;
int inputCount;
void insertTeam(char *teamData)
{
  teamNode *n;
  teamNode *aux;
  n = (teamNode *) malloc(sizeof(teamNode));
  n->team_name = malloc((1 + strlen(teamData)) * (sizeof(char)));
  strcpy(n->team_name, teamData);
  if (teamList == 0)
  {
    {
      n->next = 0;
      teamList = n;
    }
  }
  else
  {
    {
      aux = teamList;
      while (aux->next != 0)
      {
        aux = aux->next;
      }

      n->next = 0;
      aux->next = n;
    }
  }

  return;
}

void insertMatch(char *nameData, char *teamData1, char *teamData2, int score_1, int score_2)
{
  matchNode *n;
  matchNode *aux;
  n = (matchNode *) malloc(sizeof(matchNode));
  n->name = malloc((1 + strlen(nameData)) * (sizeof(char)));
  strcpy(n->name, nameData);
  n->team_1 = malloc((1 + strlen(teamData1)) * (sizeof(char)));
  strcpy(n->team_1, teamData1);
  n->team_2 = malloc((1 + strlen(teamData2)) * (sizeof(char)));
  strcpy(n->team_2, teamData2);
  n->score_1 = score_1;
  n->score_2 = score_2;
  if (matchList == 0)
  {
    {
      n->next = 0;
      matchList = n;
    }
  }
  else
  {
    {
      aux = matchList;
      while (aux->next != 0)
      {
        aux = aux->next;
      }

      n->next = 0;
      aux->next = n;
    }
  }

  return;
}

void add_match(char *name, char *team_1, char *team_2, int score_1, int score_2)
{
  matchNode *aux = matchList;
  teamNode *aux2 = teamList;
  bool b1 = 0;
  bool b2 = 0;
  while (aux != 0)
  {
    if (!strcmp(aux->name, name))
    {
      {
        printf("%d Jogo existente.\n", inputCount);
        return;
      }
    }
    else
    {
      
    }

    aux = aux->next;
  }

  while (aux2 != 0)
  {
    if (!strcmp(aux2->team_name, team_1))
    {
      {
        b1 = 1;
      }
    }
    else
    {
      
    }

    if (!strcmp(aux2->team_name, team_2))
    {
      {
        b2 = 1;
      }
    }
    else
    {
      
    }

    aux2 = aux2->next;
  }

  if ((!b1) || (!b2))
  {
    {
      printf("%d Equipa inexistente.\n", inputCount);
      return;
    }
  }
  else
  {
    
  }

  insertMatch(name, team_1, team_2, score_1, score_2);
  return;
}

void list_match()
{
  matchNode *auxList;
  auxList = matchList;
  if (auxList == 0)
  {
    {
      return;
    }
  }
  else
  {
    
  }

  while (auxList != 0)
  {
    printf("%d %s %s %s %d %d\n", inputCount, auxList->name, auxList->team_1, auxList->team_2, auxList->score_1, auxList->score_2);
    auxList = auxList->next;
  }

  return;
}

void match_search(char *namep)
{
  matchNode *auxMatch = matchList;
  bool b1 = 0;
  while (auxMatch != 0)
  {
    if (!strcmp(auxMatch->name, namep))
    {
      {
        b1 = 1;
        printf("%d %s %s %s %d %d\n", inputCount, namep, auxMatch->team_1, auxMatch->team_2, auxMatch->score_1, auxMatch->score_2);
        return;
      }
    }
    else
    {
      
    }

    auxMatch = auxMatch->next;
  }

  if (!b1)
  {
    {
      printf("%d Jogo inexistente.\n", inputCount);
      return;
    }
  }
  else
  {
    
  }

  return;
}

void change_score(char *name, int score_1, int score_2)
{
  matchNode *auxMatch = matchList;
  matchNode *auxHead = auxMatch;
  bool b1 = 0;
  while (auxMatch != 0)
  {
    if (!strcmp(auxMatch->name, name))
    {
      {
        b1 = 1;
        auxMatch->score_1 = score_1;
        auxMatch->score_2 = score_2;
      }
    }
    else
    {
      
    }

    auxMatch = auxMatch->next;
  }

  if (!b1)
  {
    {
      printf("%d Jogo inexistente.\n", inputCount);
      return;
    }
  }
  else
  {
    
  }

  matchList = auxHead;
  return;
}

void add_team(char *nameA)
{
  teamNode *aux = teamList;
  while (aux != 0)
  {
    if (!strcmp(aux->team_name, nameA))
    {
      {
        printf("%d Equipa existente.\n", inputCount);
        return;
      }
    }
    else
    {
      
    }

    aux = aux->next;
  }

  insertTeam(nameA);
  return;
}

void delete_match(char *name)
{
  matchNode *auxMatch = matchList;
  matchNode *auxPrevious = 0;
  if ((auxMatch != 0) && (!strcmp(auxMatch->name, name)))
  {
    {
      matchList = auxMatch->next;
      return;
    }
  }
  else
  {
    
  }

  while ((auxMatch != 0) && strcmp(auxMatch->name, name))
  {
    auxPrevious = auxMatch;
    auxMatch = auxMatch->next;
  }

  if (auxMatch == 0)
  {
    {
      printf("%d Jogo inexistente.\n", inputCount);
      return;
    }
  }
  else
  {
    
  }

  auxPrevious->next = auxMatch->next;
  return;
}

void team_search(char *name)
{
  matchNode *auxMatch = matchList;
  teamNode *auxTeam = teamList;
  int winCount = 0;
  bool b1 = 0;
  bool b2 = 0;
  while (auxTeam != 0)
  {
    if (!strcmp(auxTeam->team_name, name))
    {
      {
        b1 = 1;
      }
    }
    else
    {
      
    }

    if (!strcmp(auxTeam->team_name, name))
    {
      {
        b2 = 1;
      }
    }
    else
    {
      
    }

    auxTeam = auxTeam->next;
  }

  if ((!b1) || (!b2))
  {
    {
      printf("%d Equipa inexistente.\n", inputCount);
      return;
    }
  }
  else
  {
    
  }

  while (auxMatch != 0)
  {
    if ((!strcmp(auxMatch->team_1, name)) & (auxMatch->score_1 > auxMatch->score_2))
    {
      {
        winCount++;
      }
    }
    else
    {
      
    }

    if ((!strcmp(auxMatch->team_2, name)) & (auxMatch->score_2 > auxMatch->score_1))
    {
      {
        winCount++;
      }
    }
    else
    {
      
    }

    auxMatch = auxMatch->next;
  }

  printf("%d %s %d\n", inputCount, name, winCount);
  return;
}

void list_team()
{
  typedef struct vic_Team
  {
    char vName[1024];
    int vicCount;
    struct vic_Team *next;
  } vicNode;
  int maxVict = 0;
  int i;
  int j;
  int k = 0;
  vicNode vicTeam[50];
  char auxVic[1024];
  teamNode *aux_team = teamList;
  matchNode *aux_match;
  bool swapped;
  if (aux_team == 0)
  {
    {
      return;
    }
  }
  else
  {
    
  }

  while (aux_team != 0)
  {
    strcpy(vicTeam[i].vName, aux_team->team_name);
    vicTeam[i].vicCount = 0;
    aux_match = matchList;
    while (aux_match != 0)
    {
      if ((!strcmp(aux_match->team_1, vicTeam[i].vName)) && (aux_match->score_1 > aux_match->score_2))
      {
        {
          vicTeam[i].vicCount++;
        }
      }
      else
      {
        
      }

      if ((!strcmp(aux_match->team_2, vicTeam[i].vName)) && (aux_match->score_2 > aux_match->score_1))
      {
        {
          vicTeam[i].vicCount++;
        }
      }
      else
      {
        
      }

      aux_match = aux_match->next;
    }

    if (vicTeam[i].vicCount > maxVict)
    {
      maxVict = vicTeam[i].vicCount;
    }
    else
    {
      
    }

    aux_team = aux_team->next;
    i++;
    strcpy(vicTeam[i].vName, "EOF");
  }

  free(aux_team);
  free(aux_match);
  swapped = 1;
  while (swapped)
  {
    swapped = 0;
    for (j = 0; j < (i - 1); j++)
    {
      if (strcmp(vicTeam[j].vName, vicTeam[j + 1].vName) > 0)
      {
        {
          strcpy(auxVic, vicTeam[j].vName);
          k = vicTeam[j].vicCount;
          strcpy(vicTeam[j].vName, vicTeam[j + 1].vName);
          vicTeam[j].vicCount = vicTeam[j + 1].vicCount;
          strcpy(vicTeam[j + 1].vName, auxVic);
          vicTeam[j + 1].vicCount = k;
          swapped = 1;
        }
      }
      else
      {
        
      }

    }

  }

  printf("%d %s %d\n", inputCount, "Melhores", maxVict);
  for (j = 0; j < i; j++)
  {
    if ((vicTeam[j].vicCount == maxVict) && strcmp(vicTeam[j].vName, vicTeam[j + 1].vName))
    {
      {
        printf("%d %s %s\n", inputCount, "*", vicTeam[j].vName);
      }
    }
    else
    {
      
    }

  }

  return;
}

void end_prog()
{
  free(teamList);
  free(matchList);
  exit(0);
}

void run_command(Command com, char *args)
{
  char name[1024];
  char team_1[1024];
  char team_2[1024];
  char *r_args_1;
  char *r_args_2;
  char *r_args;
  int score_1;
  int score_2;
  switch (com)
  {
    case ADD_MATCH:
      inputCount++;
      r_args = strchr(args, ':');
      r_args[0] = '\0';
      r_args++;
      strcpy(name, args);
      r_args_1 = strchr(r_args, ':');
      r_args_1[0] = '\0';
      r_args_1++;
      strcpy(team_1, r_args);
      r_args_2 = strchr(r_args_1, ':');
      r_args_2[0] = '\0';
      r_args_2++;
      strcpy(team_2, r_args_1);
      score_1 = new_sym_var(sizeof(int) * 8);
      score_2 = new_sym_var(sizeof(int) * 8);
      add_match(name, team_1, team_2, score_1, score_2);
      break;

    case LIST_MATCH:
      inputCount++;
      list_match();
      break;

    case MATCH_SEARCH:
      inputCount++;
      for (int name_index = 0; name_index < 10; name_index++)
    {
      name[name_index] = new_sym_var(sizeof(char) * 8);
    }

      name[10 - 1] = '\0';
      match_search(name);
      break;

    case DELETE_MATCH:
      inputCount++;
      for (int name_index = 0; name_index < 10; name_index++)
    {
      name[name_index] = new_sym_var(sizeof(char) * 8);
    }

      name[10 - 1] = '\0';
      delete_match(name);
      break;

    case CHANGE_SCORE:
      inputCount++;
      r_args = strchr(args, ':');
      r_args[0] = '\0';
      r_args++;
      strcpy(name, args);
      score_1 = new_sym_var(sizeof(int) * 8);
      score_2 = new_sym_var(sizeof(int) * 8);
      change_score(name, score_1, score_2);
      break;

    case ADD_TEAM:
      inputCount++;
      for (int name_index = 0; name_index < 10; name_index++)
    {
      name[name_index] = new_sym_var(sizeof(char) * 8);
    }

      name[10 - 1] = '\0';
      add_team(name);
      break;

    case TEAM_SEARCH:
      inputCount++;
      for (int name_index = 0; name_index < 10; name_index++)
    {
      name[name_index] = new_sym_var(sizeof(char) * 8);
    }

      name[10 - 1] = '\0';
      team_search(name);
      break;

    case LIST_TEAM:
      inputCount++;
      list_team();
      break;

    case END_PROG:
      end_prog();
      break;

    default:
      break;

  }

}

Command read_command(char **args)
{
  if (!fgets(buffer, 100, stdin))
  {
    return UNKNOWN_COMMAND;
  }
  else
  {
    
  }

  *args = buffer + 2;
  return (Command) buffer[0];
}

int main()
{
  char *args;
  args = 0;
  teamList = 0;
  inputCount = 0;
  while (1)
  {
    Command com = read_command(&args);
    run_command(com, args);
  }

}

