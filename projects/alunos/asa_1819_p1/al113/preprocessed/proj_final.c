#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>


typedef struct node
{
  int value;
  struct node *next;
} *Link;
typedef struct list
{
  Link head;
} *List;
List init_list()
{
  List l = (List) malloc(sizeof(struct list));
  l->head = 0;
  return l;
}

void insert_list(List l, int v)
{
  Link new = (Link) malloc(sizeof(struct node));
  new->value = v;
  new->next = l->head;
  l->head = new;
}

void remove_from_list(List l, int v)
{
  Link x;
  Link aux;
  if (l->head == 0)
  {
    return;
  }
  else
  {
    
  }

  if (l->head->value == v)
  {
    x = l->head;
    l->head = x->next;
  }
  else
  {
    for (aux = l->head; (aux->next != 0) && (aux->next->value != v); aux = aux->next)
      ;

    if ((x = aux->next) == 0)
    {
      return;
    }
    else
    {
      
    }

    aux->next = x->next;
  }

  free(x);
}

void clear_list(List l)
{
  Link x = l->head;
  Link aux;
  while (x != 0)
  {
    aux = x;
    x = aux->next;
    free(aux);
  }

  l->head = 0;
}

int comparator(const void *a, const void *b)
{
  return (*((int *) a)) > (*((int *) b));
}

void aux_findBiggestSubgraph(List *graph, int numVertices, int v, int *visited, int *size)
{
  Link aux;
  visited[v] = 1;
  for (aux = graph[v]->head; aux != 0; aux = aux->next)
    if (!visited[aux->value])
  {
    aux_findBiggestSubgraph(graph, numVertices, aux->value, visited, size);
  }
  else
  {
    
  }


  (*size)++;
}

int findBiggestSubgraph(List *graph, int numVertices)
{
  int i;
  int maxSize = 0;
  int size;
  int *visited = (int *) malloc((sizeof(int)) * numVertices);
  for (i = 0; i < numVertices; i++)
  {
    if ((graph[i]->head != 0) && (graph[i]->head->value == (-1)))
    {
      visited[i] = 1;
    }
    else
    {
      visited[i] = 0;
    }

  }

  for (i = 0; i < numVertices; i++)
    if (!visited[i])
  {
    size = 0;
    aux_findBiggestSubgraph(graph, numVertices, i, visited, &size);
    maxSize = (size > maxSize) ? (size) : (maxSize);
  }
  else
  {
    
  }


  free(visited);
  return maxSize;
}

int visit(List *graph, int numVertices, int v, int predecessor, int *d, int *low, int *t, int *numCriticals)
{
  int u;
  int id;
  int subGraphId = v;
  int children = 0;
  int critical = 0;
  Link aux;
  d[v] = (*t)++;
  low[v] = d[v];
  for (aux = graph[v]->head; aux != 0; aux = aux->next)
  {
    u = aux->value;
    if (!(d[u] != (-1)))
    {
      children++;
      id = visit(graph, numVertices, u, v, d, low, t, numCriticals);
      low[v] = (low[u] < low[v]) ? (low[u]) : (low[v]);
      subGraphId = (id > subGraphId) ? (id) : (subGraphId);
      if ((!(predecessor == (-1))) && (low[u] >= d[v]))
      {
        critical = 1;
      }
      else
      {
        
      }

    }
    else
    {
      if (u != predecessor)
      {
        low[v] = (d[u] < low[v]) ? (d[u]) : (low[v]);
      }
      else
      {
        
      }

    }

  }

  if ((predecessor == (-1)) && (children > 1))
  {
    critical = 1;
  }
  else
  {
    
  }

  if (critical)
  {
    (*numCriticals)++;
    clear_list(graph[v]);
    insert_list(graph[v], -1);
  }
  else
  {
    
  }

  return subGraphId;
}

void performAlgorithm(List *graph, int numVertices)
{
  int i;
  int t = 1;
  int maxVertices = 0;
  int numCriticals = 0;
  Link aux;
  int *d = (int *) malloc((sizeof(int)) * numVertices);
  int *low = (int *) malloc((sizeof(int)) * numVertices);
  int numSubGraphs = 0;
  List subGraphs = init_list();
  for (i = 0; i < numVertices; i++)
  {
    d[i] = -1;
    low[i] = -1;
  }

  for (i = 0; i < numVertices; i++)
    if (!(d[i] != (-1)))
  {
    numSubGraphs++;
    insert_list(subGraphs, visit(graph, numVertices, i, -1, d, low, &t, &numCriticals));
  }
  else
  {
    
  }


  free(d);
  free(low);
  int *subAux = (int *) malloc((sizeof(int)) * numSubGraphs);
  for (i = 0, aux = subGraphs->head; aux != 0; aux = aux->next, i++)
    subAux[i] = aux->value;

  qsort(subAux, numSubGraphs, sizeof(int), comparator);
  printf("%d\n", numSubGraphs);
  for (i = 0; i < (numSubGraphs - 1); i++)
    printf("%d ", subAux[i] + 1);

  printf("%d\n", subAux[i] + 1);
  printf("%d\n", numCriticals);
  clear_list(subGraphs);
  free(subGraphs);
  free(subAux);
  maxVertices = findBiggestSubgraph(graph, numVertices);
  printf("%d\n", maxVertices);
}

int main(int argc, char *argv[])
{
  int i;
  int v1;
  int v2;
  int numRouters;
  int numConnections;
  numRouters = new_sym_var(sizeof(int) * 8);
  numConnections = new_sym_var(sizeof(int) * 8);
  List *network = (List *) malloc((sizeof(List)) * numRouters);
  for (i = 0; i < numRouters; i++)
    network[i] = init_list();

  for (i = 0; i < numConnections; i++)
  {
    v1 = new_sym_var(sizeof(int) * 8);
    v2 = new_sym_var(sizeof(int) * 8);
    insert_list(network[v1 - 1], v2 - 1);
    insert_list(network[v2 - 1], v1 - 1);
  }

  performAlgorithm(network, numRouters);
  for (i = 0; i < numRouters; i++)
  {
    if (network[i] != 0)
    {
      clear_list(network[i]);
    }
    else
    {
      
    }

    free(network[i]);
  }

  free(network);
  return 0;
}

