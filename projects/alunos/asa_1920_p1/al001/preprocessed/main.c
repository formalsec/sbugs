#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>


typedef struct listNode *ListNode;
typedef struct student
{
  int grade;
  int isDone;
  ListNode helpees;
} Student;
struct listNode
{
  Student *student;
  ListNode next;
};
void freeList(ListNode node)
{
  if (node == 0)
  {
    return;
  }
  else
  {
    
  }

  freeList(node->next);
  free(node);
}

void merge(Student *arr[], int l, int m, int r)
{
  int i;
  int j;
  int k;
  int szL = (m - l) + 1;
  int szR = r - m;
  Student **L = (Student **) malloc(szL * (sizeof(Student *)));
  Student **R = (Student **) malloc(szR * (sizeof(Student *)));
  for (i = 0; i < szL; i++)
  {
    L[i] = arr[l + i];
  }

  for (j = 0; j < szR; j++)
  {
    R[j] = arr[(m + 1) + j];
  }

  i = 0;
  j = 0;
  k = l;
  while ((i < szL) || (j < szR))
  {
    if ((j >= szR) || ((i < szL) && (L[i]->grade <= R[j]->grade)))
    {
      arr[k] = L[i];
      i++;
    }
    else
    {
      arr[k] = R[j];
      j++;
    }

    k++;
  }

  free(L);
  free(R);
}

void mergeSort(Student *arr[], int l, int r)
{
  int m;
  if (l >= r)
  {
    return;
  }
  else
  {
    
  }

  m = (l + r) / 2;
  mergeSort(arr, l, m);
  mergeSort(arr, m + 1, r);
  merge(arr, l, m, r);
}

void addFriend(Student *u, Student *v)
{
  ListNode newNode = (ListNode) malloc(sizeof(struct listNode));
  newNode->student = u;
  newNode->next = v->helpees;
  v->helpees = newNode;
}

void spreadGrade(Student *student)
{
  ListNode aux;
  if (student->isDone)
  {
    return;
  }
  else
  {
    
  }

  aux = student->helpees;
  student->isDone = 1;
  while (aux != 0)
  {
    if (aux->student->grade < student->grade)
    {
      aux->student->grade = student->grade;
    }
    else
    {
      
    }

    spreadGrade(aux->student);
    aux = aux->next;
  }

}

void predictGrades(Student *arr[], int size)
{
  int i;
  for (i = size - 1; i >= 0; i--)
  {
    spreadGrade(arr[i]);
  }

}

int main()
{
  Student *students;
  Student **studentsSorted;
  int i;
  int numStudents;
  int numRelations;
  int u;
  int v;
  numStudents = new_sym_var(sizeof(int) * 8);
  numRelations = new_sym_var(sizeof(int) * 8);
  students = (Student *) malloc(numStudents * (sizeof(Student)));
  studentsSorted = (Student **) malloc(numStudents * (sizeof(Student *)));
  for (i = 0; i < numStudents; i++)
  {
    students[i].grade = new_sym_var(sizeof(int) * 8);
    students[i].isDone = 0;
    students[i].helpees = 0;
    studentsSorted[i] = &students[i];
  }

  for (i = 0; i < numRelations; i++)
  {
    u = new_sym_var(sizeof(int) * 8);
    v = new_sym_var(sizeof(int) * 8);
    addFriend(&students[u - 1], &students[v - 1]);
  }

  mergeSort(studentsSorted, 0, numStudents - 1);
  predictGrades(studentsSorted, numStudents);
  for (i = 0; i < numStudents; i++)
  {
    printf("%d\n", students[i].grade);
    freeList(students[i].helpees);
  }

  free(students);
  free(studentsSorted);
  return 0;
}

