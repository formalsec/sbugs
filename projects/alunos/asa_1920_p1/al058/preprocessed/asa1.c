#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>


int initialize(int nstudents);
void startgraph(int connections);
void insertfriend(int s1, int s2);
int DFSVisit(int v, int max_grade);
void free_graph();
typedef struct 
{
  int color;
  int grade;
  int nfriends;
} Student;
Student *students;
typedef struct Node
{
  struct Node *next;
  int v;
} Node;
typedef struct 
{
  Node *head;
} Graph;
Graph *graph;
int main()
{
  int nstudents;
  int connections;
  int v;
  int i;
  int max_grade;
  nstudents = new_sym_var(sizeof(int) * 8);
  connections = new_sym_var(sizeof(int) * 8);
  graph = malloc((sizeof(Graph)) * nstudents);
  students = malloc((sizeof(Student)) * nstudents);
  max_grade = initialize(nstudents);
  startgraph(connections);
  for (v = 0; v < nstudents; v++)
  {
    if ((students[v].nfriends == 0) || (students[v].grade == max_grade))
    {
      students[v].color = 3;
    }
    else
    {
      
    }

  }

  for (v = 0; v < nstudents; v++)
  {
    if (students[v].color != 3)
    {
      DFSVisit(v, max_grade);
      students[v].color = 3;
    }
    else
    {
      
    }

    printf("%d\n", students[v].grade);
  }

  free(students);
  for (i = 0; i < nstudents; i++)
  {
    Node *iter;
    while (graph[i].head != 0)
    {
      iter = graph[i].head;
      graph[i].head = graph[i].head->next;
      free(iter);
    }

  }

  free(graph);
  return 0;
}

int initialize(int nstudents)
{
  int i;
  int max_grade = 0;
  for (i = 0; i < nstudents; i++)
  {
    students[i].grade = new_sym_var(sizeof(int) * 8);
    if (students[i].grade > max_grade)
    {
      max_grade = students[i].grade;
    }
    else
    {
      
    }

    students[i].color = 1;
    students[i].nfriends = 0;
    graph[i].head = 0;
  }

  return max_grade;
}

void startgraph(int connections)
{
  int s1;
  int s2;
  int i;
  for (i = 0; i < connections; i++)
  {
    s1 = new_sym_var(sizeof(int) * 8);
    s2 = new_sym_var(sizeof(int) * 8);
    insertfriend(s1, s2);
  }

}

void insertfriend(int s1, int s2)
{
  Node *node = malloc(sizeof(Node));
  node->v = s2 - 1;
  node->next = graph[s1 - 1].head;
  graph[s1 - 1].head = node;
  students[s1 - 1].nfriends++;
}

int DFSVisit(int i, int max_grade)
{
  Node *iter;
  students[i].color = 2;
  iter = graph[i].head;
  while (iter != 0)
  {
    if (students[iter->v].grade == max_grade)
    {
      students[i].grade = max_grade;
      students[i].color = 3;
      return students[i].grade;
    }
    else
    {
      
    }

    if (students[iter->v].color == 1)
    {
      students[iter->v].grade = DFSVisit(iter->v, max_grade);
    }
    else
    {
      
    }

    if (students[i].grade < students[iter->v].grade)
    {
      students[i].grade = students[iter->v].grade;
    }
    else
    {
      
    }

    iter = iter->next;
  }

  students[i].color = 1;
  return students[i].grade;
}

