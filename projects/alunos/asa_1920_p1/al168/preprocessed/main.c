#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <string.h>
#include <stdio.h>
#include <stdlib.h>


typedef struct student
{
  int flag;
  int grade;
  struct node *friendlist;
} Student;
typedef struct node
{
  struct student *content;
  struct node *next;
} Node;
int num_students;
int num_relations;
Student **students;
Node *grade_table[20 + 1];
void init_student_array()
{
  students = malloc((sizeof(struct student *)) * num_students);
}

void init_grade_table()
{
  memset(grade_table, 0, sizeof(grade_table));
}

Student *new_student(int grade)
{
  Student *s = malloc(sizeof(struct student));
  s->flag = 0;
  s->grade = grade;
  s->friendlist = 0;
  return s;
}

Node *new_node(Student *s)
{
  Node *n = malloc(sizeof(Node));
  n->content = s;
  n->next = 0;
  return n;
}

void add_node(Node **head, Node *node)
{
  node->next = *head;
  *head = node;
}

void assign_grade(Student *s)
{
  add_node(&grade_table[s->grade], new_node(s));
}

void add_friend(Student *s, Student *friend)
{
  add_node(&s->friendlist, new_node(friend));
}

void change_grade(Student *s, int grade)
{
  s->grade = grade;
  s->flag = 1;
}

void update_friend_grades(Student *s, int grade)
{
  if (!s->flag)
  {
    change_grade(s, grade);
    Node *n;
    for (n = s->friendlist; n != 0; n = n->next)
    {
      update_friend_grades(n->content, grade);
    }

  }
  else
  {
    
  }

}

void update_all_grades()
{
  int i;
  for (i = 20; i >= 0; i--)
  {
    Node *n;
    for (n = grade_table[i]; n != 0; n = n->next)
    {
      update_friend_grades(n->content, i);
    }

  }

}

void display_grades()
{
  int i;
  for (i = 0; i < num_students; i++)
  {
    printf("%d\n", students[i]->grade);
  }

}

void free_list(Node *head)
{
  Node *n = head;
  while (n != 0)
  {
    Node *tmp = n->next;
    free(n);
    n = tmp;
  }

}

void free_grade_table()
{
  int i;
  for (i = 0; i <= 20; i++)
    free_list(grade_table[i]);

}

void free_student(Student *s)
{
  free_list(s->friendlist);
  free(s);
}

void free_all_students()
{
  int i;
  for (i = 0; i < num_students; i++)
    free_student(students[i]);

  free(students);
}

int main()
{
  int i;
  num_students = new_sym_var(sizeof(int) * 8);
  num_relations = new_sym_var(sizeof(int) * 8);
  init_grade_table();
  init_student_array();
  for (i = 0; i < num_students; i++)
  {
    int grade;
    grade = new_sym_var(sizeof(int) * 8);
    Student *s = new_student(grade);
    students[i] = s;
    assign_grade(s);
  }

  for (i = 0; i < num_relations; i++)
  {
    int index_friend;
    int index_student;
    index_friend = new_sym_var(sizeof(int) * 8);
    index_student = new_sym_var(sizeof(int) * 8);
    add_friend(students[index_student - 1], students[index_friend - 1]);
  }

  update_all_grades();
  display_grades();
  free_grade_table();
  free_all_students();
  return 0;
}

