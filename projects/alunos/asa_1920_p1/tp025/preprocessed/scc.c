#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>


typedef struct stru_student
{
  int d;
  int low;
  int grade;
  int in_stack;
  int num_friends;
  int group;
  int visited;
  struct stru_student **frients;
} *Student;
typedef struct stru_stack
{
  int top;
  Student *array;
} Stack;
Stack *stack;
Student *students;
int *group;
int time = 0;
int g = 0;
void initialize(int *num_students, int *num_relations);
void DFS(int n);
void DFS_visit(Student current);
void Tarjan(int size);
void Tarjan_visite(Student student);
void print_grade(int n);
Student create_student(int id, int grade);
void add_relation(int src, int dest);
Stack *create_stack(int size);
int is_empty();
void push(Student student);
Student pop();
int main()
{
  int num_students;
  int num_relations;
  initialize(&num_students, &num_relations);
  Tarjan(num_students);
  DFS(num_students);
  print_grade(num_students);
  return 0;
}

void initialize(int *num_students, int *num_relations)
{
  for (int num_students_index = 0; num_students_index < 10; num_students_index++)
  {
    num_students[num_students_index] = new_sym_var(sizeof(int) * 8);
  }

  for (int num_relations_index = 0; num_relations_index < 10; num_relations_index++)
  {
    num_relations[num_relations_index] = new_sym_var(sizeof(int) * 8);
  }

  students = malloc((*num_students) * (sizeof(Student)));
  group = malloc((*num_students) * (sizeof(int)));
  stack = malloc(sizeof(Stack));
  stack->top = -1;
  int grade;
  int i;
  int src;
  int dest;
  for (i = 0; i < (*num_students); i++)
  {
    grade = new_sym_var(sizeof(int) * 8);
    students[i] = create_student(i, grade);
  }

  for (i = 0; i < (*num_relations); i++)
  {
    src = new_sym_var(sizeof(int) * 8);
    dest = new_sym_var(sizeof(int) * 8);
    add_relation(src - 1, dest - 1);
  }

}

void print_grade(int n)
{
  int i;
  for (i = 0; i < n; i++)
  {
    printf("%d\n", group[students[i]->group]);
  }

}

void DFS(int n)
{
  int i;
  for (i = 0; i < n; i++)
  {
    if (students[i]->visited == 0)
    {
      DFS_visit(students[i]);
    }
    else
    {
      
    }

  }

}

void DFS_visit(Student current)
{
  current->visited = 1;
  int i;
  for (i = 0; i < current->num_friends; i++)
  {
    Student temp = current->frients[i];
    if (temp->visited == 0)
    {
      DFS_visit(temp);
    }
    else
    {
      
    }

    if (current->group != temp->group)
    {
      group[current->group] = (group[current->group] > group[temp->group]) ? (group[current->group]) : (group[temp->group]);
    }
    else
    {
      
    }

  }

}

void Tarjan(int size)
{
  int i;
  for (i = 0; i < size; i++)
  {
    if (students[i]->d == (-1))
    {
      Tarjan_visite(students[i]);
    }
    else
    {
      
    }

  }

}

void Tarjan_visite(Student student)
{
  student->d = time;
  student->low = time;
  time++;
  push(student);
  int i;
  int max;
  Student next_student;
  for (i = 0; i < student->num_friends; i++)
  {
    next_student = student->frients[i];
    if ((next_student->d == (-1)) || (next_student->in_stack == 1))
    {
      if (next_student->d == (-1))
      {
        Tarjan_visite(next_student);
      }
      else
      {
        
      }

      student->low = (student->low < next_student->low) ? (student->low) : (next_student->low);
    }
    else
    {
      
    }

  }

  if (student->d == student->low)
  {
    Student temp = pop();
    temp->group = g;
    max = temp->grade;
    while ((temp->d != student->d) && (temp != 0))
    {
      temp = pop();
      temp->group = g;
      max = (temp->grade > max) ? (temp->grade) : (max);
    }

    group[g++] = max;
  }
  else
  {
    
  }

}

Student create_student(int id, int grade)
{
  Student new_student = malloc(sizeof(struct stru_student));
  new_student->d = -1;
  new_student->in_stack = 0;
  new_student->grade = grade;
  new_student->frients = 0;
  new_student->num_friends = 0;
  new_student->group = -1;
  new_student->visited = 0;
  return new_student;
}

void add_relation(int src, int dest)
{
  Student friend = students[dest];
  Student student = students[src];
  student->frients = realloc(student->frients, (student->num_friends + 1) * (sizeof(Student)));
  student->frients[student->num_friends] = friend;
  student->num_friends++;
}

Stack *create_stack(int size)
{
  Stack *stack = malloc(sizeof(Stack));
  stack->top = -1;
  stack->array = malloc(size * (sizeof(Student)));
  return stack;
}

int is_empty()
{
  return stack->top == (-1);
}

void push(Student student)
{
  stack->top++;
  stack->array = realloc(stack->array, (stack->top + 1) * (sizeof(Student)));
  stack->array[stack->top] = student;
  student->in_stack = 1;
}

Student pop()
{
  if (is_empty(stack))
  {
    return 0;
  }
  else
  {
    
  }

  Student student = stack->array[stack->top];
  stack->top--;
  stack->array = realloc(stack->array, (stack->top + 1) * (sizeof(Student)));
  student->in_stack = 0;
  return student;
}

