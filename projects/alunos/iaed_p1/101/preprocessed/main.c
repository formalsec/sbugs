/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


typedef struct 
{
  int idp;
  char descricao[63];
  int preco;
  int peso;
  int quantidade;
} Produto;
typedef struct 
{
  int idp;
  int quantidade;
} Item;
typedef struct 
{
  Item itens[10000];
  int tamanho;
  int peso;
} Encomenda;
void inserir_produto(Item itens[10000], int left, int right);
int encontrar_produto(Item itens[10000], int left, int right, int idp);
void mergesort(int a[], int left, int right);
void merge(int a[], int left, int middle, int right);
void comando_a();
void comando_q();
void comando_N();
void comando_A();
void comando_r();
void comando_R();
void comando_C();
void comando_p();
void comando_E();
void comando_m();
void comando_L();
void comando_l();
Produto stock[10000];
int por_preco[10000];
int aux[10000];
int num_produtos = 0;
Encomenda encomendas[500];
int num_encomendas = 0;
int main()
{
  int estado = 0;
  char comando;
  while (estado != 1)
  {
    comando = getchar();
    switch (comando)
    {
      case 'a':
        comando_a();
        break;

      case 'q':
        comando_q();
        break;

      case 'N':
        comando_N();
        break;

      case 'A':
        comando_A();
        break;

      case 'r':
        comando_r();
        break;

      case 'R':
        comando_R();
        break;

      case 'C':
        comando_C();
        break;

      case 'p':
        comando_p();
        break;

      case 'E':
        comando_E();
        break;

      case 'm':
        comando_m();
        break;

      case 'l':
        comando_l();
        break;

      case 'L':
        comando_L();
        break;

      case 'x':
        estado = 1;
        break;

    }

  }

  return 0;
}

void inserir_produto(Item itens[10000], int left, int right)
{
  Item v = itens[right];
  int i = right - 1;
  while ((i >= left) && (strcmp(stock[v.idp].descricao, stock[itens[i].idp].descricao) < 0))
  {
    itens[i + 1] = itens[i];
    i--;
  }

  itens[i + 1] = v;
}

int encontrar_produto(Item itens[10000], int left, int right, int idp)
{
  if (right >= left)
  {
    int middle = left + ((right - left) / 2);
    if (itens[middle].idp == idp)
    {
      return middle;
    }
    else
    {
      
    }

    if (strcmp(stock[itens[middle].idp].descricao, stock[idp].descricao) > 0)
    {
      return encontrar_produto(itens, left, middle - 1, idp);
    }
    else
    {
      
    }

    return encontrar_produto(itens, middle + 1, right, idp);
  }
  else
  {
    
  }

  return -1;
}

void mergesort(int a[], int left, int right)
{
  int middle = (right + left) / 2;
  if (right <= left)
  {
    return;
  }
  else
  {
    
  }

  mergesort(a, left, middle);
  mergesort(a, middle + 1, right);
  merge(a, left, middle, right);
}

void merge(int a[], int left, int middle, int right)
{
  int i;
  int j;
  int k;
  for (i = middle + 1; i > left; i--)
    aux[i - 1] = a[i - 1];

  for (j = middle; j < right; j++)
    aux[(right + middle) - j] = a[j + 1];

  for (k = left; k <= right; k++)
    if ((stock[aux[j]].preco < stock[aux[i]].preco) || ((stock[aux[j]].preco == stock[aux[i]].preco) && (aux[j] < aux[i])))
  {
    a[k] = aux[j--];
  }
  else
  {
    a[k] = aux[i++];
  }


}

void comando_a()
{
  for (int stock_index = 0; stock_index < 10; stock_index++)
  {
    stock[num_produtos].descricao[stock_index] = new_sym_var(sizeof(char) * 8);
  }

  stock[num_produtos].descricao[10 - 1] = '\0';
  stock[num_produtos].preco = new_sym_var(sizeof(int) * 8);
  stock[num_produtos].peso = new_sym_var(sizeof(int) * 8);
  stock[num_produtos].quantidade = new_sym_var(sizeof(int) * 8);
  stock[num_produtos].idp = num_produtos;
  por_preco[num_produtos] = num_produtos;
  printf("Novo produto %d.\n", num_produtos);
  num_produtos++;
}

void comando_q()
{
  int idp;
  int quantidade;
  idp = new_sym_var(sizeof(int) * 8);
  quantidade = new_sym_var(sizeof(int) * 8);
  if (idp >= num_produtos)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
  }
  else
  {
    stock[idp].quantidade += quantidade;
  }

}

void comando_N()
{
  encomendas[num_encomendas].tamanho = 0;
  encomendas[num_encomendas].peso = 0;
  printf("Nova encomenda %d.\n", num_encomendas);
  num_encomendas++;
}

void comando_A()
{
  int ide;
  int idp;
  int quantidade;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  quantidade = new_sym_var(sizeof(int) * 8);
  if (ide >= num_encomendas)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (idp >= num_produtos)
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      if (quantidade > stock[idp].quantidade)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
      }
      else
      {
        if (((quantidade * stock[idp].peso) + encomendas[ide].peso) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
        }
        else
        {
          int procurar = encontrar_produto(encomendas[ide].itens, 0, encomendas[ide].tamanho - 1, idp);
          stock[idp].quantidade -= quantidade;
          encomendas[ide].peso += quantidade * stock[idp].peso;
          if (procurar != (-1))
          {
            encomendas[ide].itens[procurar].quantidade += quantidade;
          }
          else
          {
            encomendas[ide].itens[encomendas[ide].tamanho].idp = idp;
            encomendas[ide].itens[encomendas[ide].tamanho].quantidade = quantidade;
            inserir_produto(encomendas[ide].itens, 0, encomendas[ide].tamanho);
            encomendas[ide].tamanho++;
          }

        }

      }

    }

  }

}

void comando_r()
{
  int idp;
  int quantidade;
  idp = new_sym_var(sizeof(int) * 8);
  quantidade = new_sym_var(sizeof(int) * 8);
  if (idp >= num_produtos)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    if ((stock[idp].quantidade - quantidade) < 0)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", quantidade, idp);
    }
    else
    {
      stock[idp].quantidade -= quantidade;
    }

  }

}

void comando_R()
{
  int ide;
  int idp;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (ide >= num_encomendas)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (idp >= num_produtos)
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      int pos = encontrar_produto(encomendas[ide].itens, 0, encomendas[ide].tamanho - 1, idp);
      if (pos != (-1))
      {
        int i;
        encomendas[ide].peso -= encomendas[ide].itens[pos].quantidade * stock[idp].peso;
        stock[idp].quantidade += encomendas[ide].itens[pos].quantidade;
        encomendas[ide].itens[pos].quantidade = 0;
        for (i = pos; i < (encomendas[ide].tamanho - 1); i++)
        {
          encomendas[ide].itens[i] = encomendas[ide].itens[i + 1];
        }

        encomendas[ide].tamanho--;
      }
      else
      {
        
      }

    }

  }

}

void comando_C()
{
  int ide;
  ide = new_sym_var(sizeof(int) * 8);
  if (ide >= num_encomendas)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    int custo = 0;
    int i;
    int tamanho = encomendas[ide].tamanho;
    for (i = 0; i < tamanho; i++)
    {
      custo += stock[encomendas[ide].itens[i].idp].preco * encomendas[ide].itens[i].quantidade;
    }

    printf("Custo da encomenda %d %d.\n", ide, custo);
  }

}

void comando_p()
{
  int idp;
  int preco;
  idp = new_sym_var(sizeof(int) * 8);
  preco = new_sym_var(sizeof(int) * 8);
  if (idp >= num_produtos)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    stock[idp].preco = preco;
  }

}

void comando_E()
{
  int ide;
  int idp;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (ide >= num_encomendas)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    if (idp >= num_produtos)
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
    }
    else
    {
      int quantidade = 0;
      int indice = encontrar_produto(encomendas[ide].itens, 0, encomendas[ide].tamanho, idp);
      if (indice != (-1))
      {
        quantidade += encomendas[ide].itens[indice].quantidade;
      }
      else
      {
        
      }

      printf("%s %d.\n", stock[idp].descricao, quantidade);
    }

  }

}

void comando_m()
{
  int idp;
  idp = new_sym_var(sizeof(int) * 8);
  if (idp >= num_produtos)
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    if (num_encomendas > 0)
    {
      int quantidade = 0;
      int ide = 0;
      int i;
      for (i = 0; i < num_encomendas; i++)
      {
        int item = encontrar_produto(encomendas[i].itens, 0, encomendas[i].tamanho - 1, idp);
        if ((item != (-1)) && (encomendas[i].itens[item].quantidade > quantidade))
        {
          quantidade = encomendas[i].itens[item].quantidade;
          ide = i;
        }
        else
        {
          
        }

      }

      if (quantidade > 0)
      {
        printf("Maximo produto %d %d %d.\n", idp, ide, quantidade);
      }
      else
      {
        
      }

    }
    else
    {
      
    }

  }

}

void comando_l()
{
  int i;
  mergesort(por_preco, 0, num_produtos - 1);
  printf("Produtos\n");
  for (i = 0; i < num_produtos; i++)
  {
    int idp = por_preco[i];
    printf("* %s %d %d\n", stock[idp].descricao, stock[idp].preco, stock[idp].quantidade);
  }

}

void comando_L()
{
  int ide;
  ide = new_sym_var(sizeof(int) * 8);
  if (ide >= num_encomendas)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    int i;
    printf("Encomenda %d\n", ide);
    for (i = 0; i < encomendas[ide].tamanho; i++)
    {
      int idp = encomendas[ide].itens[i].idp;
      int quantidade = encomendas[ide].itens[i].quantidade;
      printf("* %s %d %d\n", stock[idp].descricao, stock[idp].preco, quantidade);
    }

  }

}

