/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


typedef struct produto
{
  int idp;
  char desc[63];
  int preco;
  int peso;
  int quant;
  int estado;
} produto;
produto produtos[10000];
typedef struct encomenda
{
  int ide;
  produto produtos[10000];
  int estado;
  int peso;
  int preco;
  int numero;
} encomenda;
encomenda encomendas[500];
produto sistema[10000];
produto aux[10000];
produto resultado[10000];
produto resultado_string[10000];
int len;
int i;
int e;
int stock_plus;
int n;
int quant;
int idp_i;
int ide_i;
int quant_i;
int custo;
int max_produto;
int l;
int m;
int r;
int n_encomenda;
void adiciona_produto(int idp);
void adiciona_stock();
void adiciona_encomenda(int ide);
void adiciona_produto_encomenda();
void remove_stock();
void custo_encomenda();
void altera_preco();
void display_produto_encomenda();
void maximo_produto();
void ordena_sistema();
void ordena_encomenda();
void merge(produto sistema[10000], int l, int m, int r);
void merge_sort(produto sistema[10000], int l, int r);
void merge_string(produto a[10000], int l, int m, int r);
void merge_sort_string(produto a[10000], int l, int r);
void remove_produto_encomenda();
void inicializa_vetor(produto resultado_string[10000]);
int main()
{
  char c;
  int idp;
  int ide;
  idp = 0;
  ide = 0;
  while ((c = getchar()) != 'x')
  {
    switch (c)
    {
      case 'a':
        getchar();
        adiciona_produto(idp);
        idp++;
        break;

      case 'q':
        getchar();
        adiciona_stock();
        break;

      case 'N':
        getchar();
        adiciona_encomenda(ide);
        ide++;
        break;

      case 'A':
        getchar();
        adiciona_produto_encomenda();
        break;

      case 'r':
        getchar();
        remove_stock();
        break;

      case 'R':
        getchar();
        remove_produto_encomenda();
        break;

      case 'C':
        getchar();
        custo_encomenda();
        break;

      case 'p':
        getchar();
        altera_preco();
        break;

      case 'E':
        getchar();
        display_produto_encomenda();
        break;

      case 'm':
        getchar();
        maximo_produto();
        break;

      case 'l':
        getchar();
        ordena_sistema(idp);
        break;

      case 'L':
        getchar();
        ordena_encomenda();
        break;

    }

  }

  return 0;
}

void adiciona_produto(int idp_i)
{
  sistema[idp_i].idp = idp_i;
  sistema[idp_i].estado = 1;
  for (int sistema_index = 0; sistema_index < 10; sistema_index++)
  {
    sistema[idp_i].desc[sistema_index] = new_sym_var(sizeof(char) * 8);
  }

  sistema[idp_i].desc[10 - 1] = '\0';
  sistema[idp_i].preco = new_sym_var(sizeof(int) * 8);
  sistema[idp_i].peso = new_sym_var(sizeof(int) * 8);
  sistema[idp_i].quant = new_sym_var(sizeof(int) * 8);
  printf("Novo produto %d.\n", idp_i);
}

void adiciona_stock()
{
  n = new_sym_var(sizeof(int) * 8);
  stock_plus = new_sym_var(sizeof(int) * 8);
  if (sistema[n].estado == 1)
  {
    sistema[n].quant += stock_plus;
  }
  else
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", n);
  }

}

void adiciona_encomenda(int ide)
{
  encomendas[ide].estado = 1;
  encomendas[ide].ide = ide;
  encomendas[ide].peso = 0;
  encomendas[ide].preco = 0;
  encomendas[ide].numero = 0;
  printf("Nova encomenda %d.\n", ide);
}

void adiciona_produto_encomenda()
{
  ide_i = new_sym_var(sizeof(int) * 8);
  idp_i = new_sym_var(sizeof(int) * 8);
  quant_i = new_sym_var(sizeof(int) * 8);
  if (encomendas[ide_i].estado != 1)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp_i, ide_i);
  }
  else
  {
    if (sistema[idp_i].estado != 1)
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp_i, ide_i);
    }
    else
    {
      if (quant_i > sistema[idp_i].quant)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp_i, ide_i);
      }
      else
      {
        if ((encomendas[ide_i].peso + (sistema[idp_i].peso * quant_i)) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp_i, ide_i);
        }
        else
        {
          if (encomendas[ide_i].produtos[idp_i].estado != 1)
          {
            encomendas[ide_i].produtos[idp_i].idp = sistema[idp_i].idp;
            strcpy(encomendas[ide_i].produtos[idp_i].desc, sistema[idp_i].desc);
            encomendas[ide_i].produtos[idp_i].preco = sistema[idp_i].preco;
            encomendas[ide_i].produtos[idp_i].peso = sistema[idp_i].peso;
            encomendas[ide_i].produtos[idp_i].estado = 1;
            encomendas[ide_i].numero++;
          }
          else
          {
            
          }

          encomendas[ide_i].produtos[idp_i].quant += quant_i;
          encomendas[ide_i].peso += sistema[idp_i].peso * quant_i;
          encomendas[ide_i].preco += sistema[idp_i].preco * quant_i;
          sistema[idp_i].quant -= quant_i;
        }

      }

    }

  }

}

void remove_stock()
{
  idp_i = new_sym_var(sizeof(int) * 8);
  quant_i = new_sym_var(sizeof(int) * 8);
  if (sistema[idp_i].estado != 1)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp_i);
  }
  else
  {
    if (quant_i > sistema[idp_i].quant)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", quant_i, idp_i);
    }
    else
    {
      sistema[idp_i].quant -= quant_i;
    }

  }

}

void remove_produto_encomenda()
{
  ide_i = new_sym_var(sizeof(int) * 8);
  idp_i = new_sym_var(sizeof(int) * 8);
  if (encomendas[ide_i].estado != 1)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp_i, ide_i);
  }
  else
  {
    if (sistema[idp_i].estado != 1)
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp_i, ide_i);
    }
    else
    {
      if (encomendas[ide_i].produtos[idp_i].estado == 1)
      {
        sistema[idp_i].quant += encomendas[ide_i].produtos[idp_i].quant;
        encomendas[ide_i].peso -= encomendas[ide_i].produtos[idp_i].quant * encomendas[ide_i].produtos[idp_i].peso;
        encomendas[ide_i].preco -= encomendas[ide_i].produtos[idp_i].quant * encomendas[ide_i].produtos[idp_i].preco;
        encomendas[ide_i].produtos[idp_i].estado = 0;
        encomendas[ide_i].produtos[idp_i].peso = 0;
        encomendas[ide_i].produtos[idp_i].preco = 0;
        encomendas[ide_i].produtos[idp_i].quant = 0;
        encomendas[ide_i].numero--;
      }
      else
      {
        
      }

    }

  }

}

void custo_encomenda()
{
  ide_i = new_sym_var(sizeof(int) * 8);
  if (encomendas[ide_i].estado != 1)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide_i);
  }
  else
  {
    printf("Custo da encomenda %d %d.\n", ide_i, encomendas[ide_i].preco);
  }

}

void altera_preco()
{
  idp_i = new_sym_var(sizeof(int) * 8);
  n = new_sym_var(sizeof(int) * 8);
  if (sistema[idp_i].estado != 1)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp_i);
  }
  else
  {
    sistema[idp_i].preco = n;
    for (i = 0; i < 500; i++)
    {
      if (encomendas[i].produtos[idp_i].estado == 1)
      {
        encomendas[i].preco -= encomendas[i].produtos[idp_i].preco * encomendas[i].produtos[idp_i].quant;
        encomendas[i].produtos[idp_i].preco = n;
        encomendas[i].preco += encomendas[i].produtos[idp_i].preco * encomendas[i].produtos[idp_i].quant;
      }
      else
      {
        
      }

    }

  }

}

void display_produto_encomenda()
{
  ide_i = new_sym_var(sizeof(int) * 8);
  idp_i = new_sym_var(sizeof(int) * 8);
  if (encomendas[ide_i].estado != 1)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide_i);
  }
  else
  {
    if (sistema[idp_i].estado != 1)
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", idp_i);
    }
    else
    {
      printf("%s %d.\n", sistema[idp_i].desc, encomendas[ide_i].produtos[idp_i].quant);
    }

  }

}

void maximo_produto()
{
  idp_i = new_sym_var(sizeof(int) * 8);
  if (sistema[idp_i].estado != 1)
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp_i);
  }
  else
  {
    max_produto = 0;
    n_encomenda = 0;
    for (e = 0; e <= 500; e++)
    {
      if (encomendas[e].produtos[idp_i].estado == 1)
      {
        if (encomendas[e].produtos[idp_i].quant > max_produto)
        {
          n_encomenda = e;
          max_produto = encomendas[e].produtos[idp_i].quant;
        }
        else
        {
          
        }

      }
      else
      {
        
      }

    }

    if (max_produto > 0)
    {
      printf("Maximo produto %d %d %d.\n", idp_i, encomendas[n_encomenda].ide, max_produto);
    }
    else
    {
      
    }

  }

}

void ordena_sistema(int idp_i)
{
  for (i = 0; i < idp_i; i++)
  {
    strcpy(resultado[i].desc, sistema[i].desc);
    resultado[i].idp = sistema[i].idp;
    resultado[i].peso = sistema[i].peso;
    resultado[i].preco = sistema[i].preco;
    resultado[i].quant = sistema[i].quant;
  }

  merge_sort(resultado, 0, idp_i - 1);
  printf("Produtos\n");
  for (i = 0; i < idp_i; i++)
  {
    printf("* %s %d %d\n", resultado[i].desc, resultado[i].preco, resultado[i].quant);
  }

}

void ordena_encomenda()
{
  ide_i = new_sym_var(sizeof(int) * 8);
  inicializa_vetor(resultado_string);
  if (encomendas[ide_i].estado != 1)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide_i);
  }
  else
  {
    i = 0;
    e = 0;
    while (e < encomendas[ide_i].numero)
    {
      if (encomendas[ide_i].produtos[i].estado == 1)
      {
        strcpy(resultado_string[e].desc, encomendas[ide_i].produtos[i].desc);
        resultado_string[e].idp = encomendas[ide_i].produtos[i].idp;
        resultado_string[e].peso = encomendas[ide_i].produtos[i].peso;
        resultado_string[e].preco = encomendas[ide_i].produtos[i].preco;
        resultado_string[e].quant = encomendas[ide_i].produtos[i].quant;
        e++;
      }
      else
      {
        
      }

      i++;
    }

    printf("Encomenda %d\n", ide_i);
    merge_sort_string(resultado_string, 0, e - 1);
    for (i = 0; i < e; i++)
    {
      printf("* %s %d %d\n", resultado_string[i].desc, resultado_string[i].preco, resultado_string[i].quant);
    }

  }

}

void inicializa_vetor(produto resultado_string[10000])
{
  for (i = 0; i <= 10000; i++)
  {
    resultado_string[i].desc[0] = '\0';
    resultado_string[i].idp = 0;
    resultado_string[i].peso = 0;
    resultado_string[i].preco = 0;
    resultado_string[i].quant = 0;
  }

}

void merge(produto a[10000], int l, int m, int r)
{
  int i;
  int j;
  int k;
  for (i = m + 1; i > l; i--)
  {
    aux[i - 1] = a[i - 1];
  }

  for (j = m; j < r; j++)
  {
    aux[(r + m) - j] = a[j + 1];
  }

  for (k = l; k <= r; k++)
  {
    if (aux[j].preco < aux[i].preco)
    {
      resultado[k] = aux[j--];
    }
    else
    {
      if (aux[j].preco == aux[i].preco)
      {
        if (aux[j].idp < aux[i].idp)
        {
          resultado[k] = aux[j--];
        }
        else
        {
          resultado[k] = aux[i++];
        }

      }
      else
      {
        resultado[k] = aux[i++];
      }

    }

  }

}

void merge_sort(produto a[10000], int l, int r)
{
  int m = (l + r) / 2;
  if (r <= l)
  {
    return;
  }
  else
  {
    
  }

  merge_sort(a, l, m);
  merge_sort(a, m + 1, r);
  merge(a, l, m, r);
}

void merge_string(produto a[10000], int l, int m, int r)
{
  int i;
  int j;
  int k;
  for (i = m + 1; i > l; i--)
  {
    aux[i - 1] = a[i - 1];
  }

  for (j = m; j < r; j++)
  {
    aux[(r + m) - j] = a[j + 1];
  }

  for (k = l; k <= r; k++)
  {
    if (strcmp(aux[j].desc, aux[i].desc) < 0)
    {
      resultado_string[k] = aux[j--];
    }
    else
    {
      resultado_string[k] = aux[i++];
    }

  }

}

void merge_sort_string(produto a[10000], int l, int r)
{
  int m = (l + r) / 2;
  if (r <= l)
  {
    return;
  }
  else
  {
    
  }

  merge_sort_string(a, l, m);
  merge_sort_string(a, m + 1, r);
  merge_string(a, l, m, r);
}

