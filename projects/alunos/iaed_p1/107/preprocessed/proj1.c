#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


typedef struct produto
{
  int id;
  char descricao[64];
  int preco;
  int peso;
  int qtd;
} produto;
typedef struct encomenda
{
  produto prods[200];
  int prod_num;
  int id;
  int peso;
} encomenda;
produto armazem[10000];
encomenda pedidos[500];
int p_num;
int e_num;
int teste_produto_encomenda(int ide, int idp)
{
  int i;
  for (i = 0; i < 200; i++)
  {
    if ((pedidos[ide].prods[i].id == idp) && (pedidos[ide].prods[i].peso != 0))
    {
      return i;
    }
    else
    {
      
    }

  }

  return -1;
}

int teste_encomenda(int ide)
{
  return (pedidos[ide].id == ide) && e_num;
}

int teste_produto(int idp)
{
  return (armazem[idp].id == idp) && p_num;
}

void merge_preco(produto vetor[], int esq, int meio, int dir)
{
  produto tmp[10000];
  int i;
  int j;
  int k;
  for (i = meio + 1; i > esq; i--)
  {
    tmp[i - 1] = vetor[i - 1];
  }

  for (j = meio; j < dir; j++)
  {
    tmp[(dir + meio) - j] = vetor[j + 1];
  }

  for (k = esq; k <= dir; k++)
  {
    if ((tmp[j].preco < tmp[i].preco) || ((tmp[j].preco == tmp[i].preco) && (tmp[j].id < tmp[i].id)))
    {
      vetor[k] = tmp[j--];
    }
    else
    {
      vetor[k] = tmp[i++];
    }

  }

}

void merge_id(produto vetor[], int esq, int meio, int dir)
{
  produto tmp[10000];
  int i;
  int j;
  int k;
  for (i = meio + 1; i > esq; i--)
  {
    tmp[i - 1] = vetor[i - 1];
  }

  for (j = meio; j < dir; j++)
  {
    tmp[(dir + meio) - j] = vetor[j + 1];
  }

  for (k = esq; k <= dir; k++)
  {
    if (tmp[j].id < tmp[i].id)
    {
      vetor[k] = tmp[j--];
    }
    else
    {
      vetor[k] = tmp[i++];
    }

  }

}

void merge_nome(produto vetor[], int esq, int meio, int dir)
{
  produto tmp[10000];
  int i;
  int j;
  int k;
  for (i = meio + 1; i > esq; i--)
  {
    tmp[i - 1] = vetor[i - 1];
  }

  for (j = meio; j < dir; j++)
  {
    tmp[(dir + meio) - j] = vetor[j + 1];
  }

  for (k = esq; k <= dir; k++)
  {
    if (strcmp(tmp[j].descricao, tmp[i].descricao) < 0)
    {
      vetor[k] = tmp[j--];
    }
    else
    {
      vetor[k] = tmp[i++];
    }

  }

}

void mergesort(produto vetor[], int esq, int dir, int ctrl)
{
  int meio = (dir + esq) / 2;
  if (dir <= esq)
  {
    return;
  }
  else
  {
    
  }

  mergesort(vetor, esq, meio, ctrl);
  mergesort(vetor, meio + 1, dir, ctrl);
  if (ctrl == 0)
  {
    merge_nome(vetor, esq, meio, dir);
  }
  else
  {
    if (ctrl == 1)
    {
      merge_preco(vetor, esq, meio, dir);
    }
    else
    {
      if (ctrl == 2)
      {
        merge_id(vetor, esq, meio, dir);
      }
      else
      {
        
      }

    }

  }

}

void adicionar_produto_sistema(char descricao[], int preco, int peso, int qtd)
{
  strcpy(armazem[p_num].descricao, descricao);
  armazem[p_num].id = p_num;
  armazem[p_num].preco = preco;
  armazem[p_num].peso = peso;
  armazem[p_num].qtd = qtd;
  printf("Novo produto %d.\n", p_num);
  p_num++;
}

void adicionar_stock(int idp, int qtd)
{
  if (teste_produto(idp))
  {
    armazem[idp].qtd += qtd;
  }
  else
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
  }

}

void adicionar_encomenda()
{
  pedidos[e_num].id = e_num;
  pedidos[e_num].peso = 0;
  pedidos[e_num].prod_num = 0;
  printf("Nova encomenda %d.\n", e_num);
  e_num++;
}

void remove_stock(int idp, int qtd)
{
  if (!teste_produto(idp))
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
    return;
  }
  else
  {
    if ((armazem[idp].qtd - qtd) >= 0)
    {
      armazem[idp].qtd -= qtd;
    }
    else
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, idp);
    }

  }

}

void adicionar_produto_encomenda(int ide, int idp, int qtd)
{
  int i;
  if (!teste_encomenda(ide))
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
    return;
  }
  else
  {
    if (!teste_produto(idp))
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
      return;
    }
    else
    {
      if (qtd > armazem[idp].qtd)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
        return;
      }
      else
      {
        if ((pedidos[ide].peso + (qtd * armazem[idp].peso)) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
          return;
        }
        else
        {
          
        }

      }

    }

  }

  if ((i = teste_produto_encomenda(ide, idp)) == (-1))
  {
    i = pedidos[ide].prod_num;
    pedidos[ide].prods[i] = armazem[idp];
    pedidos[ide].prods[i].qtd = 0;
    pedidos[ide].prod_num++;
  }
  else
  {
    
  }

  remove_stock(idp, qtd);
  pedidos[ide].prods[i].qtd += qtd;
  pedidos[ide].peso += armazem[idp].peso * qtd;
}

void remove_produto_encomenda(int ide, int idp)
{
  int i;
  if (!teste_encomenda(ide))
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (!teste_produto(idp))
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      if ((i = teste_produto_encomenda(ide, idp)) != (-1))
      {
        pedidos[ide].peso -= pedidos[ide].prods[i].qtd * pedidos[ide].prods[i].peso;
        armazem[idp].qtd += pedidos[ide].prods[i].qtd;
        while (i < pedidos[ide].prod_num)
        {
          pedidos[ide].prods[i] = pedidos[ide].prods[i + 1];
          i++;
        }

        pedidos[ide].prod_num--;
      }
      else
      {
        
      }

    }

  }

}

void calcula_custo(int ide)
{
  int i;
  int total = 0;
  if (teste_encomenda(ide))
  {
    for (i = 0; i < pedidos[ide].prod_num; i++)
    {
      total += pedidos[ide].prods[i].preco * pedidos[ide].prods[i].qtd;
    }

    printf("Custo da encomenda %d %d.\n", ide, total);
  }
  else
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }

}

void altera_preco_produto(int idp, int preco)
{
  int i;
  int j;
  if (teste_produto(idp))
  {
    armazem[idp].preco = preco;
    for (i = 0; i < e_num; i++)
    {
      if ((j = teste_produto_encomenda(i, idp)) != (-1))
      {
        pedidos[i].prods[j].preco = preco;
      }
      else
      {
        
      }

    }

  }
  else
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
  }

}

void lista_produto_encomenda(int ide, int idp)
{
  int i;
  int qtd = 0;
  if (teste_encomenda(ide))
  {
    if (teste_produto(idp))
    {
      if ((i = teste_produto_encomenda(ide, idp)) != (-1))
      {
        qtd = pedidos[ide].prods[i].qtd;
      }
      else
      {
        
      }

      printf("%s %d.\n", armazem[idp].descricao, qtd);
    }
    else
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
    }

  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }

}

void lista_produto_ocorremais(int idp)
{
  int i;
  int j;
  int maior = -1;
  int qtd = 0;
  if (!e_num)
  {
    return;
  }
  else
  {
    
  }

  if (teste_produto(idp))
  {
    for (i = 0; i < e_num; i++)
    {
      if (((j = teste_produto_encomenda(i, idp)) != (-1)) && (pedidos[i].prods[j].qtd > qtd))
      {
        qtd = pedidos[i].prods[j].qtd;
        maior = i;
      }
      else
      {
        
      }

    }

    if (maior == (-1))
    {
      return;
    }
    else
    {
      printf("Maximo produto %d %d %d.\n", idp, maior, qtd);
    }

  }
  else
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
  }

}

void lista_produtos_preco()
{
  int i;
  mergesort(armazem, 0, p_num - 1, 1);
  printf("Produtos\n");
  i = 0;
  while (i < p_num)
  {
    printf("* %s %d %d\n", armazem[i].descricao, armazem[i].preco, armazem[i].qtd);
    i++;
  }

  mergesort(armazem, 0, p_num - 1, 2);
}

void lista_encomenda_nome(int ide)
{
  int i;
  if (teste_encomenda(ide))
  {
    mergesort(pedidos[ide].prods, 0, pedidos[ide].prod_num - 1, 0);
    printf("Encomenda %d\n", ide);
    i = 0;
    while (i < pedidos[ide].prod_num)
    {
      printf("* %s %d %d\n", pedidos[ide].prods[i].descricao, pedidos[ide].prods[i].preco, pedidos[ide].prods[i].qtd);
      i++;
    }

  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }

}

int main()
{
  char s;
  char arg1[64];
  int arg2;
  int arg3;
  int arg4;
  while ((s = getchar()) != EOF)
  {
    switch (s)
    {
      case 'a':
        getchar();
        for (int arg1_index = 0; arg1_index < 10; arg1_index++)
      {
        arg1[arg1_index] = new_sym_var(sizeof(char) * 8);
      }

        arg1[10 - 1] = '\0';
        arg2 = new_sym_var(sizeof(int) * 8);
        arg3 = new_sym_var(sizeof(int) * 8);
        arg4 = new_sym_var(sizeof(int) * 8);
        adicionar_produto_sistema(arg1, arg2, arg3, arg4);
        break;

      case 'q':
        arg2 = new_sym_var(sizeof(int) * 8);
        arg3 = new_sym_var(sizeof(int) * 8);
        adicionar_stock(arg2, arg3);
        break;

      case 'N':
        adicionar_encomenda();
        break;

      case 'A':
        arg2 = new_sym_var(sizeof(int) * 8);
        arg3 = new_sym_var(sizeof(int) * 8);
        arg4 = new_sym_var(sizeof(int) * 8);
        adicionar_produto_encomenda(arg2, arg3, arg4);
        break;

      case 'r':
        arg2 = new_sym_var(sizeof(int) * 8);
        arg3 = new_sym_var(sizeof(int) * 8);
        remove_stock(arg2, arg3);
        break;

      case 'R':
        arg2 = new_sym_var(sizeof(int) * 8);
        arg3 = new_sym_var(sizeof(int) * 8);
        remove_produto_encomenda(arg2, arg3);
        break;

      case 'C':
        arg2 = new_sym_var(sizeof(int) * 8);
        calcula_custo(arg2);
        break;

      case 'p':
        arg2 = new_sym_var(sizeof(int) * 8);
        arg3 = new_sym_var(sizeof(int) * 8);
        altera_preco_produto(arg2, arg3);
        break;

      case 'E':
        arg2 = new_sym_var(sizeof(int) * 8);
        arg3 = new_sym_var(sizeof(int) * 8);
        lista_produto_encomenda(arg2, arg3);
        break;

      case 'm':
        arg2 = new_sym_var(sizeof(int) * 8);
        lista_produto_ocorremais(arg2);
        break;

      case 'l':
        lista_produtos_preco();
        break;

      case 'L':
        arg2 = new_sym_var(sizeof(int) * 8);
        lista_encomenda_nome(arg2);
        break;

      case 'x':
        return 0;

      default:
        break;

    }

    getchar();
  }

  return 0;
}

