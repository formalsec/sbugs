#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


int stop = 0;
int idp = 0;
int ide = 0;
struct prod
{
  int price;
  int weight;
  int stock;
  int id_prod;
  char desc[63];
};
struct prod produtos[10000];
struct prod aux2[10000];
struct prod aux1[10000];
struct prod encomendas[500][201];
void add_prod();
void add_enc();
void remove_prod();
void remove_enc();
void add_stock_prod();
void cria_nova_enc();
void cost_enc();
void change_price_prod();
void check_stock();
void search_most_wanted();
void list_prod_value();
void list_enc_name();
void print_prod();
void print_enc(int x);
void mergesort(struct prod a[], int left, int right);
void merge(struct prod a[], int left, int m, int right);
int main()
{
  while (stop != 1)
  {
    int op;
    op = getchar();
    if (op == 'a')
    {
      add_prod();
    }
    else
    {
      if (op == 'q')
      {
        add_stock_prod();
      }
      else
      {
        if (op == 'N')
        {
          cria_nova_enc();
        }
        else
        {
          if (op == 'A')
          {
            add_enc();
          }
          else
          {
            if (op == 'r')
            {
              remove_prod();
            }
            else
            {
              if (op == 'R')
              {
                remove_enc();
              }
              else
              {
                if (op == 'C')
                {
                  cost_enc();
                }
                else
                {
                  if (op == 'p')
                  {
                    change_price_prod();
                  }
                  else
                  {
                    if (op == 'E')
                    {
                      check_stock();
                    }
                    else
                    {
                      if (op == 'm')
                      {
                        search_most_wanted();
                      }
                      else
                      {
                        if (op == 'l')
                        {
                          list_prod_value();
                        }
                        else
                        {
                          if (op == 'L')
                          {
                            list_enc_name();
                          }
                          else
                          {
                            if (op == 'x')
                            {
                              stop = 1;
                            }
                            else
                            {
                              continue;
                            }

                          }

                        }

                      }

                    }

                  }

                }

              }

            }

          }

        }

      }

    }

  }

  return 0;
}

void add_prod()
{
  int j;
  int i = 0;
  int preco;
  int peso;
  int qtd;
  char descricao[63];
  char aux;
  getchar();
  aux = getchar();
  for (j = 0; aux != ':'; j++)
  {
    descricao[j] = aux;
    aux = getchar();
  }

  descricao[j] = '\0';
  preco = new_sym_var(sizeof(int) * 8);
  getchar();
  peso = new_sym_var(sizeof(int) * 8);
  getchar();
  qtd = new_sym_var(sizeof(int) * 8);
  for (i = 0; descricao[i] != '\0'; i++)
    produtos[idp].desc[i] = descricao[i];

  produtos[idp].price = preco;
  produtos[idp].weight = peso;
  produtos[idp].stock = qtd;
  produtos[idp].id_prod = idp;
  printf("Novo produto %d.\n", idp);
  idp++;
}

void add_enc()
{
  int i;
  int id_enc;
  int id_prod;
  int qtd;
  int aux;
  int in = 0;
  getchar();
  id_enc = new_sym_var(sizeof(int) * 8);
  getchar();
  id_prod = new_sym_var(sizeof(int) * 8);
  getchar();
  qtd = new_sym_var(sizeof(int) * 8);
  if (id_enc >= ide)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", id_prod, id_enc);
  }
  else
  {
    if (id_prod >= idp)
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", id_prod, id_enc);
    }
    else
    {
      if (produtos[id_prod].stock < qtd)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", id_prod, id_enc);
      }
      else
      {
        if ((encomendas[id_enc][200].weight + (produtos[id_prod].weight * qtd)) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", id_prod, id_enc);
        }
        else
        {
          aux = encomendas[id_enc][200].stock;
          for (i = 0; i < aux; i++)
          {
            if (strcmp(produtos[id_prod].desc, encomendas[id_enc][i].desc) == 0)
            {
              in = 1;
              encomendas[id_enc][i].stock += qtd;
              encomendas[id_enc][200].price += qtd * produtos[id_prod].price;
              encomendas[id_enc][200].weight += qtd * produtos[id_prod].weight;
              produtos[id_prod].stock -= qtd;
            }
            else
            {
              
            }

          }

          if (in == 0)
          {
            encomendas[id_enc][aux].price = produtos[id_prod].price;
            encomendas[id_enc][aux].stock = qtd;
            encomendas[id_enc][aux].weight = produtos[id_prod].weight;
            strcpy(encomendas[id_enc][aux].desc, produtos[id_prod].desc);
            encomendas[id_enc][200].price += produtos[id_prod].price * qtd;
            encomendas[id_enc][200].weight += produtos[id_prod].weight * qtd;
            encomendas[id_enc][200].stock++;
            produtos[id_prod].stock -= qtd;
          }
          else
          {
            
          }

        }

      }

    }

  }

}

void remove_prod()
{
  int id_prod;
  int qtd;
  getchar();
  id_prod = new_sym_var(sizeof(int) * 8);
  getchar();
  qtd = new_sym_var(sizeof(int) * 8);
  if (id_prod >= idp)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", id_prod);
  }
  else
  {
    if ((produtos[id_prod].stock - qtd) < 0)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, id_prod);
    }
    else
    {
      produtos[id_prod].stock -= qtd;
    }

  }

}

void remove_enc()
{
  int id_enc;
  int id_prod;
  int aux;
  int i;
  int in = 0;
  getchar();
  id_enc = new_sym_var(sizeof(int) * 8);
  getchar();
  id_prod = new_sym_var(sizeof(int) * 8);
  if (id_enc >= ide)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", id_prod, id_enc);
  }
  else
  {
    if (id_prod >= idp)
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", id_prod, id_enc);
    }
    else
    {
      aux = encomendas[id_enc][200].stock;
      for (i = 0; i < aux; i++)
        if (strcmp(produtos[id_prod].desc, encomendas[id_enc][i].desc) == 0)
      {
        in = 1;
        break;
      }
      else
      {
        
      }


      if (in == 1)
      {
        encomendas[id_enc][200].price -= produtos[id_prod].price * encomendas[id_enc][i].stock;
        encomendas[id_enc][200].weight -= produtos[id_prod].weight * encomendas[id_enc][i].stock;
        produtos[id_prod].stock += encomendas[id_enc][i].stock;
        encomendas[id_enc][i].stock = 0;
      }
      else
      {
        
      }

    }

  }

}

void add_stock_prod()
{
  int id;
  int qtd;
  getchar();
  id = new_sym_var(sizeof(int) * 8);
  getchar();
  qtd = new_sym_var(sizeof(int) * 8);
  if (id >= idp)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", id);
  }
  else
  {
    produtos[id].stock += qtd;
  }

}

void cria_nova_enc()
{
  printf("Nova encomenda %d.\n", ide);
  encomendas[ide][200].price = 0;
  encomendas[ide][200].weight = 0;
  encomendas[ide][200].stock = 0;
  encomendas[ide][200].id_prod = 200;
  strcpy(&encomendas[ide][200].desc[0], "Fatura");
  ide++;
}

void cost_enc()
{
  int id_enc;
  getchar();
  id_enc = new_sym_var(sizeof(int) * 8);
  if (id_enc >= ide)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", id_enc);
  }
  else
  {
    printf("Custo da encomenda %d %d.\n", id_enc, encomendas[id_enc][200].price);
  }

}

void change_price_prod()
{
  int i;
  int j;
  int aux;
  int id_prod;
  int preco;
  getchar();
  id_prod = new_sym_var(sizeof(int) * 8);
  getchar();
  preco = new_sym_var(sizeof(int) * 8);
  if (id_prod >= idp)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", id_prod);
  }
  else
  {
    produtos[id_prod].price = preco;
    for (i = 0; i < ide; i++)
    {
      aux = encomendas[i][200].stock;
      for (j = 0; j < aux; j++)
        if (strcmp(produtos[id_prod].desc, encomendas[i][j].desc) == 0)
      {
        encomendas[i][200].price -= encomendas[i][j].stock * encomendas[i][j].price;
        encomendas[i][j].price = preco;
        encomendas[i][200].price += encomendas[i][j].stock * encomendas[i][j].price;
      }
      else
      {
        
      }


    }

  }

}

void check_stock()
{
  int not_in = 1;
  int aux;
  int i;
  int id_enc;
  int id_prod;
  getchar();
  id_enc = new_sym_var(sizeof(int) * 8);
  getchar();
  id_prod = new_sym_var(sizeof(int) * 8);
  if (id_enc >= ide)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", id_enc);
  }
  else
  {
    if (id_prod >= idp)
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", id_prod);
    }
    else
    {
      aux = encomendas[id_enc][200].stock;
      for (i = 0; i < aux; i++)
        if (strcmp(produtos[id_prod].desc, encomendas[id_enc][i].desc) == 0)
      {
        printf("%s %d.\n", produtos[id_prod].desc, encomendas[id_enc][i].stock);
        not_in = 0;
        break;
      }
      else
      {
        
      }


      if (not_in == 1)
      {
        printf("%s 0.\n", produtos[id_prod].desc);
      }
      else
      {
        
      }

    }

  }

}

void search_most_wanted()
{
  int aux;
  int i;
  int j;
  int id_prod;
  int maior = 0;
  int qtd = 0;
  getchar();
  id_prod = new_sym_var(sizeof(int) * 8);
  if (id_prod >= idp)
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", id_prod);
  }
  else
  {
    for (i = 0; i < ide; i++)
    {
      aux = encomendas[i][200].stock;
      for (j = 0; j < aux; j++)
      {
        if (strcmp(produtos[id_prod].desc, encomendas[i][j].desc) == 0)
        {
          if (qtd < encomendas[i][j].stock)
          {
            qtd = encomendas[i][j].stock;
            maior = i;
          }
          else
          {
            
          }

        }
        else
        {
          
        }

      }

    }

    if (qtd != 0)
    {
      printf("Maximo produto %d %d %d.\n", id_prod, maior, qtd);
    }
    else
    {
      
    }

  }

}

void list_prod_value()
{
  int i;
  for (i = 0; i < idp; i++)
    aux2[i] = produtos[i];

  mergesort(aux2, 0, idp - 1);
  print_prod();
}

void list_enc_name()
{
  int menor;
  int nr_prods;
  int id_enc;
  int trade;
  int i;
  int j;
  char menor_d[63];
  struct prod aux;
  getchar();
  id_enc = new_sym_var(sizeof(int) * 8);
  if (id_enc >= ide)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", id_enc);
  }
  else
  {
    nr_prods = encomendas[id_enc][200].stock;
    for (i = 0; i < nr_prods; i++)
    {
      trade = 0;
      strcpy(menor_d, encomendas[id_enc][i].desc);
      for (j = i; j < nr_prods; j++)
        if (strcmp(encomendas[id_enc][j].desc, menor_d) < 0)
      {
        menor = j;
        strcpy(menor_d, encomendas[id_enc][j].desc);
        trade = 1;
      }
      else
      {
        
      }


      if (trade == 1)
      {
        aux = encomendas[id_enc][i];
        encomendas[id_enc][i] = encomendas[id_enc][menor];
        encomendas[id_enc][menor] = aux;
      }
      else
      {
        
      }

    }

    print_enc(id_enc);
  }

}

void print_prod()
{
  int i;
  printf("Produtos\n");
  for (i = 0; i < idp; i++)
    printf("* %s %d %d\n", aux2[i].desc, aux2[i].price, aux2[i].stock);

}

void print_enc(int x)
{
  int i;
  int aux;
  aux = encomendas[x][200].stock;
  printf("Encomenda %d\n", x);
  for (i = 0; i < aux; i++)
    if (encomendas[x][i].stock != 0)
  {
    printf("* %s %d %d\n", encomendas[x][i].desc, encomendas[x][i].price, encomendas[x][i].stock);
  }
  else
  {
    
  }


}

void mergesort(struct prod a[], int left, int right)
{
  int m = (right + left) / 2;
  if (right <= left)
  {
    return;
  }
  else
  {
    
  }

  mergesort(a, left, m);
  mergesort(a, m + 1, right);
  merge(a, left, m, right);
}

void merge(struct prod a[], int left, int m, int right)
{
  int i;
  int j;
  int k;
  for (i = m + 1; i > left; i--)
    aux1[i - 1] = a[i - 1];

  for (j = m; j < right; j++)
    aux1[(right + m) - j] = a[j + 1];

  for (k = left; k <= right; k++)
    if ((aux1[j].price < aux1[i].price) || ((aux1[j].price == aux1[i].price) && (aux1[j].id_prod < aux1[i].id_prod)))
  {
    a[k] = aux1[j--];
  }
  else
  {
    a[k] = aux1[i++];
  }


}

