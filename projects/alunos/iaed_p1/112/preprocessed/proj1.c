#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


typedef struct 
{
  int id;
  char descricao[63];
  int preco;
  int peso;
  int stock;
} Produto;
typedef struct 
{
  int quantidade;
  int id_produto;
} Data;
typedef struct 
{
  int peso;
  int num_produtos;
  Data produtos[200];
} Encomenda;
typedef struct 
{
  int id_produto;
  int to_sort;
  char *desc;
} ToSort;
int produto_in_encomenda(int idp, Encomenda encomenda)
{
  int i;
  for (i = 0; i < encomenda.num_produtos; i++)
  {
    if (idp == encomenda.produtos[i].id_produto)
    {
      return i;
    }
    else
    {
      
    }

  }

  return -1;
}

void repor_vetor(Data vetor[], int i_repor, int i_limite)
{
  int i;
  for (i = i_repor; i < i_limite; i++)
  {
    vetor[i] = vetor[i + 1];
  }

  vetor[i_limite].id_produto = 0;
  vetor[i_limite].quantidade = 0;
}

void a(Produto prod[10000], int prod_proximo)
{
  for (int prod_index = 0; prod_index < 10; prod_index++)
  {
    prod[prod_proximo].descricao[prod_index] = new_sym_var(sizeof(char) * 8);
  }

  prod[prod_proximo].descricao[10 - 1] = '\0';
  prod[prod_proximo].preco = new_sym_var(sizeof(int) * 8);
  prod[prod_proximo].peso = new_sym_var(sizeof(int) * 8);
  prod[prod_proximo].stock = new_sym_var(sizeof(int) * 8);
  prod[prod_proximo].id = prod_proximo;
  printf("Novo produto %d.\n", prod[prod_proximo].id);
}

void q(Produto prod[10000], int prod_proximo)
{
  int idp;
  int qnt;
  idp = new_sym_var(sizeof(int) * 8);
  qnt = new_sym_var(sizeof(int) * 8);
  if ((idp >= prod_proximo) || (idp < 0))
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
  }
  else
  {
    prod[idp].stock += qnt;
  }

}

void N(Encomenda enco[500], int enco_proximo)
{
  if (enco_proximo <= (500 - 1))
  {
    enco[enco_proximo].peso = 0;
    enco[enco_proximo].num_produtos = 0;
    printf("Nova encomenda %d.\n", enco_proximo);
  }
  else
  {
    
  }

}

void A(Produto prod[10000], Encomenda enco[500], int prod_proximo, int enco_proximo)
{
  int ide;
  int idp;
  int qnt;
  int in_order;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  qnt = new_sym_var(sizeof(int) * 8);
  if ((ide >= enco_proximo) || (ide < 0))
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if ((idp >= prod_proximo) || (idp < 0))
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      if ((prod[idp].stock - qnt) < 0)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
      }
      else
      {
        if ((enco[ide].peso + (prod[idp].peso * qnt)) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de %d.\n", idp, ide, 200);
        }
        else
        {
          if ((in_order = produto_in_encomenda(idp, enco[ide])) != (-1))
          {
            enco[ide].produtos[in_order].quantidade += qnt;
          }
          else
          {
            enco[ide].produtos[enco[ide].num_produtos].id_produto = idp;
            enco[ide].produtos[enco[ide].num_produtos].quantidade = qnt;
            enco[ide].num_produtos += 1;
          }

          prod[idp].stock -= qnt;
          enco[ide].peso += prod[idp].peso * qnt;
        }

      }

    }

  }

}

void r(Produto prod[10000], int proximo)
{
  int idp;
  int qnt;
  idp = new_sym_var(sizeof(int) * 8);
  qnt = new_sym_var(sizeof(int) * 8);
  if ((idp >= proximo) || (idp < 0))
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    if ((prod[idp].stock - qnt) < 0)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qnt, idp);
    }
    else
    {
      prod[idp].stock -= qnt;
    }

  }

}

void R(Produto prod[10000], Encomenda enco[500], int prod_proximo, int enco_proximo)
{
  int idp;
  int ide;
  int in_order;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if ((ide >= enco_proximo) || (ide < 0))
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if ((idp >= prod_proximo) || (idp < 0))
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      if ((in_order = produto_in_encomenda(idp, enco[ide])) != (-1))
      {
        prod[idp].stock += enco[ide].produtos[in_order].quantidade;
        enco[ide].peso -= enco[ide].produtos[in_order].quantidade * prod[idp].peso;
        enco[ide].num_produtos -= 1;
        repor_vetor(enco[ide].produtos, in_order, enco[ide].num_produtos);
      }
      else
      {
        
      }

    }

  }

}

void C(Produto prod[10000], Encomenda enco[500], int enco_proximo)
{
  int i;
  int ide;
  int idp;
  int in_order;
  int custo = 0;
  ide = new_sym_var(sizeof(int) * 8);
  if ((ide >= enco_proximo) || (ide < 0))
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    for (i = 0; i < enco[ide].num_produtos; i++)
    {
      idp = enco[ide].produtos[i].id_produto;
      in_order = produto_in_encomenda(idp, enco[ide]);
      custo += prod[idp].preco * enco[ide].produtos[in_order].quantidade;
    }

    printf("Custo da encomenda %d %d.\n", ide, custo);
  }

}

void p(Produto prod[10000], int prod_proximo)
{
  int idp;
  int novo_preco;
  idp = new_sym_var(sizeof(int) * 8);
  novo_preco = new_sym_var(sizeof(int) * 8);
  if ((idp >= prod_proximo) || (idp < 0))
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    prod[idp].preco = novo_preco;
  }

}

void E(Produto prod[10000], Encomenda enco[500], int prod_proximo, int enco_proximo)
{
  int ide;
  int idp;
  int in_order;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if ((ide >= enco_proximo) || (ide < 0))
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    if ((idp >= prod_proximo) || (idp < 0))
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
    }
    else
    {
      if ((in_order = produto_in_encomenda(idp, enco[ide])) != (-1))
      {
        printf("%s %d.\n", prod[idp].descricao, enco[ide].produtos[in_order].quantidade);
      }
      else
      {
        printf("%s %d.\n", prod[idp].descricao, 0);
      }

    }

  }

}

void m(Encomenda enco[500], int prod_proximo, int enco_proximo)
{
  int i;
  int idp;
  int in_order;
  int maior = -1;
  idp = new_sym_var(sizeof(int) * 8);
  if ((idp >= prod_proximo) || (idp < 0))
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    for (i = 0; i < enco_proximo; i++)
    {
      in_order = produto_in_encomenda(idp, enco[i]);
      if (in_order != (-1))
      {
        if (enco[i].produtos[in_order].quantidade > enco[maior].produtos[produto_in_encomenda(idp, enco[maior])].quantidade)
        {
          maior = i;
        }
        else
        {
          
        }

      }
      else
      {
        
      }

    }

    if (maior != (-1))
    {
      printf("Maximo produto %d %d %d.\n", idp, maior, enco[maior].produtos[produto_in_encomenda(idp, enco[maior])].quantidade);
    }
    else
    {
      
    }

  }

}

int partition(ToSort a[], int left, int right, int alphaSwitch)
{
  ToSort temp;
  int pivot = right;
  int i = left;
  int j = right;
  while (i < j)
  {
    if (alphaSwitch == 1)
    {
      while (strcmp(a[i].desc, a[pivot].desc) < 0)
        i++;

      while ((strcmp(a[j].desc, a[pivot].desc) >= 0) && (j > left))
        j--;

    }
    else
    {
      while (a[i].to_sort < a[pivot].to_sort)
        i++;

      while ((a[j].to_sort >= a[pivot].to_sort) && (j > left))
        j--;

    }

    if (i < j)
    {
      temp = a[i];
      a[i] = a[j];
      a[j] = temp;
    }
    else
    {
      
    }

  }

  temp = a[pivot];
  a[pivot] = a[i];
  a[i] = temp;
  return i;
}

void quicksort(ToSort a[], int left, int right, int alphaSwitch)
{
  int i;
  if (left < right)
  {
    i = partition(a, left, right, alphaSwitch);
    quicksort(a, left, i - 1, alphaSwitch);
    quicksort(a, i + 1, right, alphaSwitch);
  }
  else
  {
    
  }

}

void l(Produto prod[10000], int prod_proximo)
{
  int i;
  int high;
  int low = -1;
  ToSort lista[10000];
  for (i = 0; i < prod_proximo; i++)
  {
    lista[i].id_produto = i;
    lista[i].to_sort = prod[i].preco;
  }

  quicksort(lista, 0, prod_proximo - 1, 0);
  for (i = 1; i < (prod_proximo + 1); i++)
  {
    if (lista[i].to_sort == lista[i - 1].to_sort)
    {
      if (low == (-1))
      {
        low = i - 1;
      }
      else
      {
        
      }

      lista[i - 1].to_sort = lista[i - 1].id_produto;
    }
    else
    {
      if (low != (-1))
      {
        high = i - 1;
        lista[high].to_sort = lista[high].id_produto;
        quicksort(lista, low, high, 0);
        low = -1;
      }
      else
      {
        
      }

    }

  }

  printf("Produtos\n");
  for (i = 0; i < prod_proximo; i++)
  {
    printf("* %s %d %d\n", prod[lista[i].id_produto].descricao, prod[lista[i].id_produto].preco, prod[lista[i].id_produto].stock);
  }

}

void L(Produto prod[10000], Encomenda enco[500], int enco_proximo)
{
  int ide;
  int idp;
  int i;
  ToSort lista[200];
  ide = new_sym_var(sizeof(int) * 8);
  if ((ide >= enco_proximo) || (ide < 0))
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    for (i = 0; i < enco[ide].num_produtos; i++)
    {
      lista[i].id_produto = enco[ide].produtos[i].id_produto;
      lista[i].desc = prod[lista[i].id_produto].descricao;
    }

    quicksort(lista, 0, enco[ide].num_produtos - 1, 1);
    printf("Encomenda %d\n", ide);
    for (i = 0; i < enco[ide].num_produtos; i++)
    {
      idp = lista[i].id_produto;
      printf("* %s %d %d\n", prod[idp].descricao, prod[idp].preco, enco[ide].produtos[produto_in_encomenda(idp, enco[ide])].quantidade);
    }

  }

}

int main()
{
  char c;
  int prod_proximo = 0;
  int enco_proximo = 0;
  Encomenda encomendas[500];
  Produto produto[10000];
  while (c = getchar())
  {
    switch (c)
    {
      case 'a':
        a(produto, prod_proximo);
        prod_proximo += 1;
        break;

      case 'q':
        q(produto, prod_proximo);
        break;

      case 'N':
        N(encomendas, enco_proximo);
        enco_proximo += 1;
        break;

      case 'A':
        A(produto, encomendas, prod_proximo, enco_proximo);
        break;

      case 'r':
        r(produto, prod_proximo);
        break;

      case 'R':
        R(produto, encomendas, prod_proximo, enco_proximo);
        break;

      case 'C':
        C(produto, encomendas, enco_proximo);
        break;

      case 'p':
        p(produto, prod_proximo);
        break;

      case 'E':
        E(produto, encomendas, prod_proximo, enco_proximo);
        break;

      case 'm':
        m(encomendas, prod_proximo, enco_proximo);
        break;

      case 'l':
        l(produto, prod_proximo);
        break;

      case 'L':
        L(produto, encomendas, enco_proximo);
        break;

      case 'x':
        return 0;

    }

  }

  return 1;
}

