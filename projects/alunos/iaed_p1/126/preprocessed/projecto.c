#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


typedef struct p
{
  int id;
  char descricao[63];
  int preco;
  int peso;
  int qntd;
} Produto;
typedef struct encomenda
{
  int peso;
  int custo;
} Encomenda;
Produto produtos[10000];
Produto produtos_encomendas[500][200];
Encomenda encomendas[500];
char comando[80] = {0};
Produto produtos_ordena[10000];
int i[1];
int ids[2];
int ide[] = {-1};
int idp[] = {-1};
typedef Produto Item;
void quicksortP(Item a[], int left, int right)
{
  int i = left - 1;
  int j = right;
  Item v = a[right];
  if (right <= left)
  {
    return;
  }
  else
  {
    
  }

  while (i < j)
  {
    while ((a[++i].preco < v.preco) || ((a[i].preco == v.preco) && (a[i].id < v.id)))
      ;

    while ((v.preco < a[--j].preco) || ((v.preco == a[j].preco) && (v.id < a[j].id)))
    {
      if (j == left)
      {
        break;
      }
      else
      {
        
      }

    }

    if (i < j)
    {
      {
        Item t = a[i];
        a[i] = a[j];
        a[j] = t;
      }
      ;
      ;
    }
    else
    {
      
    }

  }

  {
    Item t = a[i];
    a[i] = a[right];
    a[right] = t;
  }
  ;
  ;
  quicksortP(a, left, i - 1);
  quicksortP(a, i + 1, right);
}

void bubbleD(Produto a[], int l, int r)
{
  int i;
  int j;
  for (i = l; i < r; i++)
  {
    for (j = l; j < (r + (l - i)); j++)
    {
      if (strcmp(a[j + 1].descricao, a[j].descricao) < 0)
      {
        {
          Item t = a[j + 1];
          a[j + 1] = a[j];
          a[j] = t;
        }
        ;
        ;
      }
      else
      {
        
      }

    }

  }

}

void obtemComando()
{
  int c;
  int i;
  c = getchar();
  for (i = 0; (c != '\n') && (c != EOF); i++)
  {
    comando[i] = c;
    c = getchar();
  }

  comando[i] = '.';
}

int obtemInteiro()
{
  int total = 0;
  while ((comando[i[0]] != ':') && (comando[i[0]] != '.'))
  {
    total = (total * 10) + (comando[i[0]] - '0');
    i[0]++;
  }

  return total;
}

Produto adicionaProduto()
{
  int total = 0;
  int n = 0;
  Produto product;
  i[0] = 2;
  product.id = idp[0];
  for (n = 0; comando[i[0]] != ':'; n++)
  {
    product.descricao[n] = comando[i[0]];
    i[0]++;
  }

  product.descricao[n] = '\0';
  i[0]++;
  total = obtemInteiro();
  product.preco = total;
  i[0]++;
  total = obtemInteiro();
  product.peso = total;
  i[0]++;
  total = obtemInteiro();
  product.qntd = total;
  return product;
}

Produto adicionaStock()
{
  int id;
  int quantidade;
  i[0] = 2;
  id = obtemInteiro();
  i[0]++;
  quantidade = obtemInteiro();
  if (id > idp[0])
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", id);
  }
  else
  {
    produtos[id].qntd += quantidade;
  }

  return produtos[id];
}

Produto adicionaNovoProdutoEncomenda(int quantidade)
{
  int n;
  int p;
  for (p = 0; p < 200; p++)
  {
    if (produtos_encomendas[ids[0]][p].id == (-1))
    {
      produtos_encomendas[ids[0]][p].id = ids[1];
      produtos_encomendas[ids[0]][p].qntd = quantidade;
      produtos_encomendas[ids[0]][p].preco = produtos[ids[1]].preco;
      produtos_encomendas[ids[0]][p].peso = produtos[ids[1]].peso;
      for (n = 0; produtos[ids[1]].descricao[n] != '\0'; n++)
      {
        produtos_encomendas[ids[0]][p].descricao[n] = produtos[ids[1]].descricao[n];
      }

      produtos_encomendas[ids[0]][p].descricao[n] = '\0';
      break;
    }
    else
    {
      
    }

  }

  return produtos_encomendas[ids[0]][p];
}

Produto adicionaProdutoExistenteEncomenda(int indice, int quantidade)
{
  produtos_encomendas[ids[0]][indice].qntd += quantidade;
  return produtos_encomendas[ids[0]][indice];
}

Produto removeProdutoEncomenda(int id)
{
  produtos_encomendas[ids[0]][id].id = -1;
  produtos_encomendas[ids[0]][id].qntd = 0;
  produtos_encomendas[ids[0]][id].preco = 0;
  produtos_encomendas[ids[0]][id].peso = 0;
  return produtos_encomendas[ids[0]][id];
}

Produto removeStock()
{
  int id;
  int quantidade;
  i[0] = 2;
  id = obtemInteiro();
  i[0]++;
  quantidade = obtemInteiro();
  if (id > idp[0])
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", id);
  }
  else
  {
    if (quantidade > produtos[id].qntd)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", quantidade, id);
    }
    else
    {
      produtos[id].qntd -= quantidade;
    }

  }

  return produtos[id];
}

Produto alteraPrecoProduto(int id, int preco)
{
  produtos[id].preco = preco;
  return produtos[id];
}

Encomenda alteraEncomendaNovoProduto(int qntd)
{
  encomendas[ids[0]].peso += qntd * produtos[ids[1]].peso;
  encomendas[ids[0]].custo += qntd * produtos[ids[1]].preco;
  return encomendas[ids[0]];
}

Encomenda alteraEncomendaRetiraProduto(int id)
{
  encomendas[ids[0]].peso -= produtos_encomendas[ids[0]][id].qntd * produtos_encomendas[ids[0]][id].peso;
  encomendas[ids[0]].custo -= produtos_encomendas[ids[0]][id].qntd * produtos_encomendas[ids[0]][id].preco;
  return encomendas[ids[0]];
}

void listaE()
{
  int p;
  int cont = 0;
  Produto produto;
  i[0] = 2;
  ids[0] = obtemInteiro();
  i[0]++;
  ids[1] = obtemInteiro();
  if (ids[0] > ide[0])
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ids[0]);
  }
  else
  {
    if (ids[1] > idp[0])
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", ids[1]);
    }
    else
    {
      for (p = 0; p < 200; p++)
      {
        if (produtos_encomendas[ids[0]][p].id == ids[1])
        {
          produto = produtos_encomendas[ids[0]][p];
          cont = 1;
          break;
        }
        else
        {
          
        }

      }

      if (cont != 1)
      {
        printf("%s 0.\n", produtos[ids[1]].descricao);
      }
      else
      {
        printf("%s %d.\n", produto.descricao, produto.qntd);
      }

    }

  }

}

void maximoProduto()
{
  int e;
  int maior_qntd = 0;
  int maior_id = 0;
  int id;
  int p;
  i[0] = 2;
  id = obtemInteiro();
  if (id > idp[0])
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", id);
  }
  else
  {
    for (e = 0; e < 500; e++)
    {
      for (p = 0; p < 200; p++)
      {
        if ((produtos_encomendas[e][p].id == id) && (produtos_encomendas[e][p].qntd > maior_qntd))
        {
          maior_qntd = produtos_encomendas[e][p].qntd;
          maior_id = e;
        }
        else
        {
          
        }

      }

    }

    if ((maior_qntd != 0) && (ide[0] != (-1)))
    {
      printf("Maximo produto %d %d %d.\n", id, maior_id, maior_qntd);
    }
    else
    {
      
    }

  }

}

void listaL()
{
  int id;
  int comp = 0;
  int p;
  int z = 0;
  i[0] = 2;
  id = obtemInteiro();
  if (id > ide[0])
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", id);
  }
  else
  {
    printf("Encomenda %d\n", id);
    for (p = 0; p < 200; p++)
    {
      produtos_ordena[p].id = -1;
      if (produtos_encomendas[id][p].id != (-1))
      {
        produtos_ordena[z] = produtos_encomendas[id][p];
        comp++;
        z++;
      }
      else
      {
        
      }

    }

    if (comp == 1)
    {
      printf("* %s %d %d\n", produtos_ordena[0].descricao, produtos_ordena[0].preco, produtos_ordena[0].qntd);
    }
    else
    {
      bubbleD(produtos_ordena, 0, comp - 1);
      for (p = 0; p < comp; p++)
      {
        printf("* %s %d %d\n", produtos_ordena[p].descricao, produtos_ordena[p].preco, produtos_ordena[p].qntd);
      }

    }

  }

}

void listal()
{
  int p;
  printf("Produtos\n");
  for (p = 0; p <= idp[0]; p++)
  {
    produtos_ordena[p] = produtos[p];
  }

  quicksortP(produtos_ordena, 0, idp[0]);
  for (p = 0; p <= idp[0]; p++)
  {
    printf("* %s %d %d\n", produtos_ordena[p].descricao, produtos_ordena[p].preco, produtos_ordena[p].qntd);
  }

}

int main()
{
  char letra;
  int n;
  int p;
  for (n = 0; n < 500; n++)
  {
    for (p = 0; p < 200; p++)
    {
      produtos_encomendas[n][p].id = -1;
      produtos_encomendas[n][p].qntd = 0;
      produtos_encomendas[n][p].peso = 0;
      produtos_encomendas[n][p].preco = 0;
    }

  }

  obtemComando();
  letra = comando[0];
  while (letra != 'x')
  {
    if (letra == 'a')
    {
      idp[0]++;
      produtos[idp[0]] = adicionaProduto();
      printf("Novo produto %d.\n", idp[0]);
    }
    else
    {
      if (letra == 'q')
      {
        adicionaStock();
      }
      else
      {
        if (letra == 'N')
        {
          ide[0]++;
          encomendas[ide[0]].custo = 0;
          encomendas[ide[0]].peso = 0;
          printf("Nova encomenda %d.\n", ide[0]);
        }
        else
        {
          if (letra == 'A')
          {
            int quantidade;
            int cont = 0;
            i[0] = 2;
            ids[0] = obtemInteiro();
            i[0]++;
            ids[1] = obtemInteiro();
            i[0]++;
            quantidade = obtemInteiro();
            if (ids[0] > ide[0])
            {
              printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", ids[1], ids[0]);
            }
            else
            {
              if (ids[1] > idp[0])
              {
                printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", ids[1], ids[0]);
              }
              else
              {
                if (produtos[ids[1]].qntd < quantidade)
                {
                  printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", ids[1], ids[0]);
                }
                else
                {
                  if ((encomendas[ids[0]].peso + (quantidade * produtos[ids[1]].peso)) > 200)
                  {
                    printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", ids[1], ids[0]);
                  }
                  else
                  {
                    for (p = 0; p < 200; p++)
                    {
                      if (produtos_encomendas[ids[0]][p].id == ids[1])
                      {
                        adicionaProdutoExistenteEncomenda(p, quantidade);
                        cont = 1;
                      }
                      else
                      {
                        
                      }

                    }

                    if (cont != 1)
                    {
                      adicionaNovoProdutoEncomenda(quantidade);
                    }
                    else
                    {
                      
                    }

                    alteraEncomendaNovoProduto(quantidade);
                    produtos[ids[1]].qntd -= quantidade;
                  }

                }

              }

            }

          }
          else
          {
            if (letra == 'r')
            {
              removeStock();
            }
            else
            {
              if (letra == 'R')
              {
                i[0] = 2;
                ids[0] = obtemInteiro();
                i[0]++;
                ids[1] = obtemInteiro();
                if (ids[0] > ide[0])
                {
                  printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", ids[1], ids[0]);
                }
                else
                {
                  if (ids[1] > idp[0])
                  {
                    printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", ids[1], ids[0]);
                  }
                  else
                  {
                    for (p = 0; p < 200; p++)
                    {
                      if (produtos_encomendas[ids[0]][p].id == ids[1])
                      {
                        alteraEncomendaRetiraProduto(p);
                        produtos[ids[1]].qntd += produtos_encomendas[ids[0]][p].qntd;
                        removeProdutoEncomenda(p);
                        break;
                      }
                      else
                      {
                        
                      }

                    }

                  }

                }

              }
              else
              {
                if (letra == 'C')
                {
                  int id;
                  i[0] = 2;
                  id = obtemInteiro();
                  if (id > ide[0])
                  {
                    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", id);
                  }
                  else
                  {
                    printf("Custo da encomenda %d %d.\n", id, encomendas[id].custo);
                  }

                }
                else
                {
                  if (letra == 'p')
                  {
                    int id;
                    int novo_preco;
                    int e;
                    int p;
                    i[0] = 2;
                    id = obtemInteiro();
                    i[0]++;
                    novo_preco = obtemInteiro();
                    if (id > idp[0])
                    {
                      printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", id);
                    }
                    else
                    {
                      alteraPrecoProduto(id, novo_preco);
                      for (e = 0; e < 500; e++)
                      {
                        for (p = 0; p < 200; p++)
                        {
                          if (produtos_encomendas[e][p].id == id)
                          {
                            encomendas[e].custo -= produtos_encomendas[e][p].qntd * produtos_encomendas[e][p].preco;
                            produtos_encomendas[e][p].preco = novo_preco;
                            encomendas[e].custo += produtos_encomendas[e][p].qntd * produtos_encomendas[e][p].preco;
                          }
                          else
                          {
                            
                          }

                        }

                      }

                    }

                  }
                  else
                  {
                    if (letra == 'E')
                    {
                      listaE();
                    }
                    else
                    {
                      if (letra == 'm')
                      {
                        maximoProduto();
                      }
                      else
                      {
                        if (letra == 'l')
                        {
                          listal();
                        }
                        else
                        {
                          if (letra == 'L')
                          {
                            listaL();
                          }
                          else
                          {
                            
                          }

                        }

                      }

                    }

                  }

                }

              }

            }

          }

        }

      }

    }

    obtemComando();
    letra = comando[0];
  }

  return 0;
}

