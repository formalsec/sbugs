#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


typedef struct Produto
{
  int id;
  char descricao[63];
  int preco;
  int peso;
  int quantidade;
} produto;
typedef struct Encomenda
{
  int id;
  int peso;
  produto produtos[10000];
} encomenda;
int indice_produto = 0;
int indice_encomenda = 0;
int key;
produto vetor_produtos[10000] = {0};
encomenda vetor_encomendas[500] = {0};
void cria_produto();
void adicionar_stock();
void cria_encomenda();
void adiciona_produto();
void remove_stock();
void remove_produto();
void calcula_custo();
void altera_preco();
void informacao_produto_encomenda();
void ocorrencia_produto();
void merge(produto vetor_produtos[], int left, int m, int right, int key);
void mergesort(produto vetor_produtos[], int left, int right, int key);
void ordena_preco();
void ordena_alfa();
int main()
{
  char c;
  do
  {
    c = getchar();
    switch (c)
    {
      case 'a':
        cria_produto();
        break;

      case 'q':
        adicionar_stock();
        break;

      case 'N':
        cria_encomenda();
        break;

      case 'A':
        adiciona_produto();
        break;

      case 'r':
        remove_stock();
        break;

      case 'R':
        remove_produto();
        break;

      case 'C':
        calcula_custo();
        break;

      case 'p':
        altera_preco();
        break;

      case 'E':
        informacao_produto_encomenda();
        break;

      case 'm':
        ocorrencia_produto();
        break;

      case 'l':
        ordena_preco();
        break;

      case 'L':
        ordena_alfa();
        break;

    }

  }
  while (c != 'x');
  return 0;
}

void cria_produto()
{
  produto prod;
  prod.id = indice_produto;
  for (int prod_index = 0; prod_index < 10; prod_index++)
  {
    prod.descricao[prod_index] = new_sym_var(sizeof(char) * 8);
  }

  prod.descricao[10 - 1] = '\0';
  prod.preco = new_sym_var(sizeof(int) * 8);
  prod.peso = new_sym_var(sizeof(int) * 8);
  prod.quantidade = new_sym_var(sizeof(int) * 8);
  vetor_produtos[prod.id] = prod;
  indice_produto++;
  printf("Novo produto %d.\n", prod.id);
}

void adicionar_stock()
{
  produto prod;
  prod.id = new_sym_var(sizeof(int) * 8);
  prod.quantidade = new_sym_var(sizeof(int) * 8);
  if (prod.id >= indice_produto)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", prod.id);
  }
  else
  {
    vetor_produtos[prod.id].quantidade += prod.quantidade;
  }

}

void cria_encomenda()
{
  encomenda ord;
  ord.id = indice_encomenda;
  ord.peso = 0;
  vetor_encomendas[ord.id] = ord;
  indice_encomenda++;
  printf("Nova encomenda %d.\n", ord.id);
}

void adiciona_produto()
{
  encomenda ord;
  produto prod;
  ord.id = new_sym_var(sizeof(int) * 8);
  prod.id = new_sym_var(sizeof(int) * 8);
  prod.quantidade = new_sym_var(sizeof(int) * 8);
  if (ord.id >= indice_encomenda)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", prod.id, ord.id);
  }
  else
  {
    if (prod.id >= indice_produto)
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", prod.id, ord.id);
    }
    else
    {
      if (prod.quantidade > vetor_produtos[prod.id].quantidade)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", prod.id, ord.id);
      }
      else
      {
        if (((vetor_produtos[prod.id].peso * prod.quantidade) + vetor_encomendas[ord.id].peso) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", prod.id, ord.id);
        }
        else
        {
          if (vetor_encomendas[ord.id].produtos[prod.id].quantidade != 0)
          {
            vetor_encomendas[ord.id].peso += vetor_produtos[prod.id].peso * prod.quantidade;
            vetor_encomendas[ord.id].produtos[prod.id].quantidade += prod.quantidade;
            vetor_produtos[prod.id].quantidade -= prod.quantidade;
          }
          else
          {
            prod.preco = vetor_produtos[prod.id].preco;
            prod.peso = vetor_produtos[prod.id].peso;
            strcpy(prod.descricao, vetor_produtos[prod.id].descricao);
            vetor_encomendas[ord.id].produtos[prod.id] = prod;
            vetor_encomendas[ord.id].peso += vetor_produtos[prod.id].peso * prod.quantidade;
            vetor_produtos[prod.id].quantidade -= prod.quantidade;
          }

        }

      }

    }

  }

}

void remove_stock()
{
  produto prod;
  prod.id = new_sym_var(sizeof(int) * 8);
  prod.quantidade = new_sym_var(sizeof(int) * 8);
  if (prod.id >= indice_produto)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", prod.id);
  }
  else
  {
    if ((vetor_produtos[prod.id].quantidade - prod.quantidade) < 0)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", prod.quantidade, prod.id);
    }
    else
    {
      vetor_produtos[prod.id].quantidade = vetor_produtos[prod.id].quantidade - prod.quantidade;
    }

  }

}

void remove_produto()
{
  encomenda ord;
  produto prod;
  ord.id = new_sym_var(sizeof(int) * 8);
  prod.id = new_sym_var(sizeof(int) * 8);
  if (ord.id >= indice_encomenda)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", prod.id, ord.id);
  }
  else
  {
    if (prod.id >= indice_produto)
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", prod.id, ord.id);
    }
    else
    {
      vetor_produtos[prod.id].quantidade += vetor_encomendas[ord.id].produtos[prod.id].quantidade;
      vetor_encomendas[ord.id].peso -= vetor_produtos[prod.id].peso * vetor_encomendas[ord.id].produtos[prod.id].quantidade;
      vetor_encomendas[ord.id].produtos[prod.id].quantidade = 0;
      vetor_encomendas[ord.id].produtos[prod.id].peso = 0;
      vetor_encomendas[ord.id].produtos[prod.id].preco = 0;
    }

  }

}

void calcula_custo()
{
  encomenda ord;
  int total = 0;
  int i;
  ord.id = new_sym_var(sizeof(int) * 8);
  if (ord.id >= indice_encomenda)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ord.id);
  }
  else
  {
    for (i = 0; i < indice_produto; i++)
    {
      total += vetor_encomendas[ord.id].produtos[i].preco * vetor_encomendas[ord.id].produtos[i].quantidade;
    }

    printf("Custo da encomenda %d %d.\n", ord.id, total);
  }

}

void altera_preco()
{
  produto prod;
  int i;
  prod.id = new_sym_var(sizeof(int) * 8);
  prod.preco = new_sym_var(sizeof(int) * 8);
  if (prod.id > indice_produto)
  {
    printf("Impossivel alterar o preco do produto %d. Produto inexistente.\n", prod.id);
  }
  else
  {
    vetor_produtos[prod.id].preco = prod.preco;
    for (i = 0; i < indice_encomenda; i++)
    {
      if (vetor_encomendas[i].produtos[prod.id].quantidade != 0)
      {
        vetor_encomendas[i].produtos[prod.id].preco = prod.preco;
      }
      else
      {
        
      }

    }

  }

}

void informacao_produto_encomenda()
{
  produto prod;
  encomenda ord;
  ord.id = new_sym_var(sizeof(int) * 8);
  prod.id = new_sym_var(sizeof(int) * 8);
  if (ord.id >= indice_encomenda)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ord.id);
  }
  else
  {
    if (prod.id >= indice_produto)
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", prod.id);
    }
    else
    {
      printf("%s %d.\n", vetor_produtos[prod.id].descricao, vetor_encomendas[ord.id].produtos[prod.id].quantidade);
    }

  }

}

void ocorrencia_produto()
{
  produto prod;
  int maior_encomenda = 0;
  int j;
  prod.id = new_sym_var(sizeof(int) * 8);
  if (prod.id >= indice_produto)
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", prod.id);
  }
  else
  {
    for (j = 0; j < indice_encomenda; j++)
    {
      if (vetor_encomendas[j].produtos[prod.id].quantidade > vetor_encomendas[maior_encomenda].produtos[prod.id].quantidade)
      {
        maior_encomenda = vetor_encomendas[j].id;
      }
      else
      {
        if ((vetor_encomendas[j].produtos[prod.id].quantidade == vetor_encomendas[maior_encomenda].produtos[prod.id].quantidade) && (vetor_encomendas[j].id < maior_encomenda))
        {
          maior_encomenda = vetor_encomendas[j].id;
        }
        else
        {
          
        }

      }

    }

    if (maior_encomenda != 0)
    {
      printf("Maximo produto %d %d %d\n", prod.id, maior_encomenda, vetor_encomendas[maior_encomenda].produtos[prod.id].quantidade);
    }
    else
    {
      
    }

  }

}

void ordena_preco()
{
  int i;
  mergesort(vetor_produtos, 0, indice_produto - 1, 0);
  printf("Produtos\n");
  for (i = 0; i < indice_produto; i++)
  {
    printf("* %s %d %d\n", vetor_produtos[i].descricao, vetor_produtos[i].preco, vetor_produtos[i].quantidade);
  }

}

void merge(produto vetor_produtos[], int left, int m, int right, int key)
{
  int i;
  int j;
  int k;
  int n1 = (m - left) + 1;
  int n2 = right - m;
  produto aux_left[10000];
  produto aux_right[10000];
  for (i = 0; i < n1; i++)
  {
    aux_left[i] = vetor_produtos[left + i];
  }

  for (j = 0; j < n2; j++)
  {
    aux_right[j] = vetor_produtos[(m + 1) + j];
  }

  i = 0;
  j = 0;
  k = left;
  if (key == 0)
  {
    while ((i < n1) && (j < n2))
    {
      if (aux_left[i].preco <= aux_right[j].preco)
      {
        vetor_produtos[k] = aux_left[i];
        i++;
      }
      else
      {
        vetor_produtos[k] = aux_right[j];
        j++;
      }

      k++;
    }

  }
  else
  {
    while ((i < n1) && (j < n2))
    {
      if (strcmp(aux_left[i].descricao, aux_right[j].descricao) < 0)
      {
        vetor_produtos[k] = aux_left[i];
        i++;
      }
      else
      {
        vetor_produtos[k] = aux_right[j];
        j++;
      }

      k++;
    }

  }

  while (i < n1)
  {
    vetor_produtos[k] = aux_left[i];
    i++;
    k++;
  }

  while (j < n2)
  {
    vetor_produtos[k] = aux_right[j];
    j++;
    k++;
  }

}

void mergesort(produto vetor_produtos[], int left, int right, int key)
{
  if (left < right)
  {
    int m = left + ((right - 1) / 2);
    mergesort(vetor_produtos, left, m, key);
    mergesort(vetor_produtos, m + 1, right, key);
    merge(vetor_produtos, left, m, right, key);
  }
  else
  {
    
  }

}

void ordena_alfa()
{
  encomenda ord;
  int i;
  int j;
  int k = 0;
  produto vetor_aux[200];
  ord.id = new_sym_var(sizeof(int) * 8);
  if (ord.id >= indice_encomenda)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ord.id);
  }
  else
  {
    for (j = 0; j < 200; j++)
    {
      if (vetor_encomendas[ord.id].produtos[j].quantidade != 0)
      {
        vetor_aux[k] = vetor_encomendas[ord.id].produtos[j];
        k++;
      }
      else
      {
        
      }

    }

    mergesort(vetor_aux, 0, k - 1, 1);
    printf("Encomenda %d\n", ord.id);
    for (i = 0; i < k; i++)
    {
      printf("* %s %d %d\n", vetor_aux[i].descricao, vetor_aux[i].preco, vetor_aux[i].quantidade);
    }

  }

}

