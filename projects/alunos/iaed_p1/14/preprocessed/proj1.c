#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>


void inicializar_tabelas();
void cria_produto();
void adiciona_stock();
void remove_stock();
void cria_encomenda();
void adiciona_produto_encomenda();
void remove_produto_encomenda();
void calcula_custo();
void altera_preco_produto();
void descricao_encomenda();
void encontra_encomenda();
void lista_produtos_ordem_alfabetica();
void lista_produtos_ordem_preco();
void altera_stock(int, int);
void altera_encomenda(int, int, int);
typedef struct 
{
  int id;
  char descricao[64];
  int preco;
  int peso;
  int qtd;
} Produto;
typedef struct 
{
  int id;
  int produtos[10000];
  int peso;
} Encomenda;
int numero_produtos = 0;
int numero_encomendas = 0;
Produto produtos[10000];
Encomenda encomendas[500];
int main()
{
  char command;
  inicializar_tabelas();
  while (1)
  {
    command = getchar();
    switch (command)
    {
      case 'a':
        cria_produto();
        break;

      case 'q':
        adiciona_stock();
        break;

      case 'N':
        cria_encomenda();
        break;

      case 'A':
        adiciona_produto_encomenda();
        break;

      case 'r':
        remove_stock();
        break;

      case 'R':
        remove_produto_encomenda();
        break;

      case 'C':
        calcula_custo();
        break;

      case 'p':
        altera_preco_produto();
        break;

      case 'E':
        descricao_encomenda();
        break;

      case 'm':
        encontra_encomenda();
        break;

      case 'l':
        lista_produtos_ordem_preco();
        break;

      case 'L':
        lista_produtos_ordem_alfabetica();
        break;

      case 'x':
        return 0;

    }

  }

  return 0;
}

void inicializar_tabelas()
{
  int i = 0;
  for (i = 0; i < 10000; i++)
  {
    produtos[i].id = i;
    produtos[i].qtd = 0;
  }

}

void cria_produto()
{
  for (int produtos_index = 0; produtos_index < 10; produtos_index++)
  {
    produtos[numero_produtos].descricao[produtos_index] = new_sym_var(sizeof(char) * 8);
  }

  produtos[numero_produtos].descricao[10 - 1] = '\0';
  produtos[numero_produtos].preco = new_sym_var(sizeof(int) * 8);
  produtos[numero_produtos].peso = new_sym_var(sizeof(int) * 8);
  produtos[numero_produtos].qtd = new_sym_var(sizeof(int) * 8);
  printf("Novo produto %d.\n", numero_produtos);
  numero_produtos++;
}

void adiciona_stock()
{
  int idp;
  int qtd;
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (idp > (numero_produtos - 1))
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
  }
  else
  {
    
  }

  altera_stock(idp, qtd);
}

void cria_encomenda()
{
  printf("Nova encomenda %d.\n", numero_encomendas);
  numero_encomendas++;
}

void adiciona_produto_encomenda()
{
  int ide;
  int idp;
  int qtd;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (ide > (numero_encomendas - 1))
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (idp > (numero_produtos - 1))
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      if (qtd > produtos[idp].qtd)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
      }
      else
      {
        if ((encomendas[ide].peso + (produtos[idp].peso * qtd)) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
        }
        else
        {
          altera_encomenda(ide, idp, qtd);
        }

      }

    }

  }

}

void remove_stock()
{
  int idp;
  int qtd;
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (idp > (numero_produtos - 1))
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    if (produtos[idp].qtd < qtd)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, idp);
    }
    else
    {
      altera_stock(idp, -qtd);
    }

  }

}

void remove_produto_encomenda()
{
  int ide;
  int idp;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (ide > (numero_encomendas - 1))
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (idp > (numero_produtos - 1))
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      altera_stock(idp, encomendas[ide].produtos[idp]);
      encomendas[ide].produtos[idp] = 0;
    }

  }

}

void calcula_custo()
{
  int i;
  int c = 0;
  int ide;
  ide = new_sym_var(sizeof(int) * 8);
  if (ide > (numero_encomendas - 1))
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    for (i = 0; i < numero_produtos; i++)
      if (encomendas[ide].produtos[i] > 0)
    {
      c = c + (produtos[i].preco * encomendas[ide].produtos[i]);
    }
    else
    {
      
    }


    printf("Custo da encomenda %d %d.\n", ide, c);
  }

}

void altera_preco_produto()
{
  int idp;
  int c;
  idp = new_sym_var(sizeof(int) * 8);
  c = new_sym_var(sizeof(int) * 8);
  if (idp > (numero_produtos - 1))
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    produtos[idp].preco = c;
  }

}

void descricao_encomenda()
{
  int ide;
  int idp;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (ide > (numero_encomendas - 1))
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    if (idp > (numero_produtos - 1))
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
    }
    else
    {
      printf("%s %d.\n", produtos[idp].descricao, encomendas[ide].produtos[idp]);
    }

  }

}

void encontra_encomenda()
{
  int idp;
  int ide;
  int m = 0;
  int i = 0;
  idp = new_sym_var(sizeof(int) * 8);
  if (idp > (numero_produtos - 1))
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    for (i = 0; i < (numero_encomendas - 1); i++)
      if (encomendas[i].produtos[idp] > m)
    {
      m = encomendas[i].produtos[idp];
      ide = i;
    }
    else
    {
      
    }


  }

  if (m > 0)
  {
    printf("Maximo produto %d %d %d\n", idp, ide, m);
  }
  else
  {
    
  }

}

void lista_produtos_ordem_preco()
{
  int i;
  int j;
  int lista_ordenada[10000];
  int produtos_ordenados = 0;
  for (i = 0; i < numero_produtos; i++)
  {
    for (j = i - 1; j >= (-1); j--)
    {
      if (j == (-1))
      {
        lista_ordenada[0] = i;
        produtos_ordenados++;
        break;
      }
      else
      {
        if (produtos[i].preco >= produtos[lista_ordenada[j]].preco)
        {
          lista_ordenada[j + 1] = i;
          produtos_ordenados++;
          break;
        }
        else
        {
          lista_ordenada[j + 1] = lista_ordenada[j];
        }

      }

    }

  }

  printf("Produtos\n");
  for (i = 0; i < produtos_ordenados; i++)
    printf("* %s %d %d\n", produtos[lista_ordenada[i]].descricao, produtos[lista_ordenada[i]].preco, produtos[lista_ordenada[i]].qtd);

}

void lista_produtos_ordem_alfabetica()
{
  int ide;
  int i;
  int j;
  int lista_ordenada[10000];
  int produtos_ordenados = 0;
  ide = new_sym_var(sizeof(int) * 8);
  if (ide > (numero_encomendas - 1))
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    for (i = 0; i < numero_produtos; i++)
      if (encomendas[ide].produtos[i] == 0)
    {
      break;
    }
    else
    {
      for (j = i - 1; j >= (-1); j++)
      {
        if (j == (-1))
        {
          lista_ordenada[j + 1] = i;
          produtos_ordenados++;
          break;
        }
        else
        {
          if (strcmp(produtos[i].descricao, produtos[lista_ordenada[j]].descricao) >= 1)
          {
            lista_ordenada[j + 1] = i;
            produtos_ordenados++;
            break;
          }
          else
          {
            lista_ordenada[j + 1] = lista_ordenada[j];
          }

        }

      }

    }


    printf("Encomenda %d\n", ide);
    for (i = 0; i < produtos_ordenados; i++)
      printf("* %s %d %d\n", produtos[lista_ordenada[i]].descricao, produtos[lista_ordenada[i]].preco, encomendas[ide].produtos[lista_ordenada[i]]);

  }

}

void altera_stock(int idp, int qtd)
{
  produtos[idp].qtd = produtos[idp].qtd + qtd;
}

void altera_encomenda(int ide, int idp, int qtd)
{
  encomendas[ide].produtos[idp] = encomendas[ide].produtos[idp] + qtd;
  encomendas[ide].peso = encomendas[ide].peso + (produtos[idp].peso * qtd);
  altera_stock(idp, -qtd);
}

