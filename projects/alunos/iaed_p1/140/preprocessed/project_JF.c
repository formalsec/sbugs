#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <strings.h>


typedef struct product
{
  char description[63 + 1];
  int price;
  int weight;
  int stock;
} product;
typedef struct order
{
  int products[2][200];
  int next_index;
  int weight;
} order;
product warehouse[10000];
int next_p_id;
int print_warehouse[10000];
order order_list[500];
int next_o_id;
int compare_price(int pos_a, int pos_b)
{
  int id_a = print_warehouse[pos_a];
  int id_b = print_warehouse[pos_b];
  if (warehouse[id_a].price < warehouse[id_b].price)
  {
    return 1;
  }
  else
  {
    if (warehouse[id_a].price == warehouse[id_b].price)
    {
      if (id_a < id_b)
      {
        return 1;
      }
      else
      {
        return 0;
      }

    }
    else
    {
      return 0;
    }

  }

}

int partition_warehouse(int left, int right)
{
  int l = left - 1;
  int r = right;
  int pivot = right;
  int tmp;
  while (l < r)
  {
    while (compare_price(++l, pivot))
      ;

    while (compare_price(pivot, --r))
    {
      if (r == left)
      {
        break;
      }
      else
      {
        
      }

    }

    if (l < r)
    {
      tmp = print_warehouse[l];
      print_warehouse[l] = print_warehouse[r];
      print_warehouse[r] = tmp;
    }
    else
    {
      
    }

  }

  tmp = print_warehouse[l];
  print_warehouse[l] = print_warehouse[right];
  print_warehouse[right] = tmp;
  return l;
}

void quicksort_warehouse(int left, int right)
{
  int i;
  if (right <= left)
  {
    return;
  }
  else
  {
    
  }

  i = partition_warehouse(left, right);
  quicksort_warehouse(left, i - 1);
  quicksort_warehouse(i + 1, right);
}

int compare_description(int pos_a, int pos_b, int order_id)
{
  int product_id_a = order_list[order_id].products[0][pos_a];
  int product_id_b = order_list[order_id].products[0][pos_b];
  if (strcasecmp(warehouse[product_id_a].description, warehouse[product_id_b].description) < 0)
  {
    return 1;
  }
  else
  {
    return 0;
  }

}

int partition_order(int left, int right, int order_id)
{
  int l = left - 1;
  int r = right;
  int pivot = right;
  int tmp_id;
  int tmp_amount;
  while (l < r)
  {
    while (compare_description(++l, pivot, order_id))
      ;

    while (compare_description(pivot, --r, order_id))
    {
      if (r == left)
      {
        break;
      }
      else
      {
        
      }

    }

    if (l < r)
    {
      tmp_id = order_list[order_id].products[0][l];
      order_list[order_id].products[0][l] = order_list[order_id].products[0][r];
      order_list[order_id].products[0][r] = tmp_id;
      tmp_id = order_list[order_id].products[1][l];
      order_list[order_id].products[1][l] = order_list[order_id].products[1][r];
      order_list[order_id].products[1][r] = tmp_id;
    }
    else
    {
      
    }

  }

  tmp_id = order_list[order_id].products[0][l];
  order_list[order_id].products[0][l] = order_list[order_id].products[0][right];
  order_list[order_id].products[0][right] = tmp_id;
  tmp_amount = order_list[order_id].products[1][l];
  order_list[order_id].products[1][l] = order_list[order_id].products[1][right];
  order_list[order_id].products[1][right] = tmp_amount;
  return l;
}

void quicksort_order(int left, int right, int order_id)
{
  int i;
  if (right <= left)
  {
    return;
  }
  else
  {
    
  }

  i = partition_order(left, right, order_id);
  quicksort_order(left, i - 1, order_id);
  quicksort_order(i + 1, right, order_id);
}

void a(char description[], int price, int weight, int amount)
{
  int i;
  for (i = 0; (description[i] != '\0') && (i < 63); i++)
  {
    warehouse[next_p_id].description[i] = description[i];
  }

  warehouse[next_p_id].price = price;
  warehouse[next_p_id].weight = weight;
  warehouse[next_p_id].stock = amount;
  printf("Novo produto %d.\n", next_p_id++);
}

void q(int product_id, int amount)
{
  if (product_id >= next_p_id)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", product_id);
  }
  else
  {
    warehouse[product_id].stock += amount;
  }

}

void N()
{
  order_list[next_o_id].weight = 0;
  order_list[next_o_id].next_index = 0;
  printf("Nova encomenda %d.\n", next_o_id++);
}

void A(int order_id, int product_id, int amount)
{
  int next_product_id;
  int i;
  if (order_id >= next_o_id)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", product_id, order_id);
  }
  else
  {
    if (product_id >= next_p_id)
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", product_id, order_id);
    }
    else
    {
      if (warehouse[product_id].stock < amount)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", product_id, order_id);
      }
      else
      {
        if ((200 - order_list[order_id].weight) < (amount * warehouse[product_id].weight))
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", product_id, order_id);
        }
        else
        {
          next_product_id = order_list[order_id].next_index;
          for (i = 0; i < next_product_id; i++)
          {
            if (order_list[order_id].products[0][i] == product_id)
            {
              order_list[order_id].products[1][i] += amount;
              break;
            }
            else
            {
              
            }

          }

          if (i == next_product_id)
          {
            order_list[order_id].products[0][next_product_id] = product_id;
            order_list[order_id].products[1][next_product_id] = amount;
            order_list[order_id].next_index++;
          }
          else
          {
            
          }

          order_list[order_id].weight += amount * warehouse[product_id].weight;
          warehouse[product_id].stock -= amount;
        }

      }

    }

  }

}

void r(int product_id, int amount)
{
  if (product_id >= next_p_id)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", product_id);
  }
  else
  {
    if (warehouse[product_id].stock < amount)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", amount, product_id);
    }
    else
    {
      warehouse[product_id].stock -= amount;
    }

  }

}

void R(int order_id, int product_id)
{
  int i;
  int last_p;
  int amount;
  if (order_id >= next_o_id)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", product_id, order_id);
  }
  else
  {
    if (product_id >= next_p_id)
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", product_id, order_id);
    }
    else
    {
      for (i = 0; i < order_list[order_id].next_index; i++)
      {
        if (order_list[order_id].products[0][i] == product_id)
        {
          amount = order_list[order_id].products[1][i];
          warehouse[product_id].stock += amount;
          order_list[order_id].weight -= amount * warehouse[product_id].weight;
          last_p = (order_list[order_id].next_index--) - 1;
          if (i != last_p)
          {
            order_list[order_id].products[0][i] = order_list[order_id].products[0][last_p];
            order_list[order_id].products[1][i] = order_list[order_id].products[1][last_p];
          }
          else
          {
            
          }

          break;
        }
        else
        {
          
        }

      }

    }

  }

}

void C(int order_id)
{
  int total = 0;
  int price;
  int amount;
  int i;
  if (order_id >= next_o_id)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", order_id);
  }
  else
  {
    for (i = 0; i < order_list[order_id].next_index; i++)
    {
      amount = order_list[order_id].products[1][i];
      price = warehouse[order_list[order_id].products[0][i]].price;
      total += amount * price;
    }

    printf("Custo da encomenda %d %d.\n", order_id, total);
  }

}

void p(int product_id, int price)
{
  if (product_id >= next_p_id)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", product_id);
  }
  else
  {
    warehouse[product_id].price = price;
  }

}

void E(int order_id, int product_id)
{
  int c;
  int i;
  if (order_id >= next_o_id)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", order_id);
  }
  else
  {
    if (product_id >= next_p_id)
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", product_id);
    }
    else
    {
      for (i = 0; ((c = warehouse[product_id].description[i]) != '\0') && (i < 63); i++)
      {
        putchar(c);
      }

      for (i = 0; i < order_list[order_id].next_index; i++)
      {
        if (order_list[order_id].products[0][i] == product_id)
        {
          printf(" %d.\n", order_list[order_id].products[1][i]);
          break;
        }
        else
        {
          
        }

      }

      if (i == order_list[order_id].next_index)
      {
        printf(" 0.\n");
      }
      else
      {
        
      }

    }

  }

}

void m(int product_id)
{
  int max = 0;
  int last_o_id = 0;
  int i;
  int j;
  if (product_id >= next_p_id)
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", product_id);
  }
  else
  {
    for (i = 0; i < next_o_id; i++)
    {
      for (j = 0; j < order_list[i].next_index; j++)
      {
        if ((order_list[i].products[0][j] == product_id) && (order_list[i].products[1][j] > max))
        {
          max = order_list[i].products[1][j];
          last_o_id = i;
          break;
        }
        else
        {
          
        }

      }

    }

    if (max != 0)
    {
      printf("Maximo produto %d %d %d.\n", product_id, last_o_id, max);
    }
    else
    {
      
    }

  }

}

void l()
{
  int product_id;
  int i;
  for (i = 0; i < next_p_id; i++)
  {
    print_warehouse[i] = i;
  }

  quicksort_warehouse(0, next_p_id - 1);
  printf("Produtos\n");
  for (i = 0; i < next_p_id; i++)
  {
    product_id = print_warehouse[i];
    printf("* %s %d %d\n", warehouse[product_id].description, warehouse[product_id].price, warehouse[product_id].stock);
  }

}

void L(int order_id)
{
  int N_products = order_list[order_id].next_index - 1;
  int product_id;
  int i;
  if (order_id >= next_o_id)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", order_id);
  }
  else
  {
    quicksort_order(0, N_products, order_id);
    printf("Encomenda %d\n", order_id);
    for (i = 0; i <= N_products; i++)
    {
      product_id = order_list[order_id].products[0][i];
      printf("* %s %d %d\n", warehouse[product_id].description, warehouse[product_id].price, order_list[order_id].products[1][i]);
    }

  }

}

void parser()
{
  int opt;
  int i;
  int c;
  int in1;
  int in2;
  int in3;
  char description[63 + 1];
  opt = getchar();
  switch (opt)
  {
    case 'a':
      getchar();
      for (i = 0; ((c = getchar()) != ':') && (i <= 63); i++)
    {
      description[i] = c;
    }

      description[i] = '\0';
      in1 = new_sym_var(sizeof(int) * 8);
      in2 = new_sym_var(sizeof(int) * 8);
      in3 = new_sym_var(sizeof(int) * 8);
      a(description, in1, in2, in3);
      break;

    case 'q':
      in1 = new_sym_var(sizeof(int) * 8);
      in2 = new_sym_var(sizeof(int) * 8);
      q(in1, in2);
      break;

    case 'N':
      N();
      break;

    case 'A':
      in1 = new_sym_var(sizeof(int) * 8);
      in2 = new_sym_var(sizeof(int) * 8);
      in3 = new_sym_var(sizeof(int) * 8);
      A(in1, in2, in3);
      break;

    case 'r':
      in1 = new_sym_var(sizeof(int) * 8);
      in2 = new_sym_var(sizeof(int) * 8);
      r(in1, in2);
      break;

    case 'R':
      in1 = new_sym_var(sizeof(int) * 8);
      in2 = new_sym_var(sizeof(int) * 8);
      R(in1, in2);
      break;

    case 'C':
      in1 = new_sym_var(sizeof(int) * 8);
      C(in1);
      break;

    case 'p':
      in1 = new_sym_var(sizeof(int) * 8);
      in2 = new_sym_var(sizeof(int) * 8);
      p(in1, in2);
      break;

    case 'E':
      in1 = new_sym_var(sizeof(int) * 8);
      in2 = new_sym_var(sizeof(int) * 8);
      E(in1, in2);
      break;

    case 'm':
      in1 = new_sym_var(sizeof(int) * 8);
      m(in1);
      break;

    case 'l':
      l();
      break;

    case 'L':
      in1 = new_sym_var(sizeof(int) * 8);
      L(in1);
      break;

    case 'x':
      return;
      break;

  }

  getchar();
  parser();
}

int main()
{
  next_p_id = 0;
  next_o_id = 0;
  parser();
  return 0;
}

