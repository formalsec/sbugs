#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


typedef struct Produto
{
  int id;
  char desc[64];
  int preco;
  int peso;
  int stock;
} Produto;
typedef struct Encomenda
{
  int id;
  int peso;
  int preco;
  Produto produto[10000];
  int n_de_prods;
} Encomenda;
Produto sistema[10000];
int n_sis = 0;
Encomenda encomenda[500];
int n_encoms = 0;
void adicionaProduto()
{
  char descricao[64];
  int preco;
  int peso;
  int quantidade;
  for (int descricao_index = 0; descricao_index < 10; descricao_index++)
  {
    descricao[descricao_index] = new_sym_var(sizeof(char) * 8);
  }

  descricao[10 - 1] = '\0';
  preco = new_sym_var(sizeof(int) * 8);
  peso = new_sym_var(sizeof(int) * 8);
  quantidade = new_sym_var(sizeof(int) * 8);
  strcpy(sistema[n_sis].desc, descricao);
  sistema[n_sis].preco = preco;
  sistema[n_sis].peso = peso;
  sistema[n_sis].stock = quantidade;
  sistema[n_sis].id = n_sis;
  printf("Novo produto %d.\n", sistema[n_sis].id);
  n_sis++;
}

void adicionaStock()
{
  int quantidade;
  int id;
  id = new_sym_var(sizeof(int) * 8);
  quantidade = new_sym_var(sizeof(int) * 8);
  if (id > (n_sis - 1))
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", id);
  }
  else
  {
    sistema[id].stock += quantidade;
  }

}

void criaEncomenda()
{
  encomenda[n_encoms].id = n_encoms;
  encomenda[n_encoms].peso = 0;
  encomenda[n_encoms].preco = 0;
  encomenda[n_encoms].n_de_prods = 0;
  printf("Nova encomenda %d.\n", encomenda[n_encoms].id);
  n_encoms++;
}

void adicionaProdEncomenda()
{
  int id_encom;
  int id_prod;
  int quantidade;
  int i;
  int ja_existe;
  int posic_do_prod;
  ja_existe = 0;
  id_encom = new_sym_var(sizeof(int) * 8);
  id_prod = new_sym_var(sizeof(int) * 8);
  quantidade = new_sym_var(sizeof(int) * 8);
  if (id_encom > (n_encoms - 1))
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", id_prod, id_encom);
  }
  else
  {
    if (id_prod > (n_sis - 1))
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", id_prod, id_encom);
    }
    else
    {
      if (quantidade > sistema[id_prod].stock)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", id_prod, id_encom);
      }
      else
      {
        if ((encomenda[id_encom].peso + (sistema[id_prod].peso * quantidade)) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de %d.\n", id_prod, id_encom, 200);
        }
        else
        {
          for (i = 0; i < encomenda[id_encom].n_de_prods; i++)
            if (id_prod == encomenda[id_encom].produto[i].id)
          {
            ja_existe = 1;
            posic_do_prod = i;
            break;
          }
          else
          {
            
          }


          if (ja_existe == 1)
          {
            encomenda[id_encom].produto[posic_do_prod].stock += quantidade;
          }
          else
          {
            strcpy(encomenda[id_encom].produto[encomenda[id_encom].n_de_prods].desc, sistema[id_prod].desc);
            encomenda[id_encom].produto[encomenda[id_encom].n_de_prods].id = id_prod;
            encomenda[id_encom].produto[encomenda[id_encom].n_de_prods].peso = sistema[id_prod].peso;
            encomenda[id_encom].produto[encomenda[id_encom].n_de_prods].preco = sistema[id_prod].preco;
            encomenda[id_encom].produto[encomenda[id_encom].n_de_prods].stock = quantidade;
            encomenda[id_encom].n_de_prods++;
          }

          sistema[id_prod].stock -= quantidade;
          encomenda[id_encom].peso += quantidade * sistema[id_prod].peso;
          encomenda[id_encom].preco += quantidade * sistema[id_prod].preco;
        }

      }

    }

  }

}

void removeStockProd()
{
  int id_prod;
  int quantidade;
  id_prod = new_sym_var(sizeof(int) * 8);
  quantidade = new_sym_var(sizeof(int) * 8);
  if (id_prod > (n_sis - 1))
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", id_prod);
  }
  else
  {
    if (quantidade > sistema[id_prod].stock)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", quantidade, id_prod);
    }
    else
    {
      sistema[id_prod].stock -= quantidade;
    }

  }

}

void removeProdEncomenda()
{
  int id_encom;
  int id_prod;
  int i;
  id_encom = new_sym_var(sizeof(int) * 8);
  id_prod = new_sym_var(sizeof(int) * 8);
  if (id_encom > (n_encoms - 1))
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", id_prod, id_encom);
  }
  else
  {
    if (id_prod > (n_sis - 1))
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", id_prod, id_encom);
    }
    else
    {
      for (i = 0; i < encomenda[id_encom].n_de_prods; i++)
        if (encomenda[id_encom].produto[i].id == id_prod)
      {
        encomenda[id_encom].peso -= sistema[id_prod].peso * encomenda[id_encom].produto[i].stock;
        encomenda[id_encom].preco -= sistema[id_prod].preco * encomenda[id_encom].produto[i].stock;
        sistema[id_prod].stock += encomenda[id_encom].produto[i].stock;
        encomenda[id_encom].produto[i].stock = 0;
        break;
      }
      else
      {
        
      }


    }

  }

}

void calculaCustoEncomenda()
{
  int id_encom;
  int i;
  int custo;
  custo = 0;
  id_encom = new_sym_var(sizeof(int) * 8);
  if (id_encom >= n_encoms)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", id_encom);
  }
  else
  {
    for (i = 0; i < encomenda[id_encom].n_de_prods; i++)
      custo += encomenda[id_encom].produto[i].preco * encomenda[id_encom].produto[i].stock;

    printf("Custo da encomenda %d %d.\n", id_encom, custo);
  }

}

void alteraPreco()
{
  int id_prod;
  int novo_preco;
  int i;
  int j;
  id_prod = new_sym_var(sizeof(int) * 8);
  novo_preco = new_sym_var(sizeof(int) * 8);
  if (id_prod > (n_sis - 1))
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", id_prod);
    return;
  }
  else
  {
    
  }

  sistema[id_prod].preco = novo_preco;
  for (i = 0; i < n_encoms; i++)
    for (j = 0; j < encomenda[i].n_de_prods; j++)
    if (encomenda[i].produto[j].id == id_prod)
  {
    encomenda[i].preco += (novo_preco - encomenda[i].produto[j].preco) * encomenda[i].produto[j].stock;
    encomenda[i].produto[j].preco = novo_preco;
  }
  else
  {
    
  }



}

void listaProduto()
{
  int id_encom;
  int id_prod;
  int i;
  int esta_na_enc;
  esta_na_enc = 0;
  id_encom = new_sym_var(sizeof(int) * 8);
  id_prod = new_sym_var(sizeof(int) * 8);
  if (id_encom > (n_encoms - 1))
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", id_encom);
  }
  else
  {
    if (id_prod > (n_sis - 1))
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", id_prod);
    }
    else
    {
      for (i = 0; i < encomenda[id_encom].n_de_prods; i++)
        if (encomenda[id_encom].produto[i].id == id_prod)
      {
        printf("%s %d.\n", encomenda[id_encom].produto[i].desc, encomenda[id_encom].produto[i].stock);
        esta_na_enc = 1;
        break;
      }
      else
      {
        
      }


      if (esta_na_enc == 0)
      {
        printf("%s %d.\n", sistema[id_prod].desc, 0);
      }
      else
      {
        
      }

    }

  }

}

void encomendaMaisProduto()
{
  int id_prod;
  int maior_n_ocorr;
  int id_enc_maior;
  int i;
  int j;
  maior_n_ocorr = 0;
  id_prod = new_sym_var(sizeof(int) * 8);
  if (id_prod > (n_sis - 1))
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", id_prod);
    return;
  }
  else
  {
    
  }

  for (i = 0; i < n_encoms; i++)
    for (j = 0; j < encomenda[i].n_de_prods; j++)
    if ((encomenda[i].produto[j].id == id_prod) && (encomenda[i].produto[j].stock > maior_n_ocorr))
  {
    maior_n_ocorr = encomenda[i].produto[j].stock;
    id_enc_maior = encomenda[i].id;
  }
  else
  {
    
  }



  if (maior_n_ocorr > 0)
  {
    printf("Maximo produto %d %d %d.\n", id_prod, id_enc_maior, maior_n_ocorr);
  }
  else
  {
    
  }

}

void merge(Produto v[], int e, int d, int m, char c)
{
  int i_e;
  int i_d;
  int i_t;
  int i;
  Produto temp[10000];
  i_e = e;
  i_d = m + 1;
  i_t = e;
  while ((i_e <= m) && (i_d <= d))
    if ((c == 'p') ? (v[i_d].preco < v[i_e].preco) : (strcmp(v[i_e].desc, v[i_d].desc) >= 0))
  {
    temp[i_t] = v[i_d];
    i_t++;
    i_d++;
  }
  else
  {
    if ((c == 'p') ? (v[i_d].preco > v[i_e].preco) : (strcmp(v[i_e].desc, v[i_d].desc) < 0))
    {
      temp[i_t] = v[i_e];
      i_t++;
      i_e++;
    }
    else
    {
      if (v[i_d].id <= v[i_e].id)
      {
        temp[i_t] = v[i_d];
        i_t++;
        i_d++;
      }
      else
      {
        temp[i_t] = v[i_e];
        i_t++;
        i_e++;
      }

    }

  }


  while (i_e <= m)
  {
    temp[i_t] = v[i_e];
    i_t++;
    i_e++;
  }

  while (i_d <= d)
  {
    temp[i_t] = v[i_d];
    i_t++;
    i_d++;
  }

  for (i = e; i <= d; i++)
    v[i] = temp[i];

}

void mergesort(Produto v[], int esq, int dir, char crit)
{
  int m;
  if (esq < dir)
  {
    m = (esq + dir) / 2;
    mergesort(v, esq, m, crit);
    mergesort(v, m + 1, dir, crit);
    merge(v, esq, dir, m, crit);
  }
  else
  {
    
  }

}

void listaProdutosPreco()
{
  Produto res[10000];
  int i;
  for (i = 0; i < n_sis; i++)
    res[i] = sistema[i];

  mergesort(res, 0, n_sis - 1, 'p');
  printf("Produtos\n");
  for (i = 0; i < n_sis; i++)
    printf("* %s %d %d\n", res[i].desc, res[i].preco, res[i].stock);

}

void listaProdutosDesc()
{
  Produto res[10000];
  int i;
  int id_encom;
  id_encom = new_sym_var(sizeof(int) * 8);
  if (id_encom > (n_encoms - 1))
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", id_encom);
    return;
  }
  else
  {
    
  }

  for (i = 0; i < encomenda[id_encom].n_de_prods; i++)
    res[i] = encomenda[id_encom].produto[i];

  mergesort(res, 0, encomenda[id_encom].n_de_prods - 1, 'd');
  printf("Encomenda %d\n", id_encom);
  for (i = 0; i < encomenda[id_encom].n_de_prods; i++)
    if (res[i].stock > 0)
  {
    printf("* %s %d %d\n", res[i].desc, res[i].preco, res[i].stock);
  }
  else
  {
    
  }


}

int main()
{
  char comando;
  comando = new_sym_var(sizeof(char) * 8);
  while (comando != 'x')
  {
    switch (comando)
    {
      case 'a':
        adicionaProduto();
        break;

      case 'q':
        adicionaStock();
        break;

      case 'N':
        criaEncomenda();
        break;

      case 'A':
        adicionaProdEncomenda();
        break;

      case 'r':
        removeStockProd();
        break;

      case 'R':
        removeProdEncomenda();
        break;

      case 'C':
        calculaCustoEncomenda();
        break;

      case 'p':
        alteraPreco();
        break;

      case 'E':
        listaProduto();
        break;

      case 'm':
        encomendaMaisProduto();
        break;

      case 'l':
        listaProdutosPreco();
        break;

      case 'L':
        listaProdutosDesc();
        break;

      default:
        break;

    }

    comando = new_sym_var(sizeof(char) * 8);
  }

  return 0;
}

