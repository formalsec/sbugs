/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <assert.h>


typedef struct 
{
  int idp;
  char desc[63];
  int preco;
  int peso;
  int qtd;
} Produto;
Produto Encomendas[500][200];
Produto Stock[10000];
static int produtoscount;
static int encomendascount;
int calcula_preco(int ide, int idp);
int calcula_pesoE(int ide);
void mostra_produto(int idp);
void mostra_encomenda(int ide, int i);
void bubble_idp(Produto a[], int l, int r);
void bubble_preco(Produto a[], int l, int r);
void bubble_desc(Produto a[], int l, int r);
int total_produtos(int ide);
void inicializar(int ide, int idp);
int procura_produto(int idp);
void novo_produto();
void adiciona_stock(int idp, int qtd);
void nova_encomenda();
void adiciona_produto(int ide, int idp, int qtd);
void remove_stock(int idp, int qtd);
void remove_produto(int ide, int idp);
void custo_encomenda(int ide);
void alterar_preco(int idp, int preco);
void listar_produto(int ide, int idp);
void listar_maisvezes(int idp);
void listar_produtos();
void listar_produtos_encomenda(int ide);
int main()
{
  int idp;
  int ide;
  int qtd;
  int preco;
  int comando;
  int i;
  int j;
  int p;
  for (p = 0; p < 10000; p++)
  {
    Stock[p].idp = 0;
    strcpy(Stock[p].desc, "NULL");
    Stock[p].preco = 0;
    Stock[p].peso = 0;
    Stock[p].qtd = 0;
  }

  for (i = 0; i < 500; i++)
  {
    for (j = 0; j < 200; j++)
    {
      inicializar(i, j);
    }

  }

  while ((comando = getchar()) != 'x')
  {
    switch (comando)
    {
      case 'a':
        novo_produto();
        break;

      case 'q':
        idp = new_sym_var(sizeof(int) * 8);
        qtd = new_sym_var(sizeof(int) * 8);
        adiciona_stock(idp, qtd);
        break;

      case 'N':
        nova_encomenda();
        break;

      case 'A':
        ide = new_sym_var(sizeof(int) * 8);
        idp = new_sym_var(sizeof(int) * 8);
        qtd = new_sym_var(sizeof(int) * 8);
        adiciona_produto(ide, idp, qtd);
        break;

      case 'r':
        idp = new_sym_var(sizeof(int) * 8);
        qtd = new_sym_var(sizeof(int) * 8);
        remove_stock(idp, qtd);
        break;

      case 'R':
        ide = new_sym_var(sizeof(int) * 8);
        idp = new_sym_var(sizeof(int) * 8);
        remove_produto(ide, idp);
        break;

      case 'C':
        ide = new_sym_var(sizeof(int) * 8);
        custo_encomenda(ide);
        break;

      case 'p':
        idp = new_sym_var(sizeof(int) * 8);
        preco = new_sym_var(sizeof(int) * 8);
        alterar_preco(idp, preco);
        break;

      case 'E':
        ide = new_sym_var(sizeof(int) * 8);
        idp = new_sym_var(sizeof(int) * 8);
        listar_produto(ide, idp);
        break;

      case 'm':
        idp = new_sym_var(sizeof(int) * 8);
        listar_maisvezes(idp);
        break;

      case 'l':
        listar_produtos();
        break;

      case 'L':
        ide = new_sym_var(sizeof(int) * 8);
        listar_produtos_encomenda(ide);
        break;

      default:
        break;

    }

  }

  return 0;
}

void novo_produto()
{
  int preco;
  int peso;
  int qtd;
  char desc[63];
  for (int desc_index = 0; desc_index < 10; desc_index++)
  {
    desc[desc_index] = new_sym_var(sizeof(char) * 8);
  }

  desc[10 - 1] = '\0';
  preco = new_sym_var(sizeof(int) * 8);
  peso = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (produtoscount < 10000)
  {
    Stock[produtoscount].idp = produtoscount;
    strcpy(Stock[produtoscount].desc, desc);
    Stock[produtoscount].preco = preco;
    Stock[produtoscount].peso = peso;
    Stock[produtoscount].qtd = qtd;
    printf("Novo produto %d.\n", produtoscount);
    produtoscount++;
  }
  else
  {
    
  }

}

void adiciona_stock(int idp, int qtd)
{
  if (idp < produtoscount)
  {
    int p;
    p = procura_produto(idp);
    Stock[p].qtd += qtd;
  }
  else
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
  }

}

void nova_encomenda()
{
  if (encomendascount < 500)
  {
    printf("Nova encomenda %d.\n", encomendascount);
    encomendascount++;
  }
  else
  {
    
  }

}

void adiciona_produto(int ide, int idp, int qtd)
{
  int i;
  int p;
  int t;
  p = procura_produto(idp);
  t = total_produtos(ide);
  if (ide >= encomendascount)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (idp >= produtoscount)
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      if (qtd > Stock[p].qtd)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
      }
      else
      {
        if ((calcula_pesoE(ide) + (Stock[p].peso * qtd)) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de %d.\n", idp, ide, 200);
        }
        else
        {
          for (i = 0; i < produtoscount; i++)
          {
            if ((i == t) || ((Encomendas[ide][i].idp == idp) && (Encomendas[ide][i].preco != 0)))
            {
              Encomendas[ide][i].idp = Stock[p].idp;
              strcpy(Encomendas[ide][i].desc, Stock[p].desc);
              Encomendas[ide][i].preco = Stock[p].preco;
              Encomendas[ide][i].peso = Stock[p].peso;
              Encomendas[ide][i].qtd += qtd;
              break;
            }
            else
            {
              
            }

          }

          remove_stock(idp, qtd);
        }

      }

    }

  }

}

void remove_stock(int idp, int qtd)
{
  int p;
  p = procura_produto(idp);
  if (idp < produtoscount)
  {
    if (Stock[p].qtd >= qtd)
    {
      Stock[p].qtd = Stock[p].qtd - qtd;
    }
    else
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, idp);
    }

  }
  else
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
  }

}

void remove_produto(int ide, int idp)
{
  int i;
  if (ide < encomendascount)
  {
    if (idp < produtoscount)
    {
      for (i = 0; i < total_produtos(ide); i++)
      {
        if ((Encomendas[ide][i].idp == idp) && (Encomendas[ide][i].peso != 0))
        {
          adiciona_stock(idp, Encomendas[ide][i].qtd);
          Encomendas[ide][i].idp = -1;
          Encomendas[ide][i].preco = 0;
          Encomendas[ide][i].peso = 0;
          Encomendas[ide][i].qtd = 0;
          break;
        }
        else
        {
          continue;
        }

      }

    }
    else
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }

  }
  else
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }

}

void custo_encomenda(int ide)
{
  int i;
  int custo = 0;
  if (ide < encomendascount)
  {
    for (i = 0; i < total_produtos(ide); i++)
    {
      custo = custo + calcula_preco(ide, i);
    }

    printf("Custo da encomenda %d %d.\n", ide, custo);
  }
  else
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }

}

void alterar_preco(int idp, int preco)
{
  int i;
  int j;
  int p;
  p = procura_produto(idp);
  if (idp < produtoscount)
  {
    Stock[p].preco = preco;
    for (i = 0; i < encomendascount; i++)
    {
      for (j = 0; j < total_produtos(i); j++)
      {
        if ((Encomendas[i][j].idp == idp) && (Encomendas[i][j].peso != 0))
        {
          Encomendas[i][j].preco = preco;
        }
        else
        {
          
        }

      }

    }

  }
  else
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
  }

}

void listar_produto(int ide, int idp)
{
  int i;
  int t = 0;
  int p = 0;
  p = procura_produto(idp);
  if (ide < encomendascount)
  {
    if (idp < produtoscount)
    {
      for (i = 0; i < total_produtos(ide); i++)
      {
        if ((Encomendas[ide][i].idp == idp) && (Encomendas[ide][i].preco != 0))
        {
          printf("%s %d.\n", Encomendas[ide][i].desc, Encomendas[ide][i].qtd);
          t++;
          break;
        }
        else
        {
          
        }

      }

      if (t == 0)
      {
        printf("%s %d.\n", Stock[p].desc, 0);
      }
      else
      {
        
      }

    }
    else
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
    }

  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }

}

void listar_maisvezes(int idp)
{
  int i;
  int j;
  int t = 0;
  int max = 0;
  int ide = 0;
  if (idp < produtoscount)
  {
    for (i = 0; i < encomendascount; i++)
    {
      for (j = 0; j < total_produtos(i); j++)
      {
        if ((Encomendas[i][j].idp == idp) && (Encomendas[i][j].peso != 0))
        {
          if (Encomendas[i][j].qtd > max)
          {
            t++;
            max = Encomendas[i][j].qtd;
            ide = i;
          }
          else
          {
            if (i == ide)
            {
              max = max + Encomendas[i][j].qtd;
            }
            else
            {
              
            }

          }

        }
        else
        {
          
        }

      }

    }

    if (t >= 1)
    {
      printf("Maximo produto %d %d %d.\n", idp, ide, max);
    }
    else
    {
      
    }

  }
  else
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
  }

}

void listar_produtos()
{
  int i;
  bubble_idp(Stock, 0, produtoscount);
  bubble_preco(Stock, 0, produtoscount);
  printf("Produtos\n");
  for (i = 0; i < produtoscount; i++)
  {
    mostra_produto(i);
  }

}

void listar_produtos_encomenda(int ide)
{
  int i;
  int t;
  t = total_produtos(ide);
  if (ide < encomendascount)
  {
    if (t > 0)
    {
      bubble_desc(Encomendas[ide], 0, t);
      printf("Encomenda %d\n", ide);
      for (i = 0; i < t; i++)
      {
        if (Encomendas[ide][i].peso != 0)
        {
          mostra_encomenda(ide, i);
        }
        else
        {
          continue;
        }

      }

    }
    else
    {
      printf("Encomenda %d\n", ide);
    }

  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }

}

int calcula_pesoE(int ide)
{
  int i;
  int peso = 0;
  for (i = 0; i < total_produtos(ide); i++)
  {
    peso = peso + (Encomendas[ide][i].peso * Encomendas[ide][i].qtd);
  }

  return peso;
}

int total_produtos(int ide)
{
  int i;
  int total = 0;
  for (i = 0; i < produtoscount; i++)
  {
    if ((Encomendas[ide][i].preco != 0) || (Encomendas[ide][i].idp == (-1)))
    {
      total++;
    }
    else
    {
      
    }

  }

  return total;
}

void inicializar(int ide, int idp)
{
  Encomendas[ide][idp].idp = 0;
  strcpy(Encomendas[ide][idp].desc, "NULL");
  Encomendas[ide][idp].preco = 0;
  Encomendas[ide][idp].peso = 0;
  Encomendas[ide][idp].qtd = 0;
}

int procura_produto(int idp)
{
  int i;
  int j = 0;
  for (i = 0; i < produtoscount; ++i)
  {
    if (Stock[i].idp == idp)
    {
      j = i;
    }
    else
    {
      
    }

  }

  return j;
}

int calcula_preco(int ide, int idp)
{
  int preco = 0;
  preco = Encomendas[ide][idp].preco * Encomendas[ide][idp].qtd;
  return preco;
}

void mostra_produto(int idp)
{
  if ((idp >= 0) && (idp < produtoscount))
  {
    printf("* %s %d %d\n", Stock[idp].desc, Stock[idp].preco, Stock[idp].qtd);
  }
  else
  {
    
  }

}

void mostra_encomenda(int ide, int i)
{
  if ((i >= 0) && (i < produtoscount))
  {
    printf("* %s %d %d\n", Encomendas[ide][i].desc, Encomendas[ide][i].preco, Encomendas[ide][i].qtd);
  }
  else
  {
    
  }

}

void bubble_idp(Produto a[], int l, int r)
{
  int i;
  int j;
  Produto pro;
  for (i = l; i < r; i++)
  {
    for (j = l; j < (r + (l - 1)); j++)
      if (a[j].idp > a[j + 1].idp)
    {
      pro = a[j];
      a[j] = a[j + 1];
      a[j + 1] = pro;
    }
    else
    {
      
    }


  }

}

void bubble_preco(Produto a[], int l, int r)
{
  int i;
  int j;
  Produto pro;
  for (i = l; i < r; i++)
  {
    for (j = l; j < (r + (l - 1)); j++)
      if (a[j].preco > a[j + 1].preco)
    {
      pro = a[j];
      a[j] = a[j + 1];
      a[j + 1] = pro;
    }
    else
    {
      
    }


  }

}

void bubble_desc(Produto a[], int l, int r)
{
  int i;
  int j;
  Produto pro;
  for (i = l; i < r; i++)
  {
    for (j = l; j < (r + (l - 1)); j++)
      if (strcmp(a[j].desc, a[j + 1].desc) > 0)
    {
      pro = a[j];
      a[j] = a[j + 1];
      a[j + 1] = pro;
    }
    else
    {
      
    }


  }

}

