#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>


int cont_idp = 0;
int cont_ide = 0;
typedef struct produto
{
  int idp;
  int preco;
  int peso;
  int qtd;
  char desc[64];
} produto;
typedef struct encomenda
{
  int ide;
  int cont_prod;
  produto produtos[200];
} encomenda;
produto stock[10000] = {0};
encomenda encomendas[500] = {0};
int produtoExiste(int idp)
{
  if (idp >= cont_idp)
  {
    return 0;
  }
  else
  {
    return 1;
  }

}

int encomendaExiste(int ide)
{
  if (ide >= cont_ide)
  {
    return 0;
  }
  else
  {
    return 1;
  }

}

int pesoEncomenda(encomenda e)
{
  int i;
  int peso = 0;
  for (i = 0; i < e.cont_prod; i++)
    peso += e.produtos[i].peso * e.produtos[i].qtd;

  return peso;
}

produto aux[10000];
void merge(produto a[], int left, int m, int right, char c)
{
  int i;
  int j;
  int k;
  for (i = m + 1; i > left; i--)
    aux[i - 1] = a[i - 1];

  for (j = m; j < right; j++)
    aux[(right + m) - j] = a[j + 1];

  if (c == 'l')
  {
    for (k = left; k <= right; k++)
      if (aux[j].preco < aux[i].preco)
    {
      a[k] = aux[j--];
    }
    else
    {
      if (aux[j].preco > aux[i].preco)
      {
        a[k] = aux[i++];
      }
      else
      {
        if (aux[j].idp < aux[i].idp)
        {
          a[k] = aux[j--];
        }
        else
        {
          a[k] = aux[i++];
        }

      }

    }


  }
  else
  {
    for (k = left; k <= right; k++)
      if (aux[j].desc[0] < aux[i].desc[0])
    {
      a[k] = aux[j--];
    }
    else
    {
      if (aux[j].desc[0] > aux[i].desc[0])
      {
        a[k] = aux[i++];
      }
      else
      {
        if (aux[j].desc[1] < aux[i].desc[1])
        {
          a[k] = aux[j--];
        }
        else
        {
          a[k] = aux[i++];
        }

      }

    }


  }

}

void mergesort(produto a[], int left, int right, char c)
{
  int m = (right + left) / 2;
  if (right <= left)
  {
    return;
  }
  else
  {
    
  }

  mergesort(a, left, m, c);
  mergesort(a, m + 1, right, c);
  merge(a, left, m, right, c);
}

void a()
{
  char desc[64];
  int preco;
  int peso;
  int qtd;
  produto novo_produto;
  for (int desc_index = 0; desc_index < 10; desc_index++)
  {
    desc[desc_index] = new_sym_var(sizeof(char) * 8);
  }

  desc[10 - 1] = '\0';
  preco = new_sym_var(sizeof(int) * 8);
  peso = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  strcpy(novo_produto.desc, desc);
  novo_produto.preco = preco;
  novo_produto.peso = peso;
  novo_produto.qtd = qtd;
  novo_produto.idp = cont_idp;
  stock[novo_produto.idp] = novo_produto;
  printf("Novo produto %d.\n", novo_produto.idp);
  cont_idp++;
}

void q()
{
  int idp;
  int qtd;
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (produtoExiste(idp))
  {
    stock[idp].qtd += qtd;
  }
  else
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
  }

}

void N()
{
  encomenda nova_encomenda;
  nova_encomenda.ide = cont_ide;
  nova_encomenda.cont_prod = 0;
  encomendas[nova_encomenda.ide] = nova_encomenda;
  printf("Nova encomenda %d.\n", nova_encomenda.ide);
  cont_ide++;
}

void A()
{
  int ide;
  int idp;
  int qtd;
  int i;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (!encomendaExiste(ide))
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (!produtoExiste(idp))
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      if (stock[idp].qtd < qtd)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
      }
      else
      {
        if ((pesoEncomenda(encomendas[ide]) + (stock[idp].peso * qtd)) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
        }
        else
        {
          int FOUND = 0;
          for (i = 0; i < encomendas[ide].cont_prod; i++)
          {
            if (encomendas[ide].produtos[i].idp == idp)
            {
              encomendas[ide].produtos[i].qtd += qtd;
              stock[idp].qtd -= qtd;
              FOUND = 1;
            }
            else
            {
              
            }

          }

          if (!FOUND)
          {
            encomendas[ide].produtos[encomendas[ide].cont_prod] = stock[idp];
            encomendas[ide].produtos[encomendas[ide].cont_prod].qtd = qtd;
            stock[idp].qtd -= qtd;
            encomendas[ide].cont_prod++;
          }
          else
          {
            
          }

        }

      }

    }

  }

}

void r()
{
  int idp;
  int qtd;
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (produtoExiste(idp))
  {
    if ((stock[idp].qtd - qtd) >= 0)
    {
      stock[idp].qtd -= qtd;
    }
    else
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, idp);
    }

  }
  else
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
  }

}

void R()
{
  int idp;
  int ide;
  int i;
  int FOUND = 0;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (!encomendaExiste(ide))
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (!produtoExiste(idp))
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      for (i = 0; i < encomendas[ide].cont_prod; i++)
      {
        if (encomendas[ide].produtos[i].idp == idp)
        {
          FOUND = 1;
          break;
        }
        else
        {
          
        }

      }

      if (FOUND)
      {
        stock[idp].qtd += encomendas[ide].produtos[i].qtd;
        while ((i + 1) <= encomendas[ide].cont_prod)
        {
          encomendas[ide].produtos[i] = encomendas[ide].produtos[i + 1];
          i++;
        }

        encomendas[ide].cont_prod--;
      }
      else
      {
        
      }

    }

  }

}

void C()
{
  int ide;
  int i;
  int total = 0;
  ide = new_sym_var(sizeof(int) * 8);
  if (encomendaExiste(ide))
  {
    for (i = 0; i < encomendas[ide].cont_prod; i++)
      total += encomendas[ide].produtos[i].qtd * encomendas[ide].produtos[i].preco;

    printf("Custo da encomenda %d %d.\n", ide, total);
  }
  else
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }

}

void p()
{
  int idp;
  int preco;
  int i;
  int j;
  idp = new_sym_var(sizeof(int) * 8);
  preco = new_sym_var(sizeof(int) * 8);
  if (produtoExiste(idp))
  {
    stock[idp].preco = preco;
    for (i = 0; i < cont_ide; i++)
    {
      for (j = 0; j < encomendas[i].cont_prod; j++)
      {
        if (encomendas[i].produtos[j].idp == idp)
        {
          encomendas[i].produtos[j].preco = preco;
        }
        else
        {
          
        }

      }

    }

  }
  else
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
  }

}

void E()
{
  int ide;
  int idp;
  int i;
  int FOUND = 0;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (!encomendaExiste(ide))
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    if (!produtoExiste(idp))
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
    }
    else
    {
      for (i = 0; i < encomendas[ide].cont_prod; i++)
      {
        if (encomendas[ide].produtos[i].idp == idp)
        {
          FOUND = 1;
          break;
        }
        else
        {
          
        }

      }

      if (FOUND)
      {
        printf("%s %d.\n", encomendas[ide].produtos[i].desc, encomendas[ide].produtos[i].qtd);
      }
      else
      {
        printf("%s 0.\n", stock[idp].desc);
      }

    }

  }

}

void m()
{
  int idp;
  int i;
  int j;
  int FOUND = 0;
  int max_qtd[2] = {0};
  idp = new_sym_var(sizeof(int) * 8);
  if (!produtoExiste(idp))
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    for (i = 0; i < cont_ide; i++)
    {
      for (j = 0; j < encomendas[i].cont_prod; j++)
      {
        if (encomendas[i].produtos[j].idp == idp)
        {
          if (encomendas[i].produtos[j].qtd > max_qtd[1])
          {
            max_qtd[0] = i;
            max_qtd[1] = encomendas[i].produtos[j].qtd;
          }
          else
          {
            
          }

          FOUND = 1;
        }
        else
        {
          
        }

      }

    }

    if (FOUND)
    {
      printf("Maximo produto %d %d %d.\n", idp, max_qtd[0], max_qtd[1]);
    }
    else
    {
      
    }

  }

}

void k()
{
  int i;
  printf("Produtos\n");
  for (i = 0; i < cont_idp; i++)
    printf("* %s %d %d\n", stock[i].desc, stock[i].preco, stock[i].qtd);

}

void K()
{
  int ide;
  int i;
  ide = new_sym_var(sizeof(int) * 8);
  printf("Encomenda %d\n", ide);
  for (i = 0; i < encomendas[ide].cont_prod; i++)
    printf("* %s %d %d\n", encomendas[ide].produtos[i].desc, encomendas[ide].produtos[i].preco, encomendas[ide].produtos[i].qtd);

}

void l()
{
  produto produtos[10000];
  int i;
  for (i = 0; i < cont_idp; i++)
    produtos[i] = stock[i];

  mergesort(produtos, 0, cont_idp - 1, 'l');
  printf("Produtos\n");
  for (i = 0; i < cont_idp; i++)
    printf("* %s %d %d\n", produtos[i].desc, produtos[i].preco, produtos[i].qtd);

}

void L()
{
  int i;
  int ide;
  produto produtos[200];
  ide = new_sym_var(sizeof(int) * 8);
  if (encomendaExiste(ide))
  {
    for (i = 0; i < encomendas[ide].cont_prod; i++)
      produtos[i] = encomendas[ide].produtos[i];

    mergesort(produtos, 0, encomendas[ide].cont_prod - 1, 'L');
    printf("Encomenda %d\n", ide);
    for (i = 0; i < encomendas[ide].cont_prod; i++)
      printf("* %s %d %d\n", produtos[i].desc, produtos[i].preco, produtos[i].qtd);

  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }

}

int main()
{
  char com;
  while ((com = getchar()) != 'x')
  {
    switch (com)
    {
      case 'a':
        a();
        break;

      case 'q':
        q();
        break;

      case 'N':
        N();
        break;

      case 'A':
        A();
        break;

      case 'R':
        R();
        break;

      case 'r':
        r();
        break;

      case 'C':
        C();
        break;

      case 'p':
        p();
        break;

      case 'E':
        E();
        break;

      case 'm':
        m();
        break;

      case 'k':
        k();
        break;

      case 'K':
        K();
        break;

      case 'l':
        l();
        break;

      case 'L':
        L();
        break;

      default:
        break;

    }

  }

  return 0;
}

