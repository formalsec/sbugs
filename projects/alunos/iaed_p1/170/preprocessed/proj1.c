#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


typedef struct 
{
  int id;
  char desc[63];
  int preco;
  int peso;
  int qtd_stock;
} produto;
typedef struct 
{
  int ide;
  int peso_total;
  int custo;
  produto produtos[10000];
  int produtos_in[10000];
} encomenda;
typedef struct 
{
  produto produtos[10000];
  encomenda encomendas[500];
} sis_log;
static int i_produtos;
static int i_encomendas;
sis_log sistema;
void comando_a();
void comando_q();
void comando_N();
void comando_A();
void comando_r();
void comando_R();
void comando_C();
void comando_p();
void comando_E();
void comando_m();
void comando_l();
void comando_L();
void merge_sort(int vetor[], int esquerda, int direita);
void merge(int vetor[], int esquerda, int m, int direita);
void merge_sort_desc(int vetor[], int esquerda, int direita);
void merge_desc(int vetor[], int esquerda, int m, int direita);
int main()
{
  char primeira_letra;
  primeira_letra = new_sym_var(sizeof(char) * 8);
  while (primeira_letra != 'x')
  {
    switch (primeira_letra)
    {
      case 'a':
        getchar();
        comando_a();
        getchar();
        break;

      case 'q':
        getchar();
        comando_q();
        getchar();
        break;

      case 'N':
        comando_N();
        getchar();
        break;

      case 'A':
        getchar();
        comando_A();
        getchar();
        break;

      case 'r':
        getchar();
        comando_r();
        getchar();
        break;

      case 'R':
        getchar();
        comando_R();
        getchar();
        break;

      case 'C':
        getchar();
        comando_C();
        getchar();
        break;

      case 'p':
        getchar();
        comando_p();
        getchar();
        break;

      case 'E':
        getchar();
        comando_E();
        getchar();
        break;

      case 'm':
        getchar();
        comando_m();
        getchar();
        break;

      case 'l':
        comando_l();
        getchar();
        break;

      case 'L':
        getchar();
        comando_L();
        getchar();
        break;

    }

    primeira_letra = new_sym_var(sizeof(char) * 8);
  }

  return 0;
}

void comando_a()
{
  produto prod;
  for (int prod_index = 0; prod_index < 10; prod_index++)
  {
    prod.desc[prod_index] = new_sym_var(sizeof(char) * 8);
  }

  prod.desc[10 - 1] = '\0';
  prod.preco = new_sym_var(sizeof(int) * 8);
  prod.peso = new_sym_var(sizeof(int) * 8);
  prod.qtd_stock = new_sym_var(sizeof(int) * 8);
  prod.id = i_produtos;
  sistema.produtos[prod.id].id = prod.id;
  strcpy(sistema.produtos[prod.id].desc, prod.desc);
  sistema.produtos[prod.id].preco = prod.preco;
  sistema.produtos[prod.id].peso = prod.peso;
  sistema.produtos[prod.id].qtd_stock = prod.qtd_stock;
  printf("Novo produto %d.\n", prod.id);
  i_produtos++;
}

void comando_q()
{
  produto prod;
  prod.id = new_sym_var(sizeof(int) * 8);
  prod.qtd_stock = new_sym_var(sizeof(int) * 8);
  if (prod.id >= i_produtos)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", prod.id);
  }
  else
  {
    sistema.produtos[prod.id].qtd_stock += prod.qtd_stock;
  }

}

void comando_N()
{
  printf("Nova encomenda %d.\n", i_encomendas);
  i_encomendas++;
}

void comando_A()
{
  produto prod;
  encomenda enco;
  enco.ide = new_sym_var(sizeof(int) * 8);
  prod.id = new_sym_var(sizeof(int) * 8);
  prod.qtd_stock = new_sym_var(sizeof(int) * 8);
  if (prod.id >= i_produtos)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", prod.id, enco.ide);
  }
  else
  {
    if (enco.ide >= i_encomendas)
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", prod.id, enco.ide);
    }
    else
    {
      if (prod.qtd_stock > sistema.produtos[prod.id].qtd_stock)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", prod.id, enco.ide);
      }
      else
      {
        if (((sistema.produtos[prod.id].peso * prod.qtd_stock) + sistema.encomendas[enco.ide].peso_total) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", prod.id, enco.ide);
        }
        else
        {
          if (sistema.encomendas[enco.ide].produtos_in[prod.id])
          {
            sistema.encomendas[enco.ide].peso_total += prod.qtd_stock * sistema.produtos[prod.id].peso;
            sistema.encomendas[enco.ide].produtos[prod.id].qtd_stock += prod.qtd_stock;
            sistema.produtos[prod.id].qtd_stock -= prod.qtd_stock;
          }
          else
          {
            sistema.encomendas[enco.ide].produtos[prod.id].id = sistema.produtos[prod.id].id;
            strcpy(sistema.encomendas[enco.ide].produtos[prod.id].desc, sistema.produtos[prod.id].desc);
            sistema.encomendas[enco.ide].produtos[prod.id].preco = sistema.produtos[prod.id].preco;
            sistema.encomendas[enco.ide].produtos[prod.id].peso = sistema.produtos[prod.id].peso;
            sistema.encomendas[enco.ide].produtos[prod.id].qtd_stock = prod.qtd_stock;
            sistema.encomendas[enco.ide].peso_total += prod.qtd_stock * sistema.produtos[prod.id].peso;
            sistema.produtos[prod.id].qtd_stock -= prod.qtd_stock;
            sistema.encomendas[enco.ide].produtos_in[prod.id] = 1;
          }

        }

      }

    }

  }

}

void comando_r()
{
  produto prod;
  prod.id = new_sym_var(sizeof(int) * 8);
  prod.qtd_stock = new_sym_var(sizeof(int) * 8);
  if (prod.id >= i_produtos)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", prod.id);
  }
  else
  {
    if (prod.qtd_stock > sistema.produtos[prod.id].qtd_stock)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", prod.qtd_stock, prod.id);
    }
    else
    {
      sistema.produtos[prod.id].qtd_stock -= prod.qtd_stock;
    }

  }

}

void comando_R()
{
  produto prod;
  encomenda enco;
  enco.ide = new_sym_var(sizeof(int) * 8);
  prod.id = new_sym_var(sizeof(int) * 8);
  if (enco.ide >= i_encomendas)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", prod.id, enco.ide);
  }
  else
  {
    if (prod.id >= i_produtos)
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", prod.id, enco.ide);
    }
    else
    {
      if (sistema.encomendas[enco.ide].produtos_in[prod.id])
      {
        sistema.encomendas[enco.ide].peso_total -= sistema.encomendas[enco.ide].produtos[prod.id].peso * sistema.encomendas[enco.ide].produtos[prod.id].qtd_stock;
        sistema.produtos[prod.id].qtd_stock += sistema.encomendas[enco.ide].produtos[prod.id].qtd_stock;
        sistema.encomendas[enco.ide].produtos_in[prod.id] = 0;
      }
      else
      {
        
      }

    }

  }

}

void comando_C()
{
  encomenda enco;
  int i;
  enco.ide = new_sym_var(sizeof(int) * 8);
  sistema.encomendas[enco.ide].custo = 0;
  if (enco.ide >= i_encomendas)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", enco.ide);
  }
  else
  {
    for (i = 0; i < i_produtos; i++)
    {
      if (sistema.encomendas[enco.ide].produtos_in[i])
      {
        sistema.encomendas[enco.ide].custo += sistema.encomendas[enco.ide].produtos[i].preco * sistema.encomendas[enco.ide].produtos[i].qtd_stock;
      }
      else
      {
        
      }

    }

    printf("Custo da encomenda %d %d.\n", enco.ide, sistema.encomendas[enco.ide].custo);
  }

}

void comando_p()
{
  produto prod;
  int i;
  prod.id = new_sym_var(sizeof(int) * 8);
  prod.preco = new_sym_var(sizeof(int) * 8);
  if (prod.id >= i_produtos)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", prod.id);
  }
  else
  {
    sistema.produtos[prod.id].preco = prod.preco;
    for (i = 0; i < i_encomendas; i++)
    {
      if (sistema.encomendas[i].produtos_in[prod.id])
      {
        sistema.encomendas[i].produtos[prod.id].preco = prod.preco;
      }
      else
      {
        
      }

    }

  }

}

void comando_E()
{
  encomenda enco;
  produto prod;
  enco.ide = new_sym_var(sizeof(int) * 8);
  prod.id = new_sym_var(sizeof(int) * 8);
  if (enco.ide >= i_encomendas)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", enco.ide);
  }
  else
  {
    if (prod.id >= i_produtos)
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", prod.id);
    }
    else
    {
      if (sistema.encomendas[enco.ide].produtos_in[prod.id])
      {
        printf("%s %d.\n", sistema.encomendas[enco.ide].produtos[prod.id].desc, sistema.encomendas[enco.ide].produtos[prod.id].qtd_stock);
      }
      else
      {
        printf("%s %d.\n", sistema.produtos[prod.id].desc, 0);
      }

    }

  }

}

void comando_m()
{
  int i;
  int controlo = 0;
  int qtd_maior = 0;
  produto prod;
  encomenda enco_prod_maior;
  prod.id = new_sym_var(sizeof(int) * 8);
  if (prod.id >= i_produtos)
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", prod.id);
  }
  else
  {
    if (i_encomendas < 1)
    {
      return;
    }
    else
    {
      for (i = 0; i < i_encomendas; i++)
      {
        if (sistema.encomendas[i].produtos_in[prod.id])
        {
          controlo = 1;
          if (sistema.encomendas[i].produtos[prod.id].qtd_stock > qtd_maior)
          {
            enco_prod_maior.ide = i;
            qtd_maior = sistema.encomendas[i].produtos[prod.id].qtd_stock;
          }
          else
          {
            
          }

        }
        else
        {
          
        }

      }

      if (controlo)
      {
        printf("Maximo produto %d %d %d.\n", prod.id, enco_prod_maior.ide, qtd_maior);
      }
      else
      {
        
      }

    }

  }

}

void comando_l()
{
  int i;
  int contador = 0;
  int vetor_indices[10000];
  for (i = 0; i < i_produtos; i++)
  {
    vetor_indices[i] = i;
    contador++;
  }

  merge_sort(vetor_indices, 0, contador - 1);
  printf("Produtos\n");
  for (i = 0; i < contador; i++)
  {
    printf("* %s %d %d\n", sistema.produtos[vetor_indices[i]].desc, sistema.produtos[vetor_indices[i]].preco, sistema.produtos[vetor_indices[i]].qtd_stock);
  }

}

void comando_L()
{
  encomenda enco;
  int i;
  int contador = 0;
  int vetor_indices[10000];
  enco.ide = new_sym_var(sizeof(int) * 8);
  if (enco.ide >= i_encomendas)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", enco.ide);
  }
  else
  {
    for (i = 0; i < i_produtos; i++)
    {
      if (sistema.encomendas[enco.ide].produtos_in[i])
      {
        vetor_indices[contador] = i;
        contador++;
      }
      else
      {
        
      }

    }

    merge_sort_desc(vetor_indices, 0, contador - 1);
    printf("Encomenda %d\n", enco.ide);
    for (i = 0; i < contador; i++)
    {
      printf("* %s %d %d\n", sistema.encomendas[enco.ide].produtos[vetor_indices[i]].desc, sistema.encomendas[enco.ide].produtos[vetor_indices[i]].preco, sistema.encomendas[enco.ide].produtos[vetor_indices[i]].qtd_stock);
    }

  }

}

void merge_sort(int vetor[], int esquerda, int direita)
{
  int m = (direita + esquerda) / (1 + 1);
  if (direita <= esquerda)
  {
    return;
  }
  else
  {
    
  }

  merge_sort(vetor, esquerda, m);
  merge_sort(vetor, m + 1, direita);
  merge(vetor, esquerda, m, direita);
}

void merge_sort_desc(int vetor[], int esquerda, int direita)
{
  int m = (direita + esquerda) / (1 + 1);
  if (direita <= esquerda)
  {
    return;
  }
  else
  {
    
  }

  merge_sort_desc(vetor, esquerda, m);
  merge_sort_desc(vetor, m + 1, direita);
  merge_desc(vetor, esquerda, m, direita);
}

int aux[10000];
void merge(int vetor[], int esquerda, int m, int direita)
{
  int i;
  int j;
  int k;
  for (i = m + 1; i > esquerda; i--)
  {
    aux[i - 1] = vetor[i - 1];
  }

  for (j = m; j < direita; j++)
  {
    aux[(direita + m) - j] = vetor[j + 1];
  }

  for (k = esquerda; k <= direita; k++)
  {
    if ((sistema.produtos[aux[j]].id < sistema.produtos[aux[i]].id) && (sistema.produtos[aux[j]].preco == sistema.produtos[aux[i]].preco))
    {
      vetor[k] = aux[j--];
    }
    else
    {
      if (sistema.produtos[aux[j]].preco < sistema.produtos[aux[i]].preco)
      {
        vetor[k] = aux[j--];
      }
      else
      {
        vetor[k] = aux[i++];
      }

    }

  }

}

int aux1[10000];
void merge_desc(int vetor[], int esquerda, int m, int direita)
{
  int i;
  int j;
  int k;
  for (i = m + 1; i > esquerda; i--)
  {
    aux1[i - 1] = vetor[i - 1];
  }

  for (j = m; j < direita; j++)
  {
    aux1[(direita + m) - j] = vetor[j + 1];
  }

  for (k = esquerda; k <= direita; k++)
  {
    if (strcmp(sistema.produtos[aux1[j]].desc, sistema.produtos[aux1[i]].desc) < 0)
    {
      vetor[k] = aux1[j--];
    }
    else
    {
      vetor[k] = aux1[i++];
    }

  }

}

