/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


typedef struct 
{
  char descricao[63];
  int preco;
  int peso;
  int quantidade;
  int idp;
} produto;
typedef struct 
{
  int id_prod[10000];
} encomenda;
produto catalogo[10000];
encomenda pedidos[500];
int idp;
int ide;
int qtd;
int p;
int e;
void adiciona_produto(int p)
{
  printf("Novo produto %d.\n", p);
  catalogo[p].idp = p;
  for (int catalogo_index = 0; catalogo_index < 10; catalogo_index++)
  {
    catalogo[p].descricao[catalogo_index] = new_sym_var(sizeof(char) * 8);
  }

  catalogo[p].descricao[10 - 1] = '\0';
  catalogo[p].preco = new_sym_var(sizeof(int) * 8);
  catalogo[p].peso = new_sym_var(sizeof(int) * 8);
  catalogo[p].quantidade = new_sym_var(sizeof(int) * 8);
}

void adiciona_stock(produto catalogo[], int p)
{
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (idp >= p)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
  }
  else
  {
    catalogo[idp].quantidade += qtd;
  }

}

void adiciona_produto_encomenda(encomenda pedidos[], produto catalogo[], int e, int p)
{
  int peso_total;
  int i;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (ide >= e)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (idp >= p)
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      if (qtd > catalogo[idp].quantidade)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
      }
      else
      {
        for (i = 0, peso_total = 0; i < p; i++)
        {
          if (i == idp)
          {
            peso_total += (pedidos[ide].id_prod[idp] + qtd) * catalogo[idp].peso;
          }
          else
          {
            peso_total += pedidos[ide].id_prod[i] * catalogo[i].peso;
          }

        }

        if (peso_total > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
        }
        else
        {
          pedidos[ide].id_prod[idp] += qtd;
          catalogo[idp].quantidade -= qtd;
        }

      }

    }

  }

}

void remove_stock(produto catalogo[], int p)
{
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (idp >= p)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    if ((catalogo[idp].quantidade - qtd) < 0)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, idp);
    }
    else
    {
      catalogo[idp].quantidade -= qtd;
    }

  }

}

void remove_produto(encomenda pedidos[], produto catalogo[], int e, int p)
{
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (ide >= e)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (idp >= p)
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      catalogo[idp].quantidade += pedidos[ide].id_prod[idp];
      pedidos[ide].id_prod[idp] = 0;
    }

  }

}

void calcula_custo(encomenda pedidos[], produto catalogo[], int e, int p)
{
  ide = new_sym_var(sizeof(int) * 8);
  if (ide >= e)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    int i;
    int custo;
    for (i = 0, custo = 0; i < p; i++)
      custo += pedidos[ide].id_prod[i] * catalogo[i].preco;

    printf("Custo da encomenda %d %d.\n", ide, custo);
  }

}

void altera_preco(produto catalogo[], int p)
{
  int novo_preco;
  idp = new_sym_var(sizeof(int) * 8);
  novo_preco = new_sym_var(sizeof(int) * 8);
  if (idp >= p)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    catalogo[idp].preco = novo_preco;
  }

}

void lista_produto(encomenda pedidos[], produto catalogo[], int e, int p)
{
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (ide >= e)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    if (idp >= p)
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
    }
    else
    {
      printf("%s %d.\n", catalogo[idp].descricao, pedidos[ide].id_prod[idp]);
    }

  }

}

void lista_maximo_produto(encomenda pedidos[], int e, int p)
{
  int ide;
  int max_enco;
  int qtd_max;
  idp = new_sym_var(sizeof(int) * 8);
  if (idp >= p)
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    for (ide = 0, max_enco = 0, qtd_max = 0; ide < e; ide++)
      if (qtd_max < pedidos[ide].id_prod[idp])
    {
      qtd_max = pedidos[ide].id_prod[idp];
      max_enco = ide;
    }
    else
    {
      
    }


    if (qtd_max != 0)
    {
      printf("Maximo produto %d %d %d.\n", idp, max_enco, qtd_max);
    }
    else
    {
      
    }

  }

}

void merge_produtos(produto lista[], int left, int m, int right)
{
  produto aux[10000];
  int i;
  int j;
  int k;
  for (i = m + 1; i > left; i--)
    aux[i - 1] = lista[i - 1];

  for (j = m; j < right; j++)
    aux[(right + m) - j] = lista[j + 1];

  for (k = left; k <= right; k++)
  {
    if (aux[j].preco < aux[i].preco)
    {
      lista[k] = aux[j--];
    }
    else
    {
      if (aux[j].preco == aux[i].preco)
      {
        if (aux[i].idp < aux[j].idp)
        {
          lista[k] = aux[i++];
        }
        else
        {
          lista[k] = aux[j--];
        }

      }
      else
      {
        lista[k] = aux[i++];
      }

    }

  }

}

void merge_sort_produtos(produto lista[], int left, int right)
{
  int m = (right + left) / 2;
  if (right <= left)
  {
    return;
  }
  else
  {
    
  }

  merge_sort_produtos(lista, left, m);
  merge_sort_produtos(lista, m + 1, right);
  merge_produtos(lista, left, m, right);
}

void lista_ordenada_produtos(produto catalogo[], int p)
{
  produto lista[10000];
  int i;
  for (i = 0; i < p; i++)
    lista[i] = catalogo[i];

  merge_sort_produtos(lista, 0, p - 1);
  printf("Produtos\n");
  for (i = 0; i < p; i++)
    printf("* %s %d %d\n", lista[i].descricao, lista[i].preco, lista[i].quantidade);

}

void merge_encomenda(produto lista[], int left, int m, int right)
{
  produto aux[200];
  int i;
  int j;
  int k;
  for (i = m + 1; i > left; i--)
    aux[i - 1] = lista[i - 1];

  for (j = m; j < right; j++)
    aux[(right + m) - j] = lista[j + 1];

  for (k = left; k <= right; k++)
    if (strcmp(aux[j].descricao, aux[i].descricao) < 0)
  {
    lista[k] = aux[j--];
  }
  else
  {
    lista[k] = aux[i++];
  }


}

void merge_sort_encomenda(produto lista[], int left, int right)
{
  int m = (right + left) / 2;
  if (right <= left)
  {
    return;
  }
  else
  {
    
  }

  merge_sort_encomenda(lista, left, m);
  merge_sort_encomenda(lista, m + 1, right);
  merge_encomenda(lista, left, m, right);
}

void lista_ordenada_encomenda(encomenda pedidos[], produto catalogo[], int e, int p)
{
  int i;
  int j = 0;
  int n_total_produtos;
  produto lista[200];
  ide = new_sym_var(sizeof(int) * 8);
  if (ide >= e)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    for (i = 0, j = 0; i < p; i++)
      if (pedidos[ide].id_prod[i] != 0)
    {
      lista[j] = catalogo[i];
      lista[j++].quantidade = pedidos[ide].id_prod[i];
    }
    else
    {
      
    }


    n_total_produtos = j;
    merge_sort_encomenda(lista, 0, j - 1);
    printf("Encomenda %d\n", ide);
    for (i = 0; i < n_total_produtos; i++)
      printf("* %s %d %d\n", lista[i].descricao, lista[i].preco, lista[i].quantidade);

  }

}

int main()
{
  char car;
  car = getchar();
  while (car != 'x')
  {
    switch (car)
    {
      case 'a':
        adiciona_produto(p);
        p++;
        break;

      case 'q':
        adiciona_stock(catalogo, p);
        break;

      case 'N':
        printf("Nova encomenda %d.\n", e);
        e++;
        break;

      case 'A':
        adiciona_produto_encomenda(pedidos, catalogo, e, p);
        break;

      case 'r':
        remove_stock(catalogo, p);
        break;

      case 'R':
        remove_produto(pedidos, catalogo, e, p);
        break;

      case 'C':
        calcula_custo(pedidos, catalogo, e, p);
        break;

      case 'p':
        altera_preco(catalogo, p);
        break;

      case 'E':
        lista_produto(pedidos, catalogo, e, p);
        break;

      case 'm':
        lista_maximo_produto(pedidos, e, p);
        break;

      case 'l':
        lista_ordenada_produtos(catalogo, p);
        break;

      case 'L':
        lista_ordenada_encomenda(pedidos, catalogo, e, p);
        break;

    }

    car = getchar();
  }

  return 0;
}

