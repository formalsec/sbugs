#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


typedef struct produto
{
  char desc[63];
  int price;
  int weight;
  int stock;
} produto;
typedef struct encomenda
{
  int stock[10000];
  int weight;
  int verificap[10000];
  int sortL[10000];
  int contap;
} encomenda;
char c;
int ip = 0;
int ie = 0;
int idp;
int ide;
int qtd;
int price;
int total = 0;
int maior = 0;
int i;
int sortl[10000];
int aux[10000];
produto P[10000];
encomenda E[500];
int ordena_l(int l, int r)
{
  if (P[l].price == P[r].price)
  {
    return l < r;
  }
  else
  {
    return P[l].price < P[r].price;
  }

}

int ordena_L(int l, int r)
{
  return strcmp(P[l].desc, P[r].desc) < 0;
}

void merge(int a[], int l, int m, int r, int (*choose)(int, int))
{
  int i;
  int j;
  int k;
  for (i = m + 1; i > l; i--)
    aux[i - 1] = a[i - 1];

  for (j = m; j < r; j++)
    aux[(r + m) - j] = a[j + 1];

  for (k = l; k <= r; k++)
    if (choose(aux[j], aux[i]))
  {
    a[k] = aux[j--];
  }
  else
  {
    a[k] = aux[i++];
  }


}

void mergesort(int a[], int l, int r, int (*choose)(int, int))
{
  int m = (r + l) / 2;
  if (r <= l)
  {
    return;
  }
  else
  {
    
  }

  mergesort(a, l, m, choose);
  mergesort(a, m + 1, r, choose);
  merge(a, l, m, r, choose);
}

void a()
{
  for (int P_index = 0; P_index < 10; P_index++)
  {
    P[ip].desc[P_index] = new_sym_var(sizeof(char) * 8);
  }

  P[ip].desc[10 - 1] = '\0';
  P[ip].price = new_sym_var(sizeof(int) * 8);
  P[ip].weight = new_sym_var(sizeof(int) * 8);
  P[ip].stock = new_sym_var(sizeof(int) * 8);
  printf("Novo produto %d.\n", ip);
  sortl[ip] = ip;
  ip++;
}

void q()
{
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (idp < ip)
  {
    P[idp].stock += qtd;
  }
  else
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
  }

}

void N()
{
  printf("Nova encomenda %d.\n", ie);
  ie++;
}

void A()
{
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (ide < ie)
  {
    if (idp < ip)
    {
      if (qtd <= P[idp].stock)
      {
        if ((E[ide].weight + (qtd * P[idp].weight)) <= 200)
        {
          if (E[ide].verificap[idp] != 1)
          {
            E[ide].sortL[E[ide].contap] = idp;
            E[ide].contap += 1;
            E[ide].verificap[idp] = 1;
          }
          else
          {
            
          }

          E[ide].stock[idp] += qtd;
          E[ide].weight += qtd * P[idp].weight;
          P[idp].stock -= qtd;
        }
        else
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
        }

      }
      else
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
      }

    }
    else
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }

  }
  else
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }

}

void r()
{
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (idp < ip)
  {
    if (qtd <= P[idp].stock)
    {
      P[idp].stock -= qtd;
    }
    else
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, idp);
    }

  }
  else
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
  }

}

void R()
{
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (ide < ie)
  {
    if (idp < ip)
    {
      P[idp].stock += E[ide].stock[idp];
      E[ide].weight -= E[ide].stock[idp] * P[idp].weight;
      E[ide].stock[idp] = 0;
    }
    else
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }

  }
  else
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }

}

void C()
{
  ide = new_sym_var(sizeof(int) * 8);
  if (ide < ie)
  {
    for (idp = 0; idp < ip; idp++)
      total += E[ide].stock[idp] * P[idp].price;

    printf("Custo da encomenda %d %d.\n", ide, total);
    total = 0;
  }
  else
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }

}

void p()
{
  idp = new_sym_var(sizeof(int) * 8);
  price = new_sym_var(sizeof(int) * 8);
  if (idp < ip)
  {
    P[idp].price = price;
  }
  else
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
  }

}

void e()
{
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (ide < ie)
  {
    if (idp < ip)
    {
      printf("%s %d.\n", P[idp].desc, E[ide].stock[idp]);
    }
    else
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
    }

  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }

}

void m()
{
  idp = new_sym_var(sizeof(int) * 8);
  if (idp < ip)
  {
    maior = 0;
    for (i = 0; i < 500; i++)
    {
      if (E[i].stock[idp] > maior)
      {
        maior = E[i].stock[idp];
        ide = i;
      }
      else
      {
        
      }

    }

    if (maior != 0)
    {
      printf("Maximo produto %d %d %d.\n", idp, ide, maior);
    }
    else
    {
      
    }

  }
  else
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
  }

}

void l()
{
  mergesort(sortl, 0, ip - 1, ordena_l);
  printf("Produtos\n");
  for (i = 0; i < ip; i++)
    printf("* %s %d %d\n", P[sortl[i]].desc, P[sortl[i]].price, P[sortl[i]].stock);

}

void L()
{
  ide = new_sym_var(sizeof(int) * 8);
  if (ide < ie)
  {
    mergesort(E[ide].sortL, 0, E[ide].contap - 1, ordena_L);
    printf("Encomenda %d\n", ide);
    for (i = 0; i < E[ide].contap; i++)
    {
      if (E[ide].stock[E[ide].sortL[i]] != 0)
      {
        printf("* %s %d %d\n", P[E[ide].sortL[i]].desc, P[E[ide].sortL[i]].price, E[ide].stock[E[ide].sortL[i]]);
      }
      else
      {
        
      }

    }

  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }

}

int main()
{
  do
  {
    c = getchar();
    switch (c)
    {
      case 'a':
        a();
        break;

      case 'q':
        q();
        break;

      case 'N':
        N();
        break;

      case 'A':
        A();
        break;

      case 'r':
        r();
        break;

      case 'R':
        R();
        break;

      case 'C':
        C();
        break;

      case 'p':
        p();
        break;

      case 'E':
        e();
        break;

      case 'm':
        m();
        break;

      case 'l':
        l();
        break;

      case 'L':
        L();
        break;

    }

  }
  while (c != 'x');
  return 0;
}

