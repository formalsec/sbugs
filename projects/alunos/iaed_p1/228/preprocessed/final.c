/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>


typedef struct item
{
  int idp;
  int price;
  int weight;
  int stock;
  char description[64];
} Item;
typedef struct order
{
  int ide;
  int weight;
  int next_pos;
  Item item_list[10000];
} Order;
Item items_array[10000];
Order orders_array[500];
Item aux_item_array[10000 - 1];
int item_pos = 0;
int orders_pos = 0;
char args[200 - 2];
int item_id_pos = 0;
int order_id_pos = 0;
int exe_command(char action);
int getItemId();
int getOrderId();
int getPrice();
int getItemWeight();
int getOrderWeight();
int getStock();
void add_item();
int add_stock();
void list_items();
void sort();
void merging();
void quicksort();
void add_order();
int item_to_order();
int is_order();
int is_item();
int is_overweight();
void item_to_order_aux();
int remove_stock();
int no_stock();
int remove_item_from_order();
int order_cost();
int list_items_in_order();
int change_price();
int list_items_desc_amount_in_order();
int most_item_occ_order();
int list_orders();
int get_command()
{
  char command[200];
  int i;
  fgets(command, sizeof(command), stdin);
  fflush(stdin);
  for (i = 0; (i < (200 - 1)) && (command[i] != EOF); i++)
  {
    if (i >= 2)
    {
      args[i - 2] = command[i];
    }
    else
    {
      
    }

  }

  command[i] = '\0';
  return exe_command(command[0]);
}

int exe_command(char action)
{
  char description[64];
  int price;
  int weight;
  int amount;
  int ide;
  int idp;
  switch (action)
  {
    case 'a':
      for (int description_index = 0; description_index < 10; description_index++)
    {
      description[description_index] = new_sym_var(sizeof(char) * 8);
    }

      description[10 - 1] = '\0';
      price = new_sym_var(sizeof(int) * 8);
      weight = new_sym_var(sizeof(int) * 8);
      amount = new_sym_var(sizeof(int) * 8);
      add_item(description, price, weight, amount);
      return 1;

    case 'q':
      idp = new_sym_var(sizeof(int) * 8);
      amount = new_sym_var(sizeof(int) * 8);
      add_stock(idp, amount);
      return 1;

    case 'l':
      list_items();
      return 1;

    case 'L':
      ide = new_sym_var(sizeof(int) * 8);
      list_items_in_order(ide);
      return 1;

    case 'N':
      add_order();
      return 1;

    case 'A':
      ide = new_sym_var(sizeof(int) * 8);
      idp = new_sym_var(sizeof(int) * 8);
      amount = new_sym_var(sizeof(int) * 8);
      item_to_order(ide, idp, amount);
      return 1;

    case 'r':
      idp = new_sym_var(sizeof(int) * 8);
      amount = new_sym_var(sizeof(int) * 8);
      remove_stock(idp, amount);
      return 1;

    case 'R':
      ide = new_sym_var(sizeof(int) * 8);
      idp = new_sym_var(sizeof(int) * 8);
      remove_item_from_order(ide, idp);
      return 1;

    case 'C':
      ide = new_sym_var(sizeof(int) * 8);
      order_cost(ide);
      return 1;

    case 'p':
      idp = new_sym_var(sizeof(int) * 8);
      price = new_sym_var(sizeof(int) * 8);
      change_price(idp, price);
      return 1;

    case 'E':
      ide = new_sym_var(sizeof(int) * 8);
      idp = new_sym_var(sizeof(int) * 8);
      list_items_desc_amount_in_order(ide, idp);
      return 1;

    case 'm':
      idp = new_sym_var(sizeof(int) * 8);
      most_item_occ_order(idp);
      return 1;

    case 'x':
      return 0;

    default:
      fflush(stdin);
      return 1;

  }

}

int getItemId(Item item)
{
  return item.idp;
}

int getOrderId(Order order)
{
  return order.ide;
}

int getPrice(Item item)
{
  return item.price;
}

int getItemWeight(Item item)
{
  return item.weight;
}

int getOrderWeight(Order order)
{
  return order.weight;
}

int getStock(Item item)
{
  return item.stock;
}

void add_item(char description[64], int price, int weight, int amount)
{
  Item item;
  strcpy(item.description, description);
  item.idp = item_pos;
  item.price = price;
  item.weight = weight;
  item.stock = amount;
  items_array[item_pos] = item;
  printf("Novo produto %d.\n", item_pos);
  item_pos++;
}

int add_stock(int idp, int amount)
{
  if (is_item(idp) == 0)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
    return 1;
  }
  else
  {
    items_array[item_id_pos].stock += amount;
    return 0;
  }

}

void list_items()
{
  int i;
  sort(0, item_pos - 1, items_array, aux_item_array);
  printf("Produtos\n");
  for (i = 0; i < item_pos; i++)
  {
    printf("* %s %d %d\n", items_array[i].description, getPrice(items_array[i]), getStock(items_array[i]));
  }

}

void merging(int low, int mid, int high, Item array1[10000], Item array_aux[10000])
{
  int l1;
  int l2;
  int i;
  int j;
  for (l1 = low, l2 = mid + 1, i = low; (l1 <= mid) && (l2 <= high); i++)
  {
    for (j = 0; j < item_pos; j++)
    {
    }

    if (getPrice(array1[l1]) < getPrice(array1[l2]))
    {
      array_aux[i] = array1[l1++];
    }
    else
    {
      if (getPrice(array1[l1]) == getPrice(array1[l2]))
      {
        if (getItemId(array1[l1]) < getItemId(array1[l2]))
        {
          array_aux[i] = array1[l1++];
        }
        else
        {
          array_aux[i] = array1[l2++];
        }

      }
      else
      {
        array_aux[i] = array1[l2++];
      }

    }

  }

  while (l1 <= mid)
    array_aux[i++] = array1[l1++];

  while (l2 <= high)
    array_aux[i++] = array1[l2++];

  for (i = low; i <= high; i++)
    array1[i] = array_aux[i];

}

void sort(int low, int high, Item array1[10000], Item array_aux[10000])
{
  int mid;
  if (low < high)
  {
    mid = (low + high) / 2;
    sort(low, mid, array1, array_aux);
    sort(mid + 1, high, array1, array_aux);
    merging(low, mid, high, items_array, aux_item_array);
  }
  else
  {
    return;
  }

}

void add_order()
{
  Order order;
  order.ide = orders_pos;
  order.weight = 0;
  order.next_pos = 0;
  orders_array[orders_pos] = order;
  printf("Nova encomenda %d.\n", orders_pos);
  orders_pos++;
}

int item_to_order(int ide, int idp, int amount)
{
  if (is_order(ide) == 0)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
    return 1;
  }
  else
  {
    
  }

  if (is_item(idp) == 0)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    return 1;
  }
  else
  {
    
  }

  if (no_stock(idp, amount) == 1)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
    return 1;
  }
  else
  {
    
  }

  if (is_overweight(amount) == 1)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
    return 1;
  }
  else
  {
    item_to_order_aux(idp, amount);
    return 0;
  }

}

int is_order(int ide)
{
  int i;
  for (i = 0; i < orders_pos; i++)
  {
    if (ide == getOrderId(orders_array[i]))
    {
      order_id_pos = i;
      return 1;
    }
    else
    {
      
    }

  }

  return 0;
}

int is_item(int idp)
{
  int i;
  for (i = 0; i < item_pos; i++)
  {
    if (idp == getItemId(items_array[i]))
    {
      item_id_pos = i;
      return 1;
    }
    else
    {
      
    }

  }

  return 0;
}

int no_stock(int idp, int amount)
{
  if (is_item(idp) == 1)
  {
    if (amount > items_array[item_id_pos].stock)
    {
      return 1;
    }
    else
    {
      
    }

  }
  else
  {
    
  }

  return 0;
}

int is_overweight(int amount)
{
  if (((getItemWeight(items_array[item_id_pos]) * amount) + getOrderWeight(orders_array[order_id_pos])) > 200)
  {
    return 1;
  }
  else
  {
    
  }

  return 0;
}

void item_to_order_aux(int idp, int amount)
{
  int temp_item_pos = 0;
  int i;
  int is_in_order = 0;
  Item temp_item;
  int next_pos = orders_array[order_id_pos].next_pos;
  items_array[item_id_pos].stock -= amount;
  for (i = 0; i < orders_array[order_id_pos].next_pos; i++)
  {
    if (idp == getItemId(orders_array[order_id_pos].item_list[i]))
    {
      temp_item = orders_array[order_id_pos].item_list[i];
      is_in_order = 1;
      temp_item_pos = i;
    }
    else
    {
      
    }

  }

  if (is_in_order == 0)
  {
    temp_item = items_array[item_id_pos];
    temp_item.stock = amount;
    orders_array[order_id_pos].item_list[next_pos] = temp_item;
    orders_array[order_id_pos].weight += getItemWeight(temp_item) * amount;
    orders_array[order_id_pos].next_pos++;
  }
  else
  {
    orders_array[order_id_pos].item_list[temp_item_pos].stock += amount;
    orders_array[order_id_pos].weight += getItemWeight(orders_array[order_id_pos].item_list[temp_item_pos]) * amount;
  }

}

int remove_stock(int idp, int amount)
{
  if (is_item(idp) == 0)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
    return 1;
  }
  else
  {
    
  }

  if (no_stock(idp, amount) == 1)
  {
    printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", amount, idp);
    return 1;
  }
  else
  {
    
  }

  items_array[item_id_pos].stock -= amount;
  return 0;
}

int remove_item_from_order(int ide, int idp)
{
  int i;
  int id;
  int len;
  int amount;
  int aux_id;
  if (is_order(ide) == 0)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
    return 1;
  }
  else
  {
    
  }

  if (is_item(idp) == 0)
  {
    printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    return 1;
  }
  else
  {
    
  }

  len = orders_array[order_id_pos].next_pos;
  for (i = 0; i < len; i++)
  {
    id = getItemId(orders_array[order_id_pos].item_list[i]);
    if (id == idp)
    {
      aux_id = i;
      amount = orders_array[order_id_pos].item_list[i].stock;
      items_array[item_id_pos].stock += amount;
      break;
    }
    else
    {
      
    }

  }

  for (i = aux_id; i < (orders_array[order_id_pos].next_pos - 1); i++)
  {
    orders_array[order_id_pos].item_list[i] = orders_array[order_id_pos].item_list[i + 1];
    orders_array[order_id_pos].next_pos--;
  }

  return 0;
}

int order_cost(int ide)
{
  int total_cost = 0;
  int amount;
  int price;
  int len;
  int i;
  if (is_order(ide) == 0)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
    return 1;
  }
  else
  {
    len = orders_array[order_id_pos].next_pos;
    for (i = 0; i < len; i++)
    {
      amount = getStock(orders_array[order_id_pos].item_list[i]);
      price = getPrice(orders_array[order_id_pos].item_list[i]);
      total_cost += price * amount;
    }

    printf("Custo da encomenda %d %d.\n", ide, total_cost);
    return 0;
  }

}

int change_price(int idp, int price)
{
  int i;
  int j;
  int len;
  if (is_item(idp) == 0)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
    return 1;
  }
  else
  {
    items_array[item_id_pos].price = price;
    for (i = 0; i < orders_pos; i++)
    {
      len = orders_array[i].next_pos;
      for (j = 0; j < len; j++)
      {
        if (idp == getItemId(orders_array[i].item_list[j]))
        {
          orders_array[i].item_list[j].price = price;
        }
        else
        {
          
        }

      }

    }

    return 0;
  }

}

int list_items_desc_amount_in_order(int ide, int idp)
{
  int amount;
  int temp_item_pos;
  int len;
  int i;
  if (is_order(ide) == 0)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
    return 1;
  }
  else
  {
    
  }

  if (is_item(idp) == 0)
  {
    printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
    return 1;
  }
  else
  {
    
  }

  len = orders_array[order_id_pos].next_pos;
  for (i = 0; i < len; i++)
  {
    if (idp == getItemId(orders_array[order_id_pos].item_list[i]))
    {
      temp_item_pos = i;
    }
    else
    {
      
    }

  }

  amount = orders_array[order_id_pos].item_list[temp_item_pos].stock;
  printf("%s %d.\n", orders_array[order_id_pos].item_list[temp_item_pos].description, amount);
  return 0;
}

int most_item_occ_order(int idp)
{
  int i;
  int j;
  int len;
  int is_in_order = 0;
  int max_stock = 0;
  int item_occ_in_order[500] = {0};
  int aux_order_id;
  if (is_item(idp) == 0)
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
    return 1;
  }
  else
  {
    
  }

  for (i = 0; i < orders_pos; i++)
  {
    len = orders_array[i].next_pos;
    for (j = 0; j < len; j++)
    {
      if (idp == getItemId(orders_array[i].item_list[j]))
      {
        item_occ_in_order[i] += getStock(orders_array[i].item_list[j]);
        is_in_order = 1;
      }
      else
      {
        
      }

    }

  }

  if (is_in_order == 0)
  {
    return 1;
  }
  else
  {
    for (i = 0; i < orders_pos; i++)
    {
      if (max_stock < item_occ_in_order[i])
      {
        max_stock = item_occ_in_order[i];
        aux_order_id = i;
      }
      else
      {
        if (max_stock == item_occ_in_order[i])
        {
          if (i < aux_order_id)
          {
            max_stock = item_occ_in_order[i];
            aux_order_id = i;
          }
          else
          {
            
          }

        }
        else
        {
          
        }

      }

    }

    printf("Maximo produto %d %d %d.\n", idp, aux_order_id, max_stock);
    return 0;
  }

}

int list_items_in_order(int ide)
{
  int amount;
  int price;
  int len;
  int i;
  if (is_order(ide) == 0)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
    return 1;
  }
  else
  {
    len = orders_array[order_id_pos].next_pos;
    printf("Encomenda %d\n", ide);
    for (i = 0; i < len; i++)
    {
      amount = getStock(orders_array[order_id_pos].item_list[i]);
      price = getPrice(orders_array[order_id_pos].item_list[i]);
      printf("* %s %d %d\n", orders_array[order_id_pos].item_list[i].description, price, amount);
    }

    return 0;
  }

}

int main()
{
  int exe = get_command();
  while (exe == 1)
  {
    exe = get_command();
  }

  return 0;
}

