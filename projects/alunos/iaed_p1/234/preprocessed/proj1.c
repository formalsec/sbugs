/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>


typedef struct 
{
  int idp;
  char description[62];
  unsigned long price;
  unsigned long weight;
  unsigned long quantity;
} product;
typedef struct 
{
  int ide;
  product p[10000];
} order;
static product x[10000];
static order y[500];
static int n;
static int m[500];
static int l;
char buf[100];
void cmds();
char *process_input();
void add_product();
void add_stock();
void new_order();
void add_to_order();
void rem_stock();
void rem_from_order();
void order_cost();
void change_price();
void product_from_order();
void order_id_product();
void sort_products();
void sort_orders_products();
int main()
{
  cmds();
  return 0;
}

void cmds()
{
  while (fgets(buf, sizeof(buf), stdin) != 0)
  {
    switch (buf[0])
    {
      case 'a':
        add_product();
        break;

      case 'q':
        add_stock();
        break;

      case 'N':
        new_order();
        break;

      case 'A':
        add_to_order();
        break;

      case 'r':
        rem_stock();
        break;

      case 'R':
        rem_from_order();
        break;

      case 'C':
        order_cost();
        break;

      case 'p':
        change_price();
        break;

      case 'x':
        return;

    }

  }

}

char *process_input()
{
  int buf_lenght = strlen(buf);
  char *input = malloc(buf_lenght + 2);
  char delim = ' ';
  char *token = strtok(buf + 2, ":");
  while (token != 0)
  {
    strncat(input, token, sizeof(strlen(token - 2)));
    token = strtok(0, ":");
    strncat(input, &delim, 1);
  }

  input[strlen(input) - 2] = 0;
  return input;
}

void add_product()
{
  if (n < 10000)
  {
    for (int x_index = 0; x_index < 10; x_index++)
    {
      x[n].description[x_index] = new_sym_var(sizeof(char) * 8);
    }

    x[n].description[10 - 1] = '\0';
    x[n].price = new_sym_var(sizeof(unsigned long) * 8);
    x[n].weight = new_sym_var(sizeof(unsigned long) * 8);
    x[n].quantity = new_sym_var(sizeof(unsigned long) * 8);
    x[n].idp = n;
    printf("Novo produto %d.\n", n);
    n++;
  }
  else
  {
    
  }

}

void add_stock()
{
  int idp;
  unsigned long quantity;
  idp = new_sym_var(sizeof(int) * 8);
  quantity = new_sym_var(sizeof(unsigned long) * 8);
  if (idp >= n)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
  }
  else
  {
    x[idp].quantity += quantity;
  }

}

void new_order()
{
  if (l < 500)
  {
    y[l].ide = l;
    printf("Nova encomenda %d.\n", l);
    l++;
  }
  else
  {
    
  }

}

void add_to_order()
{
  int ide;
  int idp;
  int total_weight = 0;
  int i;
  int existing = 0;
  unsigned long quantity;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  quantity = new_sym_var(sizeof(unsigned long) * 8);
  if (ide >= l)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (idp >= n)
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      if (x[idp].quantity < quantity)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
      }
      else
      {
        for (i = 0; i < m[ide]; i++)
        {
          total_weight += y[ide].p[i].weight * y[ide].p[i].quantity;
          if (y[ide].p[i].idp == idp)
          {
            existing = i;
          }
          else
          {
            
          }

        }

        total_weight += x[idp].weight * quantity;
        if (total_weight <= 200)
        {
          if (existing != 0)
          {
            y[ide].p[existing].quantity += quantity;
            x[idp].quantity -= quantity;
          }
          else
          {
            y[ide].p[m[ide]].price = x[idp].price;
            y[ide].p[m[ide]].weight = x[idp].weight;
            y[ide].p[m[ide]].quantity = quantity;
            x[idp].quantity -= quantity;
            y[ide].p[m[ide]].idp = idp;
            m[ide]++;
          }

        }
        else
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
        }

      }

    }

  }

}

void rem_stock()
{
  int idp;
  unsigned long quantity;
  idp = new_sym_var(sizeof(int) * 8);
  quantity = new_sym_var(sizeof(unsigned long) * 8);
  if (idp >= n)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    if (x[idp].quantity < quantity)
    {
      printf("Impossivel remover %lu unidades do produto %d do stock. Quantidade insuficiente.\n", quantity, idp);
    }
    else
    {
      x[idp].quantity -= quantity;
    }

  }

}

void rem_from_order()
{
  int ide;
  int idp;
  int i;
  int temp = -1;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (ide >= l)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (idp >= n)
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      for (i = 0; i < m[ide]; i++)
      {
        if (y[ide].p[i].idp == idp)
        {
          temp = i;
        }
        else
        {
          
        }

      }

      if (temp != (-1))
      {
        x[idp].quantity += y[ide].p[temp].quantity;
        y[ide].p[temp].quantity = 0;
        memmove(m + temp, (m + temp) + 1, (sizeof(*m)) * ((m[ide] - temp) - 1));
      }
      else
      {
        
      }

    }

  }

}

void order_cost()
{
  int ide;
  int i;
  unsigned long total_cost = 0;
  ide = new_sym_var(sizeof(int) * 8);
  if (ide >= l)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    for (i = 0; i < m[ide]; i++)
    {
      total_cost += y[ide].p[i].price * y[ide].p[i].quantity;
    }

    printf("Custo da encomenda %d %lu.\n", ide, total_cost);
  }

}

void change_price()
{
  int idp;
  unsigned long price;
  idp = new_sym_var(sizeof(int) * 8);
  price = new_sym_var(sizeof(unsigned long) * 8);
  if (idp >= n)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    x[idp].price = price;
  }

}

void product_from_order()
{
  int ide;
  int idp;
  int i;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (ide >= l)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    if (idp >= n)
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
    }
    else
    {
      for (i = 0; i < m[ide]; i++)
      {
        if (y[ide].p[i].idp == idp)
        {
          printf("%s %lu", x[idp].description, y[ide].p[i].quantity);
        }
        else
        {
          
        }

      }

    }

  }

}

