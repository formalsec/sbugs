/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>


typedef struct produto
{
  int id;
  int preco;
  int peso;
  int quantidade;
  char descricao[64];
} Produto;
typedef struct encomenda
{
  int id;
  int peso;
  int nprodutos;
  int prod_details[10000];
} Encomenda;
Encomenda sistema_encomendas[500];
int id_encomendas = -1;
Produto sistema_produtos[10000];
int id_produtos = -1;
void obtem_input(char input[])
{
  int c;
  int j = 0;
  getchar();
  while ((c = getchar()) != '\n')
    input[j++] = c;

  input[j] = '\0';
}

void trata_input(char string[], char *final[], int args)
{
  int j = 0;
  final[j] = strtok(string, ":");
  for (j = 1; j < args; j++)
    final[j] = strtok(0, ":");

}

int procuraProduto(int n)
{
  if ((n <= id_produtos) && (id_produtos > (-1)))
  {
    return 1;
  }
  else
  {
    
  }

  return -1;
}

int verificaEncomenda(int n)
{
  if ((n <= id_encomendas) && (id_encomendas > (-1)))
  {
    return 1;
  }
  else
  {
    
  }

  return -1;
}

void quicksort(int vetor[], int esq, int dir)
{
  int i;
  int j;
  int pivot;
  int temp;
  if (esq < dir)
  {
    pivot = esq;
    i = esq;
    j = dir;
    while (i < j)
    {
      while ((vetor[i] <= vetor[pivot]) && (i < dir))
        i++;

      while (vetor[j] > vetor[pivot])
        j--;

      if (i < j)
      {
        temp = vetor[i];
        vetor[i] = vetor[j];
        vetor[j] = temp;
      }
      else
      {
        
      }

    }

    temp = vetor[pivot];
    vetor[pivot] = vetor[j];
    vetor[j] = temp;
    quicksort(vetor, esq, j - 1);
    quicksort(vetor, j + 1, dir);
  }
  else
  {
    
  }

}

int cria_codigo(int id, int qtd)
{
  return (10000 * qtd) + id;
}

int obterPesoAtualEncomenda(int id)
{
  return sistema_encomendas[id].peso;
}

int obterStockProduto(int id)
{
  return sistema_produtos[id].quantidade;
}

int obterPesoProduto(int id)
{
  return sistema_produtos[id].peso;
}

int obterPrecoProduto(int id)
{
  return sistema_produtos[id].preco;
}

char *obterDescProduto(int id)
{
  return sistema_produtos[id].descricao;
}

int obterIdCodigo(int codigo)
{
  return codigo % 10000;
}

int obterQtdCodigo(int codigo)
{
  return codigo / 10000;
}

Produto cria_produto(char *string[])
{
  Produto produto;
  strcpy(produto.descricao, string[0]);
  produto.preco = atoi(string[1]);
  produto.peso = atoi(string[2]);
  produto.quantidade = atoi(string[3]);
  return produto;
}

void add_produto(Produto p)
{
  int posicao;
  if (10000 >= id_produtos)
  {
    id_produtos++;
    posicao = id_produtos;
    p.id = posicao;
    sistema_produtos[posicao] = p;
    printf("Novo produto %d.\n", posicao);
  }
  else
  {
    
  }

}

void add_stock(char *string[])
{
  int idp = atoi(string[0]);
  if (procuraProduto(idp) < 0)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
  }
  else
  {
    sistema_produtos[idp].quantidade += atoi(string[1]);
  }

}

void cria_encomenda()
{
  Encomenda encomenda;
  int posicao;
  if (500 >= id_encomendas)
  {
    id_encomendas++;
    posicao = id_encomendas;
    if (posicao >= 0)
    {
      encomenda.peso = 0;
      encomenda.nprodutos = 0;
      encomenda.id = posicao;
      sistema_encomendas[posicao] = encomenda;
      printf("Nova encomenda %d.\n", posicao);
    }
    else
    {
      
    }

  }
  else
  {
    
  }

}

void produtoParaEncomenda(char *string[])
{
  int ide = atoi(string[0]);
  int idp = atoi(string[1]);
  int qtd = atoi(string[2]);
  if (verificaEncomenda(ide) < 0)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (procuraProduto(idp) < 0)
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      if (obterStockProduto(idp) < qtd)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
      }
      else
      {
        if ((obterPesoAtualEncomenda(ide) + (obterPesoProduto(idp) * qtd)) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
        }
        else
        {
          int n;
          int i;
          int flag = 1;
          n = sistema_encomendas[ide].nprodutos;
          for (i = 0; i < n; i++)
          {
            if (obterIdCodigo(sistema_encomendas[ide].prod_details[i]) == idp)
            {
              sistema_encomendas[ide].prod_details[i] += qtd * 10000;
              sistema_produtos[idp].quantidade -= qtd;
              sistema_encomendas[ide].peso += obterPesoProduto(idp) * qtd;
              flag = 0;
              break;
            }
            else
            {
              
            }

          }

          if (flag)
          {
            sistema_encomendas[ide].prod_details[n] = cria_codigo(idp, qtd);
            sistema_encomendas[ide].nprodutos += 1;
            sistema_encomendas[ide].peso += obterPesoProduto(idp) * qtd;
            sistema_produtos[idp].quantidade -= qtd;
          }
          else
          {
            
          }

        }

      }

    }

  }

}

void removeStock(char *string[])
{
  int idp = atoi(string[0]);
  int qtd = atoi(string[1]);
  if (procuraProduto(idp) < 0)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    if ((obterStockProduto(idp) - qtd) < 0)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, idp);
    }
    else
    {
      sistema_produtos[idp].quantidade -= atoi(string[1]);
    }

  }

}

void removeProdutoEncomenda(char *string[])
{
  int ide = atoi(string[0]);
  int idp = atoi(string[1]);
  if (verificaEncomenda(ide) < 0)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (procuraProduto(idp) < 0)
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      int i;
      int nprod;
      nprod = sistema_encomendas[ide].nprodutos;
      for (i = 0; i < nprod; i++)
      {
        if (obterIdCodigo(sistema_encomendas[ide].prod_details[i]) == idp)
        {
          sistema_produtos[idp].quantidade += obterQtdCodigo(sistema_encomendas[ide].prod_details[i]);
          sistema_encomendas[ide].peso -= obterQtdCodigo(sistema_encomendas[ide].prod_details[i]) * obterPesoProduto(idp);
          sistema_encomendas[ide].nprodutos -= 1;
          break;
        }
        else
        {
          
        }

      }

      for (; i < nprod; i++)
      {
        sistema_encomendas[ide].prod_details[i] = sistema_encomendas[ide].prod_details[i + 1];
      }

    }

  }

}

void calculaCusto(char *string[])
{
  int ide = atoi(string[0]);
  int nprod;
  int i;
  int precoTotal = 0;
  if (verificaEncomenda(ide) < 0)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    nprod = sistema_encomendas[ide].nprodutos;
    for (i = 0; i < nprod; i++)
    {
      precoTotal += obterPrecoProduto(obterIdCodigo(sistema_encomendas[ide].prod_details[i])) * obterQtdCodigo(sistema_encomendas[ide].prod_details[i]);
    }

    printf("Custo da encomenda %d %d.\n", ide, precoTotal);
  }

}

void alteraPreco(char *string[])
{
  int idp = atoi(string[0]);
  int newPreco = atoi(string[1]);
  if (procuraProduto(idp) < 0)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    sistema_produtos[idp].preco = newPreco;
  }

}

void listaProduto(char *string[])
{
  int ide = atoi(string[0]);
  int idp = atoi(string[1]);
  if (verificaEncomenda(ide) < 0)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    if (procuraProduto(idp) < 0)
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
    }
    else
    {
      int qtd;
      int i;
      int nprod;
      int flag = 0;
      char desc[64];
      nprod = sistema_encomendas[ide].nprodutos;
      for (i = 0; i < nprod; i++)
      {
        if (obterIdCodigo(sistema_encomendas[ide].prod_details[i]) == idp)
        {
          qtd = obterQtdCodigo(sistema_encomendas[ide].prod_details[i]);
          strcpy(desc, obterDescProduto(idp));
          flag = 1;
          break;
        }
        else
        {
          
        }

      }

      if (flag)
      {
        printf("%s %d.\n", desc, qtd);
      }
      else
      {
        printf("%s %d.\n", sistema_produtos[idp].descricao, 0);
      }

    }

  }

}

void produtoMaisEncomendado(char *string[])
{
  int idp = atoi(string[0]);
  if (procuraProduto(idp) < 0)
  {
    printf("Impossivel listar maximo do produto %s. Produto inexistente.\n", string[0]);
  }
  else
  {
    int i;
    int nencomendas;
    int j;
    int nprod;
    int ide;
    int qtd = 0;
    nencomendas = id_encomendas + 1;
    for (i = 0; i < nencomendas; i++)
    {
      nprod = sistema_encomendas[i].nprodutos;
      for (j = 0; j < nprod; j++)
      {
        if (obterIdCodigo(sistema_encomendas[i].prod_details[j]) == idp)
        {
          if (obterQtdCodigo(sistema_encomendas[i].prod_details[j]) > qtd)
          {
            qtd = obterQtdCodigo(sistema_encomendas[i].prod_details[j]);
            ide = i;
          }
          else
          {
            
          }

          break;
        }
        else
        {
          
        }

      }

    }

    if (qtd > 0)
    {
      printf("Maximo produto %d %d %d.\n", idp, ide, qtd);
    }
    else
    {
      
    }

  }

}

void listaPreco()
{
  int nprod;
  int k;
  int i;
  int precos[10000];
  nprod = id_produtos + 1;
  if (nprod > 0)
  {
    for (i = 0; i < nprod; i++)
    {
      precos[i] = sistema_produtos[i].preco;
    }

    quicksort(precos, 0, nprod - 1);
  }
  else
  {
    
  }

  printf("Produtos\n");
  k = 0;
  i = 0;
  while ((i < nprod) && (k < nprod))
  {
    if (precos[k] == sistema_produtos[i].preco)
    {
      printf("* %s %d %d\n", sistema_produtos[i].descricao, sistema_produtos[i].preco, sistema_produtos[i].quantidade);
      if (((k + 1) < nprod) && (precos[k] == precos[k + 1]))
      {
        k++;
        i++;
      }
      else
      {
        k++;
        i = 0;
      }

    }
    else
    {
      i++;
    }

  }

}

void listaEncomenda(char *string[])
{
  int ide = atoi(string[0]);
  if (verificaEncomenda(ide) < 0)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    int i;
    int j;
    int k;
    char temp[64];
    Produto copiaOrdenada[10000];
    for (i = 0; i < sistema_encomendas[ide].nprodutos; i++)
    {
      copiaOrdenada[i] = sistema_produtos[obterIdCodigo(sistema_encomendas[ide].prod_details[i])];
    }

    for (i = 0; i < sistema_encomendas[ide].nprodutos; i++)
    {
      for (j = i + 1; j < sistema_encomendas[ide].nprodutos; j++)
      {
        if (strcmp(copiaOrdenada[i].descricao, copiaOrdenada[j].descricao) > 0)
        {
          strcpy(temp, copiaOrdenada[i].descricao);
          strcpy(copiaOrdenada[i].descricao, copiaOrdenada[j].descricao);
          strcpy(copiaOrdenada[j].descricao, temp);
        }
        else
        {
          
        }

      }

    }

    i = 0;
    k = 0;
    printf("Encomenda %d\n", ide);
    while ((i < sistema_encomendas[ide].nprodutos) && (k < sistema_encomendas[ide].nprodutos))
    {
      if (strcmp(copiaOrdenada[k].descricao, obterDescProduto(obterIdCodigo(sistema_encomendas[ide].prod_details[i]))) == 0)
      {
        printf("* %s %d %d\n", obterDescProduto(obterIdCodigo(sistema_encomendas[ide].prod_details[i])), obterPrecoProduto(obterIdCodigo(sistema_encomendas[ide].prod_details[i])), obterQtdCodigo(sistema_encomendas[ide].prod_details[i]));
        if (((k + 1) < sistema_encomendas[ide].nprodutos) && (strcmp(copiaOrdenada[k].descricao, copiaOrdenada[k + 1].descricao) == 0))
        {
          k++;
          i++;
        }
        else
        {
          k++;
          i = 0;
        }

      }
      else
      {
        i++;
      }

    }

  }

}

int main()
{
  int comando;
  char input[112];
  char *inputRefinado[4];
  while ((comando = getchar()) != 'x')
  {
    switch (comando)
    {
      case 'a':
        obtem_input(input);
        trata_input(input, inputRefinado, 4);
        add_produto(cria_produto(inputRefinado));
        break;

      case 'q':
        obtem_input(input);
        trata_input(input, inputRefinado, 2);
        add_stock(inputRefinado);
        break;

      case 'N':
        cria_encomenda();
        break;

      case 'A':
        obtem_input(input);
        trata_input(input, inputRefinado, 3);
        produtoParaEncomenda(inputRefinado);
        break;

      case 'r':
        obtem_input(input);
        trata_input(input, inputRefinado, 2);
        removeStock(inputRefinado);
        break;

      case 'R':
        obtem_input(input);
        trata_input(input, inputRefinado, 2);
        removeProdutoEncomenda(inputRefinado);
        break;

      case 'C':
        obtem_input(input);
        trata_input(input, inputRefinado, 1);
        calculaCusto(inputRefinado);
        break;

      case 'p':
        obtem_input(input);
        trata_input(input, inputRefinado, 2);
        alteraPreco(inputRefinado);
        break;

      case 'E':
        obtem_input(input);
        trata_input(input, inputRefinado, 2);
        listaProduto(inputRefinado);
        break;

      case 'm':
        obtem_input(input);
        trata_input(input, inputRefinado, 1);
        produtoMaisEncomendado(inputRefinado);
        break;

      case 'l':
        listaPreco();
        break;

      case 'L':
        obtem_input(input);
        trata_input(input, inputRefinado, 1);
        listaEncomenda(inputRefinado);
        break;

    }

  }

  return 0;
}

