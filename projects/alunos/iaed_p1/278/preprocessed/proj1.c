#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h> 
#include <string.h>
#include <stdlib.h>


typedef struct produto
{
  int identificacao_produto;
  char NOME_PRODUTO[63];
  int preco;
  int peso;
  int qtd;
} produto;
typedef struct encomenda
{
  int identificacao_encomenda;
  int peso_encomenda;
  int info_encomenda[200][2];
} encomenda;
produto STOCK_LOJA[10000];
encomenda ENCOMENDAS[500];
int LerLinha(char LINHA[])
{
  char c;
  int i = 0;
  while ((c = getchar()) != '\n')
  {
    LINHA[i] = c;
    i++;
  }

  LINHA[i] = '\0';
  return 0;
}

int SepararDados(char LINHA[], char ARMAZEM_DADOS[][63])
{
  int i;
  int p = 0;
  int a = 0;
  int b = 0;
  for (i = 0; i < 4; i++)
  {
    strncpy(ARMAZEM_DADOS[i], "", 63);
  }

  while (LINHA[p] != '\0')
  {
    if (LINHA[p] == ':')
    {
      ARMAZEM_DADOS[a][b] = '\0';
      b = 0;
      a++;
    }
    else
    {
      ARMAZEM_DADOS[a][b] = LINHA[p];
      b++;
    }

    p++;
  }

  return a;
}

void merge_L(int tabelaF[], int baixo, int cima, int mid, int encomenda)
{
  int k;
  int i;
  int j;
  int tabela_aux[10000];
  for (i = mid + 1; i > baixo; i--)
    tabela_aux[i - 1] = tabelaF[i - 1];

  for (j = mid; j < cima; j++)
    tabela_aux[(cima + mid) - j] = tabelaF[j + 1];

  for (k = baixo; k <= cima; k++)
  {
    if (strcmp(STOCK_LOJA[ENCOMENDAS[encomenda].info_encomenda[tabela_aux[j]][0]].NOME_PRODUTO, STOCK_LOJA[ENCOMENDAS[encomenda].info_encomenda[tabela_aux[i]][0]].NOME_PRODUTO) < 0)
    {
      tabelaF[k] = tabela_aux[j--];
    }
    else
    {
      tabelaF[k] = tabela_aux[i++];
    }

  }

}

void merge_l(int tabelaF[], int baixo, int cima, int mid)
{
  int k;
  int i;
  int j;
  int tabela_aux[10000];
  for (i = mid + 1; i > baixo; i--)
    tabela_aux[i - 1] = tabelaF[i - 1];

  for (j = mid; j < cima; j++)
    tabela_aux[(cima + mid) - j] = tabelaF[j + 1];

  for (k = baixo; k <= cima; k++)
  {
    if (STOCK_LOJA[tabela_aux[j]].preco < STOCK_LOJA[tabela_aux[i]].preco)
    {
      tabelaF[k] = tabela_aux[j--];
    }
    else
    {
      if ((STOCK_LOJA[tabela_aux[j]].preco == STOCK_LOJA[tabela_aux[i]].preco) && (STOCK_LOJA[tabela_aux[j]].identificacao_produto < STOCK_LOJA[tabela_aux[i]].identificacao_produto))
      {
        tabelaF[k] = tabela_aux[j--];
      }
      else
      {
        tabelaF[k] = tabela_aux[i++];
      }

    }

  }

}

void merge_sort(int baixo, int cima, int tabelaF[], int string, int encomenda)
{
  int mid = (cima + baixo) / 2;
  if (cima <= baixo)
  {
    return;
  }
  else
  {
    
  }

  merge_sort(baixo, mid, tabelaF, string, encomenda);
  merge_sort(mid + 1, cima, tabelaF, string, encomenda);
  if (string)
  {
    merge_L(tabelaF, baixo, cima, mid, encomenda);
  }
  else
  {
    merge_l(tabelaF, baixo, cima, mid);
  }

}

void adiciona_produto()
{
  int i;
  int p = 0;
  char LINHA[63];
  char ARMAZEM_DADOS[4][63];
  getchar();
  LerLinha(LINHA);
  SepararDados(LINHA, ARMAZEM_DADOS);
  for (i = 0; i < 10000; i++)
  {
    if (STOCK_LOJA[i].identificacao_produto != (-1))
    {
      p++;
    }
    else
    {
      break;
    }

  }

  STOCK_LOJA[p].identificacao_produto = p;
  strcpy(STOCK_LOJA[p].NOME_PRODUTO, ARMAZEM_DADOS[0]);
  STOCK_LOJA[p].preco = atoi(ARMAZEM_DADOS[1]);
  STOCK_LOJA[p].peso = atoi(ARMAZEM_DADOS[2]);
  STOCK_LOJA[p].qtd = atoi(ARMAZEM_DADOS[3]);
  printf("Novo produto %d.\n", p);
}

void adiciona_stock()
{
  char LINHA[63];
  char ARMAZEM_DADOS[4][63];
  getchar();
  LerLinha(LINHA);
  SepararDados(LINHA, ARMAZEM_DADOS);
  if (STOCK_LOJA[atoi(ARMAZEM_DADOS[0])].identificacao_produto != (-1))
  {
    STOCK_LOJA[atoi(ARMAZEM_DADOS[0])].qtd += atoi(ARMAZEM_DADOS[1]);
  }
  else
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", atoi(ARMAZEM_DADOS[0]));
  }

}

void cria_encomenda()
{
  int i;
  int p = 0;
  for (i = 0; i < 500; i++)
  {
    if (ENCOMENDAS[i].identificacao_encomenda != (-1))
    {
      p++;
    }
    else
    {
      
    }

  }

  ENCOMENDAS[p].identificacao_encomenda = p;
  printf("Nova encomenda %d.\n", p);
}

void adiciona_encomenda()
{
  int i;
  int permissao;
  char LINHA[63];
  char ARMAZEM_DADOS[4][63];
  getchar();
  LerLinha(LINHA);
  SepararDados(LINHA, ARMAZEM_DADOS);
  permissao = 1;
  if (ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].identificacao_encomenda != (-1))
  {
    if (STOCK_LOJA[atoi(ARMAZEM_DADOS[1])].identificacao_produto != (-1))
    {
      if (STOCK_LOJA[atoi(ARMAZEM_DADOS[1])].qtd >= atoi(ARMAZEM_DADOS[2]))
      {
        ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].peso_encomenda += atoi(ARMAZEM_DADOS[2]) * STOCK_LOJA[atoi(ARMAZEM_DADOS[1])].peso;
        if (ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].peso_encomenda > 200)
        {
          ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].peso_encomenda -= atoi(ARMAZEM_DADOS[2]) * STOCK_LOJA[atoi(ARMAZEM_DADOS[1])].peso;
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", atoi(ARMAZEM_DADOS[1]), atoi(ARMAZEM_DADOS[0]));
        }
        else
        {
          STOCK_LOJA[atoi(ARMAZEM_DADOS[1])].qtd -= atoi(ARMAZEM_DADOS[2]);
          for (i = 0; i < 200; ++i)
          {
            if (ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].info_encomenda[i][0] == atoi(ARMAZEM_DADOS[1]))
            {
              ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].info_encomenda[i][1] += atoi(ARMAZEM_DADOS[2]);
              i = 200;
              permissao = 0;
            }
            else
            {
              
            }

          }

          if (permissao)
          {
            for (i = 0; i < 200; ++i)
            {
              if (ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].info_encomenda[i][0] == (-1))
              {
                ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].info_encomenda[i][0] = atoi(ARMAZEM_DADOS[1]);
                ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].info_encomenda[i][1] = atoi(ARMAZEM_DADOS[2]);
                break;
              }
              else
              {
                
              }

            }

          }
          else
          {
            
          }

        }

      }
      else
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", atoi(ARMAZEM_DADOS[1]), atoi(ARMAZEM_DADOS[0]));
      }

    }
    else
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", atoi(ARMAZEM_DADOS[1]), atoi(ARMAZEM_DADOS[0]));
    }

  }
  else
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", atoi(ARMAZEM_DADOS[1]), atoi(ARMAZEM_DADOS[0]));
  }

}

void remove_stock()
{
  char LINHA[63];
  char ARMAZEM_DADOS[4][63];
  getchar();
  LerLinha(LINHA);
  SepararDados(LINHA, ARMAZEM_DADOS);
  if (STOCK_LOJA[atoi(ARMAZEM_DADOS[0])].identificacao_produto != (-1))
  {
    if ((STOCK_LOJA[atoi(ARMAZEM_DADOS[0])].qtd - atoi(ARMAZEM_DADOS[1])) >= 0)
    {
      STOCK_LOJA[atoi(ARMAZEM_DADOS[0])].qtd -= atoi(ARMAZEM_DADOS[1]);
    }
    else
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", atoi(ARMAZEM_DADOS[1]), atoi(ARMAZEM_DADOS[0]));
    }

  }
  else
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", atoi(ARMAZEM_DADOS[0]));
  }

}

void remove_produto_encomenda()
{
  int i;
  char LINHA[63];
  char ARMAZEM_DADOS[4][63];
  getchar();
  LerLinha(LINHA);
  SepararDados(LINHA, ARMAZEM_DADOS);
  if (ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].identificacao_encomenda != (-1))
  {
    if (STOCK_LOJA[atoi(ARMAZEM_DADOS[1])].identificacao_produto != (-1))
    {
      for (i = 0; i < 200; i++)
      {
        if (ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].info_encomenda[i][0] == atoi(ARMAZEM_DADOS[1]))
        {
          ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].peso_encomenda -= STOCK_LOJA[atoi(ARMAZEM_DADOS[1])].peso * ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].info_encomenda[i][1];
          STOCK_LOJA[atoi(ARMAZEM_DADOS[1])].qtd += ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].info_encomenda[i][1];
          ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].info_encomenda[i][1] = 0;
          break;
        }
        else
        {
          
        }

      }

    }
    else
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", atoi(ARMAZEM_DADOS[1]), atoi(ARMAZEM_DADOS[0]));
    }

  }
  else
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", atoi(ARMAZEM_DADOS[1]), atoi(ARMAZEM_DADOS[0]));
  }

}

void calcula_custa_encomenda()
{
  int i;
  int preco = 0;
  char LINHA[63];
  char ARMAZEM_DADOS[4][63];
  getchar();
  LerLinha(LINHA);
  SepararDados(LINHA, ARMAZEM_DADOS);
  if (ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].identificacao_encomenda == atoi(ARMAZEM_DADOS[0]))
  {
    for (i = 0; i < 200; i++)
    {
      if (ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].info_encomenda[i][0] != (-1))
      {
        preco += STOCK_LOJA[ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].info_encomenda[i][0]].preco * ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].info_encomenda[i][1];
      }
      else
      {
        
      }

    }

    printf("Custo da encomenda %d %d.\n", atoi(ARMAZEM_DADOS[0]), preco);
  }
  else
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", atoi(ARMAZEM_DADOS[0]));
  }

}

void altera_preco()
{
  char LINHA[63];
  char ARMAZEM_DADOS[4][63];
  getchar();
  LerLinha(LINHA);
  SepararDados(LINHA, ARMAZEM_DADOS);
  if (STOCK_LOJA[atoi(ARMAZEM_DADOS[0])].identificacao_produto != (-1))
  {
    STOCK_LOJA[atoi(ARMAZEM_DADOS[0])].preco = atoi(ARMAZEM_DADOS[1]);
  }
  else
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", atoi(ARMAZEM_DADOS[0]));
  }

}

void lista_descricao_qtd()
{
  int i;
  int ativo = 0;
  char LINHA[63];
  char ARMAZEM_DADOS[4][63];
  getchar();
  LerLinha(LINHA);
  SepararDados(LINHA, ARMAZEM_DADOS);
  if (ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].identificacao_encomenda != (-1))
  {
    if (STOCK_LOJA[atoi(ARMAZEM_DADOS[1])].identificacao_produto != (-1))
    {
      for (i = 0; i < 200; i++)
      {
        if (ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].info_encomenda[i][0] == atoi(ARMAZEM_DADOS[1]))
        {
          ativo = 1;
          break;
        }
        else
        {
          
        }

      }

      if (ativo)
      {
        printf("%s %d.\n", STOCK_LOJA[atoi(ARMAZEM_DADOS[1])].NOME_PRODUTO, ENCOMENDAS[atoi(ARMAZEM_DADOS[0])].info_encomenda[i][1]);
      }
      else
      {
        printf("%s %d.\n", STOCK_LOJA[atoi(ARMAZEM_DADOS[1])].NOME_PRODUTO, 0);
      }

    }
    else
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", atoi(ARMAZEM_DADOS[1]));
    }

  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", atoi(ARMAZEM_DADOS[0]));
  }

}

void maior_qtd_encomenda()
{
  int i;
  int p;
  int contagem = 0;
  int guarda_encomenda = 0;
  int autorizacao = 1;
  char LINHA[63];
  char ARMAZEM_DADOS[4][63];
  getchar();
  LerLinha(LINHA);
  SepararDados(LINHA, ARMAZEM_DADOS);
  if (STOCK_LOJA[atoi(ARMAZEM_DADOS[0])].identificacao_produto != (-1))
  {
    for (i = 0; i < 500; i++)
    {
      for (p = 0; p < 200; p++)
      {
        if ((ENCOMENDAS[i].info_encomenda[p][0] != (-1)) && (ENCOMENDAS[i].info_encomenda[p][0] == atoi(ARMAZEM_DADOS[0])))
        {
          if (ENCOMENDAS[i].info_encomenda[p][1] > contagem)
          {
            contagem = ENCOMENDAS[i].info_encomenda[p][1];
            guarda_encomenda = i;
          }
          else
          {
            
          }

        }
        else
        {
          
        }

      }

    }

    if ((ENCOMENDAS[0].identificacao_encomenda == (-1)) || (contagem == 0))
    {
      autorizacao = 0;
    }
    else
    {
      
    }

    if (autorizacao)
    {
      printf("Maximo produto %d %d %d.\n", atoi(ARMAZEM_DADOS[0]), guarda_encomenda, contagem);
    }
    else
    {
      
    }

  }
  else
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", atoi(ARMAZEM_DADOS[0]));
  }

}

void produtos_ordenados_preco()
{
  int i;
  int tabelaF[10000];
  int conta = 0;
  int cima;
  int baixo = 0;
  for (i = 0; i < 10000; i++)
  {
    if (STOCK_LOJA[i].identificacao_produto != (-1))
    {
      conta++;
    }
    else
    {
      break;
    }

  }

  cima = conta;
  for (i = 0; i < cima; i++)
    tabelaF[i] = STOCK_LOJA[i].identificacao_produto;

  merge_sort(baixo, cima - 1, tabelaF, 0, 0);
  printf("Produtos\n");
  for (i = 0; i < conta; i++)
  {
    printf("* %s %d %d\n", STOCK_LOJA[tabelaF[i]].NOME_PRODUTO, STOCK_LOJA[tabelaF[i]].preco, STOCK_LOJA[tabelaF[i]].qtd);
  }

}

void lista_produtos_encomenda()
{
  int i;
  int conta = 0;
  int baixo = 0;
  int cima = 0;
  int tabelaF[10000];
  int encomenda;
  char LINHA[4];
  getchar();
  LerLinha(LINHA);
  encomenda = atoi(LINHA);
  if (ENCOMENDAS[atoi(LINHA)].identificacao_encomenda != (-1))
  {
    for (i = 0; i < 200; ++i)
    {
      if (ENCOMENDAS[atoi(LINHA)].info_encomenda[i][0] != (-1))
      {
        tabelaF[cima] = i;
        cima++;
        conta++;
      }
      else
      {
        break;
      }

    }

    merge_sort(baixo, cima - 1, tabelaF, 1, encomenda);
    printf("Encomenda %d\n", encomenda);
    for (i = 0; i < conta; i++)
      if (ENCOMENDAS[encomenda].info_encomenda[tabelaF[i]][1] > 0)
    {
      printf("* %s %d %d\n", STOCK_LOJA[ENCOMENDAS[encomenda].info_encomenda[tabelaF[i]][0]].NOME_PRODUTO, STOCK_LOJA[ENCOMENDAS[encomenda].info_encomenda[tabelaF[i]][0]].preco, ENCOMENDAS[encomenda].info_encomenda[tabelaF[i]][1]);
    }
    else
    {
      
    }


  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", atoi(LINHA));
  }

}

int main()
{
  int i;
  int p;
  int c;
  int continua = 1;
  for (i = 0; i < 10000; i++)
  {
    STOCK_LOJA[i].identificacao_produto = -1;
  }

  for (i = 0; i < 500; i++)
  {
    ENCOMENDAS[i].peso_encomenda = 0;
    ENCOMENDAS[i].identificacao_encomenda = -1;
  }

  for (i = 0; i < 500; i++)
  {
    for (p = 0; p < 200; p++)
    {
      ENCOMENDAS[i].info_encomenda[p][0] = -1;
    }

  }

  while (continua)
  {
    switch (c = getchar())
    {
      case 'a':
        adiciona_produto();
        break;

      case 'q':
        adiciona_stock();
        break;

      case 'N':
        cria_encomenda();
        break;

      case 'A':
        adiciona_encomenda();
        break;

      case 'r':
        remove_stock();
        break;

      case 'R':
        remove_produto_encomenda();
        break;

      case 'C':
        calcula_custa_encomenda();
        break;

      case 'p':
        altera_preco();
        break;

      case 'E':
        lista_descricao_qtd();
        break;

      case 'm':
        maior_qtd_encomenda();
        break;

      case 'l':
        produtos_ordenados_preco();
        break;

      case 'L':
        lista_produtos_encomenda();
        break;

      case 'x':
        continua = 0;

    }

  }

  return 0;
}

