#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


typedef struct 
{
  int identificador;
  char descricao[64];
  int preco;
  int peso;
  int quant;
} produto;
typedef struct 
{
  int peso;
  int ide;
  int numerop;
  produto lista_produtos[10000];
} encomenda;
int i = 0;
int e = 0;
produto sistema[10000];
encomenda lista_encomendas[500];
void adicionaProduto()
{
  if (i <= 10000)
  {
    sistema[i].identificador = i;
    for (int sistema_index = 0; sistema_index < 10; sistema_index++)
    {
      sistema[i].descricao[sistema_index] = new_sym_var(sizeof(char) * 8);
    }

    sistema[i].descricao[10 - 1] = '\0';
    sistema[i].preco = new_sym_var(sizeof(int) * 8);
    sistema[i].peso = new_sym_var(sizeof(int) * 8);
    sistema[i].quant = new_sym_var(sizeof(int) * 8);
    printf("Novo produto %d.\n", i);
  }
  else
  {
    
  }

}

void adicionaStock()
{
  int idp;
  int add_qtd;
  idp = new_sym_var(sizeof(int) * 8);
  add_qtd = new_sym_var(sizeof(int) * 8);
  if (strcmp(sistema[idp].descricao, "") == 0)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
  }
  else
  {
    
  }

  sistema[idp].quant += add_qtd;
}

void criaEncomenda()
{
  lista_encomendas[e].ide = e;
  lista_encomendas[e].numerop = 0;
  printf("Nova encomenda %d.\n", e);
}

void adiciona_pEncomenda()
{
  int idte;
  int idtp;
  int in_qtd;
  int n;
  idte = new_sym_var(sizeof(int) * 8);
  idtp = new_sym_var(sizeof(int) * 8);
  in_qtd = new_sym_var(sizeof(int) * 8);
  if (idte >= e)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idtp, idte);
    return;
  }
  else
  {
    
  }

  if (strcmp(sistema[idtp].descricao, "") == 0)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idtp, idte);
    return;
  }
  else
  {
    
  }

  if (sistema[idtp].quant < in_qtd)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idtp, idte);
    return;
  }
  else
  {
    
  }

  if ((lista_encomendas[idte].peso + (sistema[idtp].peso * in_qtd)) > 200)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idtp, idte);
    return;
  }
  else
  {
    
  }

  sistema[idtp].quant -= in_qtd;
  lista_encomendas[idte].peso += sistema[idtp].peso * in_qtd;
  for (n = 0; n < lista_encomendas[idte].numerop; n++)
    if (lista_encomendas[idte].lista_produtos[n].identificador == idtp)
  {
    lista_encomendas[idte].lista_produtos[n].quant += in_qtd;
    return;
  }
  else
  {
    
  }


  n = lista_encomendas[idte].numerop;
  strcpy(lista_encomendas[idte].lista_produtos[n].descricao, sistema[idtp].descricao);
  lista_encomendas[idte].lista_produtos[n].identificador = idtp;
  lista_encomendas[idte].lista_produtos[n].quant = in_qtd;
  lista_encomendas[idte].numerop += 1;
}

void removeStock()
{
  int idp;
  int remove_qtd;
  idp = new_sym_var(sizeof(int) * 8);
  remove_qtd = new_sym_var(sizeof(int) * 8);
  if (strcmp(sistema[idp].descricao, "") == 0)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
    return;
  }
  else
  {
    
  }

  if (sistema[idp].quant < remove_qtd)
  {
    printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", remove_qtd, idp);
    return;
  }
  else
  {
    
  }

  sistema[idp].quant -= remove_qtd;
}

void remove_pEncomenda()
{
  int idte;
  int idtp;
  int n;
  idte = new_sym_var(sizeof(int) * 8);
  idtp = new_sym_var(sizeof(int) * 8);
  if (idte >= e)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idtp, idte);
    return;
  }
  else
  {
    
  }

  if (strcmp(sistema[idtp].descricao, "") == 0)
  {
    printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idtp, idte);
    return;
  }
  else
  {
    
  }

  for (n = 0; n < lista_encomendas[idte].numerop; n++)
    if (lista_encomendas[idte].lista_produtos[n].identificador == idtp)
  {
    lista_encomendas[idte].peso -= lista_encomendas[idte].lista_produtos[n].quant * sistema[idtp].peso;
    sistema[idtp].quant += lista_encomendas[idte].lista_produtos[n].quant;
    lista_encomendas[idte].lista_produtos[n].quant = 0;
    return;
  }
  else
  {
    
  }


}

void custoEncomenda()
{
  int idte;
  int contador;
  int preco_total = 0;
  idte = new_sym_var(sizeof(int) * 8);
  if (idte >= e)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", idte);
    return;
  }
  else
  {
    
  }

  for (contador = 0; contador < lista_encomendas[idte].numerop; contador++)
    preco_total += sistema[lista_encomendas[idte].lista_produtos[contador].identificador].preco * lista_encomendas[idte].lista_produtos[contador].quant;

  printf("Custo da encomenda %d %d.\n", idte, preco_total);
}

void alteraPreco()
{
  int idtp;
  int novo_preco;
  idtp = new_sym_var(sizeof(int) * 8);
  novo_preco = new_sym_var(sizeof(int) * 8);
  if (idtp >= i)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idtp);
    return;
  }
  else
  {
    
  }

  sistema[idtp].preco = novo_preco;
}

void lista_DescriQtd()
{
  int idte;
  int idtp;
  int n;
  idte = new_sym_var(sizeof(int) * 8);
  idtp = new_sym_var(sizeof(int) * 8);
  if (idte >= e)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", idte);
    return;
  }
  else
  {
    
  }

  if (idtp >= i)
  {
    printf("Impossivel listar produto %d. Produto inexistente.\n", idtp);
    return;
  }
  else
  {
    
  }

  for (n = 0; n < lista_encomendas[idte].numerop; n++)
    if (strcmp(lista_encomendas[idte].lista_produtos[n].descricao, sistema[idtp].descricao) == 0)
  {
    printf("%s %d.\n", sistema[idtp].descricao, lista_encomendas[idte].lista_produtos[n].quant);
    return;
  }
  else
  {
    
  }


  printf("%s 0.\n", sistema[idtp].descricao);
}

void listaMaxProduto()
{
  int idtp;
  int n;
  int p;
  int maximo_p = -1;
  int encomenda_n;
  idtp = new_sym_var(sizeof(int) * 8);
  if (idtp >= i)
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idtp);
    return;
  }
  else
  {
    
  }

  for (n = 0; n < e; n++)
  {
    for (p = 0; p < lista_encomendas[n].numerop; p++)
    {
      if (lista_encomendas[n].lista_produtos[p].identificador == idtp)
      {
        if (((lista_encomendas[n].peso != 0) && (maximo_p < lista_encomendas[n].lista_produtos[p].quant)) && (lista_encomendas[n].lista_produtos[p].quant > 0))
        {
          maximo_p = lista_encomendas[n].lista_produtos[p].quant;
          encomenda_n = n;
        }
        else
        {
          
        }

      }
      else
      {
        
      }

    }

  }

  if (maximo_p < 1)
  {
    return;
  }
  else
  {
    printf("Maximo produto %d %d %d.\n", idtp, encomenda_n, maximo_p);
  }

}

void merge(produto lista_crescente[], int l, int m, int r)
{
  int i;
  int j;
  int k;
  int n1 = (m - l) + 1;
  int n2 = r - m;
  produto E[10000];
  produto D[10000];
  for (i = 0; i < n1; i++)
    E[i] = lista_crescente[l + i];

  for (j = 0; j < n2; j++)
    D[j] = lista_crescente[(m + 1) + j];

  i = 0;
  j = 0;
  k = l;
  while ((i < n1) && (j < n2))
  {
    if (E[i].preco <= D[j].preco)
    {
      lista_crescente[k] = E[i];
      i++;
    }
    else
    {
      lista_crescente[k] = D[j];
      j++;
    }

    k++;
  }

  while (i < n1)
  {
    lista_crescente[k] = E[i];
    i++;
    k++;
  }

  while (j < n2)
  {
    lista_crescente[k] = D[j];
    j++;
    k++;
  }

}

void mergeSort(produto lista_crescente[], int l, int r)
{
  if (l < r)
  {
    int m = l + ((r - l) / 2);
    mergeSort(lista_crescente, l, m);
    mergeSort(lista_crescente, m + 1, r);
    merge(lista_crescente, l, m, r);
  }
  else
  {
    
  }

}

void listaPcrescente()
{
  int n;
  produto lista_crescente[10000];
  printf("Produtos\n");
  if (i > 0)
  {
    memcpy(&lista_crescente, &sistema, sizeof(sistema));
    mergeSort(lista_crescente, 0, i - 1);
    for (n = 0; n < i; n++)
      printf("* %s %d %d\n", lista_crescente[n].descricao, lista_crescente[n].preco, lista_crescente[n].quant);

  }
  else
  {
    
  }

}

void lista_alfabeticamente()
{
  int idte;
  int n;
  int u;
  int j;
  int numero_produtos;
  char encomenda_ordenada_abc[10000][64];
  char guarda_descricao[64];
  int encomenda_ordenada_id[10000];
  int guarda_id;
  idte = new_sym_var(sizeof(int) * 8);
  if (idte >= e)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", idte);
    return;
  }
  else
  {
    
  }

  numero_produtos = lista_encomendas[idte].numerop;
  for (u = 0; u < numero_produtos; u++)
  {
    strcpy(encomenda_ordenada_abc[u], lista_encomendas[idte].lista_produtos[u].descricao);
    encomenda_ordenada_id[u] = lista_encomendas[idte].lista_produtos[u].identificador;
  }

  for (n = 0; n < (numero_produtos - 1); n++)
  {
    for (j = n + 1; j < numero_produtos; j++)
    {
      if (strcmp(encomenda_ordenada_abc[n], encomenda_ordenada_abc[j]) > 0)
      {
        strcpy(guarda_descricao, encomenda_ordenada_abc[n]);
        guarda_id = encomenda_ordenada_id[n];
        strcpy(encomenda_ordenada_abc[n], encomenda_ordenada_abc[j]);
        encomenda_ordenada_id[n] = encomenda_ordenada_id[j];
        strcpy(encomenda_ordenada_abc[j], guarda_descricao);
        encomenda_ordenada_id[j] = guarda_id;
      }
      else
      {
        
      }

    }

  }

  printf("Encomenda %d\n", idte);
  u = 0;
  for (u = 0; u < numero_produtos; u++)
  {
    for (j = 0; j < numero_produtos; j++)
      if ((encomenda_ordenada_id[u] == lista_encomendas[idte].lista_produtos[j].identificador) && (lista_encomendas[idte].lista_produtos[j].quant > 0))
    {
      printf("* %s %d %d\n", encomenda_ordenada_abc[u], sistema[encomenda_ordenada_id[u]].preco, lista_encomendas[idte].lista_produtos[j].quant);
    }
    else
    {
      
    }


  }

}

int main()
{
  char comando = ' ';
  while ((comando != EOF) && (comando != 'x'))
  {
    comando = new_sym_var(sizeof(char) * 8);
    switch (comando)
    {
      case 'a':
        getchar();
        adicionaProduto();
        i++;
        break;

      case 'q':
        getchar();
        adicionaStock();
        break;

      case 'N':
        criaEncomenda();
        e++;
        break;

      case 'A':
        getchar();
        adiciona_pEncomenda();
        break;

      case 'r':
        getchar();
        removeStock();
        break;

      case 'R':
        getchar();
        remove_pEncomenda();
        break;

      case 'C':
        getchar();
        custoEncomenda();
        break;

      case 'p':
        getchar();
        alteraPreco();
        break;

      case 'E':
        getchar();
        lista_DescriQtd();
        break;

      case 'm':
        getchar();
        listaMaxProduto();
        break;

      case 'l':
        getchar();
        listaPcrescente();
        break;

      case 'L':
        getchar();
        lista_alfabeticamente();
        break;

    }

  }

  return 0;
}

