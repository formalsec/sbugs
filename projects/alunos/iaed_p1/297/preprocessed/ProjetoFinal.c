/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>


typedef struct produto
{
  int idp;
  char NOME_PRODUTO[64];
  int peso;
  int preco;
  int stock;
} produto;
typedef struct encomenda
{
  int peso;
  int ide;
  int produtos[200][2];
} encomenda;
encomenda vetor_encomendas[500];
produto vetor_produtos[10000];
char linha_input[100];
int aux[10000];
void readsInput(char linha_input[])
{
  char c;
  int n = 0;
  while ((c = getchar()) != '\n')
  {
    linha_input[n] = c;
    n++;
  }

  linha_input[n] = '\0';
}

void InitializesMinusOne(produto vetor_produtos[10000], encomenda vetor_encomendas[500])
{
  int i;
  int e;
  for (i = 0; i < 10000; i++)
  {
    vetor_produtos[i].idp = -1;
    for (e = 0; e < 64; e++)
    {
      vetor_produtos[i].NOME_PRODUTO[e] = ' ';
    }

  }

  for (i = 0; i < 500; i++)
  {
    vetor_encomendas[i].ide = -1;
    for (e = 0; e < 200; e++)
    {
      vetor_encomendas[i].produtos[e][0] = -1;
    }

  }

}

void CreatesDelivery()
{
  int i;
  for (i = 0; i < 500; i++)
  {
    if (vetor_encomendas[i].ide == (-1))
    {
      vetor_encomendas[i].peso = 0;
      vetor_encomendas[i].ide = i;
      break;
    }
    else
    {
      
    }

  }

  printf("Nova encomenda %d.\n", vetor_encomendas[i].ide);
}

void Merge(int vetor_idps[], int l, int m, int r)
{
  int i;
  int j;
  int k;
  int aux[10000];
  for (i = m + 1; i > l; i--)
  {
    aux[i - 1] = vetor_idps[i - 1];
  }

  for (j = m; j < r; j++)
  {
    aux[(r + m) - j] = vetor_idps[j + 1];
  }

  for (k = l; k <= r; k++)
  {
    if (vetor_produtos[aux[j]].preco < vetor_produtos[aux[i]].preco)
    {
      vetor_idps[k] = aux[j--];
    }
    else
    {
      if ((vetor_produtos[aux[j]].preco == vetor_produtos[aux[i]].preco) && (vetor_produtos[aux[j]].idp < vetor_produtos[aux[i]].idp))
      {
        vetor_idps[k] = aux[j--];
      }
      else
      {
        vetor_idps[k] = aux[i++];
      }

    }

  }

}

void MergeSort(int vetor_idps[], int l, int r)
{
  int m = (r + l) / 2;
  if (r <= l)
  {
    return;
  }
  else
  {
    
  }

  MergeSort(vetor_idps, l, m);
  MergeSort(vetor_idps, m + 1, r);
  Merge(vetor_idps, l, m, r);
}

void OrdersProductsByPrice()
{
  int vetor_idps[10000];
  int i;
  int e;
  int l = 0;
  int r;
  int contador = 0;
  for (i = 0; i < 10000; i++)
  {
    if (vetor_produtos[i].idp == i)
    {
      vetor_idps[i] = vetor_produtos[i].idp;
      contador++;
    }
    else
    {
      
    }

  }

  r = contador;
  MergeSort(vetor_idps, l, r - 1);
  printf("Produtos\n");
  for (e = 0; e < contador; e++)
  {
    printf("* %s %d %d\n", vetor_produtos[vetor_idps[e]].NOME_PRODUTO, vetor_produtos[vetor_idps[e]].preco, vetor_produtos[vetor_idps[e]].stock);
  }

}

void ListsIdeWhereIdpMoreFrequent(char linha_input[])
{
  int i;
  int e;
  int p = 0;
  int b = 0;
  int a = 0;
  int idp = 0;
  int ide = 0;
  char guarda_idp[1][10000];
  int tamanho0;
  int qtd = 0;
  getchar();
  readsInput(linha_input);
  while (linha_input[p] != '\0')
  {
    if (linha_input[p] != ':')
    {
      guarda_idp[a][b] = linha_input[p];
      b++;
    }
    else
    {
      guarda_idp[a][b] = '\0';
      b = 0;
      a++;
    }

    p++;
  }

  guarda_idp[a][b] = '\0';
  tamanho0 = strlen(guarda_idp[0]);
  for (i = 0; i < tamanho0; i++)
  {
    idp = (idp * 10) + (guarda_idp[0][i] - '0');
  }

  if (vetor_produtos[idp].idp == (-1))
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    for (e = 0; e < 500; e++)
    {
      if (vetor_encomendas[e].produtos[idp][0] == vetor_produtos[idp].idp)
      {
        if (vetor_encomendas[e].produtos[idp][1] > qtd)
        {
          qtd = vetor_encomendas[e].produtos[idp][1];
          ide = e;
        }
        else
        {
          
        }

      }
      else
      {
        
      }

    }

    if (qtd > 0)
    {
      printf("Maximo produto %d %d %d.\n", idp, ide, qtd);
    }
    else
    {
      
    }

  }

}

void ListsDescriptionQuantity(char linha_input[])
{
  int i;
  int p = 0;
  int b = 0;
  int a = 0;
  int idp = 0;
  int ide = 0;
  char guarda_ide_idp[2][10000];
  int tamanho0;
  int tamanho1;
  getchar();
  readsInput(linha_input);
  while (linha_input[p] != '\0')
  {
    if (linha_input[p] != ':')
    {
      guarda_ide_idp[a][b] = linha_input[p];
      b++;
    }
    else
    {
      guarda_ide_idp[a][b] = '\0';
      b = 0;
      a++;
    }

    p++;
  }

  guarda_ide_idp[a][b] = '\0';
  tamanho0 = strlen(guarda_ide_idp[0]);
  tamanho1 = strlen(guarda_ide_idp[1]);
  for (i = 0; i < tamanho0; i++)
  {
    ide = (ide * 10) + (guarda_ide_idp[0][i] - '0');
  }

  for (i = 0; i < tamanho1; i++)
  {
    idp = (idp * 10) + (guarda_ide_idp[1][i] - '0');
  }

  if (vetor_encomendas[ide].ide == (-1))
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    if (vetor_produtos[idp].idp == (-1))
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
    }
    else
    {
      printf("%s %d.\n", vetor_produtos[idp].NOME_PRODUTO, vetor_encomendas[ide].produtos[idp][1]);
    }

  }

}

void CalculatesPriceDelivery(char linha_input[])
{
  int i;
  int p = 0;
  int b = 0;
  int a = 0;
  int total = 0;
  int idp = 0;
  int ide = 0;
  char guarda_ide[1][10000];
  int tamanho0;
  getchar();
  readsInput(linha_input);
  while (linha_input[p] != '\0')
  {
    if (linha_input[p] != ':')
    {
      guarda_ide[a][b] = linha_input[p];
      b++;
    }
    else
    {
      guarda_ide[a][b] = '\0';
      b = 0;
      a++;
    }

    p++;
  }

  guarda_ide[a][b] = '\0';
  tamanho0 = strlen(guarda_ide[0]);
  for (i = 0; i < tamanho0; i++)
  {
    ide = (ide * 10) + (guarda_ide[0][i] - '0');
  }

  for (i = 0; i < 200; i++)
  {
    idp = vetor_encomendas[ide].produtos[i][0];
    total += vetor_encomendas[ide].produtos[i][1] * vetor_produtos[idp].preco;
  }

  if (vetor_encomendas[ide].ide == (-1))
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    printf("Custo da encomenda %d %d.\n", ide, total);
  }

}

void RemovesProductToDelivery(char linha_input[])
{
  int i;
  int p = 0;
  int b = 0;
  int a = 0;
  int peso;
  int ide = 0;
  int idp = 0;
  char guarda_ide_idp[2][10000];
  int tamanho0;
  int tamanho1;
  getchar();
  readsInput(linha_input);
  while (linha_input[p] != '\0')
  {
    if (linha_input[p] != ':')
    {
      guarda_ide_idp[a][b] = linha_input[p];
      b++;
    }
    else
    {
      guarda_ide_idp[a][b] = '\0';
      b = 0;
      a++;
    }

    p++;
  }

  guarda_ide_idp[a][b] = '\0';
  tamanho0 = strlen(guarda_ide_idp[0]);
  tamanho1 = strlen(guarda_ide_idp[1]);
  for (i = 0; i < tamanho0; i++)
  {
    ide = (ide * 10) + (guarda_ide_idp[0][i] - '0');
  }

  for (i = 0; i < tamanho1; i++)
  {
    idp = (idp * 10) + (guarda_ide_idp[1][i] - '0');
  }

  for (i = 0; i < 10000; i++)
  {
    if (vetor_produtos[i].idp == idp)
    {
      peso = vetor_produtos[i].peso;
    }
    else
    {
      
    }

  }

  if (vetor_encomendas[ide].ide == (-1))
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (vetor_produtos[idp].idp == (-1))
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      vetor_encomendas[ide].peso -= peso * vetor_encomendas[ide].produtos[idp][1];
      vetor_encomendas[ide].produtos[idp][0] = idp;
      vetor_produtos[ide].stock += vetor_encomendas[ide].produtos[idp][1];
      vetor_encomendas[ide].produtos[idp][1] = 0;
    }

  }

}

void AddsProductToDelivery(char linha_input[])
{
  int i;
  int p = 0;
  int b = 0;
  int a = 0;
  int peso;
  int ide = 0;
  int idp = 0;
  int qtd = 0;
  char guarda_ide_idp_stock[3][10000];
  int tamanho1;
  int tamanho2;
  int tamanho0;
  getchar();
  readsInput(linha_input);
  while (linha_input[p] != '\0')
  {
    if (linha_input[p] != ':')
    {
      guarda_ide_idp_stock[a][b] = linha_input[p];
      b++;
    }
    else
    {
      guarda_ide_idp_stock[a][b] = '\0';
      b = 0;
      a++;
    }

    p++;
  }

  guarda_ide_idp_stock[a][b] = '\0';
  tamanho1 = strlen(guarda_ide_idp_stock[1]);
  tamanho2 = strlen(guarda_ide_idp_stock[2]);
  tamanho0 = strlen(guarda_ide_idp_stock[0]);
  for (i = 0; i < tamanho0; i++)
  {
    ide = (ide * 10) + (guarda_ide_idp_stock[0][i] - '0');
  }

  for (i = 0; i < tamanho1; i++)
  {
    idp = (idp * 10) + (guarda_ide_idp_stock[1][i] - '0');
  }

  for (i = 0; i < tamanho2; i++)
  {
    qtd = (qtd * 10) + (guarda_ide_idp_stock[2][i] - '0');
  }

  peso = vetor_produtos[idp].peso;
  if (vetor_encomendas[ide].ide == (-1))
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (vetor_produtos[idp].idp == (-1))
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      if (qtd > vetor_produtos[idp].stock)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
      }
      else
      {
        if ((vetor_encomendas[ide].peso + (qtd * peso)) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
        }
        else
        {
          vetor_encomendas[ide].peso += qtd * peso;
          vetor_produtos[idp].stock -= qtd;
          vetor_encomendas[ide].produtos[idp][0] = idp;
          vetor_encomendas[ide].produtos[idp][1] += qtd;
        }

      }

    }

  }

}

void ChangesPrice(char linha_input[])
{
  int i;
  int p = 0;
  int b = 0;
  int a = 0;
  int e;
  int contador = 0;
  int preco = 0;
  int idp = 0;
  char guarda_idp_preco[2][1000];
  int tamanho0;
  int tamanho1;
  getchar();
  readsInput(linha_input);
  while (linha_input[p] != '\0')
  {
    if (linha_input[p] != ':')
    {
      guarda_idp_preco[a][b] = linha_input[p];
      b++;
    }
    else
    {
      guarda_idp_preco[a][b] = '\0';
      b = 0;
      a++;
    }

    p++;
  }

  guarda_idp_preco[a][b] = '\0';
  tamanho0 = strlen(guarda_idp_preco[0]);
  tamanho1 = strlen(guarda_idp_preco[1]);
  for (i = 0; i < tamanho0; i++)
  {
    idp = (idp * 10) + (guarda_idp_preco[0][i] - '0');
  }

  for (i = 0; i < tamanho1; i++)
  {
    preco = (preco * 10) + (guarda_idp_preco[1][i] - '0');
  }

  for (e = 0; e < 10000; e++)
  {
    if (vetor_produtos[e].idp == idp)
    {
      contador++;
      vetor_produtos[e].preco = preco;
      break;
    }
    else
    {
      
    }

  }

  if (contador == 0)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    
  }

}

void RemovesQuantity(char linha_input[])
{
  int i;
  int p = 0;
  int b = 0;
  int a = 0;
  int e;
  int contador = 0;
  int qtd = 0;
  int idp = 0;
  char guarda_idp_stock[2][1000];
  int tamanho0;
  int tamanho1;
  getchar();
  readsInput(linha_input);
  while (linha_input[p] != '\0')
  {
    if (linha_input[p] != ':')
    {
      guarda_idp_stock[a][b] = linha_input[p];
      b++;
    }
    else
    {
      guarda_idp_stock[a][b] = '\0';
      b = 0;
      a++;
    }

    p++;
  }

  guarda_idp_stock[a][b] = '\0';
  tamanho0 = strlen(guarda_idp_stock[0]);
  tamanho1 = strlen(guarda_idp_stock[1]);
  for (i = 0; i < tamanho0; i++)
  {
    idp = (idp * 10) + (guarda_idp_stock[0][i] - '0');
  }

  for (i = 0; i < tamanho1; i++)
  {
    qtd = (qtd * 10) + (guarda_idp_stock[1][i] - '0');
  }

  for (e = 0; e < 10000; e++)
  {
    if (vetor_produtos[e].idp == idp)
    {
      contador++;
      if (vetor_produtos[e].stock < qtd)
      {
        printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, idp);
        break;
      }
      else
      {
        
      }

    }
    else
    {
      
    }

    vetor_produtos[e].stock -= qtd;
  }

  if (contador == 0)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    
  }

}

void AddsQuantity(char linha_input[])
{
  int i;
  int p = 0;
  int b = 0;
  int a = 0;
  int e;
  int contador = 0;
  int qtd = 0;
  int idp = 0;
  char guarda_idp_stock[2][1000];
  int tamanho0;
  int tamanho1;
  getchar();
  readsInput(linha_input);
  while (linha_input[p] != '\0')
  {
    if (linha_input[p] != ':')
    {
      guarda_idp_stock[a][b] = linha_input[p];
      b++;
    }
    else
    {
      guarda_idp_stock[a][b] = '\0';
      b = 0;
      a++;
    }

    p++;
  }

  guarda_idp_stock[a][b] = '\0';
  tamanho0 = strlen(guarda_idp_stock[0]);
  tamanho1 = strlen(guarda_idp_stock[1]);
  for (i = 0; i < tamanho0; i++)
  {
    idp = (idp * 10) + (guarda_idp_stock[0][i] - '0');
  }

  for (i = 0; i < tamanho1; i++)
  {
    qtd = (qtd * 10) + (guarda_idp_stock[1][i] - '0');
  }

  for (e = 0; e < 10000; e++)
  {
    if (vetor_produtos[e].idp == idp)
    {
      vetor_produtos[e].stock += qtd;
      contador++;
    }
    else
    {
      
    }

  }

  if (contador == 0)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
  }
  else
  {
    
  }

}

void AddsNewProduct(char linha_input[100])
{
  int i;
  int e;
  int p = 0;
  int a = 0;
  int b = 0;
  int preco = 0;
  int peso = 0;
  int stock = 0;
  char guarda_produto[4][64];
  int tamanho1;
  int tamanho2;
  int tamanho3;
  getchar();
  readsInput(linha_input);
  while (linha_input[p] != '\0')
  {
    if (linha_input[p] == ':')
    {
      guarda_produto[a][b] = '\0';
      b = 0;
      a++;
    }
    else
    {
      guarda_produto[a][b] = linha_input[p];
      b++;
    }

    p++;
  }

  guarda_produto[a][b] = '\0';
  tamanho1 = strlen(guarda_produto[1]);
  tamanho2 = strlen(guarda_produto[2]);
  tamanho3 = strlen(guarda_produto[3]);
  for (i = 0; i < tamanho1; i++)
  {
    preco = (preco * 10) + (guarda_produto[1][i] - '0');
  }

  for (i = 0; i < tamanho2; i++)
  {
    peso = (peso * 10) + (guarda_produto[2][i] - '0');
  }

  for (i = 0; i < tamanho3; i++)
  {
    stock = (stock * 10) + (guarda_produto[3][i] - '0');
  }

  for (e = 0; e < 10000; e++)
  {
    if (vetor_produtos[e].idp == (-1))
    {
      for (i = 0; i < 64; i++)
      {
        vetor_produtos[e].NOME_PRODUTO[i] = guarda_produto[0][i];
      }

      vetor_produtos[e].NOME_PRODUTO[i] = '\0';
      vetor_produtos[e].preco = preco;
      vetor_produtos[e].peso = peso;
      vetor_produtos[e].stock = stock;
      vetor_produtos[e].idp = e;
      break;
    }
    else
    {
      
    }

  }

  printf("Novo produto %d.\n", vetor_produtos[e].idp);
}

int main()
{
  int running = 1;
  int c;
  InitializesMinusOne(vetor_produtos, vetor_encomendas);
  while (running == 1)
  {
    switch (c = getchar())
    {
      case 'a':
        AddsNewProduct(linha_input);
        break;

      case 'q':
        AddsQuantity(linha_input);
        break;

      case 'r':
        RemovesQuantity(linha_input);
        break;

      case 'p':
        ChangesPrice(linha_input);
        break;

      case 'N':
        CreatesDelivery();
        break;

      case 'A':
        AddsProductToDelivery(linha_input);
        break;

      case 'R':
        RemovesProductToDelivery(linha_input);
        break;

      case 'C':
        CalculatesPriceDelivery(linha_input);
        break;

      case 'E':
        ListsDescriptionQuantity(linha_input);
        break;

      case 'm':
        ListsIdeWhereIdpMoreFrequent(linha_input);
        break;

      case 'l':
        OrdersProductsByPrice();
        break;

      case 'x':
        running = 0;
        break;

    }

  }

  return 0;
}

