/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>


typedef struct 
{
  int idp;
  char description[63];
  int price;
  int weight;
  int stock;
} Product;
typedef struct 
{
  Product order_products[200];
  int ido;
  int weight;
  int orderProductsNumber;
} Order;
Product products[10000];
Order orders[500];
void newProduct();
void addStock(int productsNumber);
void newOrder();
void addProduct(int ordersNumber, int productsNumber);
void removeStock(int productsNumber);
void removeProduct(int ordersNumber, int productsNumber);
void getOrderPrice(int ordersNumber);
void changePrice(int ordersNumber, int productsNumber);
void searchProduct(int ordersNumber, int productsNumber);
void getMaxOrderProduct(int ordersNumber, int productsNumber);
void listProducts(int productsNumber);
void listOrder(int ordersNumber);
void lista(int productsNumber);
int main()
{
  char c;
  int productsNumber = 0;
  int ordersNumber = 0;
  while (((c = getchar()) != 'x') && (c != EOF))
  {
    switch (c)
    {
      case 'a':
        getchar();
        productsNumber++;
        newProduct();
        break;

      case 'q':
        addStock(productsNumber);
        break;

      case 'N':
        ordersNumber++;
        newOrder();
        break;

      case 'A':
        addProduct(ordersNumber, productsNumber);
        break;

      case 'r':
        removeStock(productsNumber);
        break;

      case 'R':
        removeProduct(ordersNumber, productsNumber);
        break;

      case 'C':
        getOrderPrice(ordersNumber);
        break;

      case 'p':
        changePrice(ordersNumber, productsNumber);
        break;

      case 'E':
        searchProduct(ordersNumber, productsNumber);
        break;

      case 'm':
        getMaxOrderProduct(ordersNumber, productsNumber);
        break;

      case 'l':
        listProducts(productsNumber);
        break;

      case 'L':
        listOrder(ordersNumber);
        break;

    }

  }

  return 0;
}

int idpGenerator()
{
  static int idp = -1;
  idp++;
  return idp;
}

int idoGenerator()
{
  static int ido = -1;
  ido++;
  return ido;
}

void readDescription(char str[63])
{
  int i;
  char c;
  for (i = 0; (((c = getchar()) != ':') && (c != '\n')) && (c != '\0'); i++)
  {
    str[i] = c;
  }

  str[i] = '\0';
}

void mergeProducts(Product array[], int left, int m, int right)
{
  int i;
  int j;
  int k;
  Product aux[10000];
  for (i = m + 1; i > left; i--)
  {
    aux[i - 1] = array[i - 1];
  }

  for (j = m; j < right; j++)
  {
    aux[(right + m) - j] = array[j + 1];
  }

  for (k = left; k <= right; k++)
  {
    if ((aux[j].price < aux[i].price) || (i > m))
    {
      array[k] = aux[j--];
    }
    else
    {
      array[k] = aux[i++];
    }

  }

}

void mergesortProducts(Product array[], int left, int right)
{
  int m = (right + left) / 2;
  if (right <= left)
  {
    return;
  }
  else
  {
    
  }

  mergesortProducts(array, left, m);
  mergesortProducts(array, m + 1, right);
  mergeProducts(array, left, m, right);
}

void mergeOrders(Product array[], int left, int m, int right)
{
  int i;
  int j;
  int k;
  Product aux[10000];
  for (i = m + 1; i > left; i--)
  {
    aux[i - 1] = array[i - 1];
  }

  for (j = m; j < right; j++)
  {
    aux[(right + m) - j] = array[j + 1];
  }

  for (k = left; k <= right; k++)
  {
    if ((strcmp(aux[j].description, aux[i].description) < 0) || (i > m))
    {
      array[k] = aux[j--];
    }
    else
    {
      array[k] = aux[i++];
    }

  }

}

void mergesortOrders(Product array[], int left, int right)
{
  int m = (right + left) / 2;
  if (right <= left)
  {
    return;
  }
  else
  {
    
  }

  mergesortOrders(array, left, m);
  mergesortOrders(array, m + 1, right);
  mergeOrders(array, left, m, right);
}

int hasProduct(int productsNumber, int idp)
{
  int i;
  for (i = 0; i < productsNumber; i++)
  {
    if (products[i].idp == idp)
    {
      return i;
    }
    else
    {
      
    }

  }

  return -1;
}

int hasOrder(int ordersNumber, int ido)
{
  int i;
  for (i = 0; i < ordersNumber; i++)
  {
    if (orders[i].ido == ido)
    {
      return i;
    }
    else
    {
      
    }

  }

  return -1;
}

int hasProductOrder(int ido, int idp)
{
  int i;
  for (i = 0; i < orders[ido].orderProductsNumber; i++)
  {
    if (orders[ido].order_products[i].idp == idp)
    {
      return i;
    }
    else
    {
      
    }

  }

  return -1;
}

void addProductAux(int o, int p)
{
  orders[o].order_products[orders[o].orderProductsNumber].idp = products[p].idp;
  strcpy(orders[o].order_products[orders[o].orderProductsNumber].description, products[p].description);
  orders[o].order_products[orders[o].orderProductsNumber].price = products[p].price;
  orders[o].order_products[orders[o].orderProductsNumber].weight = products[p].weight;
  orders[o].order_products[orders[o].orderProductsNumber].stock = 0;
  orders[o].orderProductsNumber += 1;
}

void addStockOrder(int p, int stockAdd, int o, int h)
{
  products[p].stock -= stockAdd;
  orders[o].order_products[h].stock += stockAdd;
  orders[o].weight += products[p].weight * stockAdd;
}

void removeProductAux(int o, int p, int h)
{
  int i;
  orders[o].weight -= orders[o].order_products[h].stock * products[p].weight;
  for (i = h; i < (orders[o].orderProductsNumber - 1); i++)
  {
    orders[o].order_products[i].idp = orders[o].order_products[i + 1].idp;
    strcpy(orders[o].order_products[i].description, orders[o].order_products[i + 1].description);
    orders[o].order_products[i].price = orders[o].order_products[i + 1].price;
    orders[o].order_products[i].weight = orders[o].order_products[i + 1].weight;
    orders[o].order_products[i].stock = orders[o].order_products[i + 1].stock;
  }

  orders[o].orderProductsNumber -= 1;
}

void newProduct()
{
  char description[63];
  int price;
  int weight;
  int stock;
  int idp;
  idp = idpGenerator();
  readDescription(description);
  price = new_sym_var(sizeof(int) * 8);
  weight = new_sym_var(sizeof(int) * 8);
  stock = new_sym_var(sizeof(int) * 8);
  products[idp].idp = idp;
  strcpy(products[idp].description, description);
  products[idp].price = price;
  products[idp].weight = weight;
  products[idp].stock = stock;
  printf("Novo produto %d.\n", idp);
}

void addStock(int productsNumber)
{
  int idp;
  int p;
  int stock;
  idp = new_sym_var(sizeof(int) * 8);
  stock = new_sym_var(sizeof(int) * 8);
  if ((p = hasProduct(productsNumber, idp)) >= 0)
  {
    products[p].stock += stock;
  }
  else
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
  }

}

void newOrder()
{
  int ido;
  ido = idoGenerator();
  orders[ido].ido = ido;
  orders[ido].orderProductsNumber = 0;
  orders[ido].weight = 0;
  printf("Nova encomenda %d.\n", ido);
}

void addProduct(int ordersNumber, int productsNumber)
{
  int idp;
  int ido;
  int o;
  int p;
  int h;
  int stock;
  ido = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  stock = new_sym_var(sizeof(int) * 8);
  if ((o = hasOrder(ordersNumber, ido)) >= 0)
  {
    if ((p = hasProduct(productsNumber, idp)) >= 0)
    {
      if (products[p].stock >= stock)
      {
        if ((orders[o].weight + (stock * products[p].weight)) <= 200)
        {
          if ((h = hasProductOrder(o, idp)) >= 0)
          {
            addStockOrder(p, stock, o, h);
          }
          else
          {
            addProductAux(o, p);
            addStockOrder(p, stock, o, hasProductOrder(o, idp));
          }

        }
        else
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ido);
        }

      }
      else
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ido);
      }

    }
    else
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ido);
    }

  }
  else
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ido);
  }

}

void removeStock(int productsNumber)
{
  int idp;
  int p;
  int stock;
  idp = new_sym_var(sizeof(int) * 8);
  stock = new_sym_var(sizeof(int) * 8);
  if ((p = hasProduct(productsNumber, idp)) >= 0)
  {
    if (products[p].stock >= stock)
    {
      products[p].stock -= stock;
    }
    else
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", stock, idp);
    }

  }
  else
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
  }

}

void removeProduct(int ordersNumber, int productsNumber)
{
  int idp;
  int ido;
  int o;
  int p;
  int h;
  ido = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if ((o = hasOrder(ordersNumber, ido)) >= 0)
  {
    if ((p = hasProduct(productsNumber, idp)) >= 0)
    {
      if ((h = hasProductOrder(o, idp)) >= 0)
      {
        products[p].stock += orders[o].order_products[h].stock;
        removeProductAux(o, p, h);
      }
      else
      {
        
      }

    }
    else
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ido);
    }

  }
  else
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ido);
  }

}

void getOrderPrice(int ordersNumber)
{
  int ido;
  int o;
  int h;
  int orderPrice = 0;
  ido = new_sym_var(sizeof(int) * 8);
  if ((o = hasOrder(ordersNumber, ido)) >= 0)
  {
    for (h = 0; h < orders[o].orderProductsNumber; h++)
    {
      orderPrice += orders[o].order_products[h].price * orders[o].order_products[h].stock;
    }

    printf("Custo da encomenda %d %d.\n", ido, orderPrice);
  }
  else
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ido);
  }

}

void changePrice(int ordersNumber, int productsNumber)
{
  int idp;
  int o;
  int p;
  int h;
  int price;
  idp = new_sym_var(sizeof(int) * 8);
  price = new_sym_var(sizeof(int) * 8);
  if ((p = hasProduct(productsNumber, idp)) >= 0)
  {
    products[p].price = price;
    for (o = 0; o < ordersNumber; o++)
    {
      if ((h = hasProductOrder(o, idp)) >= 0)
      {
        orders[o].order_products[h].price = price;
      }
      else
      {
        
      }

    }

  }
  else
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
  }

}

void searchProduct(int ordersNumber, int productsNumber)
{
  int ido;
  int idp;
  int o;
  int p;
  int h;
  ido = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if ((o = hasOrder(ordersNumber, ido)) >= 0)
  {
    if ((p = hasProduct(productsNumber, idp)) >= 0)
    {
      if ((h = hasProductOrder(o, idp)) >= 0)
      {
        printf("%s %d.\n", orders[o].order_products[h].description, orders[o].order_products[h].stock);
      }
      else
      {
        printf("%s 0.\n", products[p].description);
      }

    }
    else
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
    }

  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ido);
  }

}

void getMaxOrderProduct(int ordersNumber, int productsNumber)
{
  int idp;
  int o;
  int p;
  int h;
  int maxStock = 0;
  int idoMaxStock;
  idp = new_sym_var(sizeof(int) * 8);
  if ((p = hasProduct(productsNumber, idp)) >= 0)
  {
    for (o = 0; o < ordersNumber; o++)
    {
      if ((h = hasProductOrder(o, idp)) >= 0)
      {
        if (orders[o].order_products[h].stock > maxStock)
        {
          maxStock = orders[o].order_products[h].stock;
          idoMaxStock = o;
        }
        else
        {
          
        }

      }
      else
      {
        
      }

    }

    if (maxStock <= 0)
    {
      return;
    }
    else
    {
      
    }

    printf("Maximo produto %d %d %d.\n", idp, idoMaxStock, maxStock);
  }
  else
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
  }

}

void listProducts(int productsNumber)
{
  int i;
  Product array[10000];
  for (i = 0; i < productsNumber; i++)
  {
    array[i].idp = products[i].idp;
    strcpy(array[i].description, products[i].description);
    array[i].price = products[i].price;
    array[i].weight = products[i].weight;
    array[i].stock = products[i].stock;
  }

  mergesortProducts(array, 0, productsNumber - 1);
  printf("Produtos\n");
  for (i = 0; i < productsNumber; i++)
  {
    printf("* %s %d %d\n", array[i].description, array[i].price, array[i].stock);
  }

}

void listOrder(int ordersNumber)
{
  int ido;
  int o;
  int h;
  int i;
  Product array[200];
  ido = new_sym_var(sizeof(int) * 8);
  if ((o = hasOrder(ordersNumber, ido)) >= 0)
  {
    for (h = 0; h < orders[o].orderProductsNumber; h++)
    {
      array[h].idp = orders[o].order_products[h].idp;
      strcpy(array[h].description, orders[o].order_products[h].description);
      array[h].price = orders[o].order_products[h].price;
      array[h].weight = orders[o].order_products[h].weight;
      array[h].stock = orders[o].order_products[h].stock;
    }

    mergesortOrders(array, 0, orders[o].orderProductsNumber - 1);
    printf("Encomenda %d\n", ido);
    for (i = 0; i < orders[o].orderProductsNumber; i++)
    {
      printf("* %s %d %d\n", array[i].description, array[i].price, array[i].stock);
    }

  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ido);
  }

}

