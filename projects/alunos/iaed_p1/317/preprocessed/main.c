#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>


void add_product(char args[]);
void add_to_quantity(char args[]);
void new_orderid();
void new_order(char args[]);
void remove_stock(char args[]);
void remove_order(char args[]);
void order_cost(char args[]);
void alter_price(char args[]);
void discript_order(char args[]);
void most_ordered(char args[]);
void list_products();
void alpha_order(char args[]);
struct product
{
  int id;
  char desc[64];
  int price;
  int weight;
  int quantity;
};
struct order
{
  int number_product;
  int peso;
  struct product product_toorder[200];
};
struct product products[9999];
int counter = 0;
struct order orders[499];
int order_counter = 0;
int main()
{
  char function;
  char args[100];
  int stop = 0;
  while ((function != 'x') && (stop == 0))
  {
    function = new_sym_var(sizeof(char) * 8);
    switch (function)
    {
      case 'a':
        for (int args_index = 0; args_index < 10; args_index++)
      {
        args[args_index] = new_sym_var(sizeof(char) * 8);
      }

        args[10 - 1] = '\0';
        add_product(args);
        break;

      case 'q':
        for (int args_index = 0; args_index < 10; args_index++)
      {
        args[args_index] = new_sym_var(sizeof(char) * 8);
      }

        args[10 - 1] = '\0';
        add_to_quantity(args);
        break;

      case 'N':
        new_orderid();
        break;

      case 'A':
        for (int args_index = 0; args_index < 10; args_index++)
      {
        args[args_index] = new_sym_var(sizeof(char) * 8);
      }

        args[10 - 1] = '\0';
        new_order(args);
        break;

      case 'r':
        for (int args_index = 0; args_index < 10; args_index++)
      {
        args[args_index] = new_sym_var(sizeof(char) * 8);
      }

        args[10 - 1] = '\0';
        remove_stock(args);
        break;

      case 'R':
        for (int args_index = 0; args_index < 10; args_index++)
      {
        args[args_index] = new_sym_var(sizeof(char) * 8);
      }

        args[10 - 1] = '\0';
        remove_order(args);
        break;

      case 'C':
        for (int args_index = 0; args_index < 10; args_index++)
      {
        args[args_index] = new_sym_var(sizeof(char) * 8);
      }

        args[10 - 1] = '\0';
        order_cost(args);
        break;

      case 'p':
        for (int args_index = 0; args_index < 10; args_index++)
      {
        args[args_index] = new_sym_var(sizeof(char) * 8);
      }

        args[10 - 1] = '\0';
        alter_price(args);
        break;

      case 'E':
        for (int args_index = 0; args_index < 10; args_index++)
      {
        args[args_index] = new_sym_var(sizeof(char) * 8);
      }

        args[10 - 1] = '\0';
        discript_order(args);
        break;

      case 'm':
        for (int args_index = 0; args_index < 10; args_index++)
      {
        args[args_index] = new_sym_var(sizeof(char) * 8);
      }

        args[10 - 1] = '\0';
        most_ordered(args);
        break;

      case 'l':
        list_products();
        break;

      case 'L':
        alpha_order(args);
        break;

      case 'x':
        stop = 1;
        break;

    }

  }

  return 0;
}

void add_product(char args[])
{
  struct product new_product;
  strcpy(new_product.desc, strtok(args, ":"));
  new_product.price = atoi(strtok(0, ":"));
  new_product.weight = atoi(strtok(0, ":"));
  new_product.quantity = atoi(strtok(0, ":"));
  new_product.id = counter;
  products[counter] = new_product;
  counter++;
  printf("Novo produto %d.\n", products[counter - 1].id);
}

void add_to_quantity(char args[])
{
  int i = atoi(strtok(args, ":"));
  if (i >= counter)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", i);
    return;
  }
  else
  {
    products[i].quantity += atoi(strtok(0, ":"));
  }

}

void new_orderid()
{
  struct order new__order;
  new__order.peso = 0;
  new__order.number_product = 0;
  orders[order_counter] = new__order;
  printf("Nova encomenda %d.\n", order_counter);
  order_counter++;
}

void new_order(char args[])
{
  int i = 0;
  int e;
  int id_order = atoi(strtok(args, ":"));
  int id_prod = atoi(strtok(0, ":"));
  int qtd = atoi(strtok(0, ":"));
  if (id_order >= order_counter)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", id_prod, id_order);
    return;
  }
  else
  {
    if (id_prod >= counter)
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", id_prod, id_order);
      return;
    }
    else
    {
      if (qtd > products[id_prod].quantity)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", id_prod, id_order);
        return;
      }
      else
      {
        if ((products[id_prod].weight * qtd) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", id_prod, id_order);
          return;
        }
        else
        {
          
        }

      }

    }

  }

  for (e = 0; e <= orders[id_order].number_product; e++)
  {
    if (strcmp(orders[id_order].product_toorder[e].desc, products[id_prod].desc) == 0)
    {
      if ((orders[id_order].peso + (products[id_prod].weight * qtd)) > 200)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", id_prod, id_order);
        return;
      }
      else
      {
        
      }

      orders[id_order].product_toorder[e].quantity += qtd;
      i += 1;
      break;
    }
    else
    {
      
    }

  }

  if (i == 0)
  {
    if ((orders[id_order].peso + (products[id_prod].weight * qtd)) > 200)
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", id_prod, id_order);
      return;
    }
    else
    {
      
    }

    orders[id_order].product_toorder[orders[id_order].number_product].quantity = qtd;
    strcpy(orders[id_order].product_toorder[orders[id_order].number_product].desc, products[id_prod].desc);
    orders[id_order].product_toorder[orders[id_order].number_product].id = id_prod;
    orders[id_order].product_toorder[orders[id_order].number_product].weight = products[id_prod].weight;
    orders[id_order].product_toorder[orders[id_order].number_product].price = products[id_prod].price;
    orders[id_order].number_product += 1;
  }
  else
  {
    
  }

  orders[id_order].peso += products[id_prod].weight * qtd;
  products[id_prod].quantity -= qtd;
}

void remove_stock(char args[])
{
  int id_prod = atoi(strtok(args, ":"));
  int qtd = atoi(strtok(0, ":"));
  if (id_prod >= counter)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", id_prod);
    return;
  }
  else
  {
    if ((products[id_prod].quantity - qtd) < 0)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, id_prod);
      return;
    }
    else
    {
      
    }

  }

  products[id_prod].quantity -= qtd;
}

void remove_order(char args[])
{
  int id_order = atoi(strtok(args, ":"));
  int id_product = atoi(strtok(0, ":"));
  int e;
  int i;
  if (id_order >= order_counter)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", id_product, id_order);
    return;
  }
  else
  {
    if (id_product >= counter)
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", id_product, id_order);
      return;
    }
    else
    {
      
    }

  }

  for (e = 0; e < orders[id_order].number_product; e++)
  {
    if (id_product == orders[id_order].product_toorder[e].id)
    {
      orders[id_order].peso -= orders[id_order].product_toorder[e].quantity * orders[id_order].product_toorder[e].weight;
      products[id_product].quantity += orders[id_order].product_toorder[e].quantity;
      for (i = e; i <= orders[id_order].number_product; i++)
      {
        orders[id_order].product_toorder[i] = orders[id_order].product_toorder[i + 1];
      }

      orders[id_order].number_product -= 1;
      break;
    }
    else
    {
      
    }

  }

}

void order_cost(char args[])
{
  int id_order = atoi(args);
  int e;
  int price = 0;
  if (id_order >= order_counter)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", id_order);
    return;
  }
  else
  {
    
  }

  for (e = 0; e < orders[id_order].number_product; e++)
  {
    price += orders[id_order].product_toorder[e].quantity * orders[id_order].product_toorder[e].price;
  }

  printf("Custo da encomenda %d %d.\n", id_order, price);
}

void alter_price(char args[])
{
  int id_product = atoi(strtok(args, ":"));
  int price = atoi(strtok(0, ":"));
  int e;
  int i;
  if (id_product >= counter)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", id_product);
    return;
  }
  else
  {
    
  }

  products[id_product].price = price;
  for (e = 0; e < order_counter; e++)
  {
    for (i = 0; i < orders[e].number_product; i++)
    {
      if (id_product == orders[e].product_toorder[i].id)
      {
        orders[e].product_toorder[i].price = price;
        break;
      }
      else
      {
        
      }

    }

  }

}

void discript_order(char args[])
{
  int id_order = atoi(strtok(args, ":"));
  int id_product = atoi(strtok(0, ":"));
  int e;
  if (id_order >= order_counter)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", id_order);
    return;
  }
  else
  {
    if (id_product >= counter)
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", id_product);
      return;
    }
    else
    {
      
    }

  }

  for (e = 0; e < orders[id_order].number_product; e++)
  {
    if (id_product == orders[id_order].product_toorder[e].id)
    {
      printf("%s %d.\n", orders[id_order].product_toorder[e].desc, orders[id_order].product_toorder[e].quantity);
    }
    else
    {
      printf("%s %d.\n", orders[id_order].product_toorder[e].desc, 0);
    }

  }

}

void most_ordered(char args[])
{
  int id_product = atoi(args);
  int e;
  int i;
  int max[2] = {-1, -1};
  int existe = 0;
  if (id_product >= counter)
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", id_product);
    return;
  }
  else
  {
    
  }

  for (e = 0; e < order_counter; e++)
  {
    for (i = 0; i < orders[e].number_product; i++)
    {
      if ((orders[e].product_toorder[i].id == id_product) && (max[1] < orders[e].product_toorder[i].quantity))
      {
        max[0] = e;
        max[1] = orders[e].product_toorder[i].quantity;
        existe += 1;
        break;
      }
      else
      {
        
      }

    }

  }

  if (existe == 0)
  {
    return;
  }
  else
  {
    printf("Maximo produto %d %d %d.\n", id_product, max[0], max[1]);
  }

}

void list_products()
{
  int e;
  int min;
  int tobreak = 0;
  printf("Produtos\n");
  for (min = 0; tobreak != counter; min++)
    for (e = 0; e < counter; e++)
  {
    if (products[e].price == min)
    {
      printf("* %s %d %d\n", products[e].desc, products[e].price, products[e].quantity);
      tobreak++;
    }
    else
    {
      
    }

  }


}

void alpha_order(char args[])
{
  char aux[64];
  int id_order = atoi(args);
  int i;
  int e;
  char all[200][9999];
  if (id_order >= order_counter)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", id_order);
    return;
  }
  else
  {
    
  }

  printf("Encomenda %d\n", id_order);
  for (i = 0; i < orders[id_order].number_product; i++)
  {
    strcpy(all[i], orders[id_order].product_toorder[i].desc);
  }

  for (i = 0; i <= orders[id_order].number_product; i++)
  {
    for (e = i + 1; e <= orders[id_order].number_product; e++)
    {
      if (strcmp(all[i], all[e]) > 0)
      {
        strcpy(aux, all[i]);
        strcpy(all[i], all[e]);
        strcpy(all[e], aux);
      }
      else
      {
        
      }

    }

  }

  for (i = 0; i < orders[id_order].number_product; i++)
  {
    for (e = 0; e < orders[id_order].number_product; e++)
    {
      if (strcmp(all[i], orders[id_order].product_toorder[e].desc))
      {
        printf("* %s %d %d\n", all[i], orders[id_order].product_toorder[e].price, orders[id_order].product_toorder[e].quantity);
        break;
      }
      else
      {
        
      }

    }

  }

}

