/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>


int getId();
int get_Number();
void Novo_Produto();
void Add_Quantidade();
void Nova_Encomenda();
void Add_Produto_Encomenda();
void Remove_Stock();
void Remove_Produto();
void Calcula_Custo();
void Altera_Preco();
void Lista_Um_Produto();
void Encomenda_Com_Mais_Produto();
void Lista_Produtos_Sistema_Preco_Crescente();
void Lista_Produtos_Encomenda_Alfabeticamente();
void mergesort();
void merge();
struct Produto
{
  int Identificador;
  int Preco;
  int Peso;
  int Quantidade_Stock;
  int Quantidade_Encomenda;
  char Descricao[63];
};
struct Encomenda
{
  struct Produto arr_Produto[10000];
  int Peso;
  int Numero_Da_Encomenda;
  int Custo;
};
struct Produto arr_Produto[10000];
struct Encomenda arr_Encomenda[500];
struct Produto arr_Produto2[10000];
struct Produto arr2[10000];
int Id = -1;
int Number = -1;
int Escolhe_Lista = 2;
int idp = 0;
int ide = 0;
int qnt = 0;
int main()
{
  char comando;
  comando = getchar();
  while (comando != 'x')
  {
    switch (comando)
    {
      case 'a':
        Novo_Produto();
        break;

      case 'q':
        Add_Quantidade();
        break;

      case 'N':
        Nova_Encomenda();
        break;

      case 'A':
        Add_Produto_Encomenda();
        break;

      case 'r':
        Remove_Stock();
        break;

      case 'R':
        Remove_Produto();
        break;

      case 'C':
        Calcula_Custo();
        break;

      case 'p':
        Altera_Preco();
        break;

      case 'E':
        Lista_Um_Produto();
        break;

      case 'm':
        Encomenda_Com_Mais_Produto();
        break;

      case 'l':
        Lista_Produtos_Sistema_Preco_Crescente();
        break;

      case 'L':
        Lista_Produtos_Encomenda_Alfabeticamente();
        break;

    }

    comando = getchar();
  }

  return 0;
}

int get_Id()
{
  Id++;
  return Id;
}

int get_Number()
{
  Number++;
  return Number;
}

void Novo_Produto()
{
  Id = get_Id();
  arr_Produto[Id].Identificador = Id;
  for (int arr_Produto_index = 0; arr_Produto_index < 10; arr_Produto_index++)
  {
    arr_Produto[Id].Descricao[arr_Produto_index] = new_sym_var(sizeof(char) * 8);
  }

  arr_Produto[Id].Descricao[10 - 1] = '\0';
  arr_Produto[Id].Preco = new_sym_var(sizeof(int) * 8);
  arr_Produto[Id].Peso = new_sym_var(sizeof(int) * 8);
  arr_Produto[Id].Quantidade_Stock = new_sym_var(sizeof(int) * 8);
  printf("Novo produto %d.\n", arr_Produto[Id].Identificador);
}

void Add_Quantidade()
{
  idp = new_sym_var(sizeof(int) * 8);
  qnt = new_sym_var(sizeof(int) * 8);
  if (arr_Produto[idp].Peso > 0)
  {
    arr_Produto[idp].Quantidade_Stock += qnt;
  }
  else
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
  }

}

void Nova_Encomenda()
{
  Number = get_Number();
  arr_Encomenda[Number].Numero_Da_Encomenda = Number;
  printf("Nova encomenda %d.\n", Number);
}

void Add_Produto_Encomenda()
{
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  qnt = new_sym_var(sizeof(int) * 8);
  if (ide > Number)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (idp > Id)
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      if (qnt > arr_Produto[idp].Quantidade_Stock)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
      }
      else
      {
        if ((arr_Encomenda[ide].Peso + (arr_Produto[idp].Peso * qnt)) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
        }
        else
        {
          arr_Produto[idp].Quantidade_Stock -= qnt;
          arr_Encomenda[ide].arr_Produto[idp].Quantidade_Encomenda += qnt;
          arr_Encomenda[ide].Peso += arr_Produto[idp].Peso * qnt;
          arr_Encomenda[ide].Custo += arr_Produto[idp].Preco * qnt;
          arr_Encomenda[ide].arr_Produto[idp].Preco = arr_Produto[idp].Preco;
          arr_Encomenda[ide].arr_Produto[idp].Peso = arr_Produto[idp].Peso;
          strcpy(arr_Encomenda[ide].arr_Produto[idp].Descricao, arr_Produto[idp].Descricao);
        }

      }

    }

  }

}

void Remove_Stock()
{
  idp = new_sym_var(sizeof(int) * 8);
  qnt = new_sym_var(sizeof(int) * 8);
  if (idp > Id)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    if (qnt > arr_Produto[idp].Quantidade_Stock)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qnt, idp);
    }
    else
    {
      arr_Produto[idp].Quantidade_Stock -= qnt;
    }

  }

}

void Remove_Produto()
{
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (ide > Number)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }
  else
  {
    if (idp > Id)
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }
    else
    {
      arr_Encomenda[ide].Custo -= arr_Encomenda[ide].arr_Produto[idp].Quantidade_Encomenda * arr_Produto[idp].Preco;
      arr_Encomenda[ide].Peso -= arr_Encomenda[ide].arr_Produto[idp].Quantidade_Encomenda * arr_Produto[idp].Peso;
      arr_Produto[idp].Quantidade_Stock += arr_Encomenda[ide].arr_Produto[idp].Quantidade_Encomenda;
      arr_Encomenda[ide].arr_Produto[idp].Quantidade_Encomenda = 0;
    }

  }

}

void Calcula_Custo()
{
  ide = new_sym_var(sizeof(int) * 8);
  if (ide > Number)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    printf("Custo da encomenda %d %d.\n", ide, arr_Encomenda[ide].Custo);
  }

}

void Altera_Preco()
{
  int Novo_Preco;
  idp = new_sym_var(sizeof(int) * 8);
  Novo_Preco = new_sym_var(sizeof(int) * 8);
  if (idp > Id)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    for (ide = 0; ide <= Number; ide++)
    {
      if (arr_Encomenda[ide].arr_Produto[idp].Quantidade_Encomenda != 0)
      {
        arr_Encomenda[ide].Custo -= arr_Produto[idp].Preco * arr_Encomenda[ide].arr_Produto[idp].Quantidade_Encomenda;
        arr_Encomenda[ide].Custo += Novo_Preco * arr_Encomenda[ide].arr_Produto[idp].Quantidade_Encomenda;
        arr_Encomenda[ide].arr_Produto[idp].Preco = Novo_Preco;
      }
      else
      {
        
      }

    }

    arr_Produto[idp].Preco = Novo_Preco;
  }

}

void Lista_Um_Produto()
{
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (ide > Number)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    if (idp > Id)
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
    }
    else
    {
      printf("%s %d.\n", arr_Produto[idp].Descricao, arr_Encomenda[ide].arr_Produto[idp].Quantidade_Encomenda);
    }

  }

}

void Encomenda_Com_Mais_Produto()
{
  int ide_resposta;
  idp = new_sym_var(sizeof(int) * 8);
  if (idp > Id)
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
  }
  else
  {
    qnt = 0;
    for (ide = 0; ide <= Number; ide++)
    {
      if (arr_Encomenda[ide].arr_Produto[idp].Quantidade_Encomenda > qnt)
      {
        qnt = arr_Encomenda[ide].arr_Produto[idp].Quantidade_Encomenda;
        ide_resposta = ide;
      }
      else
      {
        
      }

    }

    if (qnt > 0)
    {
      printf("Maximo produto %d %d %d.\n", idp, ide_resposta, qnt);
    }
    else
    {
      
    }

  }

}

void Lista_Produtos_Sistema_Preco_Crescente()
{
  int contador = 0;
  int idp2 = 0;
  Escolhe_Lista = 0;
  for (idp = 0; idp <= Id; idp++)
  {
    if (arr_Produto[idp].Peso != 0)
    {
      arr_Produto2[idp2] = arr_Produto[idp];
      idp2++;
    }
    else
    {
      contador++;
    }

  }

  mergesort(arr_Produto2, 0, Id - contador);
  printf("Produtos\n");
  for (idp = 0; idp <= (Id - contador); idp++)
  {
    printf("* %s %d %d\n", arr_Produto2[idp].Descricao, arr_Produto2[idp].Preco, arr_Produto2[idp].Quantidade_Stock);
  }

}

void Lista_Produtos_Encomenda_Alfabeticamente()
{
  int contador = 0;
  int idp2 = 0;
  Escolhe_Lista = 1;
  ide = new_sym_var(sizeof(int) * 8);
  if (ide > Number)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    for (idp = 0; idp <= Id; idp++)
    {
      if (arr_Encomenda[ide].arr_Produto[idp].Quantidade_Encomenda != 0)
      {
        arr_Produto2[idp2] = arr_Encomenda[ide].arr_Produto[idp];
        idp2++;
      }
      else
      {
        contador++;
      }

    }

    mergesort(arr_Produto2, 0, Id - contador);
    printf("Encomenda %d\n", ide);
    for (idp = 0; idp <= (Id - contador); idp++)
    {
      printf("* %s %d %d\n", arr_Produto2[idp].Descricao, arr_Produto2[idp].Preco, arr_Produto2[idp].Quantidade_Encomenda);
    }

  }

}

void mergesort(struct Produto arr[], int l, int r)
{
  int meio = (r + l) / 2;
  if (r <= l)
  {
    return;
  }
  else
  {
    
  }

  mergesort(arr, l, meio);
  mergesort(arr, meio + 1, r);
  merge(arr, l, meio, r);
}

void merge(struct Produto arr[], int l, int m, int r)
{
  int i;
  int j;
  int k;
  for (i = m + 1; i > l; i--)
  {
    arr2[i - 1] = arr[i - 1];
  }

  for (j = m; j < r; j++)
  {
    arr2[(r + m) - j] = arr[j + 1];
  }

  for (k = l; k <= r; k++)
  {
    if (Escolhe_Lista == 0)
    {
      if (arr2[j].Preco < arr2[i].Preco)
      {
        arr[k] = arr2[j--];
      }
      else
      {
        if ((arr2[j].Preco == arr2[i].Preco) && (arr2[j].Identificador < arr2[i].Identificador))
        {
          arr[k] = arr2[j--];
        }
        else
        {
          arr[k] = arr2[i++];
        }

      }

    }
    else
    {
      if (Escolhe_Lista == 1)
      {
        if (strcmp(arr2[j].Descricao, arr2[i].Descricao) < 0)
        {
          arr[k] = arr2[j--];
        }
        else
        {
          arr[k] = arr2[i++];
        }

      }
      else
      {
        
      }

    }

  }

}

