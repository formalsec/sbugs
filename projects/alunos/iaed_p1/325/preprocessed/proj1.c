#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>


struct prod
{
  int id;
  int peso;
  int preco;
  int qtd;
  char desc[64];
};
struct enc
{
  struct prod prod_enc[10000];
  int peso_g;
  int cont_produtos;
};
struct enc encomendas[500];
void alphasort(char nomes[10000][64], int count)
{
  int i;
  int j;
  char temp[64];
  count--;
  for (i = 0; i <= count; i++)
  {
    for (j = i + 1; j <= count; j++)
    {
      if (strcmp(nomes[i], nomes[j]) > 0)
      {
        strcpy(temp, nomes[i]);
        strcpy(nomes[i], nomes[j]);
        strcpy(nomes[j], temp);
      }
      else
      {
        
      }

    }

  }

}

void mergesort(int A[], int temp[], int left, int right, struct prod produtos[10000])
{
  int mid = (left + right) / 2;
  int i;
  int curr;
  int i1 = left;
  int i2 = mid + 1;
  if (left == right)
  {
    return;
  }
  else
  {
    
  }

  mergesort(A, temp, left, mid, produtos);
  mergesort(A, temp, mid + 1, right, produtos);
  for (i = left; i <= right; i++)
    temp[i] = A[i];

  for (curr = left; curr <= right; curr++)
  {
    if (i1 == (mid + 1))
    {
      A[curr] = temp[i2++];
    }
    else
    {
      if (i2 > right)
      {
        A[curr] = temp[i1++];
      }
      else
      {
        if (produtos[temp[i1]].preco <= produtos[temp[i2]].preco)
        {
          A[curr] = temp[i1++];
        }
        else
        {
          A[curr] = temp[i2++];
        }

      }

    }

  }

}

void a(int iden_atual, struct prod produtos[10000])
{
  int i = 0;
  int prec;
  int peso;
  int qtd;
  char desc[64];
  char c;
  getchar();
  while ((c = getchar()) != ':')
  {
    desc[i] = c;
    i++;
  }

  desc[i] = '\0';
  prec = new_sym_var(sizeof(int) * 8);
  peso = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  strcpy(produtos[iden_atual].desc, desc);
  produtos[iden_atual].preco = prec;
  produtos[iden_atual].peso = peso;
  produtos[iden_atual].qtd = qtd;
  produtos[iden_atual].id = iden_atual;
  printf("Novo produto %d.\n", iden_atual);
}

void q(int iden_atual, struct prod produtos[10000])
{
  int id;
  int stck_add;
  getchar();
  id = new_sym_var(sizeof(int) * 8);
  stck_add = new_sym_var(sizeof(int) * 8);
  if (id >= iden_atual)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", id);
  }
  else
  {
    produtos[id].qtd += stck_add;
  }

}

void r(int iden_atual, struct prod produtos[10000])
{
  int id;
  int stck_rem;
  getchar();
  id = new_sym_var(sizeof(int) * 8);
  stck_rem = new_sym_var(sizeof(int) * 8);
  if (id >= iden_atual)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", id);
  }
  else
  {
    if ((produtos[id].qtd - stck_rem) < 0)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", stck_rem, id);
    }
    else
    {
      produtos[id].qtd -= stck_rem;
    }

  }

}

void p(int enc_atual, int iden_atual, struct prod produtos[10000], struct enc encomendas[500])
{
  int id;
  int n_prec;
  int e = 0;
  int i = 0;
  getchar();
  id = new_sym_var(sizeof(int) * 8);
  n_prec = new_sym_var(sizeof(int) * 8);
  if (id >= iden_atual)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", id);
  }
  else
  {
    produtos[id].preco = n_prec;
    while (e < enc_atual)
    {
      i = 0;
      while (i < encomendas[e].cont_produtos)
      {
        if (strcmp(encomendas[e].prod_enc[i].desc, produtos[id].desc) == 0)
        {
          encomendas[e].prod_enc[i].preco = n_prec;
        }
        else
        {
          
        }

        i++;
      }

      e++;
    }

  }

}

void N(int enc_atual)
{
  printf("Nova encomenda %d.\n", enc_atual);
}

void A(int enc_atual, int iden_atual, struct prod produtos[10000], struct enc encomendas[500])
{
  int ide;
  int id;
  int qtd;
  int i = -1;
  int a = 0;
  getchar();
  ide = new_sym_var(sizeof(int) * 8);
  id = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (ide >= enc_atual)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", id, ide);
  }
  else
  {
    if (id >= iden_atual)
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", id, ide);
    }
    else
    {
      if ((produtos[id].qtd - qtd) < 0)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", id, ide);
      }
      else
      {
        if ((encomendas[ide].peso_g + (produtos[id].peso * qtd)) > 200)
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", id, ide);
        }
        else
        {
          while (i < encomendas[ide].cont_produtos)
          {
            i++;
            if (strcmp(encomendas[ide].prod_enc[i].desc, produtos[id].desc) == 0)
            {
              a = 1;
              break;
            }
            else
            {
              
            }

          }

          if (a == 1)
          {
            encomendas[ide].prod_enc[i].qtd += qtd;
            produtos[id].qtd -= qtd;
            encomendas[ide].peso_g += produtos[id].peso * qtd;
          }
          else
          {
            encomendas[ide].prod_enc[encomendas[ide].cont_produtos].peso = produtos[id].peso;
            encomendas[ide].prod_enc[encomendas[ide].cont_produtos].preco = produtos[id].preco;
            encomendas[ide].prod_enc[encomendas[ide].cont_produtos].qtd = qtd;
            strcpy(encomendas[ide].prod_enc[encomendas[ide].cont_produtos].desc, produtos[id].desc);
            produtos[id].qtd -= qtd;
            encomendas[ide].peso_g += produtos[id].peso * qtd;
            encomendas[ide].cont_produtos++;
          }

        }

      }

    }

  }

}

void R(int enc_atual, int iden_atual, struct prod produtos[10000], struct enc encomendas[500])
{
  int ide;
  int i = -1;
  int id;
  getchar();
  ide = new_sym_var(sizeof(int) * 8);
  id = new_sym_var(sizeof(int) * 8);
  if (ide >= enc_atual)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", id, ide);
  }
  else
  {
    if (id >= iden_atual)
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", id, ide);
    }
    else
    {
      while (i < encomendas[ide].cont_produtos)
      {
        i++;
        if (strcmp(encomendas[ide].prod_enc[i].desc, produtos[id].desc) == 0)
        {
          break;
        }
        else
        {
          
        }

      }

      produtos[id].qtd += encomendas[ide].prod_enc[i].qtd;
      encomendas[ide].peso_g -= produtos[id].peso * encomendas[ide].prod_enc[i].qtd;
      encomendas[ide].prod_enc[i].qtd = 0;
    }

  }

}

void C(int enc_atual, struct enc encomendas[500])
{
  int custo = 0;
  int ide;
  int i = 0;
  getchar();
  ide = new_sym_var(sizeof(int) * 8);
  if (ide >= enc_atual)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    while (i < encomendas[ide].cont_produtos)
    {
      custo += encomendas[ide].prod_enc[i].preco * encomendas[ide].prod_enc[i].qtd;
      i++;
    }

    printf("Custo da encomenda %d %d.\n", ide, custo);
  }

}

void E(int enc_atual, int iden_atual, struct prod produtos[10000], struct enc encomendas[500])
{
  int ide;
  int i = -1;
  int id;
  int a = 0;
  getchar();
  ide = new_sym_var(sizeof(int) * 8);
  id = new_sym_var(sizeof(int) * 8);
  if (ide >= enc_atual)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    if (id >= iden_atual)
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", id);
    }
    else
    {
      while (i < encomendas[ide].cont_produtos)
      {
        i++;
        if (strcmp(encomendas[ide].prod_enc[i].desc, produtos[id].desc) == 0)
        {
          a = 1;
          break;
        }
        else
        {
          
        }

      }

      if (a == 1)
      {
        printf("%s %d.\n", produtos[id].desc, encomendas[ide].prod_enc[i].qtd);
      }
      else
      {
        printf("%s 0.\n", produtos[id].desc);
      }

    }

  }

}

void m(int enc_atual, int iden_atual, struct prod produtos[10000], struct enc encomendas[500])
{
  int ide_max = -1;
  int qnt_max = -1;
  int e = 0;
  int i = 0;
  int id;
  getchar();
  id = new_sym_var(sizeof(int) * 8);
  if (id >= iden_atual)
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", id);
  }
  else
  {
    while (e < enc_atual)
    {
      i = 0;
      while (i < encomendas[e].cont_produtos)
      {
        if (strcmp(encomendas[e].prod_enc[i].desc, produtos[id].desc) == 0)
        {
          if (encomendas[e].prod_enc[i].qtd > qnt_max)
          {
            ide_max = e;
            qnt_max = encomendas[e].prod_enc[i].qtd;
          }
          else
          {
            
          }

          break;
        }
        else
        {
          
        }

        i++;
      }

      e++;
    }

    if ((ide_max != (-1)) && (qnt_max > 0))
    {
      printf("Maximo produto %d %d %d.\n", id, ide_max, qnt_max);
    }
    else
    {
      
    }

  }

}

void l(int iden_atual, struct prod produtos[10000])
{
  int id[10000];
  int temp[10000];
  int i = 0;
  int x = 0;
  if (iden_atual > 0)
  {
    while (i < iden_atual)
    {
      id[i] = produtos[i].id;
      i++;
    }

    mergesort(id, temp, 0, iden_atual - 1, produtos);
    printf("Produtos\n");
    while (x < iden_atual)
    {
      printf("* %s %d %d\n", produtos[id[x]].desc, produtos[id[x]].preco, produtos[id[x]].qtd);
      x++;
    }

  }
  else
  {
    printf("Produtos\n");
  }

}

void L(int enc_atual, struct enc encomendas[500])
{
  char nomes[10000][64];
  int x = 0;
  int i = 0;
  int ide;
  int count = 0;
  getchar();
  ide = new_sym_var(sizeof(int) * 8);
  if (ide >= enc_atual)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }
  else
  {
    if (encomendas[ide].cont_produtos == 0)
    {
      printf("Encomenda %d\n", ide);
    }
    else
    {
      while (i < encomendas[ide].cont_produtos)
      {
        strcpy(nomes[i], encomendas[ide].prod_enc[i].desc);
        i++;
      }

      count = encomendas[ide].cont_produtos;
      alphasort(nomes, count);
      printf("Encomenda %d\n", ide);
      while (x < count)
      {
        i = 0;
        while (i < encomendas[ide].cont_produtos)
        {
          if ((strcmp(encomendas[ide].prod_enc[i].desc, nomes[x]) == 0) && (encomendas[ide].prod_enc[i].qtd > 0))
          {
            printf("* %s %d %d\n", nomes[x], encomendas[ide].prod_enc[i].preco, encomendas[ide].prod_enc[i].qtd);
          }
          else
          {
            
          }

          i++;
        }

        x++;
      }

    }

  }

}

int main()
{
  struct prod produtos[10000];
  char cmd;
  int iden_atual = 0;
  int enc_atual = 0;
  while ((cmd = getchar()) != 'x')
  {
    if (cmd == 'a')
    {
      a(iden_atual, produtos);
      iden_atual++;
    }
    else
    {
      if (cmd == 'q')
      {
        q(iden_atual, produtos);
      }
      else
      {
        if (cmd == 'r')
        {
          r(iden_atual, produtos);
        }
        else
        {
          if (cmd == 'N')
          {
            N(enc_atual);
            enc_atual++;
          }
          else
          {
            if (cmd == 'A')
            {
              A(enc_atual, iden_atual, produtos, encomendas);
            }
            else
            {
              if (cmd == 'R')
              {
                R(enc_atual, iden_atual, produtos, encomendas);
              }
              else
              {
                if (cmd == 'C')
                {
                  C(enc_atual, encomendas);
                }
                else
                {
                  if (cmd == 'p')
                  {
                    p(enc_atual, iden_atual, produtos, encomendas);
                  }
                  else
                  {
                    if (cmd == 'E')
                    {
                      E(enc_atual, iden_atual, produtos, encomendas);
                    }
                    else
                    {
                      if (cmd == 'm')
                      {
                        m(enc_atual, iden_atual, produtos, encomendas);
                      }
                      else
                      {
                        if (cmd == 'l')
                        {
                          l(iden_atual, produtos);
                        }
                        else
                        {
                          if (cmd == 'L')
                          {
                            L(enc_atual, encomendas);
                          }
                          else
                          {
                            continue;
                          }

                        }

                      }

                    }

                  }

                }

              }

            }

          }

        }

      }

    }

  }

  return 0;
}

