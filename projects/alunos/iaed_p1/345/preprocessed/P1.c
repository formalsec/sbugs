#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>            /* Biblioteca de Inputs e Outputs  */
#include <string.h>           /* Biblioteca de manipulacao de Strings  */
#include <stdlib.h>           /* Biblioteca de utilidade (atoi())  */                  


char descricao[10000][64];
char dados[80];
int np = 0;
int stock[10000][3];
int encomendas[500][201][3];
void Merge(int a[], int l, int m, int r)
{
  int i;
  int j;
  int k;
  int aux[10000];
  for (i = m + 1; i > l; i--)
  {
    aux[i - 1] = a[i - 1];
  }

  for (j = m; j < r; j++)
  {
    aux[(r + m) - j] = a[j + 1];
  }

  for (k = l; k <= r; k++)
  {
    if (aux[j] < aux[i])
    {
      a[k] = aux[j--];
    }
    else
    {
      a[k] = aux[i++];
    }

  }

}

void MergeSort(int a[], int l, int r)
{
  int m = (l + r) / 2;
  if (r <= l)
  {
    return;
  }
  else
  {
    
  }

  MergeSort(a, l, m);
  MergeSort(a, m + 1, r);
  Merge(a, l, m, r);
}

void OrdenarDes(char a[][64], int l, int r)
{
  char temp[64];
  int i;
  int j;
  for (i = l; i < (r - 1); i++)
  {
    for (j = i + 1; j < r; j++)
    {
      if (strcmp(a[i], a[j]) > 0)
      {
        strcpy(temp, a[i]);
        strcpy(a[i], a[j]);
        strcpy(a[j], temp);
      }
      else
      {
        
      }

    }

  }

}

void AdicionarSistema()
{
  strcpy(descricao[np], strtok(dados, ":"));
  stock[np][0] = atoi(strtok(0, ":"));
  stock[np][1] = atoi(strtok(0, ":"));
  stock[np][2] = atoi(strtok(0, ":"));
  printf("Novo produto %d.\n", np);
  np++;
}

void AdicionaStock()
{
  int idp;
  int qtd;
  idp = atoi(strtok(dados, ":"));
  qtd = atoi(strtok(0, ":"));
  if (idp >= np)
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", idp);
    return;
  }
  else
  {
    
  }

  stock[idp][2] = stock[idp][2] + qtd;
}

void CriarEncomenda()
{
  static int ide = 0;
  encomendas[ide][0][0] = 1;
  encomendas[ide][0][1] = 0;
  encomendas[ide][0][2] = 0;
  printf("Nova encomenda %d.\n", ide);
  ide++;
}

void AdicionarProdutoEncomenda()
{
  int ide;
  int idp;
  int qtd;
  int a;
  ide = atoi(strtok(dados, ":"));
  idp = atoi(strtok(0, ":"));
  qtd = atoi(strtok(0, ":"));
  if (encomendas[ide][0][0] != 1)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
    return;
  }
  else
  {
    
  }

  if (idp >= np)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    return;
  }
  else
  {
    
  }

  if (stock[idp][2] < qtd)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
    return;
  }
  else
  {
    
  }

  if ((encomendas[ide][0][1] + (stock[idp][1] * qtd)) > 200)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
    return;
  }
  else
  {
    
  }

  for (a = 1; encomendas[ide][a][1] != 0; a++)
  {
    if (encomendas[ide][a][0] == idp)
    {
      encomendas[ide][0][2] = encomendas[ide][0][2] - 1;
      break;
    }
    else
    {
      
    }

  }

  encomendas[ide][a][0] = idp;
  encomendas[ide][a][1] = encomendas[ide][a][1] + qtd;
  encomendas[ide][a][2] = encomendas[ide][a][2] + (stock[idp][0] * qtd);
  stock[idp][2] = stock[idp][2] - qtd;
  encomendas[ide][0][1] = encomendas[ide][0][1] + (stock[idp][1] * qtd);
  encomendas[ide][0][2] = encomendas[ide][0][2] + 1;
}

void RemoveStock()
{
  int idp;
  int qtd;
  idp = atoi(strtok(dados, ":"));
  qtd = atoi(strtok(0, ":"));
  if (idp >= np)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
    return;
  }
  else
  {
    
  }

  if (stock[idp][2] < qtd)
  {
    printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, idp);
    return;
  }
  else
  {
    
  }

  stock[idp][2] = stock[idp][2] - qtd;
}

void RemoveProdutoEncomenda()
{
  int ide;
  int idp;
  int a;
  ide = atoi(strtok(dados, ":"));
  idp = atoi(strtok(0, ":"));
  if (encomendas[ide][0][0] != 1)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
    return;
  }
  else
  {
    
  }

  if (idp >= np)
  {
    printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    return;
  }
  else
  {
    
  }

  for (a = 1; encomendas[ide][a][2] != 0; a++)
  {
    if (encomendas[ide][a][0] == idp)
    {
      encomendas[ide][0][1] = encomendas[ide][0][1] - (stock[idp][1] * encomendas[ide][a][1]);
      stock[idp][2] = stock[idp][2] + encomendas[ide][a][1];
      while (a <= encomendas[ide][0][2])
      {
        encomendas[ide][a][0] = encomendas[ide][a + 1][0];
        encomendas[ide][a][1] = encomendas[ide][a + 1][1];
        encomendas[ide][a][2] = encomendas[ide][a + 1][2];
        a++;
      }

      encomendas[ide][0][2] = encomendas[ide][0][2] - 1;
      break;
    }
    else
    {
      
    }

  }

}

void CustoEncomenda()
{
  int ide;
  int total = 0;
  int a;
  ide = atoi(dados);
  if (encomendas[ide][0][0] != 1)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
    return;
  }
  else
  {
    
  }

  for (a = 1; a <= encomendas[ide][0][2]; a++)
  {
    total = total + encomendas[ide][a][2];
  }

  printf("Custo da encomenda %d %d.\n", ide, total);
}

void AlterarPreco()
{
  int idp;
  int preco;
  int ide;
  int a;
  idp = atoi(strtok(dados, ":"));
  preco = atoi(strtok(0, ":"));
  if (idp >= np)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
    return;
  }
  else
  {
    
  }

  stock[idp][0] = preco;
  for (ide = 0; encomendas[ide][0][0] == 1; ide++)
  {
    for (a = 1; a <= encomendas[ide][0][2]; a++)
    {
      if (encomendas[ide][a][0] == idp)
      {
        encomendas[ide][a][2] = preco * encomendas[ide][a][1];
        break;
      }
      else
      {
        
      }

    }

  }

}

void DeQdoProdutonaEncomenda()
{
  int idp;
  int ide;
  int a;
  int qtd = 0;
  ide = atoi(strtok(dados, ":"));
  idp = atoi(strtok(0, ":"));
  if (encomendas[ide][0][0] != 1)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
    return;
  }
  else
  {
    
  }

  if (idp >= np)
  {
    printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
    return;
  }
  else
  {
    
  }

  for (a = 1; a <= encomendas[ide][0][2]; a++)
  {
    if (encomendas[ide][a][0] == idp)
    {
      qtd = encomendas[ide][a][1];
      break;
    }
    else
    {
      
    }

  }

  printf("%s %d.\n", descricao[idp], qtd);
}

void EncomendaOndeApareceMais()
{
  int idp;
  int a;
  int ide;
  int e;
  int qtd = 0;
  idp = atoi(dados);
  if (idp >= np)
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
    return;
  }
  else
  {
    
  }

  for (ide = 0; encomendas[ide][0][0] == 1; ide++)
  {
    for (a = 1; a <= encomendas[ide][0][2]; a++)
    {
      if (encomendas[ide][a][0] == idp)
      {
        if (encomendas[ide][a][1] > qtd)
        {
          e = ide;
          qtd = encomendas[e][a][1];
        }
        else
        {
          
        }

      }
      else
      {
        
      }

    }

  }

  if (qtd != 0)
  {
    printf("Maximo produto %d %d %d.\n", idp, e, qtd);
  }
  else
  {
    
  }

}

void ProdutosDoMaisBaratoParaOMaisCaro()
{
  int precos[10000];
  int a;
  int c = 0;
  for (a = 0; a < np; a++)
  {
    precos[a] = stock[a][0];
  }

  MergeSort(precos, 0, np - 1);
  printf("Produtos\n");
  while (c < np)
  {
    for (a = 0; a < np; a++)
    {
      if (precos[c] == stock[a][0])
      {
        printf("* %s %d %d\n", descricao[a], stock[a][0], stock[a][2]);
        c++;
        if (precos[c - 1] != precos[c])
        {
          break;
        }
        else
        {
          
        }

      }
      else
      {
        
      }

    }

  }

}

void ProdutosDaEncomendaPorOrdemAlfabetica()
{
  int idp;
  int ide;
  int a;
  int i;
  char des[201][64];
  ide = atoi(dados);
  if (encomendas[ide][0][0] != 1)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
    return;
  }
  else
  {
    
  }

  for (i = 1; i <= encomendas[ide][0][2]; i++)
  {
    idp = encomendas[ide][i][0];
    strcpy(des[i - 1], descricao[idp]);
  }

  OrdenarDes(des, 0, encomendas[ide][0][2]);
  printf("Encomenda %d\n", ide);
  for (i = 0; i < encomendas[ide][0][2]; i++)
  {
    for (idp = 0; strcmp(des[i], descricao[idp]) != 0; idp++)
    {
    }

    for (a = 1; idp != encomendas[ide][a][0]; a++)
    {
    }

    printf("* %s %d %d\n", descricao[idp], stock[idp][0], encomendas[ide][a][1]);
  }

}

int main()
{
  char c;
  while (1)
  {
    fgets(dados, 80, stdin);
    c = dados[0];
    memmove(dados, dados + 2, 78);
    switch (c)
    {
      case 'a':
        AdicionarSistema();
        break;

      case 'q':
        AdicionaStock();
        break;

      case 'N':
        CriarEncomenda();
        break;

      case 'A':
        AdicionarProdutoEncomenda();
        break;

      case 'r':
        RemoveStock();
        break;

      case 'R':
        RemoveProdutoEncomenda();
        break;

      case 'C':
        CustoEncomenda();
        break;

      case 'p':
        AlterarPreco();
        break;

      case 'E':
        DeQdoProdutonaEncomenda();
        break;

      case 'm':
        EncomendaOndeApareceMais();
        break;

      case 'l':
        ProdutosDoMaisBaratoParaOMaisCaro();
        break;

      case 'L':
        ProdutosDaEncomendaPorOrdemAlfabetica();
        break;

      case 'x':
        return 0;

    }

  }

}

