#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "projeto.h"


int main()
{
  encomendas new_encm[500];
  product prod[10000];
  char c;
  int idp = 0;
  int num_encomendas = 0;
  inicializa_enc(new_encm);
  inicializa_prod(prod);
  while ((c = getchar()) != 'x')
  {
    switch (c)
    {
      case 'a':
        a_comando(prod, idp);
        idp++;
        break;

      case 'q':
        q_comando(prod);
        break;

      case 'N':
        N_comando(new_encm, num_encomendas);
        num_encomendas++;
        break;

      case 'A':
        A_comando(new_encm, prod);
        break;

      case 'r':
        r_comando(prod);
        break;

      case 'R':
        R_comando(prod, new_encm);
        break;

      case 'C':
        C_comando(prod, new_encm, idp);
        break;

      case 'p':
        p_comando(prod);
        break;

      case 'E':
        E_comando(prod, new_encm);
        break;

      case 'm':
        m_comando(prod, new_encm, num_encomendas);
        break;

      case 'l':
        l_comando(prod, 0, idp);
        break;

      case 'L':
        L_comando(new_encm, prod, idp);
        break;

    }

  }

  return 0;
}

void a_comando(product prod[], int idp)
{
  prod[idp].idp = idp;
  for (int prod_index = 0; prod_index < 10; prod_index++)
  {
    prod[idp].descricao[prod_index] = new_sym_var(sizeof(char) * 8);
  }

  prod[idp].descricao[10 - 1] = '\0';
  prod[idp].preco = new_sym_var(sizeof(int) * 8);
  prod[idp].peso = new_sym_var(sizeof(int) * 8);
  prod[idp].qtd = new_sym_var(sizeof(int) * 8);
  printf("Novo produto %d.\n", idp);
}

void q_comando(product prod[])
{
  int identf;
  int quant;
  identf = new_sym_var(sizeof(int) * 8);
  quant = new_sym_var(sizeof(int) * 8);
  if (verifica_prod(prod, identf) == 1)
  {
    prod[identf].qtd += quant;
  }
  else
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", identf);
  }

}

void N_comando(encomendas new_encm[], int num_encomendas)
{
  new_encm[num_encomendas].ide = num_encomendas;
  printf("Nova encomenda %d.\n", num_encomendas);
}

void A_comando(encomendas new_encm[], product prod[])
{
  int ide;
  int idp;
  int qtd;
  int verif = 0;
  int a;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (verifica_enc(new_encm, ide) == 1)
  {
    if (verifica_prod(prod, idp) == 1)
    {
      if (prod[idp].qtd >= qtd)
      {
        if ((new_encm[ide].peso_total + (prod[idp].peso * qtd)) <= 200)
        {
          new_encm[ide].peso_total += prod[idp].peso * qtd;
          for (a = 0; a < new_encm[ide].num_pedidos; a++)
          {
            if (new_encm[ide].pedidos[a].idp == idp)
            {
              new_encm[ide].pedidos[a].qntd += qtd;
              verif = 1;
              break;
            }
            else
            {
              
            }

          }

          if (verif == 0)
          {
            new_encm[ide].pedidos[new_encm[ide].num_pedidos].idp = idp;
            new_encm[ide].pedidos[new_encm[ide].num_pedidos].qntd = qtd;
            new_encm[ide].num_pedidos++;
          }
          else
          {
            
          }

          prod[idp].qtd -= qtd;
        }
        else
        {
          printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", idp, ide);
        }

      }
      else
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", idp, ide);
      }

    }
    else
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }

  }
  else
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }

}

void r_comando(product prod[])
{
  int idp;
  int qtd;
  idp = new_sym_var(sizeof(int) * 8);
  qtd = new_sym_var(sizeof(int) * 8);
  if (verifica_prod(prod, idp) == 1)
  {
    if ((prod[idp].qtd - qtd) >= 0)
    {
      prod[idp].qtd = prod[idp].qtd - qtd;
    }
    else
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", qtd, idp);
    }

  }
  else
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", idp);
  }

}

void R_comando(product prod[], encomendas new_encm[])
{
  int ide;
  int idp;
  int a;
  int i;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (verifica_enc(new_encm, ide) == 1)
  {
    if (verifica_prod(prod, idp) == 1)
    {
      for (a = 0; a < new_encm[ide].num_pedidos; a++)
      {
        if (new_encm[ide].pedidos[a].idp == idp)
        {
          new_encm[ide].peso_total -= prod[idp].peso * new_encm[ide].pedidos[a].qntd;
          prod[idp].qtd += new_encm[ide].pedidos[a].qntd;
          for (i = a; i < new_encm[ide].num_pedidos; i++)
          {
            if (i != (new_encm[ide].num_pedidos - 1))
            {
              new_encm[ide].pedidos[i].idp = new_encm[ide].pedidos[i + 1].idp;
              new_encm[ide].pedidos[i].qntd = new_encm[ide].pedidos[i + 1].qntd;
            }
            else
            {
              new_encm[ide].pedidos[i].idp = -1;
              new_encm[ide].pedidos[i].qntd = 0;
            }

          }

          new_encm[ide].num_pedidos--;
          break;
        }
        else
        {
          
        }

      }

    }
    else
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", idp, ide);
    }

  }
  else
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", idp, ide);
  }

}

void C_comando(product prod[], encomendas new_encm[], int idp)
{
  int ide;
  int total = 0;
  int i;
  int a;
  ide = new_sym_var(sizeof(int) * 8);
  if (verifica_enc(new_encm, ide) == 1)
  {
    if (new_encm[ide].num_pedidos > 0)
    {
      for (i = 0; i < idp; i++)
      {
        for (a = 0; a < new_encm[ide].num_pedidos; a++)
        {
          if (new_encm[ide].pedidos[a].idp == prod[i].idp)
          {
            total += new_encm[ide].pedidos[a].qntd * prod[i].preco;
            break;
          }
          else
          {
            
          }

        }

      }

      printf("Custo da encomenda %d %d.\n", ide, total);
    }
    else
    {
      printf("Custo da encomenda %d %d.\n", ide, total);
    }

  }
  else
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", ide);
  }

}

void p_comando(product prod[])
{
  int idp;
  int preco;
  idp = new_sym_var(sizeof(int) * 8);
  preco = new_sym_var(sizeof(int) * 8);
  if (verifica_prod(prod, idp) == 1)
  {
    prod[idp].preco = preco;
  }
  else
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", idp);
  }

}

void E_comando(product prod[], encomendas new_encm[])
{
  int ide;
  int idp;
  int a;
  int verif = 0;
  ide = new_sym_var(sizeof(int) * 8);
  idp = new_sym_var(sizeof(int) * 8);
  if (verifica_enc(new_encm, ide) == 1)
  {
    if (verifica_prod(prod, idp) == 1)
    {
      for (a = 0; a < new_encm[ide].num_pedidos; a++)
      {
        if (new_encm[ide].pedidos[a].idp == idp)
        {
          printf("%s %d.\n", prod[idp].descricao, new_encm[ide].pedidos[a].qntd);
          verif = 1;
          break;
        }
        else
        {
          
        }

      }

      if (verif == 0)
      {
        printf("%s 0.\n", prod[idp].descricao);
      }
      else
      {
        
      }

    }
    else
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", idp);
    }

  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }

}

void m_comando(product prod[], encomendas new_encm[], int num_encomendas)
{
  int idp;
  int i;
  int num;
  int maior = 0;
  int indice = 0;
  int a;
  idp = new_sym_var(sizeof(int) * 8);
  num = num_encomendas;
  if (verifica_prod(prod, idp) == 1)
  {
    for (i = 0; i < num_encomendas; i++)
    {
      for (a = 0; a < new_encm[i].num_pedidos; a++)
      {
        if (new_encm[i].pedidos[a].idp == idp)
        {
          num--;
          if (new_encm[i].pedidos[a].qntd > maior)
          {
            maior = new_encm[i].pedidos[a].qntd;
            indice = i;
          }
          else
          {
            
          }

          break;
        }
        else
        {
          
        }

      }

    }

    if (num != num_encomendas)
    {
      printf("Maximo produto %d %d %d.\n", idp, indice, maior);
    }
    else
    {
      
    }

  }
  else
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", idp);
  }

}

void l_comando(product prod[], int l, int idp)
{
  int i;
  int a;
  product ordem[10000];
  for (a = 0; a < idp; a++)
  {
    ordem[a] = copia_produto(prod[a]);
  }

  mergeSort(ordem, l, idp - 1);
  printf("Produtos\n");
  for (i = 0; i < idp; i++)
  {
    printf("* %s %d %d\n", ordem[i].descricao, ordem[i].preco, ordem[i].qtd);
  }

}

void L_comando(encomendas new_encm[], product prod[], int idp)
{
  int ide;
  int j;
  int i;
  int a;
  int indice = 0;
  int quantidade = 0;
  product palavra;
  product ordenacao[10000];
  ide = new_sym_var(sizeof(int) * 8);
  if (verifica_enc(new_encm, ide) == 1)
  {
    for (a = 0; a < idp; a++)
    {
      for (i = 0; i < new_encm[ide].num_pedidos; i++)
      {
        if (new_encm[ide].pedidos[i].idp == prod[a].idp)
        {
          ordenacao[indice] = copia_produto(prod[a]);
          indice++;
          break;
        }
        else
        {
          
        }

      }

    }

    for (j = 0; j < indice; j++)
    {
      for (i = 0; i < indice; i++)
      {
        if (i != (indice - 1))
        {
          if (strcmp(ordenacao[i].descricao, ordenacao[i + 1].descricao) > 0)
          {
            palavra = copia_produto(ordenacao[i]);
            ordenacao[i] = copia_produto(ordenacao[i + 1]);
            ordenacao[i + 1] = copia_produto(palavra);
          }
          else
          {
            
          }

        }
        else
        {
          
        }

      }

    }

    printf("Encomenda %d\n", ide);
    if (new_encm[ide].num_pedidos > 0)
    {
      for (i = 0; i < indice; i++)
      {
        for (a = 0; a < new_encm[ide].num_pedidos; a++)
        {
          if (new_encm[ide].pedidos[a].idp == ordenacao[i].idp)
          {
            quantidade = new_encm[ide].pedidos[a].qntd;
            printf("* %s %d %d\n", ordenacao[i].descricao, ordenacao[i].preco, quantidade);
          }
          else
          {
            
          }

        }

      }

    }
    else
    {
      
    }

  }
  else
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", ide);
  }

}

void merge(product ordem[], int l, int m, int r)
{
  int i;
  int j;
  int k;
  int n1 = (m - l) + 1;
  int n2 = r - m;
  product L[10000];
  product R[10000];
  for (i = 0; i < n1; i++)
    L[i] = copia_produto(ordem[l + i]);

  for (j = 0; j < n2; j++)
    R[j] = copia_produto(ordem[(m + 1) + j]);

  i = 0;
  j = 0;
  k = l;
  while ((i < n1) && (j < n2))
  {
    if (L[i].preco <= R[j].preco)
    {
      ordem[k] = copia_produto(L[i]);
      i++;
    }
    else
    {
      ordem[k] = copia_produto(R[j]);
      j++;
    }

    k++;
  }

  while (i < n1)
  {
    ordem[k] = copia_produto(L[i]);
    i++;
    k++;
  }

  while (j < n2)
  {
    ordem[k] = copia_produto(R[j]);
    j++;
    k++;
  }

}

void mergeSort(product ordem[], int l, int r)
{
  if (l < r)
  {
    int m = l + ((r - l) / 2);
    mergeSort(ordem, l, m);
    mergeSort(ordem, m + 1, r);
    merge(ordem, l, m, r);
  }
  else
  {
    
  }

}

void inicializa_enc(encomendas enc[])
{
  int i;
  int a;
  for (i = 0; i < 500; i++)
  {
    enc[i].ide = -1;
    enc[i].peso_total = 0;
    enc[i].num_pedidos = 0;
    for (a = 0; a < 200; a++)
    {
      enc[i].pedidos[a].idp = -1;
      enc[i].pedidos[a].qntd = 0;
    }

  }

}

void inicializa_prod(product prodt[])
{
  int i;
  for (i = 0; i < 10000; i++)
  {
    prodt[i].preco = 0;
    prodt[i].peso = 0;
    prodt[i].qtd = 0;
    prodt[i].idp = -1;
    strcpy(prodt[i].descricao, "0");
  }

}

int verifica_prod(product prodct[], int idp)
{
  int existe;
  if (prodct[idp].idp == idp)
  {
    existe = 1;
  }
  else
  {
    existe = 0;
  }

  return existe;
}

int verifica_enc(encomendas enc[], int ide)
{
  int existe;
  if (enc[ide].ide == ide)
  {
    existe = 1;
  }
  else
  {
    existe = 0;
  }

  return existe;
}

product copia_produto(product prod_or)
{
  product prod_cpy;
  prod_cpy.preco = prod_or.preco;
  prod_cpy.peso = prod_or.peso;
  prod_cpy.qtd = prod_or.qtd;
  prod_cpy.idp = prod_or.idp;
  strcpy(prod_cpy.descricao, prod_or.descricao);
  return prod_cpy;
}

