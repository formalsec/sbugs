#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h> 


typedef struct 
{
  int num;
  int preco;
  int peso;
  int qnt;
  char desc[63];
} Produto;
typedef struct 
{
  int indice;
  Produto pedido[200];
} Encomenda;
Produto obj[10000];
Encomenda enc[500];
int partition_P(int a[], int l, int r)
{
  int v;
  int i = l - 1;
  int j = r;
  v = a[r];
  while (i < j)
  {
    while ((obj[a[++i]].preco < obj[v].preco) || ((obj[a[i]].preco == obj[v].preco) && (obj[a[i]].num < obj[v].num)))
      ;

    while ((obj[v].preco < obj[a[--j]].preco) || ((obj[v].preco == obj[a[j]].preco) && (obj[v].num < obj[a[j]].num)))
      if (j == l)
    {
      break;
    }
    else
    {
      
    }


    if (i < j)
    {
      int t;
      t = a[i];
      a[i] = a[j];
      a[j] = t;
    }
    else
    {
      
    }

    ;
  }

  {
    int t;
    t = a[i];
    a[i] = a[r];
    a[r] = t;
  }
  ;
  return i;
}

void quicksort_P(int a[], int l, int r)
{
  int i;
  if (r <= l)
  {
    return;
  }
  else
  {
    
  }

  i = partition_P(a, l, r);
  quicksort_P(a, l, i - 1);
  quicksort_P(a, i + 1, r);
}

int partition_L(int a[], int l, int r)
{
  int v;
  int i = l - 1;
  int j = r;
  v = a[r];
  while (i < j)
  {
    while (strcmp(obj[a[++i]].desc, obj[v].desc) < 0)
      ;

    while (strcmp(obj[v].desc, obj[a[--j]].desc) < 0)
      if (j == l)
    {
      break;
    }
    else
    {
      
    }


    if (i < j)
    {
      int t;
      t = a[i];
      a[i] = a[j];
      a[j] = t;
    }
    else
    {
      
    }

    ;
  }

  {
    int t;
    t = a[i];
    a[i] = a[r];
    a[r] = t;
  }
  ;
  return i;
}

void quicksort_L(int a[], int l, int r)
{
  int i;
  if (r <= l)
  {
    return;
  }
  else
  {
    
  }

  i = partition_L(a, l, r);
  quicksort_L(a, l, i - 1);
  quicksort_L(a, i + 1, r);
}

void adiciona_produto(int idp)
{
  char esp;
  esp = new_sym_var(sizeof(char) * 8);
  for (int obj_index = 0; obj_index < 10; obj_index++)
  {
    obj[idp].desc[obj_index] = new_sym_var(sizeof(char) * 8);
  }

  obj[idp].desc[10 - 1] = '\0';
  obj[idp].preco = new_sym_var(sizeof(int) * 8);
  obj[idp].peso = new_sym_var(sizeof(int) * 8);
  obj[idp].qnt = new_sym_var(sizeof(int) * 8);
  obj[idp].num = idp;
  printf("Novo produto %d.\n", idp);
}

void adiciona_stock(int idp)
{
  int a;
  int b;
  a = new_sym_var(sizeof(int) * 8);
  b = new_sym_var(sizeof(int) * 8);
  if (a < idp)
  {
    obj[a].qnt += b;
  }
  else
  {
    printf("Impossivel adicionar produto %d ao stock. Produto inexistente.\n", a);
  }

}

void adiciona_enc(int a, int b, int c)
{
  int i;
  int k;
  int soma = 0;
  for (i = 0; i < enc[a].indice; i++)
  {
    soma += enc[a].pedido[i].peso * enc[a].pedido[i].qnt;
  }

  soma += c * obj[b].peso;
  if (soma > 200)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", b, a);
    return;
  }
  else
  {
    
  }

  for (k = 0; k < enc[a].indice; k++)
  {
    if (enc[a].pedido[k].num == b)
    {
      enc[a].pedido[k].qnt += c;
      obj[b].qnt -= c;
      return;
    }
    else
    {
      
    }

  }

  enc[a].pedido[enc[a].indice].preco = obj[b].preco;
  enc[a].pedido[enc[a].indice].peso = obj[b].peso;
  enc[a].pedido[enc[a].indice].qnt = c;
  enc[a].pedido[enc[a].indice].num = b;
  obj[b].qnt -= c;
  enc[a].indice += 1;
}

void adiciona_prod_enc(int idp, int ide)
{
  int a;
  int b;
  int c;
  a = new_sym_var(sizeof(int) * 8);
  b = new_sym_var(sizeof(int) * 8);
  c = new_sym_var(sizeof(int) * 8);
  if (a >= ide)
  {
    printf("Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", b, a);
  }
  else
  {
    if (b >= idp)
    {
      printf("Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", b, a);
    }
    else
    {
      if (obj[b].qnt < c)
      {
        printf("Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", b, a);
      }
      else
      {
        adiciona_enc(a, b, c);
      }

    }

  }

}

void remove_stock(int idp)
{
  int a;
  int b;
  a = new_sym_var(sizeof(int) * 8);
  b = new_sym_var(sizeof(int) * 8);
  if (a >= idp)
  {
    printf("Impossivel remover stock do produto %d. Produto inexistente.\n", a);
  }
  else
  {
    if ((obj[a].qnt - b) < 0)
    {
      printf("Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", b, a);
    }
    else
    {
      obj[a].qnt -= b;
    }

  }

}

void remove_produto(int idp, int ide)
{
  int i;
  int a;
  int b;
  a = new_sym_var(sizeof(int) * 8);
  b = new_sym_var(sizeof(int) * 8);
  if (a >= ide)
  {
    printf("Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", b, a);
  }
  else
  {
    if (b >= idp)
    {
      printf("Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", b, a);
    }
    else
    {
      for (i = 0; i < enc[a].indice; i++)
      {
        if (enc[a].pedido[i].num == b)
        {
          obj[b].qnt += enc[a].pedido[i].qnt;
          enc[a].pedido[i].qnt = 0;
        }
        else
        {
          
        }

      }

    }

  }

}

void custo_encomenda(int ide)
{
  int c;
  int i;
  int custo = 0;
  c = new_sym_var(sizeof(int) * 8);
  if (c >= ide)
  {
    printf("Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", c);
  }
  else
  {
    for (i = 0; i < enc[c].indice; i++)
    {
      custo += enc[c].pedido[i].preco * enc[c].pedido[i].qnt;
    }

    printf("Custo da encomenda %d %d.\n", c, custo);
  }

}

void altera_preco(int idp, int ide)
{
  int a;
  int p;
  int i;
  int j;
  a = new_sym_var(sizeof(int) * 8);
  p = new_sym_var(sizeof(int) * 8);
  if (a >= idp)
  {
    printf("Impossivel alterar preco do produto %d. Produto inexistente.\n", a);
  }
  else
  {
    for (i = 0; i < ide; i++)
    {
      for (j = 0; j < enc[i].indice; j++)
      {
        if (enc[i].pedido[j].num == a)
        {
          enc[i].pedido[j].preco = p;
        }
        else
        {
          
        }

      }

    }

    obj[a].preco = p;
  }

}

void lista_desc_qnt(int idp, int ide)
{
  int quant = 0;
  int i;
  int a;
  int b;
  a = new_sym_var(sizeof(int) * 8);
  b = new_sym_var(sizeof(int) * 8);
  if (a >= ide)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", a);
  }
  else
  {
    if (b >= idp)
    {
      printf("Impossivel listar produto %d. Produto inexistente.\n", b);
    }
    else
    {
      for (i = 0; i < enc[a].indice; i++)
      {
        if (enc[a].pedido[i].num == b)
        {
          quant = enc[a].pedido[i].qnt;
          break;
        }
        else
        {
          
        }

      }

      printf("%s %d.\n", obj[b].desc, quant);
    }

  }

}

void lista_qnt_maxima(int idp, int ide)
{
  int i;
  int j;
  int p;
  int maior;
  int max = 0;
  p = new_sym_var(sizeof(int) * 8);
  if (p >= idp)
  {
    printf("Impossivel listar maximo do produto %d. Produto inexistente.\n", p);
  }
  else
  {
    for (j = 0; j < ide; j++)
    {
      for (i = 0; i < enc[j].indice; i++)
      {
        if (enc[j].pedido[i].num == p)
        {
          if (enc[j].pedido[i].qnt > max)
          {
            max = enc[j].pedido[i].qnt;
            maior = j;
          }
          else
          {
            
          }

        }
        else
        {
          
        }

      }

    }

    if (max)
    {
      printf("Maximo produto %d %d %d.\n", p, maior, max);
    }
    else
    {
      
    }

  }

}

void lista_por_preco(int idp)
{
  int x;
  int h;
  int sort[10000];
  for (h = 0; h < idp; h++)
  {
    sort[h] = h;
  }

  quicksort_P(sort, 0, idp - 1);
  printf("Produtos\n");
  for (x = 0; x < idp; x++)
  {
    printf("* %s %d %d\n", obj[sort[x]].desc, obj[sort[x]].preco, obj[sort[x]].qnt);
  }

}

void lista_por_desc(int ide)
{
  int a;
  int x;
  int h;
  int y;
  int fra[200];
  a = new_sym_var(sizeof(int) * 8);
  if (a >= ide)
  {
    printf("Impossivel listar encomenda %d. Encomenda inexistente.\n", a);
  }
  else
  {
    for (h = 0; h < enc[a].indice; h++)
    {
      fra[h] = enc[a].pedido[h].num;
    }

    quicksort_L(fra, 0, enc[a].indice - 1);
    printf("Encomenda %d\n", a);
    for (x = 0; x < enc[a].indice; x++)
    {
      for (y = 0; y < enc[a].indice; y++)
      {
        if ((enc[a].pedido[y].num == fra[x]) && (enc[a].pedido[y].qnt > 0))
        {
          printf("* %s %d %d\n", obj[fra[x]].desc, obj[fra[x]].preco, enc[a].pedido[y].qnt);
        }
        else
        {
          
        }

      }

    }

  }

}

int main()
{
  char v;
  int i;
  int idp = 0;
  int ide = 0;
  for (i = 0; i < 500; i++)
  {
    enc[i].indice = 0;
  }

  v = new_sym_var(sizeof(char) * 8);
  while (v != 'x')
  {
    switch (v)
    {
      case 'a':
        adiciona_produto(idp);
        idp += 1;
        break;

      case 'q':
        adiciona_stock(idp);
        break;

      case 'N':
        printf("Nova encomenda %d.\n", ide);
        ide += 1;
        break;

      case 'A':
        adiciona_prod_enc(idp, ide);
        break;

      case 'r':
        remove_stock(idp);
        break;

      case 'R':
        remove_produto(idp, ide);
        break;

      case 'C':
        custo_encomenda(ide);
        break;

      case 'p':
        altera_preco(idp, ide);
        break;

      case 'E':
        lista_desc_qnt(idp, ide);
        break;

      case 'm':
        lista_qnt_maxima(idp, ide);
        break;

      case 'l':
        lista_por_preco(idp);
        break;

      case 'L':
        lista_por_desc(ide);
        break;

    }

    v = new_sym_var(sizeof(char) * 8);
  }

  return 0;
}

