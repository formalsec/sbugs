/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h> 


struct produto
{
  int id;
  char descr[64];
  int preco;
  int peso;
  int qtd;
};
struct produto products[10000];
struct produto encomendas[500][10000];
int get_descr(char *body, char *descr)
{
  int position;
  char *position_ptr = strchr(body, ':');
  position = position_ptr - body;
  strncpy(descr, body, position);
  descr[position] = '\0';
  return position;
}

void get_price(char *body, int *preco, int *position)
{
  int f = 1;
  char c;
  char price[100] = {'0'};
  *position += 1;
  while (f == 1)
  {
    c = body[*position];
    strncat(price, &c, 1);
    *position += 1;
    if (body[*position] == ':')
    {
      f = 0;
      break;
    }
    else
    {
      
    }

  }

  *preco = atoi(price);
}

void get_weight(char *body, int *peso, int *position)
{
  int f = 1;
  char c;
  char weight[100] = {'0'};
  *position += 1;
  while (f == 1)
  {
    c = body[*position];
    strncat(weight, &c, 1);
    *position += 1;
    if (body[*position] == ':')
    {
      f = 0;
      break;
    }
    else
    {
      
    }

  }

  *peso = atoi(weight);
}

void get_qtt(char *body, int *qtd, int *position)
{
  int f = 1;
  char c;
  char qtt[100] = {'0'};
  *position += 1;
  while (f == 1)
  {
    c = body[*position];
    strncat(qtt, &c, 1);
    *position += 1;
    if (body[*position] == '\0')
    {
      f = 0;
      break;
    }
    else
    {
      
    }

  }

  *qtd = atoi(qtt);
}

void processInput()
{
  char line[1000000];
  char body_of_command[1000000];
  int position;
  int idp = 0;
  int ide = 0;
  int i = 0;
  printf("\nProcessing commands...\n");
  while (fgets(line, (sizeof(line)) / (sizeof(char)), stdin))
  {
    char token;
    token = new_sym_var(sizeof(char) * 8);
    for (int body_of_command_index = 0; body_of_command_index < 10; body_of_command_index++)
    {
      body_of_command[body_of_command_index] = new_sym_var(sizeof(char) * 8);
    }

    body_of_command[10 - 1] = '\0';
    if (token == 'a')
    {
      products[idp].id = idp;
      position = get_descr(body_of_command, products[idp].descr);
      get_price(body_of_command, &products[idp].preco, &position);
      get_weight(body_of_command, &products[idp].peso, &position);
      get_qtt(body_of_command, &products[idp].qtd, &position);
      idp++;
      fprintf(stdout, "Novo produto %d.\n", idp);
    }
    else
    {
      
    }

    if (token == 'A')
    {
      int this_ide;
      int this_idp;
      int this_qtt;
      int this_weight;
      int size;
      int f = 1;
      int position = 0;
      int i = 0;
      int found = 0;
      int found_in_order = 0;
      char c;
      char this_idp_s[4] = {'0'};
      char this_qtt_s[100] = {'0'};
      char this_ide_s[500] = {'0'};
      while (f == 1)
      {
        c = body_of_command[position];
        strncat(this_ide_s, &c, 1);
        position += 1;
        if (body_of_command[position] == ':')
        {
          f = 0;
          break;
        }
        else
        {
          
        }

      }

      this_ide = atoi(this_ide_s);
      f = 1;
      position += 1;
      while (f == 1)
      {
        c = body_of_command[position];
        strncat(this_idp_s, &c, 1);
        position += 1;
        if (body_of_command[position] == ':')
        {
          f = 0;
          break;
        }
        else
        {
          
        }

      }

      this_idp = atoi(this_idp_s);
      f = 1;
      position += 1;
      while (f == 1)
      {
        c = body_of_command[position];
        strncat(this_qtt_s, &c, 1);
        position += 1;
        if (body_of_command[position] == '\0')
        {
          f = 0;
          break;
        }
        else
        {
          
        }

      }

      this_qtt = atoi(this_qtt_s);
      for (; i < ide; i++)
      {
        if (this_ide == i)
        {
          found = 1;
        }
        else
        {
          
        }

      }

      if (!found)
      {
        fprintf(stdout, "Impossivel adicionar produto %d a encomenda %d. Encomenda inexistente.\n", this_idp, this_ide);
      }
      else
      {
        
      }

      i = 0;
      found = 0;
      for (; i < idp; i++)
      {
        if (this_idp == i)
        {
          found = 1;
          size = (sizeof(encomendas[this_ide])) / (sizeof(encomendas[this_ide][0]));
          i = 0;
          for (; i < size; i++)
          {
            if ((encomendas[this_ide][i].id == this_idp) && (encomendas[this_ide][i].qtd != 0))
            {
              found_in_order = 1;
              if (this_qtt > products[this_idp].qtd)
              {
                fprintf(stdout, "Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", this_idp, this_ide);
              }
              else
              {
                this_weight = encomendas[this_ide][i].peso * (this_qtt + encomendas[this_ide][i].qtd);
                if (this_weight > 200)
                {
                  fprintf(stdout, "Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", this_idp, this_ide);
                }
                else
                {
                  encomendas[this_ide][this_idp].qtd += this_qtt;
                }

              }

            }
            else
            {
              
            }

          }

          if (found_in_order == 0)
          {
            if (this_qtt > products[this_idp].qtd)
            {
              fprintf(stdout, "Impossivel adicionar produto %d a encomenda %d. Quantidade em stock insuficiente.\n", this_idp, this_ide);
            }
            else
            {
              this_weight = products[this_idp].peso * this_qtt;
              if (this_weight > 200)
              {
                fprintf(stdout, "Impossivel adicionar produto %d a encomenda %d. Peso da encomenda excede o maximo de 200.\n", this_idp, this_ide);
              }
              else
              {
                encomendas[this_ide][this_idp].id = this_idp;
                strcpy(encomendas[this_ide][this_idp].descr, products[this_idp].descr);
                encomendas[this_ide][this_idp].peso = products[this_idp].peso;
                encomendas[this_ide][this_idp].preco = products[this_idp].preco;
                encomendas[this_ide][this_idp].qtd = this_qtt;
                products[this_idp].qtd -= this_qtt;
              }

            }

          }
          else
          {
            
          }

        }
        else
        {
          
        }

      }

      if (!found)
      {
        fprintf(stdout, "Impossivel adicionar produto %d a encomenda %d. Produto inexistente.\n", this_idp, this_ide);
      }
      else
      {
        
      }

    }
    else
    {
      
    }

    if (token == 'C')
    {
      int this_ide;
      int this_cost = 0;
      int i = 0;
      this_ide = new_sym_var(sizeof(int) * 8);
      if (this_ide < ide)
      {
        for (; i < idp; i++)
        {
          if (encomendas[this_ide][i].qtd != 0)
          {
            this_cost += encomendas[this_ide][i].preco * encomendas[this_ide][i].qtd;
          }
          else
          {
            
          }

        }

        fprintf(stdout, "Custo da encomenda %d %d.\n", this_ide, this_cost);
      }
      else
      {
        fprintf(stdout, "Impossivel calcular custo da encomenda %d. Encomenda inexistente.\n", this_ide);
      }

    }
    else
    {
      
    }

    if (token == 'E')
    {
      int this_ide;
      int this_idp;
      int f = 1;
      int position = 0;
      int i = 0;
      int found = 0;
      char c;
      char this_idp_s[4] = {'0'};
      char this_ide_s[500] = {'0'};
      while (f == 1)
      {
        c = body_of_command[position];
        strncat(this_ide_s, &c, 1);
        position += 1;
        if (body_of_command[position] == ':')
        {
          f = 0;
          break;
        }
        else
        {
          
        }

      }

      this_ide = atoi(this_ide_s);
      f = 1;
      position += 1;
      while (f == 1)
      {
        c = body_of_command[position];
        strncat(this_idp_s, &c, 1);
        position += 1;
        if (body_of_command[position] == '\0')
        {
          f = 0;
          break;
        }
        else
        {
          
        }

      }

      this_idp = atoi(this_idp_s);
      for (; i < ide; i++)
      {
        if (this_ide == i)
        {
          found = 1;
        }
        else
        {
          
        }

      }

      if (!found)
      {
        fprintf(stdout, "Impossivel listar encomenda %d. Encomenda inexistente.\n", this_ide);
      }
      else
      {
        
      }

      i = 0;
      found = 0;
      for (; i < idp; i++)
      {
        if (this_idp == i)
        {
          found = 1;
          fprintf(stdout, "%s %d.\n", encomendas[this_ide][this_idp].descr, encomendas[this_ide][this_idp].qtd);
        }
        else
        {
          
        }

      }

      if (!found)
      {
        fprintf(stdout, "Impossivel listar produto %d. Produto inexistente.\n", this_idp);
      }
      else
      {
        
      }

    }
    else
    {
      
    }

    if (token == 'l')
    {
      int temp_preco;
      int temp_qtd;
      int k;
      int j = 0;
      char *temp[64];
      struct produto ordered_products[10000];
      i = 0;
      *temp = (char *) malloc((sizeof(char)) * 64);
      for (; j < idp; j++)
      {
        strcpy(ordered_products[j].descr, products[j].descr);
        ordered_products[j].preco = products[j].preco;
        ordered_products[j].qtd = products[j].qtd;
      }

      j = 0;
      for (; j < idp; ++j)
      {
        for (k = j + 1; k < idp; ++k)
        {
          if (ordered_products[j].preco > ordered_products[k].preco)
          {
            temp_preco = ordered_products[j].preco;
            strcpy(*temp, ordered_products[j].descr);
            temp_qtd = ordered_products[j].qtd;
            ordered_products[j].preco = ordered_products[k].preco;
            strcpy(ordered_products[j].descr, ordered_products[k].descr);
            ordered_products[j].qtd = ordered_products[k].qtd;
            ordered_products[k].preco = temp_preco;
            strcpy(ordered_products[k].descr, *temp);
            ordered_products[k].qtd = temp_qtd;
          }
          else
          {
            
          }

        }

      }

      fprintf(stdout, "Produtos\n");
      for (; i < idp; i++)
      {
        fprintf(stdout, "* %s %d %d\n", ordered_products[i].descr, ordered_products[i].preco, ordered_products[i].qtd);
      }

      free(*temp);
    }
    else
    {
      
    }

    if (token == 'L')
    {
      char *temp[64];
      struct produto encomenda_ordenada[10000];
      int this_ide;
      int count;
      int temp_peso;
      int temp_qtd;
      int temp_preco;
      int temp_id;
      int i = 0;
      int j = 0;
      *temp = (char *) malloc((sizeof(char)) * 64);
      this_ide = new_sym_var(sizeof(int) * 8);
      if (this_ide < ide)
      {
        fprintf(stdout, "Encomenda %d\n", this_ide);
        for (; i < idp; i++)
        {
          if (encomendas[this_ide][i].qtd != 0)
          {
            strcpy(encomenda_ordenada[i].descr, encomendas[this_ide][i].descr);
            encomenda_ordenada[i].preco = encomendas[this_ide][i].preco;
            encomenda_ordenada[i].peso = encomendas[this_ide][i].peso;
            encomenda_ordenada[i].qtd = encomendas[this_ide][i].qtd;
          }
          else
          {
            
          }

        }

        count = i - 1;
        i = 0;
        for (; i <= count; i++)
        {
          for (j = i + 1; j <= count; j++)
          {
            if (strcmp(encomenda_ordenada[i].descr, encomenda_ordenada[j].descr) > 0)
            {
              strcpy(*temp, encomenda_ordenada[i].descr);
              temp_preco = encomenda_ordenada[i].preco;
              temp_peso = encomenda_ordenada[i].peso;
              temp_qtd = encomenda_ordenada[i].qtd;
              temp_id = encomenda_ordenada[i].id;
              strcpy(encomenda_ordenada[i].descr, encomenda_ordenada[j].descr);
              encomenda_ordenada[i].preco = encomenda_ordenada[j].preco;
              encomenda_ordenada[i].peso = encomenda_ordenada[j].peso;
              encomenda_ordenada[i].qtd = encomenda_ordenada[j].qtd;
              encomenda_ordenada[i].id = encomenda_ordenada[j].id;
              strcpy(encomenda_ordenada[j].descr, *temp);
              encomenda_ordenada[j].preco = temp_preco;
              encomenda_ordenada[j].peso = temp_peso;
              encomenda_ordenada[j].qtd = temp_qtd;
              encomenda_ordenada[j].id = temp_id;
            }
            else
            {
              
            }

          }

        }

        i = 0;
        for (; i < idp; i++)
        {
          if (encomenda_ordenada[i].qtd != 0)
          {
            fprintf(stdout, "* %s %d %d\n", encomenda_ordenada[i].descr, encomenda_ordenada[i].preco, encomenda_ordenada[i].qtd);
          }
          else
          {
            
          }

        }

      }
      else
      {
        fprintf(stdout, "Impossivel listar encomenda %d. Encomenda inexistente.\n", this_ide);
      }

      free(*temp);
    }
    else
    {
      
    }

    if (token == 'm')
    {
      int this_idp;
      int i = 0;
      int j = 0;
      int found = 0;
      int found_in_order = 0;
      int this_qtd = 0;
      int this_ide;
      this_idp = new_sym_var(sizeof(int) * 8);
      for (; i < idp; i++)
      {
        if (i == this_idp)
        {
          found = 1;
          for (; j < ide; j++)
          {
            if (encomendas[i][this_idp].qtd > this_qtd)
            {
              found_in_order = 1;
              this_qtd = encomendas[j][this_idp].qtd;
              this_ide = j;
            }
            else
            {
              
            }

          }

          if (found_in_order == 1)
          {
            fprintf(stdout, "Maximo produto %d %d %d.\n", this_idp, this_ide, encomendas[this_ide][this_idp].qtd);
          }
          else
          {
            
          }

        }
        else
        {
          
        }

      }

      if (found == 0)
      {
        fprintf(stdout, "Impossivel listar maximo do produto %d. Produto inexistente.\n", this_idp);
      }
      else
      {
        
      }

    }
    else
    {
      
    }

    if (token == 'N')
    {
      fprintf(stdout, "Nova encomenda %d.\n", ide);
      ide++;
    }
    else
    {
      
    }

    if (token == 'p')
    {
      int this_idp;
      int this_preco;
      int i = 0;
      int found = 0;
      this_idp = new_sym_var(sizeof(int) * 8);
      this_preco = new_sym_var(sizeof(int) * 8);
      for (; i < idp; i++)
      {
        if (i == this_idp)
        {
          found = 1;
          products[this_idp].preco = this_preco;
          i = 0;
          for (; i < ide; i++)
          {
            if (encomendas[i][this_idp].preco != 0)
            {
              encomendas[i][this_idp].preco = this_preco;
            }
            else
            {
              
            }

          }

        }
        else
        {
          
        }

      }

      if (found == 0)
      {
        fprintf(stdout, "Impossivel alterar preco do produto %d. Produto inexistente.\n", this_idp);
      }
      else
      {
        
      }

    }
    else
    {
      
    }

    if (token == 'q')
    {
      int this_idp;
      int this_qtt;
      int f = 1;
      int position = 0;
      int i = 0;
      int found = 0;
      char c;
      char this_idp_s[4] = {'0'};
      char this_qtt_s[100] = {'0'};
      while (f == 1)
      {
        c = body_of_command[position];
        strncat(this_idp_s, &c, 1);
        position += 1;
        if (body_of_command[position] == ':')
        {
          f = 0;
          break;
        }
        else
        {
          
        }

      }

      this_idp = atoi(this_idp_s);
      f = 1;
      position += 1;
      while (f == 1)
      {
        c = body_of_command[position];
        strncat(this_qtt_s, &c, 1);
        position += 1;
        if (body_of_command[position] == '\0')
        {
          f = 0;
          break;
        }
        else
        {
          
        }

      }

      this_qtt = atoi(this_qtt_s);
      for (; i < idp; i++)
      {
        if (this_idp == i)
        {
          found = 1;
          products[this_idp].qtd += this_qtt;
        }
        else
        {
          
        }

      }

      if (!found)
      {
        fprintf(stdout, "Impossivel adicionar produto %d ao stock. Produto inexistente.\n", this_idp);
      }
      else
      {
        
      }

    }
    else
    {
      
    }

    if (token == 'r')
    {
      int this_idp;
      int this_qtt;
      int i = 0;
      int found = 0;
      this_idp = new_sym_var(sizeof(int) * 8);
      this_qtt = new_sym_var(sizeof(int) * 8);
      for (; i < idp; i++)
      {
        if (i == this_idp)
        {
          if (this_qtt > products[this_idp].qtd)
          {
            fprintf(stdout, "Impossivel remover %d unidades do produto %d do stock. Quantidade insuficiente.\n", this_qtt, this_idp);
          }
          else
          {
            products[this_idp].qtd -= this_qtt;
          }

          found = 1;
        }
        else
        {
          
        }

      }

      if (found == 0)
      {
        fprintf(stdout, "Impossivel remover stock do produto %d. Produto inexistente.\n", this_idp);
      }
      else
      {
        
      }

    }
    else
    {
      
    }

    if (token == 'R')
    {
      int this_idp;
      int this_ide;
      int i = 0;
      int found_order = 0;
      int found_prdct = 0;
      this_ide = new_sym_var(sizeof(int) * 8);
      this_idp = new_sym_var(sizeof(int) * 8);
      for (; i < ide; i++)
      {
        if (i == this_ide)
        {
          found_order = 1;
          i = 0;
          for (; i < idp; i++)
          {
            if (this_idp == i)
            {
              found_prdct = 1;
              encomendas[this_ide][this_idp].id = -1;
              encomendas[this_ide][this_idp].peso = 0;
              strcpy(encomendas[this_ide][this_idp].descr, "");
              encomendas[this_ide][this_idp].preco = 0;
              encomendas[this_ide][this_idp].qtd = 0;
            }
            else
            {
              
            }

          }

          if (found_prdct == 0)
          {
            fprintf(stdout, "Impossivel remover produto %d a encomenda %d. Produto inexistente.\n", this_idp, this_ide);
          }
          else
          {
            
          }

        }
        else
        {
          
        }

      }

      if (found_order == 0)
      {
        fprintf(stdout, "Impossivel remover produto %d a encomenda %d. Encomenda inexistente.\n", this_idp, this_ide);
      }
      else
      {
        
      }

    }
    else
    {
      
    }

    if (token == 'x')
    {
      printf("\nShutting down... Good bye! Adeus!\n");
      exit(0);
    }
    else
    {
      
    }

  }

}

int main()
{
  processInput();
  return 0;
}

