#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "comandos.h"
#include "jogos.h"
#include "equipas.h"


char *vencedor_f(char *equipa1, char *equipa2, unsigned int score1, unsigned int score2)
{
  char *empate = "empate";
  if (score1 > score2)
  {
    return equipa1;
  }
  else
  {
    if (score1 < score2)
    {
      return equipa2;
    }
    else
    {
      return empate;
    }

  }

}

void a(unsigned long contador, link *heads_jogos, link_e *heads_equipas, lst_ptr lista)
{
  char nome[1023];
  char equipa1[1023];
  char equipa2[1023];
  unsigned int score1;
  unsigned int score2;
  getchar();
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  for (int equipa1_index = 0; equipa1_index < 10; equipa1_index++)
  {
    equipa1[equipa1_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa1[10 - 1] = '\0';
  for (int equipa2_index = 0; equipa2_index < 10; equipa2_index++)
  {
    equipa2[equipa2_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa2[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(unsigned int) * 8);
  score2 = new_sym_var(sizeof(unsigned int) * 8);
  if (hash_search_jogo(nome, heads_jogos) != 0)
  {
    printf("%ld Jogo existente.\n", contador);
    return;
  }
  else
  {
    if ((hash_search_equipa(equipa1, heads_equipas) == 0) || (hash_search_equipa(equipa2, heads_equipas) == 0))
    {
      printf("%ld Equipa inexistente.\n", contador);
      return;
    }
    else
    {
      char *vencedor;
      char *empate = "empate";
      equipa_ptr e;
      jogo_ptr x = (jogo_ptr) malloc(sizeof(jogo));
      x->nome = (char *) malloc((sizeof(char)) * (strlen(nome) + 1));
      x->equipa1 = (char *) malloc((sizeof(char)) * (strlen(equipa1) + 1));
      x->equipa2 = (char *) malloc((sizeof(char)) * (strlen(equipa2) + 1));
      strcpy(x->nome, nome);
      strcpy(x->equipa1, equipa1);
      strcpy(x->equipa2, equipa2);
      x->score1 = score1;
      x->score2 = score2;
      hash_insert_jogo(x, heads_jogos);
      insertEnd_lista(lista, x);
      vencedor = vencedor_f(x->equipa1, x->equipa2, x->score1, x->score2);
      if (strcmp(vencedor, empate) == 0)
      {
        return;
      }
      else
      {
        e = hash_search_equipa(vencedor, heads_equipas);
        e->vitorias++;
        return;
      }

    }

  }

}

void l(unsigned long contador, lst_ptr lista)
{
  link t;
  link head = lista->head;
  jogo_ptr j;
  for (t = head; t != 0; t = t->next)
  {
    j = t->j;
    printf("%ld %s %s %s %u %u\n", contador, j->nome, j->equipa1, j->equipa2, j->score1, j->score2);
  }

  return;
}

void p(unsigned long contador, link *heads_jogos)
{
  char nome[1023];
  jogo_ptr j;
  getchar();
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  j = hash_search_jogo(nome, heads_jogos);
  if (j != 0)
  {
    printf("%ld %s %s %s %u %u\n", contador, j->nome, j->equipa1, j->equipa2, j->score1, j->score2);
    return;
  }
  else
  {
    printf("%ld Jogo inexistente.\n", contador);
    return;
  }

}

void r(unsigned long contador, link *heads_jogos, link_e *heads_equipas, lst_ptr lista)
{
  char nome[1023];
  char *vencedor;
  char *empate = "empate";
  jogo_ptr j;
  equipa_ptr e;
  getchar();
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  j = hash_search_jogo(nome, heads_jogos);
  if (j == 0)
  {
    printf("%ld Jogo inexistente.\n", contador);
    return;
  }
  else
  {
    vencedor = vencedor_f(j->equipa1, j->equipa2, j->score1, j->score2);
    if (strcmp(vencedor, empate) != 0)
    {
      e = hash_search_equipa(vencedor, heads_equipas);
      e->vitorias--;
    }
    else
    {
      
    }

    hash_delete_jogo(nome, heads_jogos, lista);
    return;
  }

}

void s(unsigned long contador, link *heads_jogos, link_e *heads_equipas)
{
  char nome[1023];
  char *empate = "empate";
  unsigned int score1;
  unsigned int score2;
  char *vencedor_ant;
  char *vencedor_dep;
  jogo_ptr j;
  equipa_ptr e_ant;
  equipa_ptr e_dep;
  getchar();
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(unsigned int) * 8);
  score2 = new_sym_var(sizeof(unsigned int) * 8);
  j = hash_search_jogo(nome, heads_jogos);
  if (j == 0)
  {
    printf("%ld Jogo inexistente.\n", contador);
    return;
  }
  else
  {
    vencedor_ant = vencedor_f(j->equipa1, j->equipa2, j->score1, j->score2);
    vencedor_dep = vencedor_f(j->equipa1, j->equipa2, score1, score2);
    j->score1 = score1;
    j->score2 = score2;
    if (strcmp(vencedor_ant, vencedor_dep) == 0)
    {
      return;
    }
    else
    {
      if (strcmp(vencedor_ant, empate) != 0)
      {
        e_ant = hash_search_equipa(vencedor_ant, heads_equipas);
        e_ant->vitorias--;
      }
      else
      {
        
      }

      if (strcmp(vencedor_dep, empate) == 0)
      {
        return;
      }
      else
      {
        e_dep = hash_search_equipa(vencedor_dep, heads_equipas);
        e_dep->vitorias++;
        return;
      }

    }

  }

}

void A(unsigned long contador, link_e *heads_equipas)
{
  char nome[1023];
  getchar();
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  if (hash_search_equipa(nome, heads_equipas) != 0)
  {
    printf("%ld Equipa existente.\n", contador);
    return;
  }
  else
  {
    equipa_ptr e = (equipa_ptr) malloc(sizeof(equipa));
    e->nome = (char *) malloc((sizeof(char)) * (strlen(nome) + 1));
    strcpy(e->nome, nome);
    e->vitorias = 0;
    hash_insert_equipa(e, heads_equipas);
    return;
  }

}

void P(unsigned long contador, link_e *heads_equipas)
{
  char nome[1023];
  equipa_ptr e;
  getchar();
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  e = hash_search_equipa(nome, heads_equipas);
  if (e == 0)
  {
    printf("%ld Equipa inexistente.\n", contador);
    return;
  }
  else
  {
    printf("%ld %s %u\n", contador, nome, e->vitorias);
    return;
  }

}

int compare(const void *x, const void *y)
{
  char **v_x;
  char **v_y;
  v_x = (char **) x;
  v_y = (char **) y;
  return strcmp(*v_x, *v_y);
}

void g(unsigned long contador, link_e *heads_equipas)
{
  char *vec[150];
  int i;
  int n_equipas = 0;
  unsigned int max_vit = 0;
  link_e t;
  equipa_ptr e;
  for (i = 0; i < 1049; i++)
  {
    for (t = heads_equipas[i]; t != 0; t = t->next)
    {
      e = t->e;
      if (e->vitorias == max_vit)
      {
        vec[n_equipas] = e->nome;
        n_equipas++;
      }
      else
      {
        if (e->vitorias > max_vit)
        {
          vec[0] = e->nome;
          n_equipas = 1;
          max_vit = e->vitorias;
        }
        else
        {
          
        }

      }

    }

  }

  if (n_equipas > 0)
  {
    printf("%ld Melhores %d\n", contador, max_vit);
    qsort(vec, n_equipas, sizeof(char *), compare);
    for (i = 0; i < n_equipas; i++)
      printf("%ld * %s\n", contador, vec[i]);

  }
  else
  {
    
  }

  return;
}

