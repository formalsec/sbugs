#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "equipa.h"
#include "jogo.h"
#include "listas.h"
#include "hashtables.h"
#include "comandos.h"


void novo_jogo(lstJogos lista, hashJogos hash_jogos, hashEquipas hash_equipas, int nl)
{
  char nome[1024];
  char equipa1[1024];
  char equipa2[1024];
  int golos1;
  int golos2;
  ptrJogo jogo;
  linkJogo aux;
  linkEquipa e1;
  linkEquipa e2;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  for (int equipa1_index = 0; equipa1_index < 10; equipa1_index++)
  {
    equipa1[equipa1_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa1[10 - 1] = '\0';
  for (int equipa2_index = 0; equipa2_index < 10; equipa2_index++)
  {
    equipa2[equipa2_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa2[10 - 1] = '\0';
  golos1 = new_sym_var(sizeof(int) * 8);
  golos2 = new_sym_var(sizeof(int) * 8);
  aux = procurar_jogo_hash(hash_jogos, nome);
  e1 = procurar_equipa_hash(hash_equipas, equipa1);
  e2 = procurar_equipa_hash(hash_equipas, equipa2);
  if (aux != 0)
  {
    printf("%d Jogo existente.\n", nl);
  }
  else
  {
    if ((e1 == 0) || (e2 == 0))
    {
      printf("%d Equipa inexistente.\n", nl);
    }
    else
    {
      jogo = criar_jogo(nome, e1, e2, golos1, golos2);
      adicionar_jogo_lst(lista, jogo);
      adicionar_jogo_hash(hash_jogos, jogo);
      if (jogo->golos1 > jogo->golos2)
      {
        e1->equipa->vitorias++;
      }
      else
      {
        if (jogo->golos1 < jogo->golos2)
        {
          e2->equipa->vitorias++;
        }
        else
        {
          
        }

      }

    }

  }

}

void nova_equipa(lstEquipas lista, hashEquipas hash_equipas, int nl)
{
  char nome[1024];
  ptrEquipa equipa;
  linkEquipa aux;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  aux = procurar_equipa_hash(hash_equipas, nome);
  if (aux != 0)
  {
    printf("%d Equipa existente.\n", nl);
  }
  else
  {
    equipa = criar_equipa(nome);
    adicionar_equipa_lst(lista, equipa);
    adicionar_equipa_hash(hash_equipas, equipa);
  }

}

void listar_jogos(lstJogos lista, int nl)
{
  linkJogo aux;
  ptrJogo jogo;
  ptrEquipa e1;
  ptrEquipa e2;
  for (aux = lista->primeiro; aux != 0; aux = aux->prox)
  {
    jogo = aux->jogo;
    e1 = jogo->equipa1;
    e2 = jogo->equipa2;
    printf("%d %s %s %s %d %d\n", nl, jogo->nome, e1->nome, e2->nome, jogo->golos1, jogo->golos2);
  }

}

void procurar_jogo(hashJogos hash_jogos, int nl)
{
  char nome[1024];
  linkJogo aux;
  ptrJogo jogo;
  ptrEquipa e1;
  ptrEquipa e2;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  aux = procurar_jogo_hash(hash_jogos, nome);
  if (aux == 0)
  {
    printf("%d Jogo inexistente.\n", nl);
  }
  else
  {
    jogo = aux->jogo;
    e1 = jogo->equipa1;
    e2 = jogo->equipa2;
    printf("%d %s %s %s %d %d\n", nl, jogo->nome, e1->nome, e2->nome, jogo->golos1, jogo->golos2);
  }

}

void procurar_equipa(hashEquipas hash_equipas, int nl)
{
  char nome[1024];
  linkEquipa aux;
  ptrEquipa equipa;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  aux = procurar_equipa_hash(hash_equipas, nome);
  if (aux == 0)
  {
    printf("%d Equipa inexistente.\n", nl);
  }
  else
  {
    equipa = aux->equipa;
    printf("%d %s %d\n", nl, equipa->nome, equipa->vitorias);
  }

}

void apagar_jogo(lstJogos lista, hashJogos hash_jogos, int nl)
{
  char nome[1024];
  linkJogo aux1;
  linkJogo aux2;
  ptrJogo jogo;
  ptrEquipa e1;
  ptrEquipa e2;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  aux1 = procurar_jogo_hash(hash_jogos, nome);
  if (aux1 == 0)
  {
    printf("%d Jogo inexistente.\n", nl);
  }
  else
  {
    jogo = aux1->jogo;
    e1 = jogo->equipa1;
    e2 = jogo->equipa2;
    if (jogo->golos1 > jogo->golos2)
    {
      e1->vitorias--;
    }
    else
    {
      if (jogo->golos1 < jogo->golos2)
      {
        e2->vitorias--;
      }
      else
      {
        
      }

    }

    aux2 = procurar_jogo_lst(lista, nome);
    remover_jogo_hash(hash_jogos, aux1);
    remover_jogo_lst(lista, aux2);
    eliminar_jogo(jogo);
  }

}

void alterar_pontuacao(hashJogos hash_jogos, int nl)
{
  linkJogo aux;
  ptrJogo jogo;
  ptrEquipa e1;
  ptrEquipa e2;
  char nome[1024];
  int novo_golos1;
  int novo_golos2;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  novo_golos1 = new_sym_var(sizeof(int) * 8);
  novo_golos2 = new_sym_var(sizeof(int) * 8);
  aux = procurar_jogo_hash(hash_jogos, nome);
  if (aux == 0)
  {
    printf("%d Jogo inexistente.\n", nl);
  }
  else
  {
    jogo = aux->jogo;
    e1 = jogo->equipa1;
    e2 = jogo->equipa2;
    if (jogo->golos1 == jogo->golos2)
    {
      if (novo_golos1 > novo_golos2)
      {
        e1->vitorias++;
      }
      else
      {
        if (novo_golos1 < novo_golos2)
        {
          e2->vitorias++;
        }
        else
        {
          
        }

      }

    }
    else
    {
      if (novo_golos1 == novo_golos2)
      {
        if (jogo->golos1 > jogo->golos2)
        {
          e1->vitorias--;
        }
        else
        {
          if (jogo->golos1 < jogo->golos2)
          {
            e2->vitorias--;
          }
          else
          {
            
          }

        }

      }
      else
      {
        if ((jogo->golos1 > jogo->golos2) && (novo_golos1 < novo_golos2))
        {
          e1->vitorias--;
          e2->vitorias++;
        }
        else
        {
          if ((jogo->golos1 < jogo->golos2) && (novo_golos1 > novo_golos2))
          {
            e1->vitorias++;
            e2->vitorias--;
          }
          else
          {
            
          }

        }

      }

    }

    jogo->golos1 = novo_golos1;
    jogo->golos2 = novo_golos2;
  }

}

void mais_vitorias(lstEquipas lista, int nl)
{
  lstEquipas lista_mais_vit = criar_lst_equipas();
  linkEquipa aux;
  int max_vit = 0;
  int i;
  int comp;
  char **nomes_mais_vit;
  for (aux = lista->primeiro; aux != 0; aux = aux->prox)
  {
    if (aux->equipa->vitorias == max_vit)
    {
      adicionar_equipa_lst(lista_mais_vit, aux->equipa);
    }
    else
    {
      if (aux->equipa->vitorias > max_vit)
      {
        max_vit = aux->equipa->vitorias;
        limpar_lst_equipas(lista_mais_vit);
        adicionar_equipa_lst(lista_mais_vit, aux->equipa);
      }
      else
      {
        
      }

    }

  }

  comp = comp_lst_equipas(lista_mais_vit);
  if (comp > 0)
  {
    nomes_mais_vit = (char **) malloc(comp * (sizeof(char *)));
    aux = lista_mais_vit->primeiro;
    for (i = 0; i < comp; i++)
    {
      nomes_mais_vit[i] = aux->equipa->nome;
      aux = aux->prox;
    }

    qsort(nomes_mais_vit, comp, sizeof(char *), comparar_str);
    printf("%d Melhores %d\n", nl, max_vit);
    for (i = 0; i < comp; i++)
      printf("%d * %s\n", nl, nomes_mais_vit[i]);

    free(nomes_mais_vit);
  }
  else
  {
    
  }

  apagar_lst_equipas(lista_mais_vit);
}

void terminar_prog(lstJogos lista_jogos, lstEquipas lista_equipas, hashJogos hash_jogos, hashEquipas hash_equipas)
{
  apagar_hash_jogos(hash_jogos);
  apagar_hash_equipas(hash_equipas);
  apagar_lst_mais_jogos(lista_jogos);
  apagar_lst_mais_equipas(lista_equipas);
}

int comparar_str(const void *str1, const void *str2)
{
  char **s1 = (char **) str1;
  char **s2 = (char **) str2;
  return strcmp(*s1, *s2);
}

