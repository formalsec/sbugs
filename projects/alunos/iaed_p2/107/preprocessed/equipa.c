#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include "equipa.h"


int hash(char nome[])
{
  int h;
  int a = 31415;
  int b = 27183;
  for (h = 0; (*nome) != '\0'; nome++, a = (a * b) % (1049 - 1))
    h = ((a * h) + (*nome)) % 1049;

  return h;
}

no_equipa *cria_equipa(char nome[])
{
  no_equipa *novo = malloc(sizeof(no_equipa));
  novo->proximo = 0;
  novo->equipa_do_no.nome = malloc((strlen(nome) + 1) * (sizeof(char)));
  strcpy(novo->equipa_do_no.nome, nome);
  novo->equipa_do_no.vitorias = 0;
  return novo;
}

void adiciona_equipa(no_equipa *tabela_equipas[], char nome[], int *numero_equipas)
{
  no_equipa *novo = cria_equipa(nome);
  int pos = hash(nome);
  if (!tabela_equipas[pos])
  {
    tabela_equipas[pos] = novo;
  }
  else
  {
    novo->proximo = tabela_equipas[pos];
    tabela_equipas[pos] = novo;
  }

  (*numero_equipas)++;
}

equipa *procura_equipa_lista(no_equipa *tabela_equipas[], char nome[])
{
  no_equipa *i;
  equipa *res = 0;
  int pos = hash(nome);
  for (i = tabela_equipas[pos]; i; i = i->proximo)
  {
    if (!strcmp(i->equipa_do_no.nome, nome))
    {
      res = &i->equipa_do_no;
      return res;
    }
    else
    {
      
    }

  }

  return res;
}

void altera_vitoria_equipa(no_equipa *tabela_equipas[], char nome[], int chave)
{
  equipa *alvo = procura_equipa_lista(tabela_equipas, nome);
  if ((chave == 3) && alvo)
  {
    alvo->vitorias++;
  }
  else
  {
    alvo->vitorias--;
  }

}

int compara(const void *a, const void *b)
{
  const char *pa = *((const char **) a);
  const char *pb = *((const char **) b);
  return strcmp(pa, pb);
}

int *procura_mais_vitorias(int numero_equipas, no_equipa *tabela_equipas[])
{
  no_equipa *aux;
  int max = 0;
  int i;
  int *res;
  int cont = 0;
  int controlo;
  res = (int *) malloc((sizeof(int)) * 2);
  for (i = 0, controlo = 0; (i < 1049) && (controlo < numero_equipas); i++)
  {
    if (!tabela_equipas[i])
    {
      continue;
    }
    else
    {
      
    }

    for (aux = tabela_equipas[i]; aux; aux = aux->proximo, controlo++)
      if (aux->equipa_do_no.vitorias > max)
    {
      max = aux->equipa_do_no.vitorias;
      cont = 1;
    }
    else
    {
      if (aux->equipa_do_no.vitorias == max)
      {
        cont++;
      }
      else
      {
        
      }

    }


  }

  res[0] = max;
  res[1] = cont;
  return res;
}

void lista_mais_vitorias(no_equipa *tabela_equipas[], int linha, int numero_equipas)
{
  int tamanho;
  int max;
  int *res;
  int i;
  int controlo;
  no_equipa *aux;
  char **mais_vitorias;
  if (!numero_equipas)
  {
    return;
  }
  else
  {
    
  }

  res = procura_mais_vitorias(numero_equipas, tabela_equipas);
  tamanho = res[1];
  max = res[0];
  mais_vitorias = (char **) malloc(tamanho * (sizeof(char *)));
  for (i = 0, controlo = 0; (i < 1049) && (controlo < tamanho); i++)
  {
    if (!tabela_equipas[i])
    {
      continue;
    }
    else
    {
      
    }

    for (aux = tabela_equipas[i]; aux && (controlo < tamanho); aux = aux->proximo)
    {
      if (aux->equipa_do_no.vitorias == max)
      {
        mais_vitorias[controlo] = aux->equipa_do_no.nome;
        controlo++;
      }
      else
      {
        
      }

    }

  }

  qsort(mais_vitorias, tamanho, sizeof(char *), compara);
  printf("%d Melhores %d\n", linha, max);
  for (i = 0; i < tamanho; i++)
  {
    printf("%d * %s\n", linha, mais_vitorias[i]);
  }

  free(res);
  free(mais_vitorias);
}

