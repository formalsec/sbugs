/*File generated by PreProcessor.py*/


#include "jogo.h"
#include "equipa.h"


no_jogo_tabela *cria_jogo(char nome[], char equipa1[], char equipa2[], int score1, int score2)
{
  no_jogo_tabela *novo = (no_jogo_tabela *) malloc(sizeof(no_jogo_tabela));
  novo->proximo = 0;
  novo->pos_fila = 0;
  novo->anterior = 0;
  novo->jogo1.nome = malloc((strlen(nome) + 1) * (sizeof(char)));
  strcpy(novo->jogo1.nome, nome);
  novo->jogo1.equipa1 = malloc((strlen(equipa1) + 1) * (sizeof(char)));
  strcpy(novo->jogo1.equipa1, equipa1);
  novo->jogo1.equipa2 = malloc((strlen(equipa2) + 1) * (sizeof(char)));
  strcpy(novo->jogo1.equipa2, equipa2);
  novo->jogo1.score1 = score1;
  novo->jogo1.score2 = score2;
  return novo;
}

void adiciona_jogo(no_equipa *tabela_equipas[], lista_jogos **fila_jogos, no_jogo_tabela *tabela_jogos[], char nome[], char equipa1[], char equipa2[], int score1, int score2)
{
  no_jogo_tabela *novo = cria_jogo(nome, equipa1, equipa2, score1, score2);
  no_jogos *novo_no = malloc(sizeof(no_jogos));
  int pos = hash(nome);
  equipa *alvo;
  novo_no->proximo = 0;
  novo_no->anterior = 0;
  novo_no->jogo_n = novo;
  novo->pos_fila = novo_no;
  if (!(*fila_jogos)->inicio)
  {
    (*fila_jogos)->inicio = novo_no;
  }
  else
  {
    
  }

  if ((*fila_jogos)->fim)
  {
    (*fila_jogos)->fim->proximo = novo_no;
    novo_no->anterior = (*fila_jogos)->fim;
  }
  else
  {
    
  }

  (*fila_jogos)->fim = novo_no;
  if (!tabela_jogos[pos])
  {
    tabela_jogos[pos] = novo;
  }
  else
  {
    novo->proximo = tabela_jogos[pos];
    tabela_jogos[pos]->anterior = novo;
    tabela_jogos[pos] = novo;
  }

  if (score1 > score2)
  {
    alvo = procura_equipa_lista(tabela_equipas, equipa1);
    alvo->vitorias++;
  }
  else
  {
    if (score2 > score1)
    {
      alvo = procura_equipa_lista(tabela_equipas, equipa2);
      alvo->vitorias++;
    }
    else
    {
      
    }

  }

}

no_jogo_tabela *procura_jogo_lista(no_jogo_tabela *tabela_jogos[], char nome[])
{
  no_jogo_tabela *i;
  int pos = hash(nome);
  for (i = tabela_jogos[pos]; i; i = i->proximo)
  {
    if (!strcmp(nome, i->jogo1.nome))
    {
      return i;
    }
    else
    {
      
    }

  }

  return 0;
}

void lista_todos_jogos(lista_jogos *fila_jogos, int linha)
{
  no_jogos *i;
  for (i = fila_jogos->inicio; i; i = i->proximo)
  {
    printf("%d %s %s %s %d %d\n", linha, i->jogo_n->jogo1.nome, i->jogo_n->jogo1.equipa1, i->jogo_n->jogo1.equipa2, i->jogo_n->jogo1.score1, i->jogo_n->jogo1.score2);
  }

}

void apaga_jogo(no_equipa *tabela_equipas[], lista_jogos **fila_jogos, no_jogo_tabela *tabela_jogos[], char nome[])
{
  no_jogo_tabela *i;
  i = procura_jogo_lista(tabela_jogos, nome);
  if (i->anterior)
  {
    i->anterior->proximo = i->proximo;
  }
  else
  {
    int pos = hash(nome);
    tabela_jogos[pos] = i->proximo;
  }

  if (i->proximo)
  {
    i->proximo->anterior = i->anterior;
  }
  else
  {
    
  }

  if ((i->pos_fila == (*fila_jogos)->fim) && (i->pos_fila == (*fila_jogos)->inicio))
  {
    (*fila_jogos)->inicio = i->pos_fila->proximo;
    (*fila_jogos)->fim = i->pos_fila->proximo;
  }
  else
  {
    if (!i->pos_fila->anterior)
    {
      (*fila_jogos)->inicio = i->pos_fila->proximo;
      (*fila_jogos)->inicio->anterior = 0;
    }
    else
    {
      if (i->pos_fila == (*fila_jogos)->fim)
      {
        (*fila_jogos)->fim = i->pos_fila->anterior;
        (*fila_jogos)->fim->proximo = 0;
      }
      else
      {
        i->pos_fila->anterior->proximo = i->pos_fila->proximo;
        i->pos_fila->proximo->anterior = i->pos_fila->anterior;
      }

    }

  }

  if (i->jogo1.score1 > i->jogo1.score2)
  {
    altera_vitoria_equipa(tabela_equipas, i->jogo1.equipa1, 2);
  }
  else
  {
    if (i->jogo1.score2 > i->jogo1.score1)
    {
      altera_vitoria_equipa(tabela_equipas, i->jogo1.equipa2, 2);
    }
    else
    {
      
    }

  }

  free(i->pos_fila);
  free(i->jogo1.nome);
  free(i->jogo1.equipa1);
  free(i->jogo1.equipa2);
  free(i);
}

void altera_score(no_equipa *tabela_equipas[], no_jogo_tabela *tabela_jogos[], char nome[], int score_novo1, int score_novo2)
{
  jogo *jogo_alvo;
  no_jogo_tabela *aux = procura_jogo_lista(tabela_jogos, nome);
  jogo_alvo = &aux->jogo1;
  if (score_novo1 == score_novo2)
  {
    if (jogo_alvo->score1 > jogo_alvo->score2)
    {
      altera_vitoria_equipa(tabela_equipas, jogo_alvo->equipa1, 2);
    }
    else
    {
      if (jogo_alvo->score2 > jogo_alvo->score1)
      {
        altera_vitoria_equipa(tabela_equipas, jogo_alvo->equipa2, 2);
      }
      else
      {
        
      }

    }

  }
  else
  {
    if (jogo_alvo->score1 == jogo_alvo->score2)
    {
      if (score_novo1 > score_novo2)
      {
        altera_vitoria_equipa(tabela_equipas, jogo_alvo->equipa1, 3);
      }
      else
      {
        altera_vitoria_equipa(tabela_equipas, jogo_alvo->equipa2, 3);
      }

    }
    else
    {
      if ((score_novo1 > score_novo2) && (!(jogo_alvo->score1 > jogo_alvo->score2)))
      {
        altera_vitoria_equipa(tabela_equipas, jogo_alvo->equipa2, 2);
        altera_vitoria_equipa(tabela_equipas, jogo_alvo->equipa1, 3);
      }
      else
      {
        if ((score_novo2 > score_novo1) && (!(jogo_alvo->score2 > jogo_alvo->score1)))
        {
          altera_vitoria_equipa(tabela_equipas, jogo_alvo->equipa2, 3);
          altera_vitoria_equipa(tabela_equipas, jogo_alvo->equipa1, 2);
        }
        else
        {
          
        }

      }

    }

  }

  jogo_alvo->score1 = score_novo1;
  jogo_alvo->score2 = score_novo2;
}

