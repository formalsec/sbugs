#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>


typedef struct 
{
  char *nome;
  char *equipa1;
  char *equipa2;
  int score1;
  int score2;
} jogo;
typedef struct nodeJ
{
  int NL;
  jogo j;
  struct nodeJ *next;
} nodeJ;
typedef struct 
{
  char *nome;
  int jogosGanhos;
} equipa;
typedef struct nodeE
{
  equipa e;
  struct nodeE *next;
} nodeE;
int hashString(char *s)
{
  int i;
  int total = 0;
  int len = strlen(s);
  for (i = 0; i < len; i++)
  {
    total += (int) s[i];
  }

  return total % 167;
}

nodeJ *JogoExiste(char *nome, nodeJ *headJ)
{
  nodeJ *n;
  if (!headJ)
  {
    return 0;
  }
  else
  {
    
  }

  if (!strcmp(headJ->j.nome, nome))
  {
    return headJ;
  }
  else
  {
    
  }

  n = headJ;
  while (n->next)
  {
    n = n->next;
    if (!strcmp(n->j.nome, nome))
    {
      return n;
    }
    else
    {
      
    }

  }

  return 0;
}

nodeE *EquipaExiste(char *equipa, nodeE *headE)
{
  nodeE *n;
  if (!headE)
  {
    return 0;
  }
  else
  {
    
  }

  if (!strcmp(headE->e.nome, equipa))
  {
    return headE;
  }
  else
  {
    
  }

  n = headE;
  while (n->next)
  {
    n = n->next;
    if (!strcmp(n->e.nome, equipa))
    {
      return n;
    }
    else
    {
      
    }

  }

  return 0;
}

void IncrementaJogosGanhos(char *nome, nodeE **h)
{
  nodeE *n;
  n = *h;
  while (n)
  {
    if (!strcmp(n->e.nome, nome))
    {
      n->e.jogosGanhos++;
      break;
    }
    else
    {
      
    }

    n = n->next;
  }

}

void DecrementaJogosGanhos(char *nome, nodeE **h)
{
  nodeE *n;
  n = *h;
  while (n)
  {
    if (!strcmp(n->e.nome, nome))
    {
      n->e.jogosGanhos--;
      break;
    }
    else
    {
      
    }

    n = n->next;
  }

}

void AdicionaNovoJogo(int NL, nodeJ **htJ, nodeE **htE)
{
  int a;
  int b;
  int ind;
  int indE1;
  int indE2;
  nodeJ *n;
  nodeJ *headJ;
  char buffer1[1023];
  char buffer2[1023];
  char buffer3[1023];
  for (int buffer1_index = 0; buffer1_index < 10; buffer1_index++)
  {
    buffer1[buffer1_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer1[10 - 1] = '\0';
  for (int buffer2_index = 0; buffer2_index < 10; buffer2_index++)
  {
    buffer2[buffer2_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer2[10 - 1] = '\0';
  for (int buffer3_index = 0; buffer3_index < 10; buffer3_index++)
  {
    buffer3[buffer3_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer3[10 - 1] = '\0';
  a = new_sym_var(sizeof(int) * 8);
  b = new_sym_var(sizeof(int) * 8);
  ind = hashString(buffer1);
  headJ = htJ[ind];
  if (JogoExiste(buffer1, headJ))
  {
    printf("%d Jogo existente.\n", NL);
    return;
  }
  else
  {
    
  }

  indE1 = hashString(buffer2);
  indE2 = hashString(buffer3);
  if ((!EquipaExiste(buffer2, htE[indE1])) || (!EquipaExiste(buffer3, htE[indE2])))
  {
    printf("%d Equipa inexistente.\n", NL);
    return;
  }
  else
  {
    
  }

  if (!headJ)
  {
    htJ[ind] = calloc(1, sizeof(nodeJ));
    n = htJ[ind];
  }
  else
  {
    n = headJ;
    while (n->next)
      n = n->next;

    n->next = calloc(1, sizeof(nodeJ));
    n = n->next;
  }

  n->j.nome = malloc(strlen(buffer1) + 1);
  n->j.equipa1 = malloc(strlen(buffer2) + 1);
  n->j.equipa2 = malloc(strlen(buffer3) + 1);
  strcpy(n->j.nome, buffer1);
  strcpy(n->j.equipa1, buffer2);
  strcpy(n->j.equipa2, buffer3);
  n->j.score1 = a;
  n->j.score2 = b;
  n->NL = NL;
  if (a > b)
  {
    IncrementaJogosGanhos(buffer2, &htE[indE1]);
  }
  else
  {
    if (b > a)
    {
      IncrementaJogosGanhos(buffer3, &htE[indE2]);
    }
    else
    {
      
    }

  }

}

void ListaJogos(int NL, nodeJ **htJ)
{
  int j;
  int ind;
  int val;
  nodeJ **n = calloc(167, sizeof(nodeJ *));
  for (j = 0; j < 167; j++)
  {
    n[j] = htJ[j];
  }

  while (1)
  {
    ind = -1;
    val = -1;
    for (j = 0; j < 167; ++j)
    {
      if (n[j])
      {
        if ((n[j]->NL < val) || (val == (-1)))
        {
          ind = j;
          val = n[j]->NL;
        }
        else
        {
          
        }

      }
      else
      {
        
      }

    }

    if (ind == (-1))
    {
      free(n);
      return;
    }
    else
    {
      printf("%d %s %s %s %d %d\n", NL, n[ind]->j.nome, n[ind]->j.equipa1, n[ind]->j.equipa2, n[ind]->j.score1, n[ind]->j.score2);
      n[ind] = n[ind]->next;
    }

  }

}

void ProcuraJogo(int NL, nodeJ **htJ)
{
  nodeJ *n;
  int ind;
  char buffer1[1023];
  for (int buffer1_index = 0; buffer1_index < 10; buffer1_index++)
  {
    buffer1[buffer1_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer1[10 - 1] = '\0';
  ind = hashString(buffer1);
  n = JogoExiste(buffer1, htJ[ind]);
  if (!n)
  {
    printf("%d Jogo inexistente.\n", NL);
    return;
  }
  else
  {
    printf("%d %s %s %s %d %d\n", NL, n->j.nome, n->j.equipa1, n->j.equipa2, n->j.score1, n->j.score2);
    return;
  }

}

void ApagaJogo(int NL, nodeJ **htJ, nodeE **htE)
{
  nodeJ *n;
  nodeJ *tmp = 0;
  nodeJ *headJ;
  int ind;
  int indE1;
  int indE2;
  int flag = 0;
  char buffer1[1023];
  for (int buffer1_index = 0; buffer1_index < 10; buffer1_index++)
  {
    buffer1[buffer1_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer1[10 - 1] = '\0';
  ind = hashString(buffer1);
  headJ = htJ[ind];
  if (headJ)
  {
    if (!strcmp(headJ->j.nome, buffer1))
    {
      tmp = headJ;
      htJ[ind] = headJ->next;
      flag = 1;
    }
    else
    {
      n = headJ;
      while (n->next)
      {
        if (!strcmp(n->next->j.nome, buffer1))
        {
          tmp = n->next;
          n->next = n->next->next;
          flag = 1;
          break;
        }
        else
        {
          
        }

        n = n->next;
      }

    }

  }
  else
  {
    
  }

  if (!flag)
  {
    printf("%d Jogo inexistente.\n", NL);
  }
  else
  {
    indE1 = hashString(tmp->j.equipa1);
    indE2 = hashString(tmp->j.equipa2);
    if (tmp->j.score1 > tmp->j.score2)
    {
      DecrementaJogosGanhos(tmp->j.equipa1, &htE[indE1]);
    }
    else
    {
      if (tmp->j.score1 < tmp->j.score2)
      {
        DecrementaJogosGanhos(tmp->j.equipa2, &htE[indE2]);
      }
      else
      {
        
      }

    }

    free(tmp->j.equipa1);
    free(tmp->j.equipa2);
    free(tmp->j.nome);
    free(tmp);
  }

}

void AlteraScore(int NL, nodeJ **htJ, nodeE **htE)
{
  int a;
  int b;
  int c;
  int d;
  int ind;
  int indE1;
  int indE2;
  nodeJ *n;
  nodeJ *headJ;
  char buffer1[1023];
  for (int buffer1_index = 0; buffer1_index < 10; buffer1_index++)
  {
    buffer1[buffer1_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer1[10 - 1] = '\0';
  a = new_sym_var(sizeof(int) * 8);
  b = new_sym_var(sizeof(int) * 8);
  ind = hashString(buffer1);
  headJ = htJ[ind];
  n = JogoExiste(buffer1, headJ);
  if (!n)
  {
    printf("%d Jogo inexistente.\n", NL);
    return;
  }
  else
  {
    
  }

  c = n->j.score1;
  d = n->j.score2;
  n->j.score1 = a;
  n->j.score2 = b;
  indE1 = hashString(n->j.equipa1);
  indE2 = hashString(n->j.equipa2);
  if ((a > b) && (c <= d))
  {
    IncrementaJogosGanhos(n->j.equipa1, &htE[indE1]);
  }
  else
  {
    if ((a <= b) && (c > d))
    {
      DecrementaJogosGanhos(n->j.equipa1, &htE[indE1]);
    }
    else
    {
      
    }

  }

  if ((a < b) && (c >= d))
  {
    IncrementaJogosGanhos(n->j.equipa2, &htE[indE2]);
  }
  else
  {
    if ((a >= b) && (c < d))
    {
      DecrementaJogosGanhos(n->j.equipa2, &htE[indE2]);
    }
    else
    {
      
    }

  }

}

void AdicionaNovaEquipa(int NL, nodeE **htE, int *numE)
{
  nodeE *n;
  nodeE *headE;
  int ind;
  char buffer1[1023];
  for (int buffer1_index = 0; buffer1_index < 10; buffer1_index++)
  {
    buffer1[buffer1_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer1[10 - 1] = '\0';
  ind = hashString(buffer1);
  headE = htE[ind];
  if (EquipaExiste(buffer1, headE))
  {
    printf("%d Equipa existente.\n", NL);
    return;
  }
  else
  {
    
  }

  if (!headE)
  {
    htE[ind] = calloc(1, sizeof(nodeE));
    n = htE[ind];
  }
  else
  {
    n = headE;
    while (n->next)
      n = n->next;

    n->next = calloc(1, sizeof(nodeE));
    n = n->next;
  }

  n->e.nome = malloc(strlen(buffer1) + 1);
  strcpy(n->e.nome, buffer1);
  n->e.jogosGanhos = 0;
  *numE = (*numE) + 1;
}

void ProcuraEquipa(int NL, nodeE **htE)
{
  nodeE *n;
  int ind;
  char buffer1[1023];
  for (int buffer1_index = 0; buffer1_index < 10; buffer1_index++)
  {
    buffer1[buffer1_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer1[10 - 1] = '\0';
  ind = hashString(buffer1);
  n = EquipaExiste(buffer1, htE[ind]);
  if (!n)
  {
    printf("%d Equipa inexistente.\n", NL);
    return;
  }
  else
  {
    
  }

  printf("%d %s %d\n", NL, n->e.nome, n->e.jogosGanhos);
}

int comparador(const void *a, const void *b)
{
  return strcmp((*((nodeE **) a))->e.nome, (*((nodeE **) b))->e.nome);
}

void EquipasGanhadoras(int NL, nodeE **htE)
{
  nodeE **n;
  nodeE **array;
  int i = 0;
  int j;
  int jogosGanhos = 0;
  int numE = 0;
  n = calloc(167, sizeof(nodeJ *));
  for (j = 0; j < 167; j++)
  {
    n[j] = htE[j];
  }

  for (j = 0; j < 167; j++)
  {
    while (n[j])
    {
      if (n[j]->e.jogosGanhos > jogosGanhos)
      {
        jogosGanhos = n[j]->e.jogosGanhos;
        numE = 1;
      }
      else
      {
        if (n[j]->e.jogosGanhos == jogosGanhos)
        {
          numE++;
        }
        else
        {
          
        }

      }

      n[j] = n[j]->next;
    }

  }

  if (!numE)
  {
    free(n);
    return;
  }
  else
  {
    
  }

  array = (nodeE **) calloc(numE, sizeof(nodeE *));
  for (j = 0; j < 167; j++)
  {
    n[j] = htE[j];
  }

  for (j = 0; j < 167; j++)
  {
    while (n[j])
    {
      if (n[j]->e.jogosGanhos == jogosGanhos)
      {
        array[i] = n[j];
        i++;
      }
      else
      {
        
      }

      n[j] = n[j]->next;
    }

  }

  qsort(array, numE, sizeof(nodeE *), comparador);
  printf("%d Melhores %d\n", NL, jogosGanhos);
  for (i = 0; i < numE; i++)
    printf("%d * %s\n", NL, array[i]->e.nome);

  free(array);
  free(n);
}

void Terminar(nodeJ **htJ, nodeE **htE)
{
  nodeE *nE;
  nodeE *tmpE;
  nodeE *headE;
  nodeJ *nJ;
  nodeJ *tmpJ;
  nodeJ *headJ;
  int i;
  for (i = 0; i < 167; ++i)
  {
    headJ = htJ[i];
    if (headJ)
    {
      nJ = headJ;
      while (nJ->next)
      {
        tmpJ = nJ->next;
        nJ->next = nJ->next->next;
        free(tmpJ->j.equipa1);
        free(tmpJ->j.equipa2);
        free(tmpJ->j.nome);
        free(tmpJ);
      }

      free(nJ->j.equipa1);
      free(nJ->j.equipa2);
      free(nJ->j.nome);
      free(nJ);
    }
    else
    {
      
    }

  }

  for (i = 0; i < 167; ++i)
  {
    headE = htE[i];
    if (headE)
    {
      nE = headE;
      while (nE->next)
      {
        tmpE = nE->next;
        nE->next = nE->next->next;
        free(tmpE->e.nome);
        free(tmpE);
      }

      free(nE->e.nome);
      free(nE);
    }
    else
    {
      
    }

  }

  free(htJ);
  free(htE);
}

int main()
{
  nodeJ **hashtableJ = calloc(167, sizeof(nodeJ *));
  nodeE **hashtableE = calloc(167, sizeof(nodeE *));
  int car;
  int NL = 0;
  int numE = 0;
  while (car = getchar())
  {
    NL++;
    switch (car)
    {
      case 'a':
        AdicionaNovoJogo(NL, hashtableJ, hashtableE);
        break;

      case 'l':
        ListaJogos(NL, hashtableJ);
        break;

      case 'p':
        ProcuraJogo(NL, hashtableJ);
        break;

      case 'r':
        ApagaJogo(NL, hashtableJ, hashtableE);
        break;

      case 's':
        AlteraScore(NL, hashtableJ, hashtableE);
        break;

      case 'A':
        AdicionaNovaEquipa(NL, hashtableE, &numE);
        break;

      case 'P':
        ProcuraEquipa(NL, hashtableE);
        break;

      case 'g':
        EquipasGanhadoras(NL, hashtableE);
        break;

      case 'x':
        Terminar(hashtableJ, hashtableE);
        return 0;

    }

    getchar();
  }

  return 0;
}

