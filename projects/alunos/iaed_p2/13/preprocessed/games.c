/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "games.h"
#include "list.h"
#include "hash.h"


char *readName()
{
  char *str;
  char buffer[1024];
  getchar();
  for (int buffer_index = 0; buffer_index < 10; buffer_index++)
  {
    buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer[10 - 1] = '\0';
  str = (char *) malloc((sizeof(char)) * (strlen(buffer) + 1));
  strcpy(str, buffer);
  return str;
}

void clean()
{
  hashClean();
  cleanList();
}

char *getName(Game *game)
{
  return game->name;
}

void freeGame(void *item)
{
  Game *game = (Game *) item;
  free(game->name);
  free(game);
}

void freeTeam(void *item)
{
  Team *team = (Team *) item;
  free(team->name);
  free(team);
}

void addGame(int lineNumber)
{
  int c;
  char *name;
  char *home;
  char *away;
  unsigned int h;
  unsigned int a;
  Game *game = (Game *) malloc(sizeof(Game));
  Team *homeT;
  Team *awayT;
  name = readName();
  if (searchGameHash(name) != 0)
  {
    free(name);
    free(game);
    printf("%d Jogo existente.\n", lineNumber);
    while (((c = getchar()) != '\n') && (c != EOF))
      ;

    return;
  }
  else
  {
    
  }

  home = readName();
  homeT = searchTeamHash(home);
  free(home);
  if (homeT == 0)
  {
    free(name);
    free(game);
    printf("%d Equipa inexistente.\n", lineNumber);
    while (((c = getchar()) != '\n') && (c != EOF))
      ;

    return;
  }
  else
  {
    
  }

  away = readName();
  awayT = searchTeamHash(away);
  free(away);
  if (awayT == 0)
  {
    free(name);
    free(game);
    printf("%d Equipa inexistente.\n", lineNumber);
    while (((c = getchar()) != '\n') && (c != EOF))
      ;

    return;
  }
  else
  {
    
  }

  h = new_sym_var(sizeof(unsigned int) * 8);
  a = new_sym_var(sizeof(unsigned int) * 8);
  game->name = name;
  game->home = homeT;
  game->away = awayT;
  game->homeScore = h;
  game->awayScore = a;
  if (h > a)
  {
    homeT->wins++;
  }
  else
  {
    if (a > h)
    {
      awayT->wins++;
    }
    else
    {
      
    }

  }

  add(game);
}

void listGames(int lineNumber)
{
  printList(lineNumber);
}

void searchGame(int lineNumber)
{
  Game *game;
  char *name;
  name = readName();
  game = searchGameHash(name);
  free(name);
  if (game == 0)
  {
    printf("%d Jogo inexistente.\n", lineNumber);
    return;
  }
  else
  {
    
  }

  printGame(lineNumber, game);
}

void deleteGame(int lineNumber)
{
  Game *game;
  char *name;
  name = readName();
  game = (Game *) hashRemove(name);
  if (game == 0)
  {
    free(name);
    printf("%d Jogo inexistente.\n", lineNumber);
    return;
  }
  else
  {
    
  }

  if (game->homeScore > game->awayScore)
  {
    game->home->wins--;
  }
  else
  {
    if (game->awayScore > game->homeScore)
    {
      game->away->wins--;
    }
    else
    {
      
    }

  }

  listRemove(name);
  free(name);
  freeGame((void *) game);
}

void changeScore(int lineNumber)
{
  char *name;
  unsigned int homeS;
  unsigned int awayS;
  Game *game;
  name = readName();
  homeS = new_sym_var(sizeof(unsigned int) * 8);
  awayS = new_sym_var(sizeof(unsigned int) * 8);
  game = searchGameHash(name);
  free(name);
  if (game == 0)
  {
    printf("%d Jogo inexistente.\n", lineNumber);
    return;
  }
  else
  {
    
  }

  if (game->homeScore > game->awayScore)
  {
    game->home->wins--;
  }
  else
  {
    if (game->awayScore > game->homeScore)
    {
      game->away->wins--;
    }
    else
    {
      
    }

  }

  game->homeScore = homeS;
  game->awayScore = awayS;
  if (game->homeScore > game->awayScore)
  {
    game->home->wins++;
  }
  else
  {
    if (game->awayScore > game->homeScore)
    {
      game->away->wins++;
    }
    else
    {
      
    }

  }

}

void addTeam(int lineNumber)
{
  char *name;
  Team *team;
  name = readName();
  team = searchTeamHash(name);
  if (team != 0)
  {
    printf("%d Equipa existente.\n", lineNumber);
    free(name);
    return;
  }
  else
  {
    
  }

  team = (Team *) malloc(sizeof(Team));
  team->wins = 0;
  team->name = name;
  hashInsertTeam(team);
}

void searchTeam(int lineNumber)
{
  char *name;
  Team *team;
  name = readName();
  team = searchTeamHash(name);
  if (team == 0)
  {
    printf("%d Equipa inexistente.\n", lineNumber);
    free(name);
    return;
  }
  else
  {
    
  }

  printf("%d %s %u\n", lineNumber, team->name, team->wins);
  free(name);
}

void printGame(int lineNumber, Game *game)
{
  printf("%d %s %s %s %u %u\n", lineNumber, game->name, game->home->name, game->away->name, game->homeScore, game->awayScore);
}

void mostSuccessfulTeams(int lineNumber)
{
  char **list;
  char **aux;
  int length;
  unsigned int wins;
  list = getBestTeams(&length, &wins);
  if (length > 0)
  {
    printf("%d Melhores %u\n", lineNumber, wins);
    aux = (char **) malloc((sizeof(char *)) * length);
    mergeSort(list, aux, 0, length - 1);
    free(aux);
    printNames(list, length, lineNumber);
  }
  else
  {
    
  }

  free(list);
}

void printNames(char **arr, int len, int lineNumber)
{
  int i;
  for (i = 0; i < len; i++)
  {
    printf("%d * %s\n", lineNumber, arr[i]);
  }

}

void mergeSort(char **arr, char **aux, int l, int r)
{
  int m;
  if (l < r)
  {
    m = (r + l) / 2;
    mergeSort(arr, aux, l, m);
    mergeSort(arr, aux, m + 1, r);
    merge(arr, aux, l, m, r);
  }
  else
  {
    
  }

}

void merge(char **arr, char **aux, int left, int m, int right)
{
  int i;
  int j;
  int k;
  for (i = m + 1; i > left; i--)
    aux[i - 1] = arr[i - 1];

  for (j = m; j < right; j++)
    aux[(right + m) - j] = arr[j + 1];

  for (k = left; k <= right; k++)
  {
    if (lower(aux[j], aux[i]) || (i > m))
    {
      arr[k] = aux[j--];
    }
    else
    {
      arr[k] = aux[i++];
    }

  }

}

int lower(const char *a, const char *b)
{
  int i = 0;
  int j = 0;
  while ((a[i] != '\0') && (b[j] != '\0'))
  {
    if (a[i] == ' ')
    {
      i++;
    }
    else
    {
      
    }

    if (b[j] == ' ')
    {
      j++;
    }
    else
    {
      
    }

    if (a[i] == b[j])
    {
      i++;
      j++;
    }
    else
    {
      return a[i] < b[j];
    }

  }

  return 0;
}

int amountOfWins(void *team)
{
  return ((Team *) team)->wins;
}

char *nameOfTeam(void *team)
{
  return ((Team *) team)->name;
}

