/*File generated by PreProcessor.py*/


#include "hashtable.h"


void add_team(tnode **teams_tab, unsigned int line);
void search_team(tnode **teams_tab, unsigned int line);
void top_teams(tnode **teams_tab, unsigned int line);
void add_game(tnode **teams_tab, gnode **games_tab, gnode **games_list, unsigned int line);
void remove_game(tnode **teams_tab, gnode **games_tab, gnode **games_list, unsigned int line);
void search_game(gnode **games_tab, unsigned int line);
void change_score(tnode **teams_tab, gnode **games_tab, unsigned int line);
void list_games(gnode *games_list, unsigned int line);
void decide_winner(tnode **teams_tab, game *g);
void remove_win(tnode **teams_tab, game *g);
void list_top_teams(tnode *teams_list, unsigned int line);
int main()
{
  int cmd;
  unsigned int line = 1;
  tnode **teams_tab = 0;
  gnode **games_tab = 0;
  gnode *games_list = 0;
  teams_tab = init_teams(teams_tab);
  games_tab = init_games(games_tab);
  while (((cmd = getchar()) != EOF) && (cmd != 'x'))
  {
    getchar();
    switch (cmd)
    {
      case 'a':
        add_game(teams_tab, games_tab, &games_list, line);
        break;

      case 'l':
        list_games(games_list, line);
        break;

      case 'p':
        search_game(games_tab, line);
        break;

      case 'r':
        remove_game(teams_tab, games_tab, &games_list, line);
        break;

      case 's':
        change_score(teams_tab, games_tab, line);
        break;

      case 'A':
        add_team(teams_tab, line);
        break;

      case 'P':
        search_team(teams_tab, line);
        break;

      case 'g':
        top_teams(teams_tab, line);
        break;

    }

    line++;
  }

  destroy_teams(teams_tab);
  destroy_games(games_tab);
  destroy_games_list(games_list);
  return 0;
}

void add_team(tnode **teams_tab, unsigned int line)
{
  char name[1024];
  team *t;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  if (table_search_team(teams_tab, name) != 0)
  {
    printf("%u Equipa existente.\n", line);
    return;
  }
  else
  {
    
  }

  t = new_team(name);
  table_insert_team(teams_tab, t);
}

void search_team(tnode **teams_tab, unsigned int line)
{
  char name[1024];
  team *t;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  if ((t = table_search_team(teams_tab, name)) == 0)
  {
    printf("%u Equipa inexistente.\n", line);
    return;
  }
  else
  {
    
  }

  printf("%u %s %d\n", line, t->name, t->wins);
}

void add_game(tnode **teams_tab, gnode **games_tab, gnode **games_list, unsigned int line)
{
  char name[1024];
  char team1[1024];
  char team2[1024];
  int score1;
  int score2;
  game *g;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  for (int team1_index = 0; team1_index < 10; team1_index++)
  {
    team1[team1_index] = new_sym_var(sizeof(char) * 8);
  }

  team1[10 - 1] = '\0';
  for (int team2_index = 0; team2_index < 10; team2_index++)
  {
    team2[team2_index] = new_sym_var(sizeof(char) * 8);
  }

  team2[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  if (table_search_game(games_tab, name) != 0)
  {
    printf("%u Jogo existente.\n", line);
    return;
  }
  else
  {
    
  }

  if ((table_search_team(teams_tab, team1) == 0) || (table_search_team(teams_tab, team2) == 0))
  {
    printf("%u Equipa inexistente.\n", line);
    return;
  }
  else
  {
    
  }

  g = new_game(name, team1, team2, score1, score2);
  table_insert_game(games_tab, g);
  decide_winner(teams_tab, g);
  *games_list = insert_game_begin(*games_list, g);
}

void remove_game(tnode **teams_tab, gnode **games_tab, gnode **games_list, unsigned int line)
{
  game *g;
  char name[1024];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  if ((g = table_search_game(games_tab, name)) == 0)
  {
    printf("%u Jogo inexistente.\n", line);
    return;
  }
  else
  {
    
  }

  remove_win(teams_tab, g);
  table_delete_game(games_tab, name);
  *games_list = del_from_glist(*games_list, name);
}

void search_game(gnode **games_tab, unsigned int line)
{
  char name[1024];
  game *g;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  if ((g = table_search_game(games_tab, name)) == 0)
  {
    printf("%u Jogo inexistente.\n", line);
    return;
  }
  else
  {
    
  }

  printf("%u %s %s %s %u %u\n", line, g->name, g->t1, g->t2, g->score1, g->score2);
}

void change_score(tnode **teams_tab, gnode **games_tab, unsigned int line)
{
  game *g;
  char name[1024];
  int score1;
  int score2;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  if ((g = table_search_game(games_tab, name)) == 0)
  {
    printf("%u Jogo inexistente.\n", line);
    return;
  }
  else
  {
    
  }

  remove_win(teams_tab, g);
  g->score1 = score1;
  g->score2 = score2;
  decide_winner(teams_tab, g);
}

void list_games(gnode *games_list, unsigned int line)
{
  if (games_list == 0)
  {
    return;
  }
  else
  {
    
  }

  list_games(games_list->next, line);
  printf("%u %s %s %s %u %u\n", line, games_list->g->name, games_list->g->t1, games_list->g->t2, games_list->g->score1, games_list->g->score2);
}

void top_teams(tnode **teams_tab, unsigned int line)
{
  int higher;
  tnode *top_teams = 0;
  higher = table_search_higher(teams_tab);
  top_teams = table_search_top_teams(teams_tab, top_teams, higher);
  if (top_teams != 0)
  {
    printf("%u Melhores %d\n", line, higher);
    list_top_teams(top_teams, line);
  }
  else
  {
    
  }

  destroy_teams_list(top_teams);
}

void decide_winner(tnode **teams_tab, game *g)
{
  team *t;
  if (g->score1 > g->score2)
  {
    t = table_search_team(teams_tab, g->t1);
    t->wins++;
  }
  else
  {
    if (g->score1 < g->score2)
    {
      t = table_search_team(teams_tab, g->t2);
      t->wins++;
    }
    else
    {
      
    }

  }

}

void remove_win(tnode **teams_tab, game *g)
{
  team *t;
  if (g->score1 > g->score2)
  {
    t = table_search_team(teams_tab, g->t1);
    t->wins--;
  }
  else
  {
    if (g->score1 < g->score2)
    {
      t = table_search_team(teams_tab, g->t2);
      t->wins--;
    }
    else
    {
      
    }

  }

}

void list_top_teams(tnode *head, unsigned int line)
{
  if (head == 0)
  {
    return;
  }
  else
  {
    
  }

  list_top_teams(head->next, line);
  printf("%u * %s\n", line, head->t->name);
}

