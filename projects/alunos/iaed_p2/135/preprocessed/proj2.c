#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "hash_equipa.h"
#include "hash_jogo.h"
#include "lista_jogo.h"
#include "jogo.h"


void adiciona_novo_jogo(list *ls, hashtable_jogo *ht_jogo, hashtable_equipa *ht_equipa, const int n_comando);
void adiciona_nova_equipa(hashtable_equipa *ht_equipa, const int n_comando);
void lista_jogos(list *ls, const int n_comando);
void procura_jogo(hashtable_jogo *ht_jogo, const int n_comando);
void procura_equipa(hashtable_equipa *ht_equipa, const int n_comando);
void apaga_jogo(list *ls, hashtable_jogo *ht_jogo, hashtable_equipa *ht_equipa, const int n_comando);
void altera_score(hashtable_jogo *ht_jogo, hashtable_equipa *ht_equipa, const int n_comando);
void lista_equipa_mais_ganhos(hashtable_equipa *ht_equipa, const int n_comando);
int main()
{
  int input;
  int n_comando = 0;
  list *ls = cria_lista_dupla();
  hashtable_jogo *ht_jogo = cria_hash_jogo(1057);
  hashtable_equipa *ht_equipa = cria_hash_equipa(1057);
  while ((input = getchar()) != 'x')
  {
    n_comando++;
    switch (input)
    {
      case 'a':
        adiciona_novo_jogo(ls, ht_jogo, ht_equipa, n_comando);
        break;

      case 'A':
        adiciona_nova_equipa(ht_equipa, n_comando);
        break;

      case 'l':
        lista_jogos(ls, n_comando);
        break;

      case 'p':
        procura_jogo(ht_jogo, n_comando);
        break;

      case 'P':
        procura_equipa(ht_equipa, n_comando);
        break;

      case 'r':
        apaga_jogo(ls, ht_jogo, ht_equipa, n_comando);
        break;

      case 's':
        altera_score(ht_jogo, ht_equipa, n_comando);
        break;

      case 'g':
        lista_equipa_mais_ganhos(ht_equipa, n_comando);
        break;

    }

    getchar();
  }

  FREEhash_equipa(ht_equipa);
  FREEhash_jogo(ht_jogo);
  FREElista(ls);
  return 0;
}

void adiciona_novo_jogo(list *ls, hashtable_jogo *ht_jogo, hashtable_equipa *ht_equipa, const int n_comando)
{
  int s1;
  int s2;
  char nome[1023 + 1];
  char e1[1023 + 1];
  char e2[1023 + 1];
  pJogo j = 0;
  el_lista_jogo *el_j = 0;
  for (int nome_index = 0; nome_index < (1023 + 1); nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[(1023 + 1) - 1] = '\0';
  for (int e1_index = 0; e1_index < (1023 + 1); e1_index++)
  {
    e1[e1_index] = new_sym_var(sizeof(char) * 8);
  }

  e1[(1023 + 1) - 1] = '\0';
  for (int e2_index = 0; e2_index < (1023 + 1); e2_index++)
  {
    e2[e2_index] = new_sym_var(sizeof(char) * 8);
  }

  e2[(1023 + 1) - 1] = '\0';
  s1 = new_sym_var(sizeof(int) * 8);
  s2 = new_sym_var(sizeof(int) * 8);
  if (procuraHash_jogo(ht_jogo, nome))
  {
    printf("%d Jogo existente.\n", n_comando);
  }
  else
  {
    if ((!procuraHash_equipa(ht_equipa, e1)) || (!procuraHash_equipa(ht_equipa, e2)))
    {
      printf("%d Equipa inexistente.\n", n_comando);
    }
    else
    {
      j = cria_jogo(nome, e1, e2, s1, s2);
      if (j->vencedora)
      {
        procuraHash_equipa(ht_equipa, j->vencedora)->n_ganhos++;
      }
      else
      {
        
      }

      el_j = adiciona_elemento(ls, j);
      insereHash_jogo(ht_jogo, el_j);
    }

  }

}

void adiciona_nova_equipa(hashtable_equipa *ht_equipa, const int n_comando)
{
  char nome[1023 + 1];
  pEquipa e = 0;
  for (int nome_index = 0; nome_index < (1023 + 1); nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[(1023 + 1) - 1] = '\0';
  if (procuraHash_equipa(ht_equipa, nome))
  {
    printf("%d Equipa existente.\n", n_comando);
  }
  else
  {
    e = malloc(sizeof(equipa));
    e->nome = strdup(nome);
    e->n_ganhos = 0;
    insereHash_equipa(ht_equipa, e);
  }

}

void lista_jogos(list *ls, const int n_comando)
{
  imprime_lista_jogo(ls, n_comando);
}

void procura_jogo(hashtable_jogo *ht_jogo, const int n_comando)
{
  char nome[1023 + 1];
  el_lista_jogo *e = 0;
  pJogo j = 0;
  for (int nome_index = 0; nome_index < (1023 + 1); nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[(1023 + 1) - 1] = '\0';
  e = procuraHash_jogo(ht_jogo, nome);
  if (!e)
  {
    printf("%d Jogo inexistente.\n", n_comando);
  }
  else
  {
    j = e->j;
    printf("%d %s %s %s %d %d\n", n_comando, nome, j->equipa1, j->equipa2, j->score1, j->score2);
  }

}

void procura_equipa(hashtable_equipa *ht_equipa, const int n_comando)
{
  char nome[1023 + 1];
  pEquipa e = 0;
  ;
  for (int nome_index = 0; nome_index < (1023 + 1); nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[(1023 + 1) - 1] = '\0';
  if (e = procuraHash_equipa(ht_equipa, nome))
  {
    printf("%d %s %d\n", n_comando, nome, e->n_ganhos);
  }
  else
  {
    printf("%d Equipa inexistente.\n", n_comando);
  }

}

void apaga_jogo(list *ls, hashtable_jogo *ht_jogo, hashtable_equipa *ht_equipa, const int n_comando)
{
  char nome[1023 + 1];
  el_lista_jogo *el = 0;
  pEquipa equipa = 0;
  for (int nome_index = 0; nome_index < (1023 + 1); nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[(1023 + 1) - 1] = '\0';
  el = procuraHash_jogo(ht_jogo, nome);
  if (!el)
  {
    printf("%d Jogo inexistente.\n", n_comando);
  }
  else
  {
    if (el->j->vencedora)
    {
      equipa = procuraHash_equipa(ht_equipa, el->j->vencedora);
      equipa->n_ganhos--;
    }
    else
    {
      
    }

    remove_elemento(ls, el);
    apagaHash_jogo(ht_jogo, nome);
  }

}

void altera_score(hashtable_jogo *ht_jogo, hashtable_equipa *ht_equipa, const int n_comando)
{
  char nome[1023 + 1];
  char *vencedora_ant;
  int s1;
  int s2;
  el_lista_jogo *el = 0;
  for (int nome_index = 0; nome_index < (1023 + 1); nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[(1023 + 1) - 1] = '\0';
  s1 = new_sym_var(sizeof(int) * 8);
  s2 = new_sym_var(sizeof(int) * 8);
  el = procuraHash_jogo(ht_jogo, nome);
  if (!el)
  {
    printf("%d Jogo inexistente.\n", n_comando);
  }
  else
  {
    if (el->j->vencedora)
    {
      vencedora_ant = strdup(el->j->vencedora);
    }
    else
    {
      vencedora_ant = 0;
    }

    altera_score_jogo(el->j, s1, s2);
    if (el->j->vencedora && vencedora_ant)
    {
      if (strcmp(el->j->vencedora, vencedora_ant))
      {
        procuraHash_equipa(ht_equipa, el->j->vencedora)->n_ganhos++;
        procuraHash_equipa(ht_equipa, vencedora_ant)->n_ganhos--;
      }
      else
      {
        
      }

    }
    else
    {
      if (el->j->vencedora)
      {
        procuraHash_equipa(ht_equipa, el->j->vencedora)->n_ganhos++;
      }
      else
      {
        if (vencedora_ant)
        {
          procuraHash_equipa(ht_equipa, vencedora_ant)->n_ganhos--;
        }
        else
        {
          
        }

      }

    }

    if (vencedora_ant)
    {
      free(vencedora_ant);
    }
    else
    {
      
    }

  }

}

void lista_equipa_mais_ganhos(hashtable_equipa *ht_equipa, const int n_comando)
{
  int maior_n_ganhos = 0;
  int n_equipas = 0;
  maior_ganhos(ht_equipa, &maior_n_ganhos, &n_equipas);
  if (n_equipas)
  {
    nome_equipas_maior_ganhos(ht_equipa, maior_n_ganhos, n_equipas, n_comando);
  }
  else
  {
    
  }

}

