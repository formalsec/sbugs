#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include "hashtable.h"
#include "data.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>


int Hash(char *name, int size)
{
  int hash = 0;
  int prime = 421;
  for (; (*name) != '\0'; name++)
  {
    hash = ((prime * hash) + (*name)) % size;
  }

  return hash;
}

int compare(const void *t1, const void *t2)
{
  return strcmp((*((Team *) t1))->name, (*((Team *) t2))->name);
}

HT_Team NewHT_Team(int size)
{
  int i;
  HT_Team Teams = (HT_Team) malloc(sizeof(teamht));
  Teams->ht = (Team *) malloc((sizeof(Team)) * size);
  for (i = 0; i < size; i++)
  {
    Teams->ht[i] = 0;
  }

  Teams->num = 0;
  Teams->size = size;
  return Teams;
}

void DeleteHT_Team(HT_Team Teams)
{
  int i;
  int size = Teams->size;
  for (i = 0; i < size; i++)
  {
    if (Teams->ht[i] != 0)
    {
      DeleteTeam(Teams->ht[i]);
    }
    else
    {
      
    }

  }

  free(Teams->ht);
  free(Teams);
}

void InsertHT_Team(HT_Team Teams, Team team)
{
  char *name;
  int i;
  int size = Teams->size;
  name = NameTeam(team);
  i = Hash(name, size);
  while (Teams->ht[i] != 0)
  {
    i = (i + 1) % size;
  }

  Teams->ht[i] = team;
  Teams->num++;
  if (Teams->num > (Teams->size / 2))
  {
    ExpandHT_Team(Teams);
  }
  else
  {
    
  }

}

Team SearchHT_Team(HT_Team Teams, char *name)
{
  int i;
  int size = Teams->size;
  i = Hash(name, size);
  while (Teams->ht[i] != 0)
  {
    if (strcmp(NameTeam(Teams->ht[i]), name) == 0)
    {
      return Teams->ht[i];
    }
    else
    {
      
    }

    i = (i + 1) % size;
  }

  return 0;
}

void ExpandHT_Team(HT_Team Teams)
{
  int i;
  Team team;
  HT_Team tmp_teams;
  int new_size = 2 * Teams->size;
  tmp_teams = NewHT_Team(new_size);
  for (i = 0; i < (new_size / 2); i++)
  {
    team = Teams->ht[i];
    if (team != 0)
    {
      InsertHT_Team(tmp_teams, team);
    }
    else
    {
      
    }

  }

  free(Teams->ht);
  Teams->ht = tmp_teams->ht;
  Teams->size = tmp_teams->size;
  free(tmp_teams);
}

void HighestWin(HT_Team Teams, int NL)
{
  Team team;
  Team *teams = 0;
  int i;
  int size = Teams->size;
  int nteams = 0;
  int win = 0;
  if (Teams->num == 0)
  {
    return;
  }
  else
  {
    
  }

  for (i = 0; i < size; i++)
  {
    team = Teams->ht[i];
    if (team != 0)
    {
      if (team->wins > win)
      {
        win = team->wins;
      }
      else
      {
        
      }

    }
    else
    {
      
    }

  }

  for (i = 0; i < size; i++)
  {
    team = Teams->ht[i];
    if (team != 0)
    {
      if (team->wins == win)
      {
        nteams++;
        teams = (Team *) realloc(teams, (sizeof(Team)) * nteams);
        teams[nteams - 1] = team;
      }
      else
      {
        
      }

    }
    else
    {
      
    }

  }

  qsort(teams, nteams, sizeof(Team), compare);
  printf("%d Melhores %d\n", NL, win);
  for (i = 0; i < nteams; i++)
  {
    printf("%d * %s\n", NL, teams[i]->name);
  }

  free(teams);
}

HT_Game NewHT_Game(int size)
{
  int i;
  HT_Game Games = (HT_Game) malloc(sizeof(gameht));
  Games->ht = (Game *) malloc((sizeof(Game)) * size);
  for (i = 0; i < size; i++)
  {
    Games->ht[i] = 0;
  }

  Games->num = 0;
  Games->size = size;
  return Games;
}

void DeleteHT_Game(HT_Game Games)
{
  int i;
  int size = Games->size;
  for (i = 0; i < size; i++)
  {
    if (Games->ht[i] != 0)
    {
      DeleteGame(Games->ht[i]);
    }
    else
    {
      
    }

  }

  free(Games->ht);
  free(Games);
}

void InsertHT_Game(HT_Game Games, Game game)
{
  char *name;
  int i;
  int size = Games->size;
  name = NameGame(game);
  i = Hash(name, size);
  while (Games->ht[i] != 0)
  {
    i = (i + 1) % size;
  }

  Games->ht[i] = game;
  Games->num++;
  if (Games->num > (Games->size / 2))
  {
    ExpandHT_Game(Games);
  }
  else
  {
    
  }

}

void RemoveHT_Game(HT_Game Games, Game game)
{
  int k;
  int i;
  int size = Games->size;
  Game tmp;
  i = Hash(NameGame(game), size);
  while (Games->ht[i] != game)
  {
    i = (i + 1) % size;
  }

  DeleteGame(game);
  Games->num--;
  Games->ht[i] = 0;
  for (k = (i + 1) % size; Games->ht[k] != 0; k = (k + 1) % size)
  {
    tmp = Games->ht[k];
    Games->ht[k] = 0;
    Games->num--;
    InsertHT_Game(Games, tmp);
  }

}

Game SearchHT_Game(HT_Game Games, char *name)
{
  int i;
  int size = Games->size;
  i = Hash(name, size);
  while (Games->ht[i] != 0)
  {
    if (strcmp(NameGame(Games->ht[i]), name) == 0)
    {
      return Games->ht[i];
    }
    else
    {
      
    }

    i = (i + 1) % size;
  }

  return 0;
}

void ExpandHT_Game(HT_Game Games)
{
  int i;
  Game game;
  HT_Game tmp_game;
  int new_size = 2 * Games->size;
  tmp_game = NewHT_Game(new_size);
  for (i = 0; i < (new_size / 2); i++)
  {
    game = Games->ht[i];
    if (game != 0)
    {
      InsertHT_Game(tmp_game, game);
    }
    else
    {
      
    }

  }

  free(Games->ht);
  Games->ht = tmp_game->ht;
  Games->size = tmp_game->size;
  free(tmp_game);
}

