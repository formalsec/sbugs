#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "equipa.h"


lista_equipa inicia_lista_equipa()
{
  lista_equipa le = (lista_equipa) malloc(sizeof(struct elist));
  le->head = 0;
  le->tamanho = 0;
  le->max_vitorias = 0;
  le->cont_equipas_max_vit = 0;
  return le;
}

pequipa nova_equipa(char *buffer)
{
  pequipa x = (pequipa) malloc(sizeof(struct equipa));
  x->nome = (char *) malloc((sizeof(char)) * (strlen(buffer) + 1));
  strcpy(x->nome, buffer);
  x->vitorias = 0;
  return x;
}

void inserir_equipa(lista_equipa le, char *texto)
{
  elink x = (elink) malloc(sizeof(struct enode));
  x->e = nova_equipa(texto);
  if (le->head == 0)
  {
    x->next = 0;
  }
  else
  {
    x->next = le->head;
  }

  le->head = x;
  le->tamanho++;
}

void libertar_equipa(elink x)
{
  free(x->e->nome);
  free(x->e);
  free(x);
}

void eliminar_lista_equipa(lista_equipa le)
{
  elink atual;
  elink prox;
  atual = le->head;
  while (atual != 0)
  {
    prox = atual->next;
    libertar_equipa(atual);
    atual = prox;
  }

  free(le);
}

void procura_max_vitorias(lista_equipa le)
{
  elink x;
  for (x = le->head; x != 0; x = x->next)
  {
    if (x->e->vitorias > le->max_vitorias)
    {
      le->max_vitorias = x->e->vitorias;
      le->cont_equipas_max_vit = 1;
    }
    else
    {
      if (x->e->vitorias == le->max_vitorias)
      {
        le->cont_equipas_max_vit++;
      }
      else
      {
        
      }

    }

  }

}

int compara_strings(const void *a, const void *b)
{
  return strcmp(*((const char **) a), *((const char **) b));
}

void encontra_max_vitorias(int cont, lista_equipa le)
{
  int max = le->cont_equipas_max_vit;
  char **tab = (char **) malloc((sizeof(char *)) * max);
  elink x;
  int i = 0;
  for (x = le->head; i < le->cont_equipas_max_vit; x = x->next)
  {
    if (x->e->vitorias == le->max_vitorias)
    {
      tab[i] = x->e->nome;
      i++;
    }
    else
    {
      
    }

  }

  qsort(tab, max, sizeof(char *), compara_strings);
  printf("%d Melhores %d\n", cont, le->max_vitorias);
  for (i = 0; i < max; i++)
  {
    printf("%d * %s\n", cont, tab[i]);
  }

  free(tab);
}

int hash(char *v, int M)
{
  int h = 0;
  int a = 127;
  for (; (*v) != '\0'; v++)
    h = ((a * h) + (*v)) % M;

  return h;
}

ht_equipas iniciar_tabela_equipas()
{
  ht_equipas ht_e = (ht_equipas) malloc(sizeof(struct hashtable_equipas));
  ht_e->hash_equipas = 0;
  ht_e->max = 499;
  ht_e->atual = 0;
  return ht_e;
}

pequipa *iniciar_hash_equipas(int M)
{
  int i;
  pequipa *hash_equipas = (pequipa *) malloc(M * (sizeof(pequipa)));
  for (i = 0; i < M; i++)
    hash_equipas[i] = 0;

  return hash_equipas;
}

void eliminar_hash_equipas(pequipa *hash_equipas, int M)
{
  int i;
  for (i = 0; i < M; i++)
  {
    if (hash_equipas[i] != 0)
    {
      hash_equipas[i] = 0;
    }
    else
    {
      
    }

  }

  free(hash_equipas);
}

void expandir_hash_equipas(ht_equipas ht_e);
void insere_equipa_hash_equipas(ht_equipas ht_e, pequipa e)
{
  int i = hash(e->nome, ht_e->max);
  while (ht_e->hash_equipas[i] != 0)
    i = (i + 1) % ht_e->max;

  ht_e->hash_equipas[i] = e;
  ht_e->atual++;
  if (ht_e->atual > (ht_e->max / 2))
  {
    expandir_hash_equipas(ht_e);
  }
  else
  {
    
  }

}

void expandir_hash_equipas(ht_equipas ht_e)
{
  int i;
  pequipa *t = ht_e->hash_equipas;
  ht_e->hash_equipas = iniciar_hash_equipas(2 * ht_e->max);
  ht_e->max = 2 * ht_e->max;
  ht_e->atual = 0;
  for (i = 0; i < (ht_e->max / 2); i++)
  {
    if (t[i] != 0)
    {
      insere_equipa_hash_equipas(ht_e, t[i]);
    }
    else
    {
      
    }

  }

  free(t);
}

int procura_equipa_hash_equipas(ht_equipas ht_e, char *texto)
{
  int i = hash(texto, ht_e->max);
  while (ht_e->hash_equipas[i] != 0)
    if (strcmp(ht_e->hash_equipas[i]->nome, texto) == 0)
  {
    return i;
  }
  else
  {
    i = (i + 1) % ht_e->max;
  }


  return -1;
}

