#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include "hashtable.h"
#include "hashtableEquipa.h"
#include <stdlib.h>
#include <string.h>


int hash(char *str, int m)
{
  int key = 0;
  unsigned int i;
  for (i = 0; i < strlen(str); ++i)
  {
    key = key + str[i];
  }

  key = key % m;
  return key;
}

char *key(Item item)
{
  return item->nome;
}

void init(int m)
{
  int i;
  heads = 0;
  heads = (Node **) malloc(m * (sizeof(Node *)));
  for (i = 0; i < m; i++)
    heads[i] = 0;

}

void insert(int tamHash, Item item)
{
  int i = hash(key(item), tamHash);
  Node *newNode = 0;
  newNode = (Node *) malloc(sizeof(Node));
  newNode->item = item;
  newNode->next = heads[i];
  heads[i] = newNode;
}

void delete(int tamHash, char *text, int tamHashEquipa)
{
  Node *head = 0;
  Node *prev = 0;
  Node *aux = 0;
  ItemEquipa ptr;
  int i = hash(text, tamHash);
  head = heads[i];
  while (strcmp(head->item->nome, text) != 0)
  {
    prev = head;
    head = head->next;
  }

  if (prev == 0)
  {
    if (head->item->pontos.score1 > head->item->pontos.score2)
    {
      ptr = searchEquipa(tamHashEquipa, head->item->equipa1);
      ptr->pontosVencedores = ptr->pontosVencedores - 1;
    }
    else
    {
      
    }

    if (head->item->pontos.score2 > head->item->pontos.score1)
    {
      ptr = searchEquipa(tamHashEquipa, head->item->equipa2);
      ptr->pontosVencedores = ptr->pontosVencedores - 1;
    }
    else
    {
      
    }

    aux = heads[i]->next;
    free(heads[i]->item->nome);
    free(heads[i]->item->equipa1);
    free(heads[i]->item->equipa2);
    free(heads[i]->item);
    free(heads[i]);
    heads[i] = aux;
  }
  else
  {
    aux = head->next;
    if (head->item->pontos.score1 > head->item->pontos.score2)
    {
      ptr = searchEquipa(tamHashEquipa, head->item->equipa1);
      ptr->pontosVencedores = ptr->pontosVencedores - 1;
    }
    else
    {
      
    }

    if (head->item->pontos.score2 > head->item->pontos.score1)
    {
      ptr = searchEquipa(tamHashEquipa, head->item->equipa2);
      ptr->pontosVencedores = ptr->pontosVencedores - 1;
    }
    else
    {
      
    }

    free(head->item->nome);
    free(head->item->equipa1);
    free(head->item->equipa2);
    free(head->item);
    free(head);
    prev->next = aux;
  }

}

Item search(int tamHash, char *text)
{
  Node *head = 0;
  Node *t = 0;
  int i = hash(text, tamHash);
  head = heads[i];
  for (t = head; t != 0; t = t->next)
  {
    if (strcmp(t->item->nome, text) == 0)
    {
      return t->item;
    }
    else
    {
      
    }

  }

  return 0;
}

void deleteTudo(int i)
{
  Node *head;
  Node *prev = 0;
  Node *aux = 0;
  head = heads[i];
  if (head != 0)
  {
    aux = head->next;
    while (aux != 0)
    {
      prev = aux;
      aux = aux->next;
      free(prev->item->equipa2);
      free(prev->item->equipa1);
      free(prev->item->nome);
      free(prev->item);
      free(prev);
    }

    free(heads[i]->item->nome);
    free(heads[i]->item->equipa1);
    free(heads[i]->item->equipa2);
    free(heads[i]->item);
    free(heads[i]);
  }
  else
  {
    
  }

}

void deleteHeads()
{
  free(heads);
}

Item *HashToArray(int tamHash, int contadorJogos)
{
  Item *array = 0;
  int i;
  int j = 0;
  Node *head;
  if (contadorJogos == 0)
  {
    return 0;
  }
  else
  {
    array = (Item *) malloc((sizeof(Item)) * contadorJogos);
    for (i = 0; i < contadorJogos; i++)
      array[i] = 0;

    for (i = 0; i < tamHash; ++i)
    {
      head = heads[i];
      while (head != 0)
      {
        array[j] = head->item;
        head = head->next;
        ++j;
      }

    }

    return array;
  }

}

void chk_hashtable(int *tamHash, int contadorJogos)
{
  int prev = *tamHash;
  Item *array;
  Node *head;
  Node *aux;
  int i;
  array = HashToArray(*tamHash, contadorJogos);
  for (i = 0; i < prev; ++i)
  {
    head = heads[i];
    while (head != 0)
    {
      aux = head->next;
      free(head);
      head = aux;
    }

  }

  free(heads);
  *tamHash = (*tamHash) + 500;
  init(*tamHash);
  for (i = 0; i < contadorJogos; ++i)
  {
    insert(*tamHash, array[i]);
  }

  free(array);
}

