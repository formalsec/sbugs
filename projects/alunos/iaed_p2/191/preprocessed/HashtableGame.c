#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "HashtableGame.h"


static int power(int base, int exp)
{
  int i;
  int res;
  res = 1;
  for (i = 0; i < exp; i++)
  {
    res = res * base;
  }

  return res;
}

static int hash(int factor, char *key)
{
  int hash;
  int len;
  int a;
  int i;
  hash = 0;
  a = power(factor, 2);
  len = strlen(key);
  for (i = 0; i < len; i++)
  {
    a = (a * len) % (factor - 1);
    hash = ((a * hash) + (*(key + i))) % factor;
  }

  return hash;
}

static int hash2(int factor, char *key)
{
  int mod;
  mod = ((*key) + strlen(key)) * 3;
  return 1 + (mod * hash(factor, key));
}

HTG *newHTG(int factor, int size)
{
  int i;
  HTG *table;
  table = (HTG *) malloc(sizeof(HTG));
  table->size = size;
  table->factor = factor;
  table->items = (Game **) malloc((sizeof(Game *)) * factor);
  for (i = 0; i < factor; i++)
  {
    table->items[i] = 0;
  }

  return table;
}

void insertHTG(HTG *table, Game *game)
{
  int i;
  int k;
  int factor;
  char *key;
  Game **vector;
  key = game->name;
  factor = table->factor;
  vector = table->items;
  i = hash(factor, key);
  k = hash2(factor, key);
  while ((vector[i] != 0) && (!vector[i]->isDeleted))
  {
    i = (i + k) % factor;
  }

  vector[i] = game;
  table->size++;
}

void deleteHTG(HTG *table, Game *game)
{
  int i;
  int k;
  int factor;
  char *key;
  Game **vector;
  key = game->name;
  factor = table->factor;
  vector = table->items;
  i = hash(factor, key);
  k = hash2(factor, key);
  while (vector[i] != 0)
  {
    if (!strcmp(vector[i]->name, key))
    {
      break;
    }
    else
    {
      i = (i + k) % factor;
    }

  }

  if (vector[i] == 0)
  {
    return;
  }
  else
  {
    
  }

  vector[i]->isDeleted = 1;
  table->size--;
}

Game *getGame(HTG *table, char *name)
{
  int i;
  int k;
  int factor;
  Game **vector;
  factor = table->factor;
  vector = table->items;
  i = hash(factor, name);
  k = hash2(factor, name);
  while ((vector[i] != 0) && (!vector[i]->isDeleted))
  {
    if (!strcmp(vector[i]->name, name))
    {
      return vector[i];
    }
    else
    {
      i = (i + k) % factor;
    }

  }

  return 0;
}

void freeHTG(HTG *table)
{
  int i;
  int size;
  int factor;
  Game **vector;
  size = table->size;
  factor = table->factor;
  vector = table->items;
  if (size >= 0)
  {
    for (i = 0; i < factor; i++)
    {
      if (vector[i] != 0)
      {
        freeGame(vector[i]);
      }
      else
      {
        
      }

    }

  }
  else
  {
    
  }

  free(vector);
  free(table);
}

