#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdbool.h>
#include "teamHTable.h"
#include<assert.h>


void err(const char *msg)
{
  printf("ERR: %s\n", msg);
  exit(1);
}

char *my_strdup(char *in)
{
  char *str;
  char *p;
  int len = 0;
  while (in[len])
    len++;

  str = malloc(len + 1);
  p = str;
  while (*in)
    *(p++) = *(in++);

  *p = '\0';
  return str;
}

int hash(char *v)
{
  int h = 0;
  int a = 31415;
  int b = 27183;
  for (h = 0; (*v) != '\0'; v++, a = (a * b) % ((9677 * 2) - 1))
    h = ((a * h) + (*v)) % 9677;

  return h;
}

int hashtwo(char *v)
{
  int h = 0;
  int a = 7879;
  int b = 4513;
  for (h = 0; (*v) != '\0'; v++, a = (a * b) % ((9677 * 2) - 1))
    h = ((a * h) + (*v)) % 9677;

  return h;
}

tlink **init_HTteams(int number)
{
  int i;
  tlink **HTteams = malloc((number * 2) * (sizeof(tlink *)));
  for (i = 0; i < (number * 2); i++)
  {
    HTteams[i] = 0;
  }

  return HTteams;
}

tlink **texpand(tlink **HTteams, int number)
{
  int i;
  tlink **t = HTteams;
  tlink **newHTteam;
  newHTteam = init_HTteams(number * 4);
  for (i = 0; i < (number * 2); i++)
  {
    if (t[i]->t->name != 0)
    {
      tsimplyInsert(t[i], newHTteam);
    }
    else
    {
      
    }

  }

  free(t);
  return newHTteam;
}

tlink *tsimplyInsert(tlink *new, tlink **HTteams)
{
  int i;
  int k;
  i = hash(new->t->name);
  k = hashtwo(new->t->name);
  printf("volto a inserir %s\n", new->t->name);
  while (HTteams[i] != 0)
    i = (i + k) % 9677;

  HTteams[i] = new;
  return new;
}

pTeam **team_array(int counter)
{
  int i;
  pTeam **lista = malloc(counter * (sizeof(pTeam *)));
  for (i = 0; i < counter; i++)
  {
    lista[i] = 0;
  }

  return lista;
}

pTeam *create_team(char *buffer0)
{
  pTeam *equipa = malloc(sizeof(struct team));
  equipa = malloc(sizeof(struct team));
  equipa->wins = 0;
  equipa->name = my_strdup(buffer0);
  return equipa;
}

tlink *tLinkInsert(char *buffer0, tlink *link, tlink **HTteams)
{
  int i;
  int k;
  if (search_team(HTteams, buffer0) != 0)
  {
    return 0;
  }
  else
  {
    link->t = create_team(buffer0);
    i = hash(link->t->name);
    k = hashtwo(link->t->name);
    while (HTteams[i] != 0)
      i = (i + k) % (9677 * 2);

    HTteams[i] = link;
    return link;
  }

}

tlink *search_team(tlink **HTteams, char *nome)
{
  int i;
  int k;
  tlink *link;
  i = hash(nome);
  k = hashtwo(nome);
  link = HTteams[i];
  while (HTteams[i] != 0)
  {
    link = HTteams[i];
    if (strcmp(nome, link->t->name) == 0)
    {
      return HTteams[i];
    }
    else
    {
      i = (i + k) % (9677 * 2);
    }

  }

  return 0;
}

pTeam **search_el(pTeam **aux, tlink **HTteams, int count)
{
  int i;
  int j = 0;
  pTeam **equipa = team_array(count);
  pTeam *taux;
  for (i = 0; i < count; i++)
  {
    if (equipa[i] != 0)
    {
      equipa[i] = aux[i];
    }
    else
    {
      
    }

  }

  while (j < count)
  {
    for (i = 0; i < (9677 * 2); i++)
    {
      if (HTteams[i] != 0)
      {
        taux = HTteams[i]->t;
        if (equipa[j] != taux)
        {
          equipa[j] = taux;
        }
        else
        {
          
        }

        j++;
      }
      else
      {
        
      }

    }

  }

  return equipa;
}

pTeam **abc_winners(pTeam **STteams, int counter)
{
  int i;
  int j;
  pTeam **equipa = team_array(counter);
  for (i = 0; i < counter; i++)
  {
    equipa[i] = STteams[i];
  }

  for (i = 0; i < (counter - 1); i++)
  {
    for (j = i + 1; j < counter; j++)
    {
      if (strcmp(STteams[i]->name, STteams[j]->name) > 0)
      {
        equipa[i] = STteams[i];
        STteams[i] = STteams[j];
        STteams[j] = equipa[i];
      }
      else
      {
        
      }

    }

  }

  return STteams;
}

tlink *change_win_team(tlink **HTteams, char *nome, int var)
{
  int i;
  int k;
  tlink *link;
  i = hash(nome);
  k = hashtwo(nome);
  while (HTteams[i] != 0)
  {
    link = HTteams[i];
    if (strcmp(nome, link->t->name) == 0)
    {
      if (var == 2)
      {
        link->t->wins += 1;
      }
      else
      {
        if (var == 3)
        {
          link->t->wins -= 1;
        }
        else
        {
          
        }

      }

      return link;
    }
    else
    {
      i = (i + k) % 9677;
    }

  }

  return 0;
}

bool teamisEmpty(tlink **HTteams)
{
  int i;
  for (i = 0; i < (9677 * 2); i++)
  {
    if (HTteams[i] != 0)
    {
      return false;
    }
    else
    {
      
    }

  }

  return true;
}

void teamFree(pTeam *t)
{
  free(t->name);
  free(t);
}

void free_tTable(tlink *ttable)
{
  int i;
  pTeam *t;
  for (i = 0; i <= 9677; i++)
  {
    t = &ttable->t[i];
    if (t != 0)
    {
      teamFree(t);
    }
    else
    {
      
    }

  }

  free(ttable->t);
  free(ttable);
}

