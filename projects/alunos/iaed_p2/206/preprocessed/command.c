#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "command.h"
#include "game.h"
#include "team.h"


void a_addNewGame(Game_List *GL, Game_Hashtable *GH, Team_Hashtable *TH, int n)
{
  char buffer_name[1024];
  char buffer_team1[1024];
  char buffer_team2[1024];
  int score1;
  int score2;
  Game new_game;
  Game existed_game;
  Team existed_team1;
  Team existed_team2;
  getchar();
  for (int buffer_name_index = 0; buffer_name_index < 10; buffer_name_index++)
  {
    buffer_name[buffer_name_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer_name[10 - 1] = '\0';
  for (int buffer_team1_index = 0; buffer_team1_index < 10; buffer_team1_index++)
  {
    buffer_team1[buffer_team1_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer_team1[10 - 1] = '\0';
  for (int buffer_team2_index = 0; buffer_team2_index < 10; buffer_team2_index++)
  {
    buffer_team2[buffer_team2_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer_team2[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  if ((existed_game = search_game_hashtable(GH, buffer_name)) != 0)
  {
    printf("%d Jogo existente.\n", n);
    return;
  }
  else
  {
    
  }

  if ((existed_team1 = search_team_hashtable(TH, buffer_team1)) == 0)
  {
    printf("%d Equipa inexistente.\n", n);
    return;
  }
  else
  {
    
  }

  if ((existed_team2 = search_team_hashtable(TH, buffer_team2)) == 0)
  {
    printf("%d Equipa inexistente.\n", n);
    return;
  }
  else
  {
    
  }

  new_game = create_game(buffer_name, buffer_team1, buffer_team2, score1, score2);
  insert_game_hashtable(GH, new_game);
  add_last_game_list(GL, new_game);
  if (score1 > score2)
  {
    existed_team1->winnings++;
  }
  else
  {
    
  }

  if (score1 < score2)
  {
    existed_team2->winnings++;
  }
  else
  {
    
  }

}

void A_addNewTeam(Team_List *TL, Team_Hashtable *TH, int n)
{
  char buffer_name[1024];
  Team new_team;
  Team existed_team;
  getchar();
  for (int buffer_name_index = 0; buffer_name_index < 10; buffer_name_index++)
  {
    buffer_name[buffer_name_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer_name[10 - 1] = '\0';
  if ((existed_team = search_team_hashtable(TH, buffer_name)) != 0)
  {
    printf("%d Equipa existente.\n", n);
    return;
  }
  else
  {
    
  }

  new_team = create_team(buffer_name);
  insert_team_hashtable(TH, new_team);
  add_last_team_list(TL, new_team);
}

void l_printAllGames(Game_List *GL, int n)
{
  Game_Node *aux_game_node = GL->head;
  while (aux_game_node != 0)
  {
    printf("%d %s %s %s %d %d\n", n, aux_game_node->game->name, aux_game_node->game->team1, aux_game_node->game->team2, aux_game_node->game->score1, aux_game_node->game->score2);
    aux_game_node = aux_game_node->next;
  }

}

void p_searchGame(Game_Hashtable *GH, int n)
{
  char buffer_name[1024];
  Game existed_game;
  getchar();
  for (int buffer_name_index = 0; buffer_name_index < 10; buffer_name_index++)
  {
    buffer_name[buffer_name_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer_name[10 - 1] = '\0';
  if ((existed_game = search_game_hashtable(GH, buffer_name)) == 0)
  {
    printf("%d Jogo inexistente.\n", n);
    return;
  }
  else
  {
    
  }

  printf("%d %s %s %s %d %d\n", n, existed_game->name, existed_game->team1, existed_game->team2, existed_game->score1, existed_game->score2);
}

void P_searchTeam(Team_Hashtable *TH, int n)
{
  char buffer_name[1024];
  Team existed_team;
  getchar();
  for (int buffer_name_index = 0; buffer_name_index < 10; buffer_name_index++)
  {
    buffer_name[buffer_name_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer_name[10 - 1] = '\0';
  if ((existed_team = search_team_hashtable(TH, buffer_name)) == 0)
  {
    printf("%d Equipa inexistente.\n", n);
    return;
  }
  else
  {
    
  }

  printf("%d %s %d\n", n, existed_team->name, existed_team->winnings);
}

void r_deleteGame(Game_List *GL, Game_Hashtable *GH, Team_Hashtable *TH, int n)
{
  char buffer_name[1024];
  int old_score1;
  int old_score2;
  Game existed_game;
  Team existed_team1;
  Team existed_team2;
  getchar();
  for (int buffer_name_index = 0; buffer_name_index < 10; buffer_name_index++)
  {
    buffer_name[buffer_name_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer_name[10 - 1] = '\0';
  if ((existed_game = search_game_hashtable(GH, buffer_name)) == 0)
  {
    printf("%d Jogo inexistente.\n", n);
    return;
  }
  else
  {
    
  }

  old_score1 = existed_game->score1;
  old_score2 = existed_game->score2;
  existed_team1 = search_team_hashtable(TH, existed_game->team1);
  existed_team2 = search_team_hashtable(TH, existed_game->team2);
  if (old_score1 < old_score2)
  {
    existed_team2->winnings--;
  }
  else
  {
    
  }

  if (old_score1 > old_score2)
  {
    existed_team1->winnings--;
  }
  else
  {
    
  }

  remove_game_list(GL, existed_game->name);
  remove_game_hashtable(GH, existed_game->name);
}

void s_changeGameScore(Game_Hashtable *GH, Team_Hashtable *TH, int n)
{
  char buffer_name[1024];
  int new_score1;
  int new_score2;
  int old_score1;
  int old_score2;
  Game existed_game;
  Team existed_team1;
  Team existed_team2;
  getchar();
  for (int buffer_name_index = 0; buffer_name_index < 10; buffer_name_index++)
  {
    buffer_name[buffer_name_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer_name[10 - 1] = '\0';
  new_score1 = new_sym_var(sizeof(int) * 8);
  new_score2 = new_sym_var(sizeof(int) * 8);
  if ((existed_game = search_game_hashtable(GH, buffer_name)) == 0)
  {
    printf("%d Jogo inexistente.\n", n);
    return;
  }
  else
  {
    
  }

  existed_team1 = search_team_hashtable(TH, existed_game->team1);
  existed_team2 = search_team_hashtable(TH, existed_game->team2);
  old_score1 = existed_game->score1;
  old_score2 = existed_game->score2;
  if ((old_score1 < old_score2) && (new_score1 > new_score2))
  {
    existed_team1->winnings++;
    existed_team2->winnings--;
  }
  else
  {
    if ((old_score1 > old_score2) && (new_score1 < new_score2))
    {
      existed_team1->winnings--;
      existed_team2->winnings++;
    }
    else
    {
      if ((old_score1 == old_score2) && (new_score1 > new_score2))
      {
        existed_team1->winnings++;
      }
      else
      {
        if ((old_score1 == old_score2) && (new_score1 < new_score2))
        {
          existed_team2->winnings++;
        }
        else
        {
          if ((old_score1 < old_score2) && (new_score1 == new_score2))
          {
            existed_team2->winnings--;
          }
          else
          {
            if ((old_score1 > old_score2) && (new_score1 == new_score2))
            {
              existed_team1->winnings--;
            }
            else
            {
              
            }

          }

        }

      }

    }

  }

  existed_game->score1 = new_score1;
  existed_game->score2 = new_score2;
}

void g_findWinners(Team_List *TL, int n)
{
  int i = 0;
  int k;
  int j;
  int number_of_teams;
  int more_winnings = 0;
  int team_count = length_team_list(TL);
  Team *winners;
  Team aux_team;
  Team_Node *aux_team_node;
  Team_Node *aux_team_node2;
  winners = malloc((sizeof(int)) * team_count);
  aux_team_node = TL->head;
  aux_team_node2 = TL->head;
  while (aux_team_node != 0)
  {
    if (aux_team_node->team->winnings >= more_winnings)
    {
      more_winnings = aux_team_node->team->winnings;
      aux_team_node = aux_team_node->next;
    }
    else
    {
      aux_team_node = aux_team_node->next;
    }

  }

  while (aux_team_node2 != 0)
  {
    if (aux_team_node2->team->winnings == more_winnings)
    {
      winners[i] = aux_team_node2->team;
      i++;
      aux_team_node2 = aux_team_node2->next;
    }
    else
    {
      aux_team_node2 = aux_team_node2->next;
    }

  }

  number_of_teams = i;
  for (j = 0; j < number_of_teams; j++)
  {
    for (k = j; k < number_of_teams; k++)
    {
      if (strcmp(winners[j]->name, winners[k]->name) > 0)
      {
        aux_team = winners[j];
        winners[j] = winners[k];
        winners[k] = aux_team;
      }
      else
      {
        
      }

    }

  }

  if (number_of_teams != 0)
  {
    printf("%d Melhores %d\n", n, more_winnings);
    for (j = 0; j < number_of_teams; j++)
    {
      printf("%d * %s\n", n, winners[j]->name);
    }

  }
  else
  {
    
  }

  free(winners);
  return;
}

void x_exitApp(Team_List *TL, Team_Hashtable *TH, Game_List *GL, Game_Hashtable *GH)
{
  free_teams_list(TL);
  free_games_list(GL);
  free_teams_hashtable(TH);
  free_games_hashtable(GH);
  return;
}

