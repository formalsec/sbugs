/*File generated by PreProcessor.py*/


#include "remove.h"


void rmvWin(list *tms, char *name)
{
  node *ptr = tms->head;
  while (ptr != 0)
  {
    ptr = ptr->next;
  }

  while (ptr)
  {
    if (strcmp(ptr->name, name) == 0)
    {
      ptr->won--;
      break;
    }
    else
    {
      
    }

    ptr = ptr->next;
  }

}

void deleteNode(node *del_n, int flag)
{
  if (flag == 0)
  {
    free(del_n->name);
    free(del_n->team1);
    free(del_n->team2);
  }
  else
  {
    free(del_n->name);
  }

  free(del_n);
}

void pop(list *ls, node *del, int flag)
{
  if (del->previous == 0)
  {
    ls->head = del->next;
  }
  else
  {
    del->previous->next = del->next;
  }

  if (del->next == 0)
  {
    ls->end = del->previous;
  }
  else
  {
    del->next->previous = del->previous;
  }

  deleteNode(del, flag);
}

void eraseGames(list *ls, char name[1024])
{
  hashNode *del;
  hashNode *aux;
  int idx = getHashKey(name);
  del = games[idx].head;
  if (del == 0)
  {
    return;
  }
  else
  {
    if (strcmp(del->point->name, name) == 0)
    {
      aux = del->next;
      pop(ls, del->point, 0);
      free(del);
      games[idx].head = aux;
      return;
    }
    else
    {
      
    }

  }

  while (del->next != 0)
  {
    if (strcmp(del->next->point->name, name) == 0)
    {
      break;
    }
    else
    {
      del = del->next;
    }

  }

  aux = del->next;
  pop(ls, aux->point, 0);
  free(aux);
  del->next = aux->next;
}

void eraseTeams(list *ls, char name[1024])
{
  hashNode *del;
  hashNode *aux;
  int idx = getHashKey(name);
  del = teams[idx].head;
  if (del == 0)
  {
    return;
  }
  else
  {
    if (strcmp(del->point->name, name) == 0)
    {
      aux = del->next;
      pop(ls, del->point, 1);
      free(del);
      teams[idx].head = aux;
      return;
    }
    else
    {
      
    }

  }

  while (del->next != 0)
  {
    if (strcmp(del->next->point->name, name) == 0)
    {
      break;
    }
    else
    {
      del = del->next;
    }

  }

  aux = del->next;
  pop(ls, aux->point, 1);
  free(aux);
  del->next = aux->next;
}

void removeGame(list *ls, list *tms)
{
  hashNode *search;
  hashNode *team1;
  hashNode *team2;
  char name[1024];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  search = getNodeGames(name);
  if (search == 0)
  {
    printf("%d Jogo inexistente.\n", counter);
    return;
  }
  else
  {
    
  }

  team1 = getNodeTeams(search->point->team1);
  team2 = getNodeTeams(search->point->team2);
  if (search->point->score1 > search->point->score2)
  {
    rmvWin(tms, team1->point->name);
    team1->point->won--;
  }
  else
  {
    if (search->point->score1 < search->point->score2)
    {
      rmvWin(tms, team2->point->name);
      team2->point->won--;
    }
    else
    {
      
    }

  }

  eraseGames(ls, name);
}

