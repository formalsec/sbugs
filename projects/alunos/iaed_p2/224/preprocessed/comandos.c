#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include "comandos.h"
#include "core.h"


Jogo *CriaJogo(char input_separado[5][1024])
{
  char *nome = input_separado[0];
  char *equipaX = input_separado[1];
  char *equipaY = input_separado[2];
  int scoreX = atoi(input_separado[3]);
  int scoreY = atoi(input_separado[4]);
  Jogo *jogo;
  jogo = (Jogo *) malloc(sizeof(Jogo));
  jogo->nome = (char *) malloc((strlen(nome) + 1) * (sizeof(char)));
  strcpy(jogo->nome, nome);
  jogo->equipaX = (char *) malloc((strlen(equipaX) + 1) * (sizeof(char)));
  strcpy(jogo->equipaX, equipaX);
  jogo->equipaY = (char *) malloc((strlen(equipaY) + 1) * (sizeof(char)));
  strcpy(jogo->equipaY, equipaY);
  jogo->scoreX = scoreX;
  jogo->scoreY = scoreY;
  jogo->drt = 0;
  jogo->esq = 0;
  return jogo;
}

void AdicionaNovoJogo(int NL, Jogo *jogo, Node **hash_table_jogos, Node **hash_table_equipas, Lista *lista_jogos)
{
  char *nome = jogo->nome;
  char *nome_equipaX = jogo->equipaX;
  char *nome_equipaY = jogo->equipaY;
  Node *node_jogo;
  Equipa *equipaX = 0;
  Equipa *equipaY = 0;
  int existeJogo = !(!ProcuraNaHashTable(nome, hash_table_jogos, 0));
  equipaX = ProcuraNaHashTable(nome_equipaX, hash_table_equipas, 1);
  equipaY = ProcuraNaHashTable(nome_equipaY, hash_table_equipas, 1);
  if (((!existeJogo) && (!(!equipaX))) && (!(!equipaY)))
  {
    if (jogo->scoreX > jogo->scoreY)
    {
      equipaX->jogos_ganhos++;
    }
    else
    {
      if (jogo->scoreX < jogo->scoreY)
      {
        equipaY->jogos_ganhos++;
      }
      else
      {
        
      }

    }

    node_jogo = CriaNode(jogo);
    InsereNaHashTable(hash_table_jogos, node_jogo, 0);
    InsereNaLista(lista_jogos, jogo, 0);
  }
  else
  {
    DestroiJogo(jogo);
    (existeJogo) ? (printf("%d Jogo existente.\n", NL)) : (((!equipaX) || (!equipaY)) ? (printf("%d Equipa inexistente.\n", NL)) : (0));
  }

}

void ListaJogosIntroduzidos(int NL, Lista *lista_jogos)
{
  Jogo *jogo = lista_jogos->cabeca;
  while (jogo)
  {
    printf("%d %s %s %s %d %d\n", NL, jogo->nome, jogo->equipaX, jogo->equipaY, jogo->scoreX, jogo->scoreY);
    jogo = jogo->drt;
  }

}

void ProcuraJogo(int NL, char input_separado[5][1024], Node **hash_table_jogos)
{
  char *nome = input_separado[0];
  Jogo *jogo;
  jogo = ProcuraNaHashTable(nome, hash_table_jogos, 0);
  if (jogo)
  {
    printf("%d %s %s %s %d %d\n", NL, jogo->nome, jogo->equipaX, jogo->equipaY, jogo->scoreX, jogo->scoreY);
  }
  else
  {
    printf("%d Jogo inexistente.\n", NL);
  }

}

void ApagaJogo(int NL, char input_separado[5][1024], Node **hash_table_jogos, Node **hash_table_equipas, Lista *lista_jogos)
{
  char *nome = input_separado[0];
  Jogo *jogo;
  Equipa *equipaX;
  Equipa *equipaY;
  jogo = ProcuraNaHashTable(nome, hash_table_jogos, 0);
  if (!jogo)
  {
    printf("%d Jogo inexistente.\n", NL);
  }
  else
  {
    equipaX = ProcuraNaHashTable(jogo->equipaX, hash_table_equipas, 1);
    equipaY = ProcuraNaHashTable(jogo->equipaY, hash_table_equipas, 1);
    if (jogo->scoreX > jogo->scoreY)
    {
      equipaX->jogos_ganhos--;
    }
    else
    {
      if (jogo->scoreY > jogo->scoreX)
      {
        equipaY->jogos_ganhos--;
      }
      else
      {
        
      }

    }

    LimpaElemento(nome, hash_table_jogos, lista_jogos, DestroiJogo, 1);
  }

}

void AlteraScore(int NL, char input_separado[5][1024], Node **hash_table_jogos, Node **hash_table_equipas)
{
  char *nome = input_separado[0];
  int scoreX_novo = atoi(input_separado[1]);
  int scoreY_novo = atoi(input_separado[2]);
  Jogo *jogo;
  Equipa *equipaX;
  Equipa *equipaY;
  jogo = ProcuraNaHashTable(nome, hash_table_jogos, 0);
  if (!jogo)
  {
    printf("%d Jogo inexistente.\n", NL);
  }
  else
  {
    equipaX = ProcuraNaHashTable(jogo->equipaX, hash_table_equipas, 1);
    equipaY = ProcuraNaHashTable(jogo->equipaY, hash_table_equipas, 1);
    if ((scoreX_novo > scoreY_novo) && (jogo->scoreX < jogo->scoreY))
    {
      equipaX->jogos_ganhos++;
      equipaY->jogos_ganhos--;
    }
    else
    {
      if ((scoreX_novo > scoreY_novo) && (jogo->scoreX == jogo->scoreY))
      {
        equipaX->jogos_ganhos++;
      }
      else
      {
        if ((scoreY_novo > scoreX_novo) && (jogo->scoreY < jogo->scoreX))
        {
          equipaY->jogos_ganhos++;
          equipaX->jogos_ganhos--;
        }
        else
        {
          if ((scoreY_novo > scoreX_novo) && (jogo->scoreY == jogo->scoreX))
          {
            equipaY->jogos_ganhos++;
          }
          else
          {
            if ((scoreX_novo == scoreY_novo) && (jogo->scoreX > jogo->scoreY))
            {
              equipaX->jogos_ganhos--;
            }
            else
            {
              if ((scoreX_novo == scoreY_novo) && (jogo->scoreY > jogo->scoreX))
              {
                equipaY->jogos_ganhos--;
              }
              else
              {
                
              }

            }

          }

        }

      }

    }

    jogo->scoreX = scoreX_novo;
    jogo->scoreY = scoreY_novo;
  }

}

Equipa *CriaEquipa(char input_separado[5][1024])
{
  char *nome = input_separado[0];
  Equipa *equipa;
  equipa = (Equipa *) malloc(sizeof(Equipa));
  equipa->nome = (char *) malloc((strlen(nome) + 1) * (sizeof(char)));
  strcpy(equipa->nome, nome);
  equipa->jogos_ganhos = 0;
  equipa->drt = 0;
  equipa->esq = 0;
  return equipa;
}

void AdicionaNovaEquipa(int NL, Equipa *equipa, Node **hash_table_equipas, Lista *lista_equipas)
{
  Node *node_equipa;
  char *nome = equipa->nome;
  int existeEquipa = !(!ProcuraNaHashTable(nome, hash_table_equipas, 1));
  if (!existeEquipa)
  {
    node_equipa = CriaNode(equipa);
    InsereNaHashTable(hash_table_equipas, node_equipa, 1);
    InsereNaLista(lista_equipas, equipa, 1);
  }
  else
  {
    DestroiEquipa(equipa);
    (existeEquipa) ? (printf("%d Equipa existente.\n", NL)) : (0);
  }

}

void ProcuraEquipa(int NL, char input_separado[5][1024], Node **hash_table_equipas)
{
  char *nome = input_separado[0];
  Equipa *equipa = ProcuraNaHashTable(nome, hash_table_equipas, 1);
  if (!(!equipa))
  {
    printf("%d %s %d\n", NL, nome, equipa->jogos_ganhos);
  }
  else
  {
    printf("%d Equipa inexistente.\n", NL);
  }

}

void Trocar(Equipa *a, Equipa *b)
{
  char *temp_nome = a->nome;
  int temp_jogos_ganhos = a->jogos_ganhos;
  a->nome = b->nome;
  a->jogos_ganhos = b->jogos_ganhos;
  b->nome = temp_nome;
  b->jogos_ganhos = temp_jogos_ganhos;
}

void BubbleSort(Equipa *inicial)
{
  int trocado;
  Equipa *equipaA;
  Equipa *equipaB = 0;
  if (inicial == 0)
  {
    return;
  }
  else
  {
    
  }

  do
  {
    trocado = 0;
    equipaA = inicial;
    while (equipaA->drt != equipaB)
    {
      if (strcmp(equipaA->nome, equipaA->drt->nome) > 0)
      {
        Trocar(equipaA, equipaA->drt);
        trocado = 1;
      }
      else
      {
        
      }

      equipaA = equipaA->drt;
    }

    equipaB = equipaA;
  }
  while (trocado);
}

void OrdenaEquipas(int NL, Lista *lista)
{
  int mais_jogos_ganhos = 0;
  Equipa *equipa_aux = lista->cabeca;
  Equipa *copia = 0;
  Equipa *aux_apagar = 0;
  Lista *lista_aux_equipas = CriaLista();
  while (equipa_aux)
  {
    if (equipa_aux->jogos_ganhos > mais_jogos_ganhos)
    {
      mais_jogos_ganhos = equipa_aux->jogos_ganhos;
    }
    else
    {
      
    }

    equipa_aux = equipa_aux->drt;
  }

  equipa_aux = lista->cabeca;
  while (equipa_aux)
  {
    if (equipa_aux->jogos_ganhos == mais_jogos_ganhos)
    {
      copia = malloc(sizeof(Equipa));
      copia->nome = (char *) malloc((strlen(equipa_aux->nome) + 1) * (sizeof(char)));
      strcpy(copia->nome, equipa_aux->nome);
      copia->jogos_ganhos = equipa_aux->jogos_ganhos;
      copia->drt = 0;
      copia->esq = 0;
      InsereNaLista(lista_aux_equipas, copia, 1);
    }
    else
    {
      
    }

    equipa_aux = equipa_aux->drt;
  }

  if (lista_aux_equipas->cabeca)
  {
    BubbleSort(lista_aux_equipas->cabeca);
    printf("%d Melhores %d\n", NL, mais_jogos_ganhos);
    equipa_aux = lista_aux_equipas->cabeca;
    while (equipa_aux)
    {
      printf("%d * %s\n", NL, equipa_aux->nome);
      aux_apagar = equipa_aux;
      equipa_aux = equipa_aux->drt;
      free(aux_apagar->nome);
      free(aux_apagar);
    }

  }
  else
  {
    
  }

  free(lista_aux_equipas);
}

