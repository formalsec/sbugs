#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdlib.h>
#include <stdio.h>
#include <string.h>


unsigned int hash(char *v, int M)
{
  int h;
  int a = 31415;
  int b = 27183;
  for (h = 0; (*v) != '\0'; v++, a = (a * b) % (M - 1))
    h = ((a * h) + (*v)) % M;

  return h;
}

typedef struct team
{
  char name[1023];
  int wins;
  struct team *next;
} team;
typedef struct game
{
  char name[1023];
  char team1[1023];
  char team2[1023];
  int score1;
  int score2;
  struct game *next;
} game;
static team *hash_table_team[5];
static team *team_head = 0;
static game *hash_table_game[5];
static game *game_head = 0;
void init_hash_table_team()
{
  int i;
  for (i = 0; i < 5; i++)
    hash_table_team[i] = 0;

}

void init_hash_table_game()
{
  int i;
  for (i = 0; i < 5; i++)
    hash_table_game[i] = 0;

}

team *init_team()
{
  team *p = (team *) malloc(sizeof(team));
  return p;
}

game *init_game()
{
  game *p = (game *) malloc(sizeof(game));
  return p;
}

void insert_game(game *t, char *name, char *team1, char *team2, int *score1, int *score2)
{
  int index = hash(name, 5);
  game *end;
  game *t_list = init_game();
  strcpy(t->name, name);
  strcpy(t->team1, team1);
  strcpy(t->team2, team2);
  t->score1 = *score1;
  t->score2 = *score2;
  t->next = hash_table_game[index];
  hash_table_game[index] = t;
  strcpy(t_list->name, name);
  strcpy(t_list->team1, team1);
  strcpy(t_list->team2, team2);
  t_list->score1 = *score1;
  t_list->score2 = *score2;
  if (game_head == 0)
  {
    t_list->next = game_head;
    game_head = t_list;
  }
  else
  {
    
  }

  for (end = game_head; end->next != 0; end = end->next)
    ;

  end->next = t_list;
  t_list->next = 0;
}

void insert_team(team *t, char *name)
{
  int index = hash(name, 5);
  team *end;
  team *t_list = init_team();
  strcpy(t->name, name);
  t->wins = 0;
  t->next = hash_table_team[index];
  hash_table_team[index] = t;
  strcpy(t_list->name, name);
  t_list->wins = 0;
  if (team_head == 0)
  {
    t_list->next = team_head;
    team_head = t_list;
  }
  else
  {
    
  }

  for (end = team_head; end->next != 0; end = end->next)
    ;

  end->next = t_list;
  t_list->next = 0;
}

team *team_search(char *name)
{
  int index = hash(name, 5);
  team *tmp = hash_table_team[index];
  while ((tmp != 0) && (strcmp(tmp->name, name) != 0))
    tmp = tmp->next;

  return tmp;
}

game *game_search(char *name)
{
  int index = hash(name, 5);
  game *tmp = hash_table_game[index];
  while ((tmp != 0) && (strcmp(tmp->name, name) != 0))
    tmp = tmp->next;

  return tmp;
}

team *teamlist_search(char *name)
{
  team *tmp = team_head;
  while ((tmp != 0) && (strcmp(tmp->name, name) != 0))
    tmp = tmp->next;

  return tmp;
}

game *gamelist_search(char *name)
{
  game *tmp = game_head;
  while ((tmp != 0) && (strcmp(tmp->name, name) != 0))
    tmp = tmp->next;

  return tmp;
}

void game_delete_hash(char *name)
{
  int index = hash(name, 5);
  game *prev = 0;
  game *tmp = hash_table_game[index];
  while ((tmp != 0) && (strcmp(tmp->name, name) != 0))
  {
    prev = tmp;
    tmp = tmp->next;
  }

  if (prev == 0)
  {
    hash_table_game[index] = tmp->next;
  }
  else
  {
    prev->next = tmp->next;
  }

}

void game_delete_list(char *name)
{
  game *prev = 0;
  game *tmp = game_head;
  while ((tmp != 0) && (strcmp(tmp->name, name) != 0))
  {
    prev = tmp;
    tmp = tmp->next;
  }

  if (prev == 0)
  {
    game_head = tmp->next;
  }
  else
  {
    prev->next = tmp->next;
  }

}

void a(int *l)
{
  char name[1023];
  char team1[1023];
  char team2[1023];
  int score1;
  int score2;
  game *p = init_game();
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  getchar();
  for (int team1_index = 0; team1_index < 10; team1_index++)
  {
    team1[team1_index] = new_sym_var(sizeof(char) * 8);
  }

  team1[10 - 1] = '\0';
  getchar();
  for (int team2_index = 0; team2_index < 10; team2_index++)
  {
    team2[team2_index] = new_sym_var(sizeof(char) * 8);
  }

  team2[10 - 1] = '\0';
  getchar();
  score1 = new_sym_var(sizeof(int) * 8);
  getchar();
  score2 = new_sym_var(sizeof(int) * 8);
  getchar();
  (*l)++;
  if (game_search(name) != 0)
  {
    free(p);
    printf("%d Jogo existente.\n", *l);
  }
  else
  {
    if ((team_search(team1) == 0) || (team_search(team2) == 0))
    {
      free(p);
      printf("%d Equipa inexistente.\n", *l);
    }
    else
    {
      insert_game(p, name, team1, team2, &score1, &score2);
      if (score1 > score2)
      {
        team_search(game_search(name)->team1)->wins += 1;
        teamlist_search(game_search(name)->team1)->wins += 1;
      }
      else
      {
        if (score2 > score1)
        {
          team_search(game_search(name)->team2)->wins += 1;
          teamlist_search(game_search(name)->team2)->wins += 1;
        }
        else
        {
          
        }

      }

    }

  }

}

void A(int *l)
{
  char name[1023];
  team *p = init_team();
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  getchar();
  (*l)++;
  if (team_search(name) == 0)
  {
    insert_team(p, name);
  }
  else
  {
    printf("%d Equipa existente.\n", *l);
    free(p);
  }

}

void l(int *l)
{
  game *temp = game_head;
  (*l)++;
  while (temp != 0)
  {
    printf("%d %s %s %s %d %d\n", *l, temp->name, temp->team1, temp->team2, temp->score1, temp->score2);
    temp = temp->next;
  }

}

void p(int *l)
{
  char name[1023];
  game *temp;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  getchar();
  (*l)++;
  temp = game_search(name);
  if (temp != 0)
  {
    printf("%d %s %s %s %d %d\n", *l, temp->name, temp->team1, temp->team2, temp->score1, temp->score2);
  }
  else
  {
    printf("%d Jogo inexistente.\n", *l);
  }

}

void P(int *l)
{
  char name[1023];
  team *tmp;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  getchar();
  (*l)++;
  tmp = team_search(name);
  if (tmp != 0)
  {
    printf("%d %s %d\n", *l, name, tmp->wins);
  }
  else
  {
    printf("%d Equipa inexistente.\n", *l);
  }

}

void r(int *l)
{
  char name[1023];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  getchar();
  if (game_search(name) == 0)
  {
    (*l)++;
    printf("%d Jogo inexistente.\n", *l);
  }
  else
  {
    int score1 = game_search(name)->score1;
    int score2 = game_search(name)->score2;
    if (score1 > score2)
    {
      team_search(game_search(name)->team1)->wins -= 1;
      teamlist_search(game_search(name)->team1)->wins -= 1;
    }
    else
    {
      if (score2 > score1)
      {
        team_search(game_search(name)->team2)->wins -= 1;
        teamlist_search(game_search(name)->team2)->wins -= 1;
      }
      else
      {
        
      }

    }

    game_delete_hash(name);
    game_delete_list(name);
  }

}

void s(int *l)
{
  char name[1023];
  int score1;
  int score2;
  game *tmp;
  game *node;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  getchar();
  if (game_search(name) != 0)
  {
    score1 = new_sym_var(sizeof(int) * 8);
    score2 = new_sym_var(sizeof(int) * 8);
    getchar();
    node = gamelist_search(name);
    tmp = game_search(name);
    tmp->score1 = score1;
    tmp->score2 = score2;
    node->score1 = score1;
    node->score2 = score2;
    if (score1 > score2)
    {
      team_search(game_search(name)->team1)->wins += 1;
      teamlist_search(game_search(name)->team1)->wins += 1;
    }
    else
    {
      if (score2 > score1)
      {
        team_search(game_search(name)->team2)->wins += 1;
        teamlist_search(game_search(name)->team2)->wins += 1;
      }
      else
      {
        
      }

    }

  }
  else
  {
    printf("%d Jogo inexistente.\n", *l);
  }

}

int main()
{
  char cmd;
  int line = 0;
  init_hash_table_team();
  init_hash_table_game();
  while (cmd = getchar())
  {
    getchar();
    switch (cmd)
    {
      case 'a':
        a(&line);
        break;

      case 'A':
        A(&line);
        break;

      case 'l':
        l(&line);
        break;

      case 'p':
        p(&line);
        break;

      case 'P':
        P(&line);
        break;

      case 'r':
        r(&line);
        break;

      case 's':
        s(&line);
        break;

      case 'x':
        return 0;

    }

  }

  return 0;
}

