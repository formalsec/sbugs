/*File generated by PreProcessor.py*/


#include "proj2.h"


lista *l;
lista2 *l2;
void inicia_listas()
{
  int i;
  l = (lista *) malloc(sizeof(lista));
  l2 = (lista2 *) malloc(sizeof(lista2));
  l->head = (l->last = 0);
  l2->head2 = (l2->last2 = 0);
  for (i = 0; i < 2000; i++)
  {
    l->HashTable_Jogo[i] = 0;
    l2->HashTable_Equipas[i] = 0;
  }

}

jogo *procura_jogo(char *Nome)
{
  int h = hash(Nome);
  jogo *j = l->HashTable_Jogo[h];
  while (j != 0)
  {
    if (strcmp(j->nome, Nome) == 0)
    {
      return j;
    }
    else
    {
      
    }

    j = j->next_HashTable_Jogo;
  }

  return 0;
}

equipas *procura_equipa(char *Equipa)
{
  int h = hash(Equipa);
  equipas *e = l2->HashTable_Equipas[h];
  while (e != 0)
  {
    if (strcmp(e->nomeE, Equipa) == 0)
    {
      return e;
    }
    else
    {
      
    }

    e = e->next_HashTable_Equipas;
  }

  return 0;
}

void free_jogo(jogo *j)
{
  free(j->nome);
  free(j->team1);
  free(j->team2);
  free(j->score1);
  free(j->score2);
  free(j);
}

void free_equipas(equipas *e)
{
  free(e->nomeE);
  free(e);
}

void lista_jogos(jogo *j)
{
  printf("%s %s %s %s %s\n", j->nome, j->team1, j->team2, j->score1, j->score2);
}

void lista_equipa(equipas *e)
{
  printf("%s %d\n", e->nomeE, e->contador);
}

void lista_equipas_vencedoras(equipas *e)
{
  printf("%s \n", e->nomeE);
}

void adiciona_Node_jogo(char *Nome, char *Equipa1, char *Equipa2, char *Score1, char *Score2)
{
  int a;
  int b;
  jogo *aux = malloc(sizeof(jogo));
  aux->next = 0;
  aux->previous = l->last;
  aux->next_HashTable_Jogo = 0;
  if (l->last == 0)
  {
    l->head = aux;
  }
  else
  {
    l->last->next = aux;
  }

  l->last = aux;
  aux->nome = (char *) memcpy(malloc((sizeof(char)) * (strlen(Nome) + 1)), Nome, (sizeof(char)) * (strlen(Nome) + 1));
  aux->team1 = (char *) memcpy(malloc((sizeof(char)) * (strlen(Equipa1) + 1)), Equipa1, (sizeof(char)) * (strlen(Equipa1) + 1));
  aux->team2 = (char *) memcpy(malloc((sizeof(char)) * (strlen(Equipa2) + 1)), Equipa2, (sizeof(char)) * (strlen(Equipa2) + 1));
  aux->score1 = (char *) memcpy(malloc((sizeof(char)) * (strlen(Score1) + 1)), Score1, (sizeof(char)) * (strlen(Score1) + 1));
  aux->score2 = (char *) memcpy(malloc((sizeof(char)) * (strlen(Score2) + 1)), Score2, (sizeof(char)) * (strlen(Score2) + 1));
  a = atoi(aux->score1);
  b = atoi(aux->score2);
  if (a > b)
  {
    equipas *e = procura_equipa(Equipa1);
    e->contador += 1;
  }
  else
  {
    
  }

  if (a < b)
  {
    equipas *e = procura_equipa(Equipa2);
    e->contador += 1;
  }
  else
  {
    
  }

}

void remove_Node_jogo(jogo *j)
{
  if (j->previous == 0)
  {
    l->head = j->next;
  }
  else
  {
    j->previous->next = j->next;
  }

  if (j->next == 0)
  {
    l->last = j->previous;
  }
  else
  {
    j->next->previous = j->previous;
  }

  free_jogo(j);
}

void adiciona_Node_equipas(char *Equipa)
{
  equipas *aux2 = malloc(sizeof(equipas));
  aux2->next2 = 0;
  aux2->previous2 = l2->last2;
  aux2->next_HashTable_Equipas = 0;
  if (l2->last2 == 0)
  {
    l2->head2 = aux2;
  }
  else
  {
    l2->last2->next2 = aux2;
  }

  l2->last2 = aux2;
  aux2->nomeE = (char *) memcpy(malloc((sizeof(char)) * (strlen(Equipa) + 1)), Equipa, (sizeof(char)) * (strlen(Equipa) + 1));
  aux2->contador = 0;
}

void remove_Node_equipas(equipas *e)
{
  if (e->previous2 == 0)
  {
    l2->head2 = e->next2;
  }
  else
  {
    e->previous2->next2 = e->next2;
  }

  if (e->next2 == 0)
  {
    l2->last2 = e->previous2;
  }
  else
  {
    e->next2->previous2 = e->previous2;
  }

  free_equipas(e);
}

int hash(char *v)
{
  int h = 0;
  int a = 127;
  for (; (*v) != '\0'; v++)
    h = ((a * h) + (*v)) % 2000;

  return h;
}

void adiciona_HashTable_Jogo(char *Nome)
{
  int h = hash(Nome);
  jogo *j = l->HashTable_Jogo[h];
  for (; j != 0; j = j->next_HashTable_Jogo)
    if (j->next_HashTable_Jogo == 0)
  {
    break;
  }
  else
  {
    
  }


  if (j != 0)
  {
    j->next_HashTable_Jogo = l->last;
  }
  else
  {
    l->HashTable_Jogo[h] = l->last;
  }

}

void remove_HashTable_Jogo(char *Nome)
{
  int h = hash(Nome);
  jogo *j = l->HashTable_Jogo[h];
  jogo *prevJogo = 0;
  for (; j != 0; j = j->next_HashTable_Jogo)
  {
    if (strcmp(j->nome, Nome) == 0)
    {
      break;
    }
    else
    {
      
    }

    prevJogo = j;
  }

  if (prevJogo == 0)
  {
    l->HashTable_Jogo[h] = j->next_HashTable_Jogo;
  }
  else
  {
    prevJogo->next_HashTable_Jogo = j->next_HashTable_Jogo;
  }

}

void adiciona_HashTable_Equipas(char *Equipa)
{
  int h = hash(Equipa);
  equipas *e = l2->HashTable_Equipas[h];
  for (; e != 0; e = e->next_HashTable_Equipas)
    if (e->next_HashTable_Equipas == 0)
  {
    break;
  }
  else
  {
    
  }


  if (e != 0)
  {
    e->next_HashTable_Equipas = l2->last2;
  }
  else
  {
    l2->HashTable_Equipas[h] = l2->last2;
  }

}

int compararNome(const void *a, const void *b)
{
  return strcmp(((equipas *) a)->nomeTeam, ((equipas *) b)->nomeTeam);
}

int main()
{
  char Nome[1024];
  char Equipa1[1024];
  char Equipa2[1024];
  char Score1[4];
  char Score2[4];
  char Equipa[1024];
  char comando;
  int conta = 0;
  int maior = 0;
  int num = 0;
  int i = 0;
  int a;
  int b;
  int j;
  equipas item[800];
  jogo *aux;
  jogo *store;
  equipas *aux2;
  equipas *store2;
  inicia_listas();
  while (1)
  {
    comando = new_sym_var(sizeof(char) * 8);
    switch (comando)
    {
      case 'a':
        for (int Nome_index = 0; Nome_index < 10; Nome_index++)
      {
        Nome[Nome_index] = new_sym_var(sizeof(char) * 8);
      }

        Nome[10 - 1] = '\0';
        for (int Equipa1_index = 0; Equipa1_index < 10; Equipa1_index++)
      {
        Equipa1[Equipa1_index] = new_sym_var(sizeof(char) * 8);
      }

        Equipa1[10 - 1] = '\0';
        for (int Equipa2_index = 0; Equipa2_index < 10; Equipa2_index++)
      {
        Equipa2[Equipa2_index] = new_sym_var(sizeof(char) * 8);
      }

        Equipa2[10 - 1] = '\0';
        for (int Score1_index = 0; Score1_index < 4; Score1_index++)
      {
        Score1[Score1_index] = new_sym_var(sizeof(char) * 8);
      }

        Score1[4 - 1] = '\0';
        for (int Score2_index = 0; Score2_index < 4; Score2_index++)
      {
        Score2[Score2_index] = new_sym_var(sizeof(char) * 8);
      }

        Score2[4 - 1] = '\0';
        conta++;
        if (procura_jogo(Nome) != 0)
      {
        printf("%d Jogo existente.\n", conta);
      }
      else
      {
        if ((procura_equipa(Equipa1) == 0) || (procura_equipa(Equipa2) == 0))
        {
          printf("%d Equipa inexistente.\n", conta);
        }
        else
        {
          adiciona_Node_jogo(Nome, Equipa1, Equipa2, Score1, Score2);
          adiciona_HashTable_Jogo(Nome);
        }

      }

        break;

      case 'l':
        aux = l->head;
        conta++;
        for (; aux != 0; aux = aux->next)
      {
        printf("%d ", conta);
        lista_jogos(aux);
      }

        break;

      case 'p':
        for (int Nome_index = 0; Nome_index < 10; Nome_index++)
      {
        Nome[Nome_index] = new_sym_var(sizeof(char) * 8);
      }

        Nome[10 - 1] = '\0';
        aux = procura_jogo(Nome);
        conta++;
        if (aux != 0)
      {
        printf("%d ", conta);
        lista_jogos(aux);
      }
      else
      {
        printf("%d Jogo inexistente.\n", conta);
      }

        break;

      case 'r':
        for (int Nome_index = 0; Nome_index < 10; Nome_index++)
      {
        Nome[Nome_index] = new_sym_var(sizeof(char) * 8);
      }

        Nome[10 - 1] = '\0';
        aux = procura_jogo(Nome);
        conta++;
        if (aux != 0)
      {
        a = atoi(aux->score1);
        b = atoi(aux->score2);
        if (a > b)
        {
          equipas *e = procura_equipa(aux->team1);
          if (e->contador == maior)
          {
            maior--;
          }
          else
          {
            
          }

          e->contador -= 1;
        }
        else
        {
          
        }

        if (a < b)
        {
          equipas *e = procura_equipa(aux->team2);
          if (e->contador == maior)
          {
            maior--;
          }
          else
          {
            
          }

          e->contador -= 1;
        }
        else
        {
          
        }

        remove_HashTable_Jogo(Nome);
        remove_Node_jogo(aux);
      }
      else
      {
        printf("%d Jogo inexistente.\n", conta);
      }

        break;

      case 's':
        for (int Nome_index = 0; Nome_index < 10; Nome_index++)
      {
        Nome[Nome_index] = new_sym_var(sizeof(char) * 8);
      }

        Nome[10 - 1] = '\0';
        for (int Score1_index = 0; Score1_index < 4; Score1_index++)
      {
        Score1[Score1_index] = new_sym_var(sizeof(char) * 8);
      }

        Score1[4 - 1] = '\0';
        for (int Score2_index = 0; Score2_index < 4; Score2_index++)
      {
        Score2[Score2_index] = new_sym_var(sizeof(char) * 8);
      }

        Score2[4 - 1] = '\0';
        aux = procura_jogo(Nome);
        conta++;
        if (aux != 0)
      {
        a = atoi(aux->score1);
        b = atoi(aux->score2);
        if (a > b)
        {
          equipas *e = procura_equipa(aux->team1);
          if (e->contador == maior)
          {
            maior--;
          }
          else
          {
            
          }

          e->contador -= 1;
        }
        else
        {
          
        }

        if (b > a)
        {
          equipas *e = procura_equipa(aux->team2);
          if (e->contador == maior)
          {
            maior--;
          }
          else
          {
            
          }

          e->contador -= 1;
        }
        else
        {
          
        }

        aux->score1 = (char *) memcpy(realloc(aux->score1, (sizeof(char)) * (strlen(Score1) + 1)), Score1, (sizeof(char)) * (strlen(Score1) + 1));
        aux->score2 = (char *) memcpy(realloc(aux->score2, (sizeof(char)) * (strlen(Score2) + 1)), Score2, (sizeof(char)) * (strlen(Score2) + 1));
        a = atoi(aux->score1);
        b = atoi(aux->score2);
        if (a > b)
        {
          equipas *e = procura_equipa(aux->team1);
          e->contador += 1;
        }
        else
        {
          
        }

        if (a < b)
        {
          equipas *e = procura_equipa(aux->team2);
          e->contador += 1;
        }
        else
        {
          
        }

      }
      else
      {
        printf("%d Jogo inexistente.\n", conta);
      }

        break;

      case 'A':
        for (int Equipa_index = 0; Equipa_index < 10; Equipa_index++)
      {
        Equipa[Equipa_index] = new_sym_var(sizeof(char) * 8);
      }

        Equipa[10 - 1] = '\0';
        conta++;
        if (procura_equipa(Equipa) != 0)
      {
        printf("%d Equipa existente.\n", conta);
      }
      else
      {
        adiciona_Node_equipas(Equipa);
        adiciona_HashTable_Equipas(Equipa);
      }

        break;

      case 'P':
        for (int Equipa_index = 0; Equipa_index < 10; Equipa_index++)
      {
        Equipa[Equipa_index] = new_sym_var(sizeof(char) * 8);
      }

        Equipa[10 - 1] = '\0';
        aux2 = procura_equipa(Equipa);
        conta++;
        if (aux2 != 0)
      {
        printf("%d ", conta);
        lista_equipa(aux2);
      }
      else
      {
        printf("%d Equipa inexistente.\n", conta);
      }

        break;

      case 'g':
        aux2 = l2->head2;
        conta++;
        if (aux2 != 0)
      {
        for (; aux2 != 0; aux2 = aux2->next2)
        {
          if (aux2->contador != 0)
          {
            if (aux2->contador > maior)
            {
              maior = aux2->contador;
            }
            else
            {
              
            }

          }
          else
          {
            
          }

        }

        printf("%d Melhores %d\n", conta, maior);
        aux2 = l2->head2;
        for (; aux2 != 0; aux2 = aux2->next2)
        {
          if (aux2->contador == maior)
          {
            num++;
            strcpy(item[i].nomeTeam, aux2->nomeE);
            i++;
          }
          else
          {
            
          }

        }

        qsort(item, num, sizeof(equipas), compararNome);
        for (j = 0; j < num; j++)
        {
          if (strcmp(item[j].nomeTeam, "\0") != 0)
          {
            printf("%d * %s\n", conta, item[j].nomeTeam);
          }
          else
          {
            
          }

        }

        for (j = 0; j < num; j++)
        {
          strcpy(item[j].nomeTeam, "\0");
        }

      }
      else
      {
        
      }

        break;

      case 'x':
        aux = l->head;
        for (; aux != 0; aux = store)
      {
        store = aux->next;
        remove_Node_jogo(aux);
      }

        aux2 = l2->head2;
        for (; aux2 != 0; aux2 = store2)
      {
        store2 = aux2->next2;
        remove_Node_equipas(aux2);
      }

        free(l);
        free(l2);
        return 0;

    }

  }

  return 0;
}

