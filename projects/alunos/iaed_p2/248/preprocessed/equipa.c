#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include "equipa.h"


Equipa *cria_equipa(char *nome)
{
  Equipa *equipa = (Equipa *) malloc(sizeof(Equipa));
  equipa->vitorias = 0;
  equipa->nome = (char *) malloc((1 + strlen(nome)) * (sizeof(char)));
  strcpy(equipa->nome, nome);
  return equipa;
}

void altera_vitorias_equipas(Equipa *equipa, int vitorias)
{
  equipa->vitorias = vitorias;
}

void liberta_equipa(Equipa *equipa)
{
  free(equipa->nome);
  free(equipa);
}

Lista_equipa *cria_lista_equipa(void)
{
  Lista_equipa *lista = (Lista_equipa *) malloc(sizeof(Lista_equipa));
  lista->head = 0;
  lista->tail = 0;
  return lista;
}

void adiciona_lista_equipa(Lista_equipa *lista, Equipa *equipa)
{
  Node_equipa *node = (Node_equipa *) malloc(sizeof(Node_equipa));
  node->equipa = equipa;
  if ((lista->head == 0) && (lista->tail == 0))
  {
    node->previous = 0;
    node->next = 0;
    lista->head = node;
    lista->tail = node;
  }
  else
  {
    node->previous = lista->tail;
    node->next = 0;
    lista->tail->next = node;
    lista->tail = node;
  }

}

Equipa *procura_lista_equipa(Lista_equipa *lista, char *equipa)
{
  Node_equipa *node_inicio = lista->head;
  Node_equipa *node_fim = lista->tail;
  while ((node_inicio != node_fim) && (node_fim->next != node_inicio))
  {
    if (strcmp(node_inicio->equipa->nome, equipa) == 0)
    {
      return node_inicio->equipa;
    }
    else
    {
      if (strcmp(node_fim->equipa->nome, equipa) == 0)
      {
        return node_fim->equipa;
      }
      else
      {
        
      }

    }

    node_inicio = node_inicio->next;
    node_fim = node_fim->previous;
  }

  if ((node_inicio == node_fim) && (node_inicio != 0))
  {
    if (strcmp(node_inicio->equipa->nome, equipa) == 0)
    {
      return node_inicio->equipa;
    }
    else
    {
      
    }

  }
  else
  {
    
  }

  return 0;
}

void liberta_lista_equipa(Lista_equipa *lista)
{
  Node_equipa *node = lista->head;
  Node_equipa *aux;
  while (node != 0)
  {
    aux = node->next;
    liberta_equipa(node->equipa);
    free(node);
    node = aux;
  }

  free(lista);
}

Hashtable_equipa *cria_hashtable_equipa(int tamanho)
{
  int i = 0;
  Hashtable_equipa *hashtable = (Hashtable_equipa *) malloc(sizeof(Hashtable_equipa));
  hashtable->tamanho = tamanho;
  hashtable->tabela = (Lista_equipa **) malloc((sizeof(Lista_equipa *)) * tamanho);
  for (; i < tamanho; i++)
  {
    *(hashtable->tabela + i) = 0;
  }

  return hashtable;
}

void adiciona_hashtable_equipa(Hashtable_equipa *hashtable, Equipa *equipa)
{
  int i = hash_equipa(equipa->nome, hashtable->tamanho);
  if ((*(hashtable->tabela + i)) == 0)
  {
    *(hashtable->tabela + i) = cria_lista_equipa();
  }
  else
  {
    
  }

  adiciona_lista_equipa(*(hashtable->tabela + i), equipa);
}

Equipa *procura_hashtable_equipa(Hashtable_equipa *hashtable, char *chave)
{
  int i = hash_equipa(chave, hashtable->tamanho);
  if ((*(hashtable->tabela + i)) != 0)
  {
    Equipa *equipa = procura_lista_equipa(*(hashtable->tabela + i), chave);
    return equipa;
  }
  else
  {
    
  }

  return 0;
}

Tabela_equipas *maximas_vitorias_equipa(Hashtable_equipa *hashtable)
{
  int i;
  int n_equipas = 0;
  int max_vitorias = 0;
  Equipa **equipas = 0;
  Tabela_equipas *tabela = (Tabela_equipas *) malloc(sizeof(Tabela_equipas));
  for (i = 0; i < hashtable->tamanho; i++)
  {
    if ((*(hashtable->tabela + i)) != 0)
    {
      Node_equipa *node_inicio = (*(hashtable->tabela + i))->head;
      Node_equipa *node_fim = (*(hashtable->tabela + i))->tail;
      while ((node_inicio != node_fim) && (node_fim->next != node_inicio))
      {
        if ((node_inicio->equipa->vitorias > node_fim->equipa->vitorias) || (node_inicio->equipa->vitorias < node_fim->equipa->vitorias))
        {
          Node_equipa *node;
          if (node_inicio->equipa->vitorias > node_fim->equipa->vitorias)
          {
            node = node_inicio;
          }
          else
          {
            node = node_fim;
          }

          if (node->equipa->vitorias > max_vitorias)
          {
            n_equipas = 1;
            max_vitorias = node->equipa->vitorias;
            equipas = (Equipa **) realloc(equipas, sizeof(Equipa *));
            *equipas = node->equipa;
          }
          else
          {
            if (node->equipa->vitorias == max_vitorias)
            {
              n_equipas++;
              equipas = (Equipa **) realloc(equipas, n_equipas * (sizeof(Equipa *)));
              *(equipas + (n_equipas - 1)) = node->equipa;
            }
            else
            {
              
            }

          }

        }
        else
        {
          if (node_inicio->equipa->vitorias > max_vitorias)
          {
            n_equipas = 2;
            max_vitorias = node_inicio->equipa->vitorias;
            equipas = (Equipa **) realloc(equipas, 2 * (sizeof(Equipa *)));
            *equipas = node_inicio->equipa;
            *(equipas + 1) = node_fim->equipa;
          }
          else
          {
            if (node_inicio->equipa->vitorias == max_vitorias)
            {
              n_equipas += 2;
              equipas = (Equipa **) realloc(equipas, n_equipas * (sizeof(Equipa *)));
              *(equipas + ((n_equipas - 1) - 1)) = node_inicio->equipa;
              *(equipas + (n_equipas - 1)) = node_fim->equipa;
            }
            else
            {
              
            }

          }

        }

        node_inicio = node_inicio->next;
        node_fim = node_fim->previous;
      }

      if ((node_inicio == node_fim) && (node_inicio != 0))
      {
        if (node_inicio->equipa->vitorias > max_vitorias)
        {
          n_equipas = 1;
          max_vitorias = node_inicio->equipa->vitorias;
          equipas = (Equipa **) realloc(equipas, sizeof(Equipa *));
          *equipas = node_inicio->equipa;
        }
        else
        {
          if (node_inicio->equipa->vitorias == max_vitorias)
          {
            n_equipas++;
            equipas = (Equipa **) realloc(equipas, n_equipas * (sizeof(Equipa *)));
            *(equipas + (n_equipas - 1)) = node_inicio->equipa;
          }
          else
          {
            
          }

        }

      }
      else
      {
        
      }

    }
    else
    {
      
    }

  }

  tabela->equipas = equipas;
  tabela->n_equipas = n_equipas;
  tabela->vitorias = max_vitorias;
  return tabela;
}

void liberta_hashtable_equipa(Hashtable_equipa *hashtable)
{
  int i;
  for (i = 0; i < hashtable->tamanho; i++)
  {
    if ((*(hashtable->tabela + i)) != 0)
    {
      liberta_lista_equipa(*(hashtable->tabela + i));
    }
    else
    {
      
    }

  }

  free(hashtable->tabela);
  free(hashtable);
}

int hash_equipa(char *chave, int tamanho)
{
  int i = 0;
  int a = 31415;
  int b = 27183;
  for (; (*chave) != '\0'; chave++, a = (a * b) % (tamanho - 1))
  {
    i = ((a * i) + (*chave)) % tamanho;
  }

  return i;
}

