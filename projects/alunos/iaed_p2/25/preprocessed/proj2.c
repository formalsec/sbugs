#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>


typedef struct team
{
  char *name;
  struct team *next;
} *team_link;
typedef struct game
{
  char *name;
  char *team1;
  char *team2;
  int score1;
  int score2;
  struct game *next;
} *game_link;
team_link teams_lookup(team_link *teams_head, char *name)
{
  team_link t;
  for (t = *teams_head; t != 0; t = t->next)
    if (strcmp(t->name, name) == 0)
  {
    return t;
  }
  else
  {
    
  }


  return 0;
}

char *copy_string(char *name)
{
  char *string = (char *) malloc((sizeof(char)) * (strlen(name) + 1));
  strcpy(string, name);
  return string;
}

void insertBegin_team(team_link *teams_head, char *name)
{
  team_link t = (team_link) malloc(sizeof(struct team));
  t->name = copy_string(name);
  t->next = *teams_head;
  *teams_head = t;
}

int games_won(game_link *games_head, char *name)
{
  int wins = 0;
  game_link g;
  for (g = *games_head; g != 0; g = g->next)
  {
    if ((strcmp(g->team1, name) == 0) && (g->score1 > g->score2))
    {
      wins++;
    }
    else
    {
      
    }

    if ((strcmp(g->team2, name) == 0) && (g->score1 < g->score2))
    {
      wins++;
    }
    else
    {
      
    }

  }

  return wins;
}

int most_wins(team_link *teams_head, game_link *games_head)
{
  int wins;
  int max = 0;
  team_link t;
  for (t = *teams_head; t != 0; t = t->next)
  {
    if ((wins = games_won(games_head, t->name)) > max)
    {
      max = wins;
    }
    else
    {
      
    }

  }

  return max;
}

void teams_copy(team_link *teams_head, game_link *games_head, team_link *teams_head_aux, int *wins)
{
  team_link t;
  for (t = *teams_head; t != 0; t = t->next)
    if (games_won(games_head, t->name) == (*wins))
  {
    insertBegin_team(teams_head_aux, t->name);
  }
  else
  {
    
  }


}

void FrontBackSplit(team_link source, team_link *frontRef, team_link *backRef)
{
  team_link fast;
  team_link slow;
  slow = source;
  fast = source->next;
  while (fast != 0)
  {
    fast = fast->next;
    if (fast != 0)
    {
      slow = slow->next;
      fast = fast->next;
    }
    else
    {
      
    }

  }

  *frontRef = source;
  *backRef = slow->next;
  slow->next = 0;
}

team_link SortedMerge(team_link a, team_link b)
{
  team_link result = 0;
  if (a == 0)
  {
    return b;
  }
  else
  {
    if (b == 0)
    {
      return a;
    }
    else
    {
      
    }

  }

  if (strcmp(a->name, b->name) < 0)
  {
    result = a;
    result->next = SortedMerge(a->next, b);
  }
  else
  {
    result = b;
    result->next = SortedMerge(a, b->next);
  }

  return result;
}

void MergeSort(team_link *teams_head)
{
  team_link head = *teams_head;
  team_link a;
  team_link b;
  if ((head == 0) || (head->next == 0))
  {
    return;
  }
  else
  {
    
  }

  FrontBackSplit(head, &a, &b);
  MergeSort(&a);
  MergeSort(&b);
  *teams_head = SortedMerge(a, b);
}

void FREE_team(team_link t)
{
  free(t->name);
  free(t);
}

void free_teams(team_link *teams_head)
{
  team_link t;
  team_link next_t;
  if ((*teams_head) != 0)
  {
    for (t = *teams_head, next_t = t->next; next_t != 0; t = next_t, next_t = next_t->next)
      FREE_team(t);

    FREE_team(t);
  }
  else
  {
    
  }

  *teams_head = 0;
}

void adiciona_equipa(int *line, team_link *teams_head)
{
  char name[1023];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  if (teams_lookup(teams_head, name) == 0)
  {
    insertBegin_team(teams_head, name);
  }
  else
  {
    printf("%d Equipa existente.\n", *line);
  }

}

void procura_equipa(int *line, team_link *teams_head, game_link *games_head)
{
  char name[1023];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  if (teams_lookup(teams_head, name) == 0)
  {
    printf("%d Equipa inexistente.\n", *line);
  }
  else
  {
    printf("%d %s %d\n", *line, name, games_won(games_head, name));
  }

}

void melhores(int *line, team_link *teams_head, game_link *games_head)
{
  int wins = most_wins(teams_head, games_head);
  team_link teams_head_aux = 0;
  team_link t;
  if ((*teams_head) == 0)
  {
    return;
  }
  else
  {
    
  }

  teams_copy(teams_head, games_head, &teams_head_aux, &wins);
  MergeSort(&teams_head_aux);
  printf("%d Melhores %d\n", *line, wins);
  for (t = teams_head_aux; t != 0; t = t->next)
    printf("%d * %s\n", *line, t->name);

  free_teams(&teams_head_aux);
}

game_link games_lookup(game_link *games_head, char *name)
{
  game_link g;
  for (g = *games_head; g != 0; g = g->next)
    if (strcmp(g->name, name) == 0)
  {
    return g;
  }
  else
  {
    
  }


  return 0;
}

game_link NEW_game(char *name, char *team1, char *team2, int score1, int score2)
{
  game_link g = (game_link) malloc(sizeof(struct game));
  g->name = copy_string(name);
  g->team1 = copy_string(team1);
  g->team2 = copy_string(team2);
  g->score1 = score1;
  g->score2 = score2;
  g->next = 0;
  return g;
}

void insertEnd_game(game_link *games_head, char *name, char *team1, char *team2, int score1, int score2)
{
  game_link g;
  if ((*games_head) == 0)
  {
    *games_head = NEW_game(name, team1, team2, score1, score2);
    return;
  }
  else
  {
    
  }

  for (g = *games_head; g->next != 0; g = g->next)
    ;

  g->next = NEW_game(name, team1, team2, score1, score2);
}

void FREE_game(game_link g)
{
  free(g->name);
  free(g->team1);
  free(g->team2);
  free(g);
}

void delete_game(game_link *games_head, char *name)
{
  game_link g;
  game_link prev;
  for (g = *games_head, prev = 0; g != 0; prev = g, g = g->next)
  {
    if (strcmp(g->name, name) == 0)
    {
      if (g == (*games_head))
      {
        *games_head = g->next;
      }
      else
      {
        prev->next = g->next;
      }

      FREE_game(g);
      return;
    }
    else
    {
      
    }

  }

}

void game_score(game_link *games_head, char *name, int score1, int score2)
{
  game_link g;
  g = games_lookup(games_head, name);
  g->score1 = score1;
  g->score2 = score2;
}

void adiciona_jogo(int *line, team_link *teams_head, game_link *games_head)
{
  char name[1023];
  char team1[1023];
  char team2[1023];
  int score1;
  int score2;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  for (int team1_index = 0; team1_index < 10; team1_index++)
  {
    team1[team1_index] = new_sym_var(sizeof(char) * 8);
  }

  team1[10 - 1] = '\0';
  for (int team2_index = 0; team2_index < 10; team2_index++)
  {
    team2[team2_index] = new_sym_var(sizeof(char) * 8);
  }

  team2[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  if (games_lookup(games_head, name) != 0)
  {
    printf("%d Jogo existente.\n", *line);
    return;
  }
  else
  {
    
  }

  if ((teams_lookup(teams_head, team1) == 0) || (teams_lookup(teams_head, team2) == 0))
  {
    printf("%d Equipa inexistente.\n", *line);
    return;
  }
  else
  {
    
  }

  insertEnd_game(games_head, name, team1, team2, score1, score2);
}

void lista_jogos(int *line, game_link *games_head)
{
  game_link g;
  for (g = *games_head; g != 0; g = g->next)
    printf("%d %s %s %s %d %d\n", *line, g->name, g->team1, g->team2, g->score1, g->score2);

}

void procura_jogo(int *line, game_link *games_head)
{
  char name[1023];
  game_link g;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  if ((g = games_lookup(games_head, name)) == 0)
  {
    printf("%d Jogo inexistente.\n", *line);
  }
  else
  {
    printf("%d %s %s %s %d %d\n", *line, g->name, g->team1, g->team2, g->score1, g->score2);
  }

}

void apaga_jogo(int *line, game_link *games_head)
{
  char name[1023];
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  if (games_lookup(games_head, name) == 0)
  {
    printf("%d Jogo inexistente.\n", *line);
  }
  else
  {
    delete_game(games_head, name);
  }

}

void altera_score(int *line, game_link *games_head)
{
  char name[1023];
  int score1;
  int score2;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  if (games_lookup(games_head, name) == 0)
  {
    printf("%d Jogo inexistente.\n", *line);
  }
  else
  {
    game_score(games_head, name, score1, score2);
  }

}

int main()
{
  int line = 0;
  char comando;
  team_link teams_head = 0;
  game_link games_head = 0;
  while (1)
  {
    comando = getchar();
    switch (comando)
    {
      case 'a':
        line++;
        adiciona_jogo(&line, &teams_head, &games_head);
        break;

      case 'l':
        line++;
        lista_jogos(&line, &games_head);
        break;

      case 'p':
        line++;
        procura_jogo(&line, &games_head);
        break;

      case 'r':
        line++;
        apaga_jogo(&line, &games_head);
        break;

      case 's':
        line++;
        altera_score(&line, &games_head);
        break;

      case 'A':
        line++;
        adiciona_equipa(&line, &teams_head);
        break;

      case 'P':
        line++;
        procura_equipa(&line, &teams_head, &games_head);
        break;

      case 'g':
        line++;
        melhores(&line, &teams_head, &games_head);
        break;

      case 'x':
        return 0;

    }

  }

  return 1;
}

