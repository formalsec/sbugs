#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdlib.h>
#include "proj2.h"


Jogoslist *inicializa_l_jogos()
{
  Jogoslist *lista = (Jogoslist *) malloc(sizeof(Jogoslist));
  lista->head = 0;
  lista->root = 0;
  return lista;
}

void inicializa_jogo(Nodo_jogo **table)
{
  int i;
  for (i = 0; i < 2997; i++)
    table[i] = 0;

  return;
}

void inicializa_equipa(Nodo_equipa **table)
{
  int i;
  for (i = 0; i < 2997; i++)
    table[i] = 0;

  return;
}

unsigned long hash(char *nome)
{
  unsigned long i = 0;
  int j;
  for (j = 0; nome[j]; j++)
    i += nome[j];

  return i % 2997;
}

Jogos *alocar_jogos()
{
  char arg1[1023];
  char arg2[1023];
  char arg3[1023];
  int arg4;
  int arg5;
  Jogos *novo_jogo;
  novo_jogo = malloc(sizeof(Jogos));
  for (int arg1_index = 0; arg1_index < 10; arg1_index++)
  {
    arg1[arg1_index] = new_sym_var(sizeof(char) * 8);
  }

  arg1[10 - 1] = '\0';
  for (int arg2_index = 0; arg2_index < 10; arg2_index++)
  {
    arg2[arg2_index] = new_sym_var(sizeof(char) * 8);
  }

  arg2[10 - 1] = '\0';
  for (int arg3_index = 0; arg3_index < 10; arg3_index++)
  {
    arg3[arg3_index] = new_sym_var(sizeof(char) * 8);
  }

  arg3[10 - 1] = '\0';
  arg4 = new_sym_var(sizeof(int) * 8);
  arg5 = new_sym_var(sizeof(int) * 8);
  novo_jogo->next = 0;
  novo_jogo->prev = 0;
  novo_jogo->nome = malloc((sizeof(char *)) * (strlen(arg1) + 1));
  novo_jogo->equipa1 = malloc((sizeof(char *)) * (strlen(arg2) + 1));
  novo_jogo->equipa2 = malloc((sizeof(char *)) * (strlen(arg2) + 1));
  novo_jogo->nome = strcpy(novo_jogo->nome, arg1);
  novo_jogo->equipa1 = strcpy(novo_jogo->equipa1, arg2);
  novo_jogo->equipa2 = strcpy(novo_jogo->equipa2, arg3);
  novo_jogo->score1 = arg4;
  novo_jogo->score2 = arg5;
  return novo_jogo;
}

Equipas *alocar_equipas_nome()
{
  char arg1[1023];
  Equipas *nova_equipa;
  nova_equipa = malloc(sizeof(Equipas));
  for (int arg1_index = 0; arg1_index < 10; arg1_index++)
  {
    arg1[arg1_index] = new_sym_var(sizeof(char) * 8);
  }

  arg1[10 - 1] = '\0';
  nova_equipa->next_e = 0;
  nova_equipa->prev_e = 0;
  nova_equipa->nome = malloc((sizeof(char *)) * (strlen(arg1) + 1));
  nova_equipa->nome = strcpy(nova_equipa->nome, arg1);
  nova_equipa->finalscore = 0;
  return nova_equipa;
}

void malloc_array(char **array, int k)
{
  int i;
  for (i = 0; i < k; i++)
  {
    array[i] = malloc(1023 * (sizeof(char)));
  }

}

void free_item(Jogos *item)
{
  free(item->nome);
  free(item->equipa1);
  free(item->equipa2);
  free(item);
}

void free_item_e(Equipas *item)
{
  free(item->nome);
  free(item);
}

void clean_array(char **array, int k)
{
  int i;
  for (i = 0; i < k; i++)
  {
    strcpy(array[i], "\0");
  }

}

void libertajogohash(Nodo_jogo *c)
{
  free(c);
}

void libertaequipahash(Nodo_equipa *c)
{
  free(c);
}

int insert(Nodo_jogo **table, Jogos *novojogo)
{
  int index = hash(novojogo->nome);
  Nodo_jogo *new_node = (Nodo_jogo *) malloc(sizeof(Nodo_jogo));
  Nodo_jogo *node_aux = table[index];
  new_node->jogo = novojogo;
  new_node->next = 0;
  if (table[index] == 0)
  {
    table[index] = new_node;
    table[index]->jogo = novojogo;
    table[index]->next = 0;
    return 1;
  }
  else
  {
    
  }

  while (node_aux->next != 0)
  {
    node_aux = node_aux->next;
  }

  node_aux->next = new_node;
  return 1;
  return 0;
}

int insert_e(Nodo_equipa **table, Equipas *novaequipa)
{
  int index = hash(novaequipa->nome);
  Nodo_equipa *new_node_e = (Nodo_equipa *) malloc(sizeof(Nodo_equipa));
  Nodo_equipa *node_aux_e = table[index];
  new_node_e->equipa = novaequipa;
  new_node_e->next_e = 0;
  if (table[index] == 0)
  {
    table[index] = new_node_e;
    table[index]->equipa = novaequipa;
    table[index]->next_e = 0;
    return 1;
  }
  else
  {
    
  }

  while (node_aux_e->next_e != 0)
  {
    node_aux_e = node_aux_e->next_e;
  }

  node_aux_e->next_e = new_node_e;
  return 1;
  return 0;
}

void inserir_score(Nodo_equipa **table_e, int score1, int score2, char *equipa1, char *equipa2)
{
  int index1 = hash(equipa1);
  int index2 = hash(equipa2);
  Nodo_equipa *aux1 = 0;
  Nodo_equipa *aux2 = 0;
  aux1 = table_e[index1];
  aux2 = table_e[index2];
  if (score1 > score2)
  {
    while (strcmp(aux1->equipa->nome, equipa1) != 0)
      aux1 = aux1->next_e;

    aux1->equipa->finalscore++;
    return;
  }
  else
  {
    
  }

  if (score2 > score1)
  {
    while (strcmp(aux2->equipa->nome, equipa2) != 0)
      aux2 = aux2->next_e;

    aux2->equipa->finalscore++;
    return;
  }
  else
  {
    
  }

}

int search(Nodo_jogo **table, char *nome)
{
  int result = -1;
  Nodo_jogo *node_aux = 0;
  int index = hash(nome);
  node_aux = table[index];
  while (node_aux != 0)
  {
    if (strcmp(node_aux->jogo->nome, nome) == 0)
    {
      return index;
    }
    else
    {
      
    }

    node_aux = node_aux->next;
  }

  free(node_aux);
  return result;
}

int search_e(Nodo_equipa **table, char *name)
{
  int result = -1;
  Nodo_equipa *node_aux;
  int index = hash(name);
  node_aux = table[index];
  while (node_aux != 0)
  {
    if (strcmp(node_aux->equipa->nome, name) == 0)
    {
      return index;
    }
    else
    {
      
    }

    node_aux = node_aux->next_e;
  }

  free(node_aux);
  return result;
}

void pop_node(Jogoslist *l, Jogos *n)
{
  Jogos *aux = l->head;
  Jogos *v = 0;
  if (aux == 0)
  {
    return;
  }
  else
  {
    
  }

  if ((aux->next == 0) && (strcmp(aux->nome, n->nome) == 0))
  {
    l->head = 0;
    l->root = 0;
    free(aux);
    return;
  }
  else
  {
    if ((aux != 0) && (strcmp(aux->nome, n->nome) == 0))
    {
      l->head = l->head->next;
      free(aux);
      return;
    }
    else
    {
      
    }

  }

  while (aux->next != 0)
  {
    if (strcmp(aux->next->nome, n->nome) == 0)
    {
      break;
    }
    else
    {
      aux = aux->next;
    }

  }

  v = aux->next;
  aux->next = aux->next->next;
  free(v);
  return;
}

void apaga(Jogoslist *lista, char name[1023], Nodo_jogo **table, Nodo_equipa **table_e)
{
  int score1_jogo = 0;
  char *nome_equipa1;
  char *nome_equipa2;
  int score2_jogo = 0;
  int index = hash(name);
  Nodo_equipa *aux_1;
  Nodo_equipa *aux_2;
  Nodo_jogo *aux = table[index];
  Nodo_jogo *v = 0;
  nome_equipa1 = table[index]->jogo->equipa1;
  nome_equipa2 = table[index]->jogo->equipa2;
  score1_jogo = hash(nome_equipa1);
  score2_jogo = hash(nome_equipa2);
  aux_1 = table_e[score1_jogo];
  aux_2 = table_e[score2_jogo];
  if (table[index]->jogo->score1 > table[index]->jogo->score2)
  {
    aux_1->equipa->finalscore--;
  }
  else
  {
    if (table[index]->jogo->score1 < table[index]->jogo->score2)
    {
      aux_2->equipa->finalscore--;
    }
    else
    {
      
    }

  }

  if (aux == 0)
  {
    return;
  }
  else
  {
    
  }

  if ((aux != 0) && (strcmp(aux->jogo->nome, name) == 0))
  {
    pop_node(lista, table[index]->jogo);
    free(aux);
    table[index] = 0;
    return;
  }
  else
  {
    
  }

  while (aux->next != 0)
  {
    if (strcmp(aux->next->jogo->nome, name) == 0)
    {
      break;
    }
    else
    {
      aux = aux->next;
    }

  }

  v = aux->next;
  aux->next = v->next;
  pop_node(lista, table[index]->jogo);
  free(v);
}

void adiciona_jogo(int i, Jogoslist *lista, Nodo_jogo **hashtable_j, Nodo_equipa **hashtable_e)
{
  Jogos *novo_jogo;
  novo_jogo = alocar_jogos();
  if (search(hashtable_j, novo_jogo->nome) != (-1))
  {
    printf("%d Jogo existente.\n", i);
    free_item(novo_jogo);
    return;
  }
  else
  {
    
  }

  if ((search_e(hashtable_e, novo_jogo->equipa1) == (-1)) || (search_e(hashtable_e, novo_jogo->equipa2) == (-1)))
  {
    printf("%d Equipa inexistente.\n", i);
    free_item(novo_jogo);
    return;
  }
  else
  {
    if (lista->head == 0)
    {
      lista->head = novo_jogo;
      lista->root = novo_jogo;
      novo_jogo->next = 0;
      novo_jogo->prev = 0;
      insert(hashtable_j, novo_jogo);
      inserir_score(hashtable_e, novo_jogo->score1, novo_jogo->score2, novo_jogo->equipa1, novo_jogo->equipa2);
      return;
    }
    else
    {
      novo_jogo->next = lista->head;
      lista->head->prev = novo_jogo;
      lista->head = novo_jogo;
      insert(hashtable_j, novo_jogo);
      inserir_score(hashtable_e, novo_jogo->score1, novo_jogo->score2, novo_jogo->equipa1, novo_jogo->equipa2);
    }

  }

}

void adiciona_equipa(int i, Nodo_equipa **hashtable_e, int *teams)
{
  Equipas *nova_equipa = 0;
  nova_equipa = alocar_equipas_nome();
  if (search_e(hashtable_e, nova_equipa->nome) != (-1))
  {
    printf("%d Equipa existente.\n", i);
    free_item_e(nova_equipa);
    return;
  }
  else
  {
    
  }

  insert_e(hashtable_e, nova_equipa);
  *teams = (*teams) + 1;
}

void lista(int i, Jogos *l)
{
  if (l == 0)
  {
    return;
  }
  else
  {
    
  }

  lista(i, l->next);
  printf("%d %s %s %s %d %d\n", i, l->nome, l->equipa1, l->equipa2, l->score1, l->score2);
}

void procurajogo(int i, Nodo_jogo **table)
{
  int index;
  char arg1[1023];
  char frase;
  Nodo_jogo *aux;
  frase = new_sym_var(sizeof(char) * 8);
  for (int arg1_index = 0; arg1_index < 10; arg1_index++)
  {
    arg1[arg1_index] = new_sym_var(sizeof(char) * 8);
  }

  arg1[10 - 1] = '\0';
  index = hash(arg1);
  aux = table[index];
  while (aux != 0)
  {
    if (strcmp(aux->jogo->nome, arg1) == 0)
    {
      printf("%d %s %s %s %d %d\n", i, aux->jogo->nome, aux->jogo->equipa1, aux->jogo->equipa2, aux->jogo->score1, aux->jogo->score2);
      return;
    }
    else
    {
      
    }

    aux = aux->next;
  }

  printf("%d Jogo inexistente.\n", i);
}

void procuraequipa(int i, Nodo_equipa **table)
{
  int index;
  char arg1[1023];
  char frase;
  Nodo_equipa *aux;
  frase = new_sym_var(sizeof(char) * 8);
  for (int arg1_index = 0; arg1_index < 10; arg1_index++)
  {
    arg1[arg1_index] = new_sym_var(sizeof(char) * 8);
  }

  arg1[10 - 1] = '\0';
  index = hash(arg1);
  aux = table[index];
  while (aux != 0)
  {
    if (strcmp(aux->equipa->nome, arg1) == 0)
    {
      printf("%d %s %d\n", i, aux->equipa->nome, aux->equipa->finalscore);
      return;
    }
    else
    {
      
    }

    aux = aux->next_e;
  }

  printf("%d Equipa inexistente.\n", i);
}

void altera_pontos(int i, Nodo_jogo **table, Nodo_equipa **table_e)
{
  int arg2;
  int arg3;
  char arg1[1023];
  char espaco;
  int index;
  int indexs1;
  int indexs2;
  Nodo_jogo *novo_jogo;
  Nodo_equipa *nova_equipa1;
  Nodo_equipa *nova_equipa2;
  espaco = new_sym_var(sizeof(char) * 8);
  for (int arg1_index = 0; arg1_index < 10; arg1_index++)
  {
    arg1[arg1_index] = new_sym_var(sizeof(char) * 8);
  }

  arg1[10 - 1] = '\0';
  arg2 = new_sym_var(sizeof(int) * 8);
  arg3 = new_sym_var(sizeof(int) * 8);
  if (search(table, arg1) == (-1))
  {
    printf("%d Jogo inexistente.\n", i);
    return;
  }
  else
  {
    
  }

  index = hash(arg1);
  indexs1 = hash(table[index]->jogo->equipa1);
  indexs2 = hash(table[index]->jogo->equipa2);
  novo_jogo = table[index];
  nova_equipa1 = table_e[indexs1];
  nova_equipa2 = table_e[indexs2];
  while (novo_jogo->next != 0)
  {
    if (strcmp(novo_jogo->jogo->nome, arg1) == 0)
    {
      break;
    }
    else
    {
      
    }

    novo_jogo = novo_jogo->next;
  }

  while (nova_equipa1->next_e != 0)
  {
    if (strcmp(nova_equipa1->equipa->nome, novo_jogo->jogo->equipa1) == 0)
    {
      break;
    }
    else
    {
      
    }

    nova_equipa1 = nova_equipa1->next_e;
  }

  while (nova_equipa2->next_e != 0)
  {
    if (strcmp(nova_equipa2->equipa->nome, novo_jogo->jogo->equipa2) == 0)
    {
      break;
    }
    else
    {
      
    }

    nova_equipa2 = nova_equipa2->next_e;
  }

  if (((arg2 > arg3) && (novo_jogo->jogo->score1 > novo_jogo->jogo->score2)) || ((arg2 == arg3) && (novo_jogo->jogo->score1 == novo_jogo->jogo->score2)))
  {
    novo_jogo->jogo->score1 = arg2;
    novo_jogo->jogo->score2 = arg3;
    return;
  }
  else
  {
    
  }

  if ((arg2 > arg3) && (novo_jogo->jogo->score1 < novo_jogo->jogo->score2))
  {
    nova_equipa1->equipa->finalscore++;
    nova_equipa2->equipa->finalscore--;
    novo_jogo->jogo->score1 = arg2;
    novo_jogo->jogo->score2 = arg3;
    return;
  }
  else
  {
    
  }

  if ((arg2 > arg3) && (novo_jogo->jogo->score1 == novo_jogo->jogo->score2))
  {
    nova_equipa1->equipa->finalscore++;
    novo_jogo->jogo->score1 = arg2;
    novo_jogo->jogo->score2 = arg3;
    return;
  }
  else
  {
    
  }

  if ((arg2 < arg3) && (novo_jogo->jogo->score1 == novo_jogo->jogo->score2))
  {
    nova_equipa2->equipa->finalscore++;
    novo_jogo->jogo->score1 = arg2;
    novo_jogo->jogo->score2 = arg3;
    return;
  }
  else
  {
    
  }

  if ((arg2 < arg3) && (novo_jogo->jogo->score1 > novo_jogo->jogo->score2))
  {
    nova_equipa1->equipa->finalscore--;
    nova_equipa2->equipa->finalscore++;
    novo_jogo->jogo->score1 = arg2;
    novo_jogo->jogo->score2 = arg3;
    return;
  }
  else
  {
    
  }

  if ((arg2 == arg3) && (novo_jogo->jogo->score1 > novo_jogo->jogo->score2))
  {
    nova_equipa1->equipa->finalscore--;
    novo_jogo->jogo->score1 = arg2;
    novo_jogo->jogo->score2 = arg3;
    return;
  }
  else
  {
    
  }

  if ((arg2 == arg3) && (novo_jogo->jogo->score1 < novo_jogo->jogo->score2))
  {
    nova_equipa2->equipa->finalscore--;
    novo_jogo->jogo->score1 = arg2;
    novo_jogo->jogo->score2 = arg3;
    return;
  }
  else
  {
    
  }

  if ((arg2 < arg3) && (novo_jogo->jogo->score1 < novo_jogo->jogo->score2))
  {
    novo_jogo->jogo->score1 = arg2;
    novo_jogo->jogo->score2 = arg3;
    return;
  }
  else
  {
    
  }

}

void remover(int i, Jogoslist *nova, Nodo_jogo **table, Nodo_equipa **table_e)
{
  char arg1[1023];
  char frase;
  frase = new_sym_var(sizeof(char) * 8);
  for (int arg1_index = 0; arg1_index < 10; arg1_index++)
  {
    arg1[arg1_index] = new_sym_var(sizeof(char) * 8);
  }

  arg1[10 - 1] = '\0';
  if (search(table, arg1) == (-1))
  {
    printf("%d Jogo inexistente.\n", i);
    return;
  }
  else
  {
    apaga(nova, arg1, table, table_e);
    return;
  }

}

void ordena(int i, int *teams, Nodo_equipa **table)
{
  Nodo_equipa *aux = 0;
  int num_equipas = *teams;
  char **array = malloc(num_equipas * (sizeof(char *)));
  char temp[1023];
  int k = 0;
  int j = 0;
  int max_score = 0;
  malloc_array(array, num_equipas);
  if (num_equipas == 0)
  {
    for (j = 0; j < num_equipas; j++)
    {
      free(array[j]);
    }

    free(array);
    return;
  }
  else
  {
    
  }

  for (j = 0; j < 2997; j++)
  {
    aux = table[j];
    while (aux != 0)
    {
      if (aux->equipa->finalscore == max_score)
      {
        strcpy(array[k], aux->equipa->nome);
        k++;
      }
      else
      {
        
      }

      if (aux->equipa->finalscore > max_score)
      {
        max_score = aux->equipa->finalscore;
        clean_array(array, num_equipas);
        strcpy(array[0], aux->equipa->nome);
        k = 1;
      }
      else
      {
        
      }

      aux = aux->next_e;
    }

  }

  printf("%d Melhores %d\n", i, max_score);
  for (k = 0; k < num_equipas; k++)
  {
    for (j = k + 1; j < num_equipas; j++)
    {
      if ((strcmp(array[j], "\0") != 0) && (strcmp(array[k], "\0") != 0))
      {
        if (strcmp(array[k], array[j]) > 0)
        {
          strcpy(temp, array[k]);
          strcpy(array[k], array[j]);
          strcpy(array[j], temp);
        }
        else
        {
          
        }

      }
      else
      {
        
      }

    }

  }

  for (j = 0; j < num_equipas; j++)
  {
    if (strcmp(array[j], "\0") == 0)
    {
      break;
    }
    else
    {
      
    }

    printf("%d * %s\n", i, array[j]);
  }

  for (j = 0; j < num_equipas; j++)
  {
    free(array[j]);
  }

  free(array);
}

int main()
{
  char frase = '\0';
  int i = 0;
  int team_counter = 0;
  Jogos *aux = 0;
  Jogoslist *newgamelist = 0;
  int *teams = 0;
  Nodo_jogo **hashtable_j;
  Nodo_equipa **hashtable_e;
  newgamelist = inicializa_l_jogos();
  hashtable_j = (Nodo_jogo **) malloc(2997 * (sizeof(Nodo_jogo)));
  inicializa_jogo(hashtable_j);
  hashtable_e = (Nodo_equipa **) malloc(2997 * (sizeof(Nodo_equipa)));
  inicializa_equipa(hashtable_e);
  teams = &team_counter;
  while (frase != 'x')
  {
    frase = new_sym_var(sizeof(char) * 8);
    switch (frase)
    {
      case 'a':
        i++;
        adiciona_jogo(i, newgamelist, hashtable_j, hashtable_e);
        break;

      case 'A':
        i++;
        adiciona_equipa(i, hashtable_e, teams);
        break;

      case 'l':
        i++;
        aux = newgamelist->head;
        lista(i, aux);
        break;

      case 'p':
        i++;
        procurajogo(i, hashtable_j);
        break;

      case 'P':
        i++;
        procuraequipa(i, hashtable_e);
        break;

      case 's':
        i++;
        altera_pontos(i, hashtable_j, hashtable_e);
        break;

      case 'r':
        i++;
        remover(i, newgamelist, hashtable_j, hashtable_e);
        break;

      case 'g':
        i++;
        ordena(i, teams, hashtable_e);
        break;

    }

  }

  return 0;
}

