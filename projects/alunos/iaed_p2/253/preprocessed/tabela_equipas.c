#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include "TABELA_HASH_E.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>


Tabela_hash *cria_tabela_hash()
{
  Tabela_hash *nova_t = malloc(sizeof(Tabela_hash));
  nova_t->capacidade = 1999;
  nova_t->topos = calloc(nova_t->capacidade, sizeof(No_hash *));
  return nova_t;
}

int hash(const char *nome, int M)
{
  int h = 0;
  int a = 127;
  for (; (*nome) != '\0'; nome++)
    h = ((a * h) + (*nome)) % M;

  return h;
}

listE *cria_listE()
{
  listE *l = malloc(sizeof(listE));
  l->topo = 0;
  return l;
}

void free_Equipa(Equipa *n)
{
  free(n->nome);
  free(n);
}

void free_list(listE *l)
{
  while (l->topo)
  {
    Equipa *temp = l->topo->proximo;
    free_Equipa(l->topo);
    l->topo = temp;
  }

  free(l);
}

void free_tabela_hash(Tabela_hash *t)
{
  No_hash *a;
  size_t i;
  for (i = 0; i < t->capacidade; i++)
  {
    while (t->topos[i])
    {
      a = t->topos[i]->proximo;
      free(t->topos[i]);
      t->topos[i] = a;
    }

  }

  free(t->topos);
  free(t);
}

void cria_Equipa(listE *l, const char *nome, Tabela_hash *tabela)
{
  const size_t i = hash(nome, tabela->capacidade);
  Equipa *novo = malloc(sizeof(Equipa));
  novo->proximo = l->topo;
  novo->nome = malloc((sizeof(char)) * (strlen(nome) + 1));
  strcpy(novo->nome, nome);
  novo->pontos = 0;
  l->topo = novo;
  tabela->topos[i] = cria_Equipa_hash(tabela->topos[i], novo);
}

No_hash *cria_Equipa_hash(No_hash *topo, Equipa *nova_E)
{
  No_hash *nn = malloc(sizeof(No_hash));
  nn->ponteiro = nova_E;
  nn->proximo = topo;
  return nn;
}

int verifica_e(Tabela_hash *tabela, const char *nome)
{
  const size_t i = hash(nome, tabela->capacidade);
  No_hash *no;
  for (no = tabela->topos[i]; no != 0; no = no->proximo)
    if (strcmp(no->ponteiro->nome, nome) == 0)
  {
    return 0;
  }
  else
  {
    
  }


  return 1;
}

void aumenta_pontos(Tabela_hash *tabela, const char *nome)
{
  const size_t i = hash(nome, tabela->capacidade);
  No_hash *no;
  for (no = tabela->topos[i]; no != 0; no = no->proximo)
    if (strcmp(no->ponteiro->nome, nome) == 0)
  {
    no->ponteiro->pontos += 1;
    return;
  }
  else
  {
    
  }


  return;
}

void retira_pontos(Tabela_hash *tabela, const char *nome)
{
  const size_t i = hash(nome, tabela->capacidade);
  No_hash *no;
  for (no = tabela->topos[i]; no != 0; no = no->proximo)
    if (strcmp(no->ponteiro->nome, nome) == 0)
  {
    no->ponteiro->pontos -= 1;
    return;
  }
  else
  {
    
  }


  return;
}

void adiciona_equipa(listE *lista_equipas, Tabela_hash *tabela, int contador)
{
  char nome[1024];
  getchar();
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  if (verifica_e(tabela, nome) == 1)
  {
    cria_Equipa(lista_equipas, nome, tabela);
  }
  else
  {
    printf("%d Equipa existente.\n", contador);
  }

}

void procura_equipa(Tabela_hash *tabela, int contador)
{
  char nome[1024];
  No_hash *equipa;
  getchar();
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  if (verifica_e(tabela, nome) == 1)
  {
    printf("%d Equipa inexistente.\n", contador);
  }
  else
  {
    const size_t i = hash(nome, tabela->capacidade);
    for (equipa = tabela->topos[i]; equipa != 0; equipa = equipa->proximo)
      if (strcmp(equipa->ponteiro->nome, nome) == 0)
    {
      printf("%d %s %d\n", contador, nome, equipa->ponteiro->pontos);
      return;
    }
    else
    {
      
    }


  }

}

void vencedores(listE *lista_equipas, int contador)
{
  int max_pontos = 0;
  int n_equipas = 0;
  int i = 0;
  int n;
  int j;
  Equipa *e_atual = lista_equipas->topo;
  char *guarda_nome;
  char **vencedores;
  if (e_atual == 0)
  {
    return;
  }
  else
  {
    
  }

  for (; e_atual != 0; e_atual = e_atual->proximo)
  {
    if (e_atual->pontos > max_pontos)
    {
      max_pontos = e_atual->pontos;
      n_equipas = 1;
    }
    else
    {
      if (e_atual->pontos == max_pontos)
      {
        n_equipas += 1;
      }
      else
      {
        
      }

    }

  }

  vencedores = malloc((sizeof(char *)) * n_equipas);
  e_atual = lista_equipas->topo;
  for (; e_atual != 0; e_atual = e_atual->proximo)
  {
    if (e_atual->pontos == max_pontos)
    {
      vencedores[i] = malloc(((sizeof(char)) * strlen(e_atual->nome)) + 1);
      strcpy(vencedores[i++], e_atual->nome);
    }
    else
    {
      
    }

  }

  for (n = 0; n < (n_equipas - 1); n++)
  {
    for (j = n + 1; j < n_equipas; j++)
    {
      if (strcmp(vencedores[n], vencedores[j]) > 0)
      {
        guarda_nome = vencedores[n];
        vencedores[n] = vencedores[j];
        vencedores[j] = guarda_nome;
      }
      else
      {
        
      }

    }

  }

  printf("%d Melhores %d\n", contador, max_pontos);
  for (i = 0; i < n_equipas; i++)
  {
    printf("%d * %s\n", contador, vencedores[i]);
    free(vencedores[i]);
  }

  free(vencedores);
}

