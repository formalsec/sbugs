#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "estruturas.h"


int codigo_hash(char *nome)
{
  int h = 0;
  int a = 127;
  for (; (*nome) != '\0'; nome++)
  {
    h = ((a * h) + (*nome)) % 5000;
  }

  return h;
}

hash_table_jogos *init_hash_jogos()
{
  int h;
  hash_table_jogos *hash_j = malloc(sizeof(hash_table_jogos));
  for (h = 0; h < 5000; h++)
  {
    hash_j->vetor[h] = 0;
  }

  return hash_j;
}

hash_table_equipas *init_hash_equipas()
{
  int h;
  hash_table_equipas *hash_e = malloc(sizeof(hash_table_equipas));
  for (h = 0; h < 5000; h++)
  {
    hash_e->vetor[h] = 0;
  }

  return hash_e;
}

void free_jogo(jogo *pointr)
{
  free(pointr->nome_jogo);
  free(pointr->equipa_1);
  free(pointr->equipa_2);
  free(pointr);
}

void free_equipa(sist_equipas *pointr)
{
  free(pointr->nome_equipa);
  free(pointr);
}

void pop_jogo(list_games *lst, jogo *game)
{
  if (game->prev != 0)
  {
    game->prev->next = game->next;
  }
  else
  {
    lst->head = game->next;
  }

  if (game->next != 0)
  {
    game->next->prev = game->prev;
  }
  else
  {
    lst->last = game->prev;
  }

  free_jogo(game);
}

void push_jogo(int index, jogo *game, hash_table_jogos *hash_jogos)
{
  jogo_hash *gm = malloc(sizeof(jogo_hash));
  gm->pointr_jogo = game;
  gm->next = hash_jogos->vetor[index];
  hash_jogos->vetor[index] = gm;
}

void push_equipa(int index, sist_equipas *team, hash_table_equipas *hash_equipas)
{
  equipa_hash *tm = malloc(sizeof(equipa_hash));
  tm->pointr_equipa = team;
  tm->next = hash_equipas->vetor[index];
  hash_equipas->vetor[index] = tm;
}

jogo_hash *procura_nome_jogo(char nome[1024], hash_table_jogos *hash_jogos)
{
  int chave_jogo = codigo_hash(nome);
  jogo_hash *temp;
  for (temp = hash_jogos->vetor[chave_jogo]; temp != 0; temp = temp->next)
  {
    if (strcmp(temp->pointr_jogo->nome_jogo, nome) == 0)
    {
      return temp;
    }
    else
    {
      
    }

  }

  return 0;
}

int n_jogos_ganhos(list_games *lst_jogos, char equipa[1024])
{
  jogo *pointr = lst_jogos->head;
  int jogos_ganhos = 0;
  while (pointr != 0)
  {
    if (strcmp(pointr->equipa_1, equipa) == 0)
    {
      if (pointr->score_1 > pointr->score_2)
      {
        jogos_ganhos++;
      }
      else
      {
        jogos_ganhos = jogos_ganhos;
      }

    }
    else
    {
      
    }

    if (strcmp(pointr->equipa_2, equipa) == 0)
    {
      if (pointr->score_2 > pointr->score_1)
      {
        jogos_ganhos++;
      }
      else
      {
        jogos_ganhos = jogos_ganhos;
      }

    }
    else
    {
      
    }

    pointr = pointr->next;
  }

  return jogos_ganhos;
}

equipa_hash *procura_nome_equipa(char nome[1024], hash_table_equipas *hash_equipas)
{
  int chave_equipa = codigo_hash(nome);
  equipa_hash *temp;
  for (temp = hash_equipas->vetor[chave_equipa]; temp != 0; temp = temp->next)
  {
    if (strcmp(temp->pointr_equipa->nome_equipa, nome) == 0)
    {
      return temp;
    }
    else
    {
      
    }

  }

  return 0;
}

void comando_l(int NL, list_games *imprime)
{
  jogo *pointer = imprime->head;
  while (pointer != 0)
  {
    printf("%d %s %s %s %d %d\n", NL, pointer->nome_jogo, pointer->equipa_1, pointer->equipa_2, pointer->score_1, pointer->score_2);
    pointer = pointer->next;
  }

}

void free_hash_table_jogos(list_games *lst_jogos, hash_table_jogos *hash_jogos)
{
  int h;
  jogo_hash *aux;
  jogo_hash *hash_j;
  jogo *temp;
  for (h = 0; h < 5000; h++)
  {
    hash_j = hash_jogos->vetor[h];
    while (hash_j != 0)
    {
      free(hash_j->pointr_jogo->nome_jogo);
      free(hash_j->pointr_jogo->equipa_1);
      free(hash_j->pointr_jogo->equipa_2);
      free(hash_j->pointr_jogo);
      aux = hash_j->next;
      free(hash_j);
      hash_j = aux;
    }

  }

  while (lst_jogos->head != 0)
  {
    temp = lst_jogos->head->next;
    free(lst_jogos->head);
    lst_jogos->head = temp;
  }

  free(hash_jogos);
  free(lst_jogos);
}

void free_hash_table_equipas(list_teams *lst_equipas, hash_table_equipas *hash_equipas)
{
  int h;
  equipa_hash *aux;
  equipa_hash *hash_e;
  sist_equipas *temp;
  for (h = 0; h < 5000; h++)
  {
    hash_e = hash_equipas->vetor[h];
    while (hash_e != 0)
    {
      free(hash_e->pointr_equipa->nome_equipa);
      aux = hash_e->next;
      free(hash_e);
      hash_e = aux;
    }

  }

  while (lst_equipas->head != 0)
  {
    temp = lst_equipas->head->next;
    free(lst_equipas->head);
    lst_equipas->head = temp;
  }

  free(hash_equipas);
  free(lst_equipas);
}

void apaga_jogo(list_games *lst_jogos, char nome[1024], hash_table_jogos *hash_jogos)
{
  int chave_jogo = codigo_hash(nome);
  jogo_hash *verifica_jogo = hash_jogos->vetor[chave_jogo];
  jogo_hash *temp;
  if (verifica_jogo != 0)
  {
    if (strcmp(verifica_jogo->pointr_jogo->nome_jogo, nome) == 0)
    {
      temp = verifica_jogo->next;
      pop_jogo(lst_jogos, verifica_jogo->pointr_jogo);
      free(verifica_jogo);
      hash_jogos->vetor[chave_jogo] = temp;
    }
    else
    {
      
    }

    while (verifica_jogo->next != 0)
    {
      if (strcmp(verifica_jogo->next->pointr_jogo->nome_jogo, nome) == 0)
      {
        break;
      }
      else
      {
        verifica_jogo = verifica_jogo->next;
      }

    }

    temp = verifica_jogo->next;
    pop_jogo(lst_jogos, temp->pointr_jogo);
    free(temp);
    verifica_jogo->next = temp->next;
  }
  else
  {
    
  }

}

void comando_a(int NL, list_games *lst_jogos, hash_table_jogos *hash_jogos, hash_table_equipas *hash_equipas)
{
  jogo_hash *pointr_jogo;
  equipa_hash *pointr_equipa_1;
  equipa_hash *pointr_equipa_2;
  char nome[1024];
  char equipa_1[1024];
  char equipa_2[1024];
  int score_1;
  int score_2;
  int chave_jogo;
  jogo *novo_jogo = malloc(sizeof(jogo));
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  for (int equipa_1_index = 0; equipa_1_index < 10; equipa_1_index++)
  {
    equipa_1[equipa_1_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa_1[10 - 1] = '\0';
  for (int equipa_2_index = 0; equipa_2_index < 10; equipa_2_index++)
  {
    equipa_2[equipa_2_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa_2[10 - 1] = '\0';
  score_1 = new_sym_var(sizeof(int) * 8);
  score_2 = new_sym_var(sizeof(int) * 8);
  novo_jogo->nome_jogo = malloc((sizeof(char)) * (strlen(nome) + 1));
  novo_jogo->equipa_1 = malloc((sizeof(char)) * (strlen(equipa_1) + 1));
  novo_jogo->equipa_2 = malloc((sizeof(char)) * (strlen(equipa_2) + 1));
  strcpy(novo_jogo->nome_jogo, nome);
  strcpy(novo_jogo->equipa_1, equipa_1);
  strcpy(novo_jogo->equipa_2, equipa_2);
  novo_jogo->score_1 = score_1;
  novo_jogo->score_2 = score_2;
  novo_jogo->next = 0;
  novo_jogo->prev = lst_jogos->last;
  pointr_jogo = procura_nome_jogo(nome, hash_jogos);
  pointr_equipa_1 = procura_nome_equipa(equipa_1, hash_equipas);
  pointr_equipa_2 = procura_nome_equipa(equipa_2, hash_equipas);
  if (pointr_jogo == 0)
  {
    if ((pointr_equipa_1 != 0) && (pointr_equipa_2 != 0))
    {
      if (lst_jogos->head == 0)
      {
        lst_jogos->head = novo_jogo;
        chave_jogo = codigo_hash(novo_jogo->nome_jogo);
        push_jogo(chave_jogo, novo_jogo, hash_jogos);
      }
      else
      {
        novo_jogo->prev = lst_jogos->last;
        lst_jogos->last->next = novo_jogo;
        chave_jogo = codigo_hash(novo_jogo->nome_jogo);
        push_jogo(chave_jogo, novo_jogo, hash_jogos);
      }

      lst_jogos->last = novo_jogo;
    }
    else
    {
      printf("%d Equipa inexistente.\n", NL);
    }

  }
  else
  {
    printf("%d Jogo existente.\n", NL);
  }

}

void comando_A(int NL, list_teams *lst_equipas, hash_table_equipas *hash_equipas)
{
  equipa_hash *pointr_equipa;
  char nome[1024];
  int chave_equipa;
  sist_equipas *nova_equipa = malloc(sizeof(sist_equipas));
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  nova_equipa->nome_equipa = malloc((sizeof(char)) * (strlen(nome) + 1));
  strcpy(nova_equipa->nome_equipa, nome);
  nova_equipa->jogos_ganhos = 0;
  nova_equipa->next = 0;
  nova_equipa->prev = lst_equipas->last;
  pointr_equipa = procura_nome_equipa(nome, hash_equipas);
  if (pointr_equipa == 0)
  {
    if (lst_equipas->head == 0)
    {
      lst_equipas->head = nova_equipa;
      chave_equipa = codigo_hash(nova_equipa->nome_equipa);
      push_equipa(chave_equipa, nova_equipa, hash_equipas);
    }
    else
    {
      nova_equipa->prev = lst_equipas->last;
      lst_equipas->last->next = nova_equipa;
      chave_equipa = codigo_hash(nova_equipa->nome_equipa);
      push_equipa(chave_equipa, nova_equipa, hash_equipas);
    }

    lst_equipas->last = nova_equipa;
  }
  else
  {
    printf("%d Equipa existente.\n", NL);
  }

}

void comando_P(int NL, list_games *lst_jogos, hash_table_equipas *hash_equipas)
{
  equipa_hash *pointr_team;
  char equipa[1024];
  int wins;
  for (int equipa_index = 0; equipa_index < 10; equipa_index++)
  {
    equipa[equipa_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa[10 - 1] = '\0';
  pointr_team = procura_nome_equipa(equipa, hash_equipas);
  if (pointr_team != 0)
  {
    wins = n_jogos_ganhos(lst_jogos, equipa);
    printf("%d %s %d\n", NL, equipa, wins);
  }
  else
  {
    printf("%d Equipa inexistente.\n", NL);
  }

}

void comando_r(int NL, list_games *lst_jogos, hash_table_jogos *hash_jogos)
{
  jogo_hash *pointr_jogo;
  char nome[1024];
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  pointr_jogo = procura_nome_jogo(nome, hash_jogos);
  if (pointr_jogo != 0)
  {
    apaga_jogo(lst_jogos, nome, hash_jogos);
  }
  else
  {
    printf("%d Jogo inexistente.\n", NL);
  }

}

void comando_p(int NL, hash_table_jogos *hash_jogos)
{
  jogo_hash *pointer_jogo;
  char nome[1024];
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  pointer_jogo = procura_nome_jogo(nome, hash_jogos);
  if (pointer_jogo != 0)
  {
    printf("%d %s %s %s %d %d\n", NL, pointer_jogo->pointr_jogo->nome_jogo, pointer_jogo->pointr_jogo->equipa_1, pointer_jogo->pointr_jogo->equipa_2, pointer_jogo->pointr_jogo->score_1, pointer_jogo->pointr_jogo->score_2);
  }
  else
  {
    printf("%d Jogo inexistente.\n", NL);
  }

}

void comando_s(int NL, hash_table_jogos *hash_jogos)
{
  jogo_hash *pointer_jogo;
  char nome[1024];
  int score_1;
  int score_2;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  score_1 = new_sym_var(sizeof(int) * 8);
  score_2 = new_sym_var(sizeof(int) * 8);
  pointer_jogo = procura_nome_jogo(nome, hash_jogos);
  if (pointer_jogo != 0)
  {
    pointer_jogo->pointr_jogo->score_1 = score_1;
    pointer_jogo->pointr_jogo->score_2 = score_2;
  }
  else
  {
    printf("%d Jogo inexistente.\n", NL);
  }

}

int main()
{
  char letra;
  int NL = 0;
  list_games *lst_jogos;
  list_teams *lst_equipas;
  hash_table_jogos *hash_jogos = init_hash_jogos();
  hash_table_equipas *hash_equipas = init_hash_equipas();
  lst_jogos = malloc(sizeof(list_games));
  lst_jogos->head = 0;
  lst_jogos->last = 0;
  lst_equipas = malloc(sizeof(list_teams));
  lst_equipas->head = 0;
  lst_equipas->last = 0;
  while (1)
  {
    letra = getchar();
    switch (letra)
    {
      case 'a':
        NL++;
        comando_a(NL, lst_jogos, hash_jogos, hash_equipas);
        break;

      case 'A':
        NL++;
        comando_A(NL, lst_equipas, hash_equipas);
        break;

      case 'l':
        NL++;
        comando_l(NL, lst_jogos);
        break;

      case 'p':
        NL++;
        comando_p(NL, hash_jogos);
        break;

      case 'P':
        NL++;
        comando_P(NL, lst_jogos, hash_equipas);
        break;

      case 'r':
        NL++;
        comando_r(NL, lst_jogos, hash_jogos);
        break;

      case 's':
        NL++;
        comando_s(NL, hash_jogos);
        break;

      case 'x':
        return 0;

      default:
        break;

    }

  }

}

