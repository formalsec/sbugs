#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <string.h>
#include <stdio.h>
#include <stdlib.h>
#include "equipas.h"
#include "equipas_hashtable.h"
#include "jogos.h"
#include "jogos_hashtable.h"


void adiciona_jogo(int linha_input, jogo **ht_jogos, int *pt_max_ht_jogos, int *pt_num_elem_ht_jogos, lista_jogos *lst_jogos, equipa **ht_equipas, int *max_ht_equipas, int *max_vitorias);
void lista_jogos_ordem_intro(int linha_input, lista_jogos *lst_jogos);
void procura_jogo(int linha_input, jogo **ht_jogos, int *pt_max_ht_jogos);
void apaga_jogo(int linha_input, jogo **ht_jogos, int *pt_max_ht_jogos, int *pt_num_elem_ht_jogos, lista_jogos *lst_jogos);
void altera_resultado(int linha_input, jogo **ht_jogos, int *pt_max_ht_jogos, int *pt_max_vitorias);
void adiciona_equipa(int linha_input, equipa **ht_equipas, int *max_ht_eqp, int *num_elem_ht_equipas);
void procura_equipa(int linha_input, equipa **ht_equipas, int *max_ht_eqp);
void lista_equipas_mais_vitorias(int linha_input, equipa **ht_equipas, int max_ht_equipas, int num_elem_ht_equipas, int max_vitorias);
int compara_strings(const void *ptr_str_1, const void *ptr_str_2);
int main()
{
  int max_ht_equipas = 2003;
  int *pt_max_ht_equipas = &max_ht_equipas;
  int num_elem_ht_equipas;
  int *pt_num_elem_ht_equipas = &num_elem_ht_equipas;
  equipa **ht_equipas = inicia_hashtable_equipas(pt_max_ht_equipas, pt_num_elem_ht_equipas);
  int max_vitorias = 0;
  int *pt_max_vitorias = &max_vitorias;
  int max_ht_jogos = 2003;
  int *pt_max_ht_jogos = &max_ht_jogos;
  int num_elem_ht_jogos;
  int *pt_num_elem_ht_jogos = &num_elem_ht_jogos;
  jogo **ht_jogos = inicia_hashtable_jogos(pt_max_ht_jogos, pt_num_elem_ht_jogos);
  lista_jogos *lst_jogos = cria_lista_jogos();
  int linha_input = 1;
  while (1)
  {
    char cmd;
    cmd = getchar();
    switch (cmd)
    {
      case 'a':
        adiciona_jogo(linha_input, ht_jogos, pt_max_ht_jogos, pt_num_elem_ht_jogos, lst_jogos, ht_equipas, pt_max_ht_equipas, pt_max_vitorias);
        break;

      case 'l':
        lista_jogos_ordem_intro(linha_input, lst_jogos);
        break;

      case 'p':
        procura_jogo(linha_input, ht_jogos, pt_max_ht_jogos);
        break;

      case 'r':
        apaga_jogo(linha_input, ht_jogos, pt_max_ht_jogos, pt_num_elem_ht_jogos, lst_jogos);
        break;

      case 's':
        altera_resultado(linha_input, ht_jogos, pt_max_ht_jogos, pt_max_vitorias);
        break;

      case 'A':
        adiciona_equipa(linha_input, ht_equipas, pt_max_ht_equipas, pt_num_elem_ht_equipas);
        break;

      case 'P':
        procura_equipa(linha_input, ht_equipas, pt_max_ht_equipas);
        break;

      case 'g':
        lista_equipas_mais_vitorias(linha_input, ht_equipas, max_ht_equipas, num_elem_ht_equipas, max_vitorias);
        break;

      case 'x':
        liberta_hashtable_equipas(ht_equipas, max_ht_equipas);
        liberta_hashtable_jogos(ht_jogos, max_ht_jogos);
        free(lst_jogos);
        return 0;

      default:
        printf("Comando desconhecido\n");

    }

    getchar();
    linha_input++;
  }

  return -1;
}

void adiciona_jogo(int linha_input, jogo **ht_jogos, int *pt_max_ht_jogos, int *pt_num_elem_ht_jogos, lista_jogos *lst_jogos, equipa **ht_equipas, int *pt_max_ht_equipas, int *max_vitorias)
{
  char jogo_input[1024];
  char equipa_1_input[1024];
  char equipa_2_input[1024];
  int reslt_1;
  int reslt_2;
  equipa *equipa_1;
  equipa *equipa_2;
  for (int jogo_input_index = 0; jogo_input_index < 10; jogo_input_index++)
  {
    jogo_input[jogo_input_index] = new_sym_var(sizeof(char) * 8);
  }

  jogo_input[10 - 1] = '\0';
  for (int equipa_1_input_index = 0; equipa_1_input_index < 10; equipa_1_input_index++)
  {
    equipa_1_input[equipa_1_input_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa_1_input[10 - 1] = '\0';
  for (int equipa_2_input_index = 0; equipa_2_input_index < 10; equipa_2_input_index++)
  {
    equipa_2_input[equipa_2_input_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa_2_input[10 - 1] = '\0';
  reslt_1 = new_sym_var(sizeof(int) * 8);
  reslt_2 = new_sym_var(sizeof(int) * 8);
  if (procura_jogo_ht(ht_jogos, jogo_input, *pt_max_ht_jogos) != 0)
  {
    printf("%d Jogo existente.\n", linha_input);
    return;
  }
  else
  {
    
  }

  if (((equipa_1 = procura_equipa_ht(ht_equipas, equipa_1_input, *pt_max_ht_equipas)) == 0) || ((equipa_2 = procura_equipa_ht(ht_equipas, equipa_2_input, *pt_max_ht_equipas)) == 0))
  {
    printf("%d Equipa inexistente.\n", linha_input);
    return;
  }
  else
  {
    
  }

  insere_jogo(novo_jogo(jogo_input, equipa_1, equipa_2, reslt_1, reslt_2), pt_max_ht_jogos, ht_jogos, pt_num_elem_ht_jogos, lst_jogos);
  if (reslt_1 > reslt_2)
  {
    if ((++equipa_1->num_vitorias) > (*max_vitorias))
    {
      *max_vitorias = equipa_1->num_vitorias;
    }
    else
    {
      
    }

  }
  else
  {
    if (reslt_2 > reslt_1)
    {
      if ((++equipa_2->num_vitorias) > (*max_vitorias))
      {
        *max_vitorias = equipa_2->num_vitorias;
      }
      else
      {
        
      }

    }
    else
    {
      
    }

  }

}

void lista_jogos_ordem_intro(int linha_input, lista_jogos *lst_jogos)
{
  jogo *jogo_aux;
  if (lst_jogos->jogo_inicial == 0)
  {
    return;
  }
  else
  {
    for (jogo_aux = lst_jogos->jogo_inicial; jogo_aux != 0; jogo_aux = jogo_aux->seguinte)
    {
      printf("%d %s %s %s %d %d\n", linha_input, jogo_aux->nome, jogo_aux->equipa_1->nome, jogo_aux->equipa_2->nome, jogo_aux->resultado_1, jogo_aux->resultado_2);
    }

  }

}

void procura_jogo(int linha_input, jogo **ht_jogos, int *pt_max_ht_jogos)
{
  char jogo_input[1024];
  jogo *jogo_procurar;
  for (int jogo_input_index = 0; jogo_input_index < 10; jogo_input_index++)
  {
    jogo_input[jogo_input_index] = new_sym_var(sizeof(char) * 8);
  }

  jogo_input[10 - 1] = '\0';
  if ((jogo_procurar = procura_jogo_ht(ht_jogos, jogo_input, *pt_max_ht_jogos)) == 0)
  {
    printf("%d Jogo inexistente.\n", linha_input);
  }
  else
  {
    printf("%d %s %s %s %d %d\n", linha_input, jogo_procurar->nome, jogo_procurar->equipa_1->nome, jogo_procurar->equipa_2->nome, jogo_procurar->resultado_1, jogo_procurar->resultado_2);
  }

}

void apaga_jogo(int linha_input, jogo **ht_jogos, int *pt_max_ht_jogos, int *pt_num_elem_ht_jogos, lista_jogos *lst_jogos)
{
  char jogo_input[1024];
  for (int jogo_input_index = 0; jogo_input_index < 10; jogo_input_index++)
  {
    jogo_input[jogo_input_index] = new_sym_var(sizeof(char) * 8);
  }

  jogo_input[10 - 1] = '\0';
  if (remove_jogo_ht(jogo_input, ht_jogos, pt_max_ht_jogos, pt_num_elem_ht_jogos, lst_jogos) != 0)
  {
    printf("%d Jogo inexistente.\n", linha_input);
  }
  else
  {
    
  }

}

void altera_resultado(int linha_input, jogo **ht_jogos, int *pt_max_ht_jogos, int *pt_max_vitorias)
{
  char jogo_input[1024];
  int novo_reslt_1;
  int novo_reslt_2;
  jogo *jogo_alterar;
  for (int jogo_input_index = 0; jogo_input_index < 10; jogo_input_index++)
  {
    jogo_input[jogo_input_index] = new_sym_var(sizeof(char) * 8);
  }

  jogo_input[10 - 1] = '\0';
  novo_reslt_1 = new_sym_var(sizeof(int) * 8);
  novo_reslt_2 = new_sym_var(sizeof(int) * 8);
  if ((jogo_alterar = procura_jogo_ht(ht_jogos, jogo_input, *pt_max_ht_jogos)) == 0)
  {
    printf("%d Jogo inexistente.\n", linha_input);
    ;
  }
  else
  {
    altera_resultados_jogo(jogo_alterar, novo_reslt_1, novo_reslt_2);
    if (jogo_alterar->equipa_1->num_vitorias > (*pt_max_vitorias))
    {
      *pt_max_vitorias = jogo_alterar->equipa_1->num_vitorias;
    }
    else
    {
      if (jogo_alterar->equipa_2->num_vitorias > (*pt_max_vitorias))
      {
        *pt_max_vitorias = jogo_alterar->equipa_2->num_vitorias;
      }
      else
      {
        
      }

    }

  }

}

void adiciona_equipa(int linha_input, equipa **ht_equipas, int *pt_max_ht_eqp, int *num_elem_ht_equipas)
{
  char equipa_input[1024];
  equipa *n_equipa;
  for (int equipa_input_index = 0; equipa_input_index < 10; equipa_input_index++)
  {
    equipa_input[equipa_input_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa_input[10 - 1] = '\0';
  n_equipa = nova_equipa(equipa_input);
  if (insere_equipa(n_equipa, pt_max_ht_eqp, ht_equipas, num_elem_ht_equipas) == 0)
  {
    liberta_equipa(n_equipa);
    printf("%d Equipa existente.\n", linha_input);
  }
  else
  {
    
  }

}

void procura_equipa(int linha_input, equipa **ht_equipas, int *pt_max_ht_eqp)
{
  char equipa_input[1024];
  equipa *equipa_procurar;
  for (int equipa_input_index = 0; equipa_input_index < 10; equipa_input_index++)
  {
    equipa_input[equipa_input_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa_input[10 - 1] = '\0';
  if ((equipa_procurar = procura_equipa_ht(ht_equipas, equipa_input, *pt_max_ht_eqp)) == 0)
  {
    printf("%d Equipa inexistente.\n", linha_input);
  }
  else
  {
    printf("%d %s %d\n", linha_input, equipa_procurar->nome, equipa_procurar->num_vitorias);
  }

}

void lista_equipas_mais_vitorias(int linha_input, equipa **ht_equipas, int max_ht_equipas, int num_elem_ht_equipas, int max_vitorias)
{
  char **aux_equipas = malloc((sizeof(char *)) * num_elem_ht_equipas);
  int i;
  int j = 0;
  for (i = 0; i < max_ht_equipas; i++)
  {
    if (ht_equipas[i] == 0)
    {
      continue;
    }
    else
    {
      if (ht_equipas[i]->num_vitorias == max_vitorias)
      {
        aux_equipas[j++] = ht_equipas[i]->nome;
      }
      else
      {
        
      }

    }

  }

  if (j != 0)
  {
    qsort(aux_equipas, j, sizeof(char *), compara_strings);
    printf("%d Melhores %d\n", linha_input, max_vitorias);
    for (i = 0; i < j; i++)
    {
      printf("%d * %s\n", linha_input, aux_equipas[i]);
    }

  }
  else
  {
    
  }

  free(aux_equipas);
}

int compara_strings(const void *ptr_str_1, const void *ptr_str_2)
{
  char *str_1 = *((char **) ptr_str_1);
  char *str_2 = *((char **) ptr_str_2);
  return strcmp(str_1, str_2);
}

