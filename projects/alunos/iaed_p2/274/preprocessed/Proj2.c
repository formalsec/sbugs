/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "Estruturas.h"


int hash(char *n)
{
  int h = 0;
  int a = 127;
  for (; (*n) != '\0'; n++)
  {
    h = ((a * h) + (*n)) % 2497;
  }

  return h;
}

tabela *cria_tabela()
{
  int i;
  tabela *tab = malloc(sizeof(tabela));
  for (i = 0; i < 2497; i++)
    tab->vet[i] = 0;

  return tab;
}

lista *cria_lista()
{
  lista *list = malloc(sizeof(lista));
  list->inicio = 0;
  list->fim = 0;
  return list;
}

tabela_e *cria_tabela_e()
{
  int i;
  tabela_e *tab_e = malloc(sizeof(tabela_e));
  for (i = 0; i < 2497; i++)
    tab_e->vet[i] = 0;

  return tab_e;
}

lista_das_equipas *cria_lista_e()
{
  lista_das_equipas *list_e = malloc(sizeof(lista_das_equipas));
  list_e->inicio = 0;
  list_e->fim = 0;
  return list_e;
}

void elimina(tabela *tab, lista *list)
{
  int i;
  hashtable *entrada;
  hashtable *temp;
  for (i = 0; i < 2497; i++)
  {
    entrada = tab->vet[i];
    while (entrada != 0)
    {
      free(entrada->item->nome);
      free(entrada->item->equipa_1);
      free(entrada->item->equipa_2);
      free(entrada->item);
      temp = entrada->seguinte;
      free(entrada);
      entrada = temp;
    }

  }

  free(tab);
  free(list);
}

void elimina_e(tabela_e *tab_e, lista_das_equipas *list_e)
{
  int i;
  hash_equipas *entrada;
  hash_equipas *temp;
  for (i = 0; i < 2497; i++)
  {
    entrada = tab_e->vet[i];
    while (entrada != 0)
    {
      free(entrada->item->nome);
      temp = entrada->seguinte;
      free(entrada);
      entrada = temp;
    }

  }

  free(tab_e);
  free(list_e);
}

hashtable *procura(tabela *tab, char *nome)
{
  int i = hash(nome);
  hashtable *t;
  for (t = tab->vet[i]; t != 0; t = t->seguinte)
  {
    if (strcmp(t->item->nome, nome) == 0)
    {
      return t;
    }
    else
    {
      
    }

  }

  return 0;
}

lista *adiciona_j(tabela *tab, lista *list, char *nome, char *equipa_1, char *equipa_2, int resultado_1, int resultado_2, tabela_e *tab_e)
{
  hashtable *entrada;
  jogo *j;
  int valor;
  int valor1;
  int valor2;
  j = malloc(sizeof(jogo));
  j->nome = malloc((sizeof(char)) * (strlen(nome) + 1));
  strcpy(j->nome, nome);
  j->equipa_1 = malloc((sizeof(char)) * (strlen(equipa_1) + 1));
  strcpy(j->equipa_1, equipa_1);
  j->equipa_2 = malloc((sizeof(char)) * (strlen(equipa_2) + 1));
  strcpy(j->equipa_2, equipa_2);
  j->resultado_1 = resultado_1;
  j->resultado_2 = resultado_2;
  j->seguinte = 0;
  j->anterior = list->fim;
  if (list->fim != 0)
  {
    list->fim->seguinte = j;
  }
  else
  {
    list->inicio = j;
  }

  list->fim = j;
  entrada = malloc(sizeof(hashtable));
  entrada->item = j;
  entrada->seguinte = 0;
  valor = hash(nome);
  valor1 = hash(equipa_1);
  valor2 = hash(equipa_2);
  entrada->seguinte = tab->vet[valor];
  tab->vet[valor] = entrada;
  if (resultado_1 > resultado_2)
  {
    tab_e->vet[valor1]->item->vitorias++;
    return list;
  }
  else
  {
    
  }

  if (resultado_2 > resultado_1)
  {
    tab_e->vet[valor2]->item->vitorias++;
    return list;
  }
  else
  {
    
  }

  return list;
}

hash_equipas *procura_e(tabela_e *tab_e, char *nome)
{
  int i = hash(nome);
  hash_equipas *t;
  for (t = tab_e->vet[i]; t != 0; t = t->seguinte)
  {
    if (strcmp(t->item->nome, nome) == 0)
    {
      return t;
    }
    else
    {
      
    }

  }

  return 0;
}

lista *adiciona_jogo(int contador, lista *list, tabela *tab, tabela_e *tab_e)
{
  hashtable *g;
  hash_equipas *a;
  hash_equipas *b;
  char nome[1024];
  char equipa_1[2497];
  char equipa_2[1024];
  int resultado_1;
  int resultado_2;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  for (int equipa_1_index = 0; equipa_1_index < 10; equipa_1_index++)
  {
    equipa_1[equipa_1_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa_1[10 - 1] = '\0';
  for (int equipa_2_index = 0; equipa_2_index < 10; equipa_2_index++)
  {
    equipa_2[equipa_2_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa_2[10 - 1] = '\0';
  resultado_1 = new_sym_var(sizeof(int) * 8);
  resultado_2 = new_sym_var(sizeof(int) * 8);
  g = procura(tab, nome);
  a = procura_e(tab_e, equipa_1);
  b = procura_e(tab_e, equipa_2);
  if (g != 0)
  {
    printf("%d Jogo existente.\n", contador);
    return list;
  }
  else
  {
    
  }

  if ((a == 0) || (b == 0))
  {
    printf("%d Equipa inexistente.\n", contador);
    return list;
  }
  else
  {
    list = adiciona_j(tab, list, nome, equipa_1, equipa_2, resultado_1, resultado_2, tab_e);
  }

  return list;
}

void lista_j(int contador, lista *list)
{
  jogo *temp = list->inicio;
  if (temp == 0)
  {
    return;
  }
  else
  {
    
  }

  while (temp != 0)
  {
    printf("%d %s %s %s %d %d\n", contador, temp->nome, temp->equipa_1, temp->equipa_2, temp->resultado_1, temp->resultado_2);
    temp = temp->seguinte;
  }

}

void procura_jogo(int contador, tabela *tab)
{
  char nome[1024];
  hashtable *entrada;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  entrada = procura(tab, nome);
  if (entrada == 0)
  {
    printf("%d Jogo inexistente.\n", contador);
  }
  else
  {
    printf("%d %s %s %s %d %d\n", contador, entrada->item->nome, entrada->item->equipa_1, entrada->item->equipa_2, entrada->item->resultado_1, entrada->item->resultado_2);
  }

}

lista_das_equipas *adiciona_e(tabela_e *tab_e, lista_das_equipas *list_e, char *nome)
{
  hash_equipas *entrada;
  equipa *e;
  int valor;
  e = malloc(sizeof(equipa));
  e->nome = malloc((sizeof(char)) * (strlen(nome) + 1));
  strcpy(e->nome, nome);
  e->vitorias = 0;
  e->seguinte = 0;
  e->anterior = list_e->fim;
  if (list_e->fim != 0)
  {
    list_e->fim->seguinte = e;
  }
  else
  {
    list_e->inicio = e;
  }

  list_e->fim = e;
  entrada = malloc(sizeof(hash_equipas));
  entrada->item = e;
  entrada->item->vitorias = 0;
  entrada->seguinte = 0;
  valor = hash(nome);
  entrada->seguinte = tab_e->vet[valor];
  tab_e->vet[valor] = entrada;
  return list_e;
}

lista_das_equipas *adiciona_equipa(int contador, lista_das_equipas *list_e, tabela_e *tab_e)
{
  hash_equipas *entrada;
  char nome[1024];
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  entrada = procura_e(tab_e, nome);
  if (entrada != 0)
  {
    printf("%d Equipa existente.\n", contador);
    return list_e;
  }
  else
  {
    list_e = adiciona_e(tab_e, list_e, nome);
    return list_e;
  }

}

void procura_equipa(int contador, tabela_e *tab_e)
{
  char nome[1024];
  hash_equipas *entrada;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  entrada = procura_e(tab_e, nome);
  if (entrada == 0)
  {
    printf("%d Equipa inexistente.\n", contador);
  }
  else
  {
    printf("%d %s %d\n", contador, entrada->item->nome, entrada->item->vitorias);
  }

}

lista *remove_jogo(lista *list, jogo *j)
{
  if (j == list->inicio)
  {
    j->anterior = 0;
  }
  else
  {
    
  }

  if (j == list->fim)
  {
    j->seguinte = 0;
  }
  else
  {
    
  }

  if (j->anterior == 0)
  {
    list->inicio = j->seguinte;
  }
  else
  {
    j->anterior->seguinte = j->seguinte;
  }

  if (j->seguinte == 0)
  {
    list->fim = j->anterior;
  }
  else
  {
    j->seguinte->anterior = j->anterior;
  }

  return list;
}

lista *apaga_j(tabela *tab, lista *list, char *nome, tabela_e *tab_e)
{
  jogo *j;
  jogo *temp;
  int valor;
  int valor1;
  int valor2;
  valor = hash(nome);
  temp = list->inicio;
  while (temp != 0)
  {
    if (strcmp(temp->nome, nome) == 0)
    {
      j = temp;
    }
    else
    {
      
    }

    temp = temp->seguinte;
  }

  valor1 = hash(j->equipa_1);
  valor2 = hash(j->equipa_2);
  list = remove_jogo(list, j);
  tab->vet[valor] = 0;
  if (j->resultado_1 > j->resultado_2)
  {
    tab_e->vet[valor1]->item->vitorias--;
    return list;
  }
  else
  {
    
  }

  if (j->resultado_2 > j->resultado_1)
  {
    tab_e->vet[valor2]->item->vitorias--;
    return list;
  }
  else
  {
    
  }

  free(j->nome);
  free(j->equipa_1);
  free(j->equipa_2);
  free(j);
  return list;
}

lista *apaga_jogo(int contador, lista *list, tabela *tab, tabela_e *tab_e)
{
  char nome[1024];
  hashtable *entrada;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  entrada = procura(tab, nome);
  if (entrada == 0)
  {
    printf("%d Jogo inexistente.\n", contador);
    return list;
  }
  else
  {
    list = apaga_j(tab, list, nome, tab_e);
    return list;
  }

}

lista *altera_score(int contador, lista *list, tabela *tab, tabela_e *tab_e)
{
  int valor1;
  int valor2;
  int resultado_1;
  int resultado_2;
  int valor;
  char nome[1024];
  hashtable *entrada;
  jogo *temp;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  resultado_1 = new_sym_var(sizeof(int) * 8);
  resultado_2 = new_sym_var(sizeof(int) * 8);
  entrada = procura(tab, nome);
  temp = list->inicio;
  if (entrada == 0)
  {
    printf("%d Jogo inexistente.\n", contador);
    return list;
  }
  else
  {
    
  }

  valor = hash(nome);
  valor1 = hash(entrada->item->equipa_1);
  valor2 = hash(entrada->item->equipa_2);
  if (tab->vet[valor]->item->resultado_1 == tab->vet[valor]->item->resultado_2)
  {
    if (resultado_1 > resultado_2)
    {
      tab_e->vet[valor1]->item->vitorias++;
    }
    else
    {
      
    }

    if (resultado_2 > resultado_1)
    {
      tab_e->vet[valor2]->item->vitorias++;
    }
    else
    {
      
    }

    tab->vet[valor]->item->resultado_1 = resultado_1;
    tab->vet[valor]->item->resultado_2 = resultado_2;
  }
  else
  {
    
  }

  if (tab->vet[valor]->item->resultado_1 > tab->vet[valor]->item->resultado_2)
  {
    if (resultado_1 < resultado_2)
    {
      tab_e->vet[valor1]->item->vitorias--;
      tab_e->vet[valor2]->item->vitorias++;
    }
    else
    {
      
    }

    if (resultado_1 == resultado_2)
    {
      tab_e->vet[valor1]->item->vitorias--;
    }
    else
    {
      
    }

    tab->vet[valor]->item->resultado_1 = resultado_1;
    tab->vet[valor]->item->resultado_2 = resultado_2;
  }
  else
  {
    
  }

  if (tab->vet[valor]->item->resultado_2 > tab->vet[valor]->item->resultado_1)
  {
    if (resultado_2 < resultado_1)
    {
      tab_e->vet[valor2]->item->vitorias--;
      tab_e->vet[valor1]->item->vitorias++;
    }
    else
    {
      
    }

    if (resultado_1 == resultado_2)
    {
      tab_e->vet[valor2]->item->vitorias--;
    }
    else
    {
      
    }

    tab->vet[valor]->item->resultado_1 = resultado_1;
    tab->vet[valor]->item->resultado_2 = resultado_2;
  }
  else
  {
    
  }

  while (temp != 0)
  {
    if (strcmp(temp->nome, nome) == 0)
    {
      temp->resultado_1 = resultado_1;
      temp->resultado_2 = resultado_2;
    }
    else
    {
      
    }

    temp = temp->seguinte;
  }

  return list;
}

int tamanho_lista(lista_das_equipas *list_e)
{
  int valor = 0;
  equipa *e;
  equipa *aux;
  e = list_e->inicio;
  aux = e;
  while (aux != 0)
  {
    valor++;
    aux = aux->seguinte;
  }

  return valor;
}

int compara_nome(const void *a, const void *b)
{
  char *e1 = *((char **) a);
  char *e2 = *((char **) b);
  return strcmp(e1, e2);
}

void encontra_equipas(int contador, lista_das_equipas *list_e)
{
  int i;
  int e = 0;
  int j = 0;
  equipa *temp;
  char **aux = malloc((sizeof(char *)) * tamanho_lista(list_e));
  temp = list_e->inicio;
  if (list_e->inicio == 0)
  {
    return;
  }
  else
  {
    
  }

  while (temp != 0)
  {
    if (temp->vitorias > j)
    {
      j = temp->vitorias;
    }
    else
    {
      
    }

    temp = temp->seguinte;
  }

  temp = list_e->inicio;
  while (temp != 0)
  {
    if (temp->vitorias == j)
    {
      aux[e] = temp->nome;
      e++;
    }
    else
    {
      
    }

    temp = temp->seguinte;
  }

  qsort(aux, e, sizeof(char *), compara_nome);
  printf("%d Melhores %d\n", contador, j);
  for (i = 0; i < e; i++)
  {
    printf("%d * %s\n", contador, aux[i]);
  }

  free(aux);
}

int menu()
{
  lista *list = cria_lista();
  tabela *tab = cria_tabela();
  lista_das_equipas *list_e = cria_lista_e();
  tabela_e *tab_e = cria_tabela_e();
  int contador = 0;
  int run = 1;
  char operation;
  while (run == 1)
  {
    fflush(stdin);
    operation = getchar();
    switch (operation)
    {
      case 'a':
        getchar();
        contador++;
        list = adiciona_jogo(contador, list, tab, tab_e);
        break;

      case 'l':
        contador++;
        lista_j(contador, list);
        break;

      case 'p':
        getchar();
        contador++;
        procura_jogo(contador, tab);
        break;

      case 'r':
        getchar();
        contador++;
        list = apaga_jogo(contador, list, tab, tab_e);
        break;

      case 's':
        getchar();
        contador++;
        list = altera_score(contador, list, tab, tab_e);
        break;

      case 'A':
        getchar();
        contador++;
        list_e = adiciona_equipa(contador, list_e, tab_e);
        break;

      case 'P':
        getchar();
        contador++;
        procura_equipa(contador, tab_e);
        break;

      case 'g':
        contador++;
        encontra_equipas(contador, list_e);
        break;

      case 'x':
        run = 0;
        elimina(tab, list);
        elimina_e(tab_e, list_e);
        break;

    }

  }

  return 0;
}

int main()
{
  menu();
  return 0;
}

