#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include "game.h"
#include "team.h"
#include "default.h"


int main()
{
  char buffer[1024];
  char t1[1024];
  char t2[1024];
  char s1[100];
  char s2[100];
  game_list game_list_aux;
  game_list primeiro_jogo;
  game_link game_link_aux;
  game_link game_link_aux2;
  link *teams;
  game_link *games;
  game_list games_sorted;
  int i;
  int contador = 0;
  char comando;
  teams = malloc(3000 * (sizeof(link)));
  games = malloc(3000 * (sizeof(game_link)));
  games_sorted = malloc(sizeof(struct game_pointers));
  primeiro_jogo = games_sorted;
  games_sorted->game = 0;
  for (i = 0; i < 3000; i++)
  {
    teams[i] = 0;
    games[i] = 0;
  }

  comando = getchar();
  while (comando != 'x')
  {
    switch (comando)
    {
      case 'A':
      {
        contador++;
        for (int buffer_index = 0; buffer_index < 10; buffer_index++)
        {
          buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
        }

        buffer[10 - 1] = '\0';
        if (existing_team(teams, buffer))
        {
          printf("%d Equipa existente.\n", contador);
          break;
        }
        else
        {
          
        }

        add_team(teams, buffer);
        break;
      }

      case 'P':
      {
        i = 0;
        contador++;
        for (int buffer_index = 0; buffer_index < 10; buffer_index++)
        {
          buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
        }

        buffer[10 - 1] = '\0';
        i = find(teams, buffer, contador);
        if (i == 1)
        {
          break;
        }
        else
        {
          
        }

        game_list_aux = games_sorted;
        while (game_list_aux->game != 0)
        {
          if (!strcmp(game_list_aux->game->team1, buffer))
          {
            if (game_list_aux->game->score1 > game_list_aux->game->score2)
            {
              i++;
            }
            else
            {
              
            }

          }
          else
          {
            
          }

          if (!strcmp(game_list_aux->game->team2, buffer))
          {
            if (game_list_aux->game->score2 > game_list_aux->game->score1)
            {
              i++;
            }
            else
            {
              
            }

          }
          else
          {
            
          }

          game_list_aux = game_list_aux->next;
        }

        printf("%d\n", i);
        break;
      }

      case 'a':
      {
        contador++;
        for (int buffer_index = 0; buffer_index < 10; buffer_index++)
        {
          buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
        }

        buffer[10 - 1] = '\0';
        getchar();
        for (int t1_index = 0; t1_index < 10; t1_index++)
        {
          t1[t1_index] = new_sym_var(sizeof(char) * 8);
        }

        t1[10 - 1] = '\0';
        getchar();
        for (int t2_index = 0; t2_index < 10; t2_index++)
        {
          t2[t2_index] = new_sym_var(sizeof(char) * 8);
        }

        t2[10 - 1] = '\0';
        getchar();
        for (int s1_index = 0; s1_index < 10; s1_index++)
        {
          s1[s1_index] = new_sym_var(sizeof(char) * 8);
        }

        s1[10 - 1] = '\0';
        getchar();
        for (int s2_index = 0; s2_index < 10; s2_index++)
        {
          s2[s2_index] = new_sym_var(sizeof(char) * 8);
        }

        s2[10 - 1] = '\0';
        getchar();
        if (existing_game(games, buffer))
        {
          printf("%d Jogo existente.\n", contador);
          break;
        }
        else
        {
          
        }

        if (!(existing_team(teams, t1) && existing_team(teams, t2)))
        {
          printf("%d Equipa inexistente.\n", contador);
          break;
        }
        else
        {
          
        }

        add_game(games, buffer, t1, t2, s1, s2, &games_sorted);
        break;
      }

      case 'l':
      {
        contador++;
        game_list_aux = primeiro_jogo;
        while (game_list_aux->prev != 0)
        {
          game_list_aux = game_list_aux->prev;
          printf("%d %s %s %s %d %d\n", contador, game_list_aux->game->name, game_list_aux->game->team1, game_list_aux->game->team2, game_list_aux->game->score1, game_list_aux->game->score2);
        }

        break;
      }

      case 'p':
      {
        contador++;
        for (int buffer_index = 0; buffer_index < 10; buffer_index++)
        {
          buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
        }

        buffer[10 - 1] = '\0';
        if (!existing_game(games, buffer))
        {
          printf("%d Jogo inexistente.\n", contador);
          break;
        }
        else
        {
          
        }

        game_link_aux = get_game(games, buffer);
        printf("%d %s %s %s %d %d\n", contador, game_link_aux->name, game_link_aux->team1, game_link_aux->team2, game_link_aux->score1, game_link_aux->score2);
        break;
      }

      case 's':
      {
        contador++;
        for (int buffer_index = 0; buffer_index < 10; buffer_index++)
        {
          buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
        }

        buffer[10 - 1] = '\0';
        getchar();
        for (int s1_index = 0; s1_index < 10; s1_index++)
        {
          s1[s1_index] = new_sym_var(sizeof(char) * 8);
        }

        s1[10 - 1] = '\0';
        getchar();
        for (int s2_index = 0; s2_index < 10; s2_index++)
        {
          s2[s2_index] = new_sym_var(sizeof(char) * 8);
        }

        s2[10 - 1] = '\0';
        if (!existing_game(games, buffer))
        {
          printf("%d Jogo inexistente.\n", contador);
          break;
        }
        else
        {
          
        }

        game_link_aux = get_game(games, buffer);
        game_link_aux->score1 = atoi(s1);
        game_link_aux->score2 = atoi(s2);
        break;
      }

      case 'r':
      {
        contador++;
        for (int buffer_index = 0; buffer_index < 10; buffer_index++)
        {
          buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
        }

        buffer[10 - 1] = '\0';
        if (!existing_game(games, buffer))
        {
          printf("%d Jogo inexistente.\n", contador);
          break;
        }
        else
        {
          
        }

        game_list_aux = games_sorted;
        while (strcmp(game_list_aux->game->name, buffer))
        {
          game_list_aux = game_list_aux->next;
        }

        game_link_aux = games[hashU(buffer)];
        if (game_link_aux->next == 0)
        {
          game_link_aux = game_link_aux->next;
          free_game_node(games[hashU(buffer)]);
          games[hashU(buffer)] = game_link_aux;
        }
        else
        {
          if (!strcmp(game_link_aux->name, buffer))
          {
            games[hashU(buffer)] = game_link_aux->next;
            free_game_node(game_link_aux);
          }
          else
          {
            while (strcmp(game_link_aux->next->name, buffer))
            {
              game_link_aux = game_link_aux->next;
            }

            game_link_aux2 = game_link_aux->next;
            game_link_aux->next = game_link_aux->next->next;
            free_game_node(game_link_aux2);
          }

        }

        if (game_list_aux->prev == 0)
        {
          games_sorted = games_sorted->next;
          games_sorted->prev = 0;
          free(game_list_aux);
        }
        else
        {
          game_list_aux->prev->next = game_list_aux->next;
          game_list_aux->next->prev = game_list_aux->prev;
          free(game_list_aux);
        }

        break;
      }

    }

    comando = getchar();
  }

  free_list(teams);
  free_game_list(games);
  free(games);
  free_ord(games_sorted);
  free(teams);
  return 0;
}

