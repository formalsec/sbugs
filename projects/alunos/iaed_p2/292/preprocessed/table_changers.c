#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdbool.h>
#include <assert.h>
#include "functions.h"


void Inseret(struct Jogos **jogos, struct Jogos **first, char rest[], int M, int NL, struct Equipas **equipas, struct Equipas *false_t, struct Jogos **top, struct Jogos *false_g, int N)
{
  int s1 = 0;
  int s2 = 0;
  int id = 0;
  char ID[1023];
  char t1[1023];
  char t2[1023];
  struct Equipas *equipa1;
  struct Equipas *equipa2;
  struct Jogos *novoJogo;
  struct Jogos *game;
  struct Jogos *jogo = *first;
  for (int ID_index = 0; ID_index < 10; ID_index++)
  {
    ID[ID_index] = new_sym_var(sizeof(char) * 8);
  }

  ID[10 - 1] = '\0';
  for (int t1_index = 0; t1_index < 10; t1_index++)
  {
    t1[t1_index] = new_sym_var(sizeof(char) * 8);
  }

  t1[10 - 1] = '\0';
  for (int t2_index = 0; t2_index < 10; t2_index++)
  {
    t2[t2_index] = new_sym_var(sizeof(char) * 8);
  }

  t2[10 - 1] = '\0';
  s1 = new_sym_var(sizeof(int) * 8);
  s2 = new_sym_var(sizeof(int) * 8);
  game = encontraJogo(jogos, ID, false, M, NL, false_g);
  if (strcmp(game->ID, "none"))
  {
    printf("%d Jogo existente.\n", NL);
    return;
  }
  else
  {
    
  }

  equipa1 = encontraEquipa(equipas, t1, false, N, NL, false_t);
  if (!strcmp(equipa1->ID, "NONE"))
  {
    printf("%d Equipa inexistente.\n", NL);
    return;
  }
  else
  {
    
  }

  equipa2 = encontraEquipa(equipas, t2, false, N, NL, false_t);
  if (!strcmp(equipa2->ID, "NONE"))
  {
    printf("%d Equipa inexistente.\n", NL);
    return;
  }
  else
  {
    
  }

  novoJogo = (struct Jogos *) malloc(sizeof(struct Jogos));
  novoJogo->ID = malloc((strlen(ID) + 1) * (sizeof(char)));
  novoJogo->team_1 = malloc((strlen(t1) + 1) * (sizeof(char)));
  novoJogo->team_2 = malloc((strlen(t2) + 1) * (sizeof(char)));
  strcpy(novoJogo->ID, ID);
  strcpy(novoJogo->team_1, t1);
  strcpy(novoJogo->team_2, t2);
  novoJogo->score1 = s1;
  novoJogo->score2 = s2;
  id = hash(ID, M);
  if (jogos[id] == 0)
  {
    jogos[id] = novoJogo;
    novoJogo->next_tabela = 0;
  }
  else
  {
    struct Jogos *aux = jogos[id];
    while (aux->next_tabela)
    {
      aux = aux->next_tabela;
    }

    aux->next_tabela = novoJogo;
    novoJogo->next_tabela = 0;
  }

  if (s1 > s2)
  {
    equipa1->wins = equipa1->wins + 1;
  }
  else
  {
    if (s1 < s2)
    {
      equipa2->wins = equipa2->wins + 1;
    }
    else
    {
      
    }

  }

  if ((*first) == 0)
  {
    *first = novoJogo;
    novoJogo->next = 0;
    novoJogo->prev = 0;
    *top = novoJogo;
    return;
  }
  else
  {
    jogo = *top;
    jogo->next = novoJogo;
    novoJogo->next = 0;
    novoJogo->prev = jogo;
    *top = novoJogo;
  }

  return;
}

int InseretEquipa(struct Equipas **equipas, char ID[], int N, int NL, struct Equipas *false_t)
{
  struct Equipas *novaEquipa;
  struct Equipas *equipa1;
  int id;
  equipa1 = encontraEquipa(equipas, ID, false, N, NL, false_t);
  if (strcmp(equipa1->ID, "NONE"))
  {
    printf("%d Equipa existente.\n", NL);
    return 0;
  }
  else
  {
    
  }

  novaEquipa = (struct Equipas *) malloc(sizeof(struct Equipas));
  novaEquipa->ID = malloc((strlen(ID) + 1) * (sizeof(char)));
  strcpy(novaEquipa->ID, ID);
  novaEquipa->wins = 0;
  id = hash(ID, N);
  if (equipas[id] == 0)
  {
    equipas[id] = novaEquipa;
    novaEquipa->next = 0;
  }
  else
  {
    struct Equipas *prev = equipas[id];
    while (prev->next)
    {
      prev = prev->next;
    }

    prev->next = novaEquipa;
    novaEquipa->next = 0;
  }

  return 1;
}

void alteraScore(struct Jogos **jogos, char resto[], int M, int NL, struct Equipas **equipas, struct Equipas *false_t, int N)
{
  struct Equipas *equipa1;
  struct Equipas *equipa2;
  struct Jogos *next;
  char id[1023];
  int s1;
  int s2;
  int x;
  for (int id_index = 0; id_index < 10; id_index++)
  {
    id[id_index] = new_sym_var(sizeof(char) * 8);
  }

  id[10 - 1] = '\0';
  s1 = new_sym_var(sizeof(int) * 8);
  s2 = new_sym_var(sizeof(int) * 8);
  x = hash(id, M);
  next = jogos[x];
  while (next != 0)
  {
    if (!strcmp(id, next->ID))
    {
      equipa1 = encontraEquipa(equipas, next->team_1, false, N, NL, false_t);
      equipa2 = encontraEquipa(equipas, next->team_2, false, N, NL, false_t);
      if (s1 > s2)
      {
        if ((next->score1 == 0) && (next->score2 == 0))
        {
          equipa1->wins = equipa1->wins + 1;
        }
        else
        {
          if (next->score1 < next->score2)
          {
            equipa1->wins = equipa1->wins + 1;
            if (equipa2->wins > 0)
            {
              equipa2->wins = equipa2->wins - 1;
            }
            else
            {
              
            }

          }
          else
          {
            if (next->score1 == next->score2)
            {
              equipa1->wins = equipa1->wins + 1;
            }
            else
            {
              
            }

          }

        }

      }
      else
      {
        if (s1 < s2)
        {
          if ((next->score1 == 0) && (next->score2 == 0))
          {
            equipa2->wins = equipa2->wins + 1;
          }
          else
          {
            if (next->score1 > next->score2)
            {
              if (equipa1->wins > 0)
              {
                equipa1->wins = equipa1->wins - 1;
              }
              else
              {
                
              }

              equipa2->wins = equipa2->wins + 1;
            }
            else
            {
              if (next->score1 == next->score2)
              {
                equipa2->wins = equipa2->wins + 1;
              }
              else
              {
                
              }

            }

          }

        }
        else
        {
          if (s1 == s2)
          {
            if (next->score1 > next->score2)
            {
              if (equipa1->wins > 0)
              {
                equipa1->wins = equipa1->wins - 1;
              }
              else
              {
                
              }

            }
            else
            {
              if (next->score1 < next->score2)
              {
                if (equipa2->wins > 0)
                {
                  equipa2->wins = equipa2->wins - 1;
                }
                else
                {
                  
                }

              }
              else
              {
                
              }

            }

          }
          else
          {
            
          }

        }

      }

      next->score1 = s1;
      next->score2 = s2;
      return;
    }
    else
    {
      
    }

    next = next->next_tabela;
  }

  printf("%d Jogo inexistente.\n", NL);
  return;
}

void deleteGame(struct Jogos **jogos, struct Jogos **tabela, char nome[], struct Equipas **equipas, struct Equipas *false_t, int M, int NL, struct Jogos *false_g, struct Jogos **top, int N)
{
  struct Jogos *elemento = *tabela;
  struct Jogos *anterior;
  struct Equipas *equipa1;
  int score1;
  int score2;
  int x = hash(nome, M);
  bool encontrou = false;
  if ((elemento != 0) && (!strcmp(elemento->ID, nome)))
  {
    *tabela = elemento->next;
    encontrou = true;
  }
  else
  {
    
  }

  if (!encontrou)
  {
    elemento = encontraJogo(jogos, nome, false, M, NL, false_g);
    if (!strcmp(elemento->ID, "none"))
    {
      printf("%d Jogo inexistente.\n", NL);
      return;
    }
    else
    {
      
    }

    if (elemento->next != 0)
    {
      elemento->next->prev = elemento->prev;
    }
    else
    {
      
    }

    if (elemento == (*top))
    {
      *top = elemento->prev;
    }
    else
    {
      
    }

    if (elemento->prev != 0)
    {
      elemento->prev->next = elemento->next;
    }
    else
    {
      
    }

  }
  else
  {
    
  }

  elemento = jogos[x];
  if ((jogos[x] != 0) && (!strcmp(elemento->ID, nome)))
  {
    if (elemento->next_tabela != 0)
    {
      jogos[x] = elemento->next_tabela;
    }
    else
    {
      if (elemento->next_tabela == 0)
      {
        jogos[x] = 0;
      }
      else
      {
        
      }

    }

  }
  else
  {
    while ((elemento != 0) && strcmp(elemento->ID, nome))
    {
      anterior = elemento;
      elemento = elemento->next_tabela;
    }

    anterior->next_tabela = elemento->next_tabela;
  }

  score1 = elemento->score1;
  score2 = elemento->score2;
  if (score1 > score2)
  {
    equipa1 = encontraEquipa(equipas, elemento->team_1, false, N, NL, false_t);
    equipa1->wins = equipa1->wins - 1;
  }
  else
  {
    if (score2 > score1)
    {
      equipa1 = encontraEquipa(equipas, elemento->team_2, false, N, NL, false_t);
      equipa1->wins = equipa1->wins - 1;
    }
    else
    {
      
    }

  }

  free(elemento->ID);
  free(elemento->team_1);
  free(elemento->team_2);
  free(elemento);
}

void freeStruct(struct Jogos **head, struct Equipas **equipas, int N)
{
  int i;
  struct Jogos *antigo = *head;
  struct Jogos *atual;
  while (antigo != 0)
  {
    atual = antigo;
    antigo = antigo->next;
    free(atual->ID);
    free(atual->team_1);
    free(atual->team_2);
    free(atual);
  }

  for (i = 0; i < N; i++)
  {
    if (equipas[i] != 0)
    {
      struct Equipas *prev;
      struct Equipas *temp = equipas[i];
      while (temp != 0)
      {
        prev = temp;
        temp = temp->next;
        free(prev->ID);
        free(prev);
      }

    }
    else
    {
      
    }

  }

}

