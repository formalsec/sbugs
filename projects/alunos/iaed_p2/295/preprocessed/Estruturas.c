#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "Estruturas.h"


int hash(char *v)
{
  int h;
  int a = 31415;
  int b = 27183;
  for (h = 0; (*v) != '\0'; v++, a = (a * b) % (10000 - 1))
  {
    h = ((a * h) + (*v)) % 10000;
  }

  return h;
}

void inicia_lista_equipas(lista_equipas *a)
{
  int i;
  for (i = 0; i < 10000; i++)
  {
    a->no[i] = 0;
  }

}

void inicia_lista_equipas_aux(lista_equipas_aux *a)
{
  a->head = 0;
}

void inicia_lista_jogos(lista_jogos *a)
{
  int i;
  for (i = 0; i < 10000; i++)
  {
    a->no[i] = 0;
  }

}

void inicia_lista_jogos_aux(lista_jogos_aux *a)
{
  a->head = 0;
  a->last = 0;
}

Equipa *procura_equipa(char nome_equipa[], lista_equipas *a)
{
  int i = hash(nome_equipa);
  no_equipas *c;
  c = a->no[i];
  while (c != 0)
  {
    if (strcmp(c->eq->nome_equipa, nome_equipa) == 0)
    {
      return c->eq;
    }
    else
    {
      c = c->next;
    }

  }

  return 0;
}

void insere_equipa(lista_equipas *a, Equipa *b)
{
  int i = hash(b->nome_equipa);
  no_equipas *atual = malloc(sizeof(no_equipas));
  atual->eq = b;
  atual->next = a->no[i];
  a->no[i] = atual;
}

void insere_equipa_aux(lista_equipas_aux *a, Equipa *b)
{
  no_equipas *atual = malloc(sizeof(no_equipas));
  atual->eq = b;
  atual->next = a->head;
  a->head = atual;
}

Jogo *procura_jogo(char nome_jogo[], lista_jogos *a)
{
  int i = hash(nome_jogo);
  no_jogos *c;
  c = a->no[i];
  while (c != 0)
  {
    if (strcmp(c->jog->nome_jogo, nome_jogo) == 0)
    {
      return c->jog;
    }
    else
    {
      c = c->next;
    }

  }

  return 0;
}

void insere_jogo(lista_jogos *a, Jogo *b, lista_equipas *c)
{
  int i;
  int j;
  no_equipas *d;
  no_jogos *atual;
  i = hash(b->nome_jogo);
  atual = malloc(sizeof(no_jogos));
  atual->jog = b;
  atual->next = a->no[i];
  if (a->no[i] != 0)
  {
    a->no[i] = atual;
    a->no[i]->previous = 0;
    a->no[i]->next->previous = atual;
  }
  else
  {
    a->no[i] = atual;
    a->no[i]->previous = 0;
  }

  if (b->resultado1 > b->resultado2)
  {
    j = hash(b->equipa1);
    d = c->no[j];
    while (strcmp(d->eq->nome_equipa, b->equipa1) != 0)
    {
      d = d->next;
    }

    d->eq->n_vitorias++;
  }
  else
  {
    
  }

  if (b->resultado1 < b->resultado2)
  {
    j = hash(b->equipa2);
    d = c->no[j];
    while (strcmp(d->eq->nome_equipa, b->equipa2) != 0)
    {
      d = d->next;
    }

    d->eq->n_vitorias++;
  }
  else
  {
    
  }

}

void insere_jogo_aux(lista_jogos_aux *a, Jogo_aux *b)
{
  no_jogos_aux *atual = malloc(sizeof(no_jogos_aux));
  atual->jog = b;
  atual->next = a->head;
  if (a->head == 0)
  {
    a->head = atual;
  }
  else
  {
    
  }

  atual->next = 0;
  atual->previous = a->last;
  if (a->last)
  {
    a->last->next = atual;
  }
  else
  {
    
  }

  a->last = atual;
}

void muda_n_vitorias(lista_equipas *a, lista_jogos *b, char nome_jogo[])
{
  int i;
  int j;
  no_jogos *c;
  no_equipas *d;
  i = hash(nome_jogo);
  c = b->no[i];
  while (strcmp(c->jog->nome_jogo, nome_jogo) != 0)
  {
    c = c->next;
  }

  if (c->jog->resultado1 > c->jog->resultado2)
  {
    j = hash(c->jog->equipa1);
    d = a->no[j];
    while (strcmp(d->eq->nome_equipa, c->jog->equipa1) != 0)
    {
      d = d->next;
    }

    d->eq->n_vitorias--;
  }
  else
  {
    if (c->jog->resultado1 < c->jog->resultado2)
    {
      j = hash(c->jog->equipa2);
      d = a->no[j];
      while (strcmp(d->eq->nome_equipa, c->jog->equipa2) != 0)
      {
        d = d->next;
      }

      d->eq->n_vitorias--;
    }
    else
    {
      
    }

  }

}

no_jogos *remove_jogo(char nome_jogo[], lista_jogos *a, lista_equipas *c)
{
  Jogo *b;
  no_jogos *d;
  no_jogos *f;
  no_jogos *g;
  no_jogos *h;
  no_jogos *j;
  int i;
  b = procura_jogo(nome_jogo, a);
  muda_n_vitorias(c, a, nome_jogo);
  i = hash(nome_jogo);
  d = a->no[i];
  f = a->no[i];
  for (; f; f = f->next)
  {
    if (strcmp(f->jog->nome_jogo, b->nome_jogo) == 0)
    {
      if ((f->next == 0) && (f->previous == 0))
      {
        free(f->jog->nome_jogo);
        free(f->jog->equipa1);
        free(f->jog->equipa2);
        free(f->jog);
        free(f);
        f = 0;
        return f;
      }
      else
      {
        if (f->previous == 0)
        {
          g = f->next;
          g->previous = 0;
          free(f->jog->nome_jogo);
          free(f->jog->equipa1);
          free(f->jog->equipa2);
          free(f->jog);
          free(f);
          return g;
        }
        else
        {
          h = f->next;
          j = f->previous;
          if (h != 0)
          {
            h->previous = j;
          }
          else
          {
            
          }

          j->next = h;
          free(f->jog->nome_jogo);
          free(f->jog->equipa1);
          free(f->jog->equipa2);
          free(f->jog);
          free(f);
          return d;
        }

      }

    }
    else
    {
      
    }

  }

  return 0;
}

void muda_resultado(int nl, char nome_jogo[], int res_equipa1, int res_equipa2, lista_jogos *a, lista_equipas *d)
{
  int c;
  int f;
  int g;
  Jogo *b;
  no_equipas *h;
  b = procura_jogo(nome_jogo, a);
  if (b != 0)
  {
    if (b->resultado1 > b->resultado2)
    {
      c = 1;
    }
    else
    {
      if (b->resultado1 < b->resultado2)
      {
        c = 2;
      }
      else
      {
        c = 0;
      }

    }

    b->resultado1 = res_equipa1;
    b->resultado2 = res_equipa2;
    if ((c == 1) && (res_equipa1 < res_equipa2))
    {
      f = hash(b->equipa1);
      h = d->no[f];
      while (strcmp(h->eq->nome_equipa, b->equipa1) != 0)
      {
        h = h->next;
      }

      h->eq->n_vitorias--;
      g = hash(b->equipa2);
      h = d->no[g];
      while (strcmp(h->eq->nome_equipa, b->equipa2) != 0)
      {
        h = h->next;
      }

      h->eq->n_vitorias++;
    }
    else
    {
      if ((c == 1) && (res_equipa1 == res_equipa2))
      {
        f = hash(b->equipa1);
        h = d->no[f];
        while (strcmp(h->eq->nome_equipa, b->equipa1) != 0)
        {
          h = h->next;
        }

        h->eq->n_vitorias--;
      }
      else
      {
        if ((c == 2) && (res_equipa1 > res_equipa2))
        {
          f = hash(b->equipa1);
          h = d->no[f];
          while (strcmp(h->eq->nome_equipa, b->equipa1) != 0)
          {
            h = h->next;
          }

          h->eq->n_vitorias++;
          g = hash(b->equipa2);
          h = d->no[g];
          while (strcmp(h->eq->nome_equipa, b->equipa2) != 0)
          {
            h = h->next;
          }

          h->eq->n_vitorias--;
        }
        else
        {
          if ((c == 2) && (res_equipa1 == res_equipa2))
          {
            g = hash(b->equipa2);
            h = d->no[g];
            while (strcmp(h->eq->nome_equipa, b->equipa2) != 0)
            {
              h = h->next;
            }

            h->eq->n_vitorias--;
          }
          else
          {
            if ((c == 0) && (res_equipa1 > res_equipa2))
            {
              f = hash(b->equipa1);
              h = d->no[f];
              while (strcmp(h->eq->nome_equipa, b->equipa1) != 0)
              {
                h = h->next;
              }

              h->eq->n_vitorias++;
            }
            else
            {
              if ((c == 0) && (res_equipa1 < res_equipa2))
              {
                g = hash(b->equipa2);
                h = d->no[g];
                while (strcmp(h->eq->nome_equipa, b->equipa2) != 0)
                {
                  h = h->next;
                }

                h->eq->n_vitorias++;
              }
              else
              {
                
              }

            }

          }

        }

      }

    }

  }
  else
  {
    printf("%d Jogo inexistente.\n", nl);
  }

}

void free_hash_equipas(lista_equipas *a)
{
  int i;
  lista_equipas *b = a;
  no_equipas *c;
  no_equipas *d;
  for (i = 0; i < 10000; i++)
  {
    c = b->no[i];
    while (c)
    {
      d = c->next;
      free(c->eq->nome_equipa);
      free(c->eq);
      free(c);
      c = d;
    }

  }

  free(a);
}

void free_lista_equipas(lista_equipas_aux *a)
{
  lista_equipas_aux *b = a;
  no_equipas *c;
  no_equipas *d;
  c = b->head;
  while (c)
  {
    if (c->next != 0)
    {
      d = c->next;
      free(c);
      c = d;
    }
    else
    {
      free(c);
      break;
    }

  }

  free(a);
}

void free_hash_jogos(lista_jogos *a)
{
  int i;
  lista_jogos *b = a;
  no_jogos *c;
  no_jogos *d;
  for (i = 0; i < 10000; i++)
  {
    c = b->no[i];
    while (c)
    {
      d = c->next;
      free(c->jog->nome_jogo);
      free(c->jog->equipa1);
      free(c->jog->equipa2);
      free(c->jog);
      free(c);
      c = d;
    }

  }

  free(a);
}

void free_lista_jogos(lista_jogos_aux *a)
{
  lista_jogos_aux *b = a;
  no_jogos_aux *c;
  no_jogos_aux *d;
  c = b->head;
  while (c)
  {
    if (c->next != 0)
    {
      d = c->next;
      free(c->jog->nome_jogo);
      free(c->jog->equipa1);
      free(c->jog->equipa2);
      free(c->jog);
      free(c);
      c = d;
    }
    else
    {
      free(c->jog->nome_jogo);
      free(c->jog->equipa1);
      free(c->jog->equipa2);
      free(c->jog);
      free(c);
      break;
    }

  }

  free(a);
}

void free_geral(lista_equipas *a, lista_equipas_aux *b, lista_jogos *c, lista_jogos_aux *d)
{
  free_hash_equipas(a);
  free_lista_equipas(b);
  free_hash_jogos(c);
  free_lista_jogos(d);
}

int aux_merge(no_equipas *a, no_equipas *b)
{
  int j;
  for (j = 0; j < 1024; j++)
  {
    if ((a->eq->nome_equipa[j] > b->eq->nome_equipa[j]) || (b->eq->nome_equipa[j] == '\0'))
    {
      return 1;
    }
    else
    {
      if ((a->eq->nome_equipa[j] < b->eq->nome_equipa[j]) || (a->eq->nome_equipa[j] == '\0'))
      {
        return 0;
      }
      else
      {
        
      }

    }

  }

  return 0;
}

void merge(no_equipas **a, int l, int m, int r)
{
  no_equipas *aux[1024];
  int i;
  int j;
  int k;
  for (i = m + 1; i > l; i--)
    aux[i - 1] = a[i - 1];

  for (j = m; j < r; j++)
    aux[(r + m) - j] = a[j + 1];

  for (k = l; k <= r; k++)
    if (aux_merge(aux[i], aux[j]))
  {
    a[k] = aux[j--];
  }
  else
  {
    a[k] = aux[i++];
  }


}

void mergesort(no_equipas **a, int l, int r)
{
  int m = (r + l) / 2;
  if (r <= l)
  {
    return;
  }
  else
  {
    
  }

  mergesort(a, l, m);
  mergesort(a, m + 1, r);
  merge(a, l, m, r);
}

