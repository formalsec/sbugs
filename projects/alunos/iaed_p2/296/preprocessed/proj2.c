#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "HashtableJogo.h"
#include "HashtableEquipa.h"


void print_jogo(int nl, char *key, Jogo *jogo)
{
  printf("%d %s %s %s %d %d\n", nl, key, jogo->equipa_1->nome_equipa, jogo->equipa_2->nome_equipa, jogo->score_equipa_1, jogo->score_equipa_2);
}

void quicksort(char **a, int l, int r)
{
  char *v;
  int i;
  int j;
  if (r <= l)
  {
    return;
  }
  else
  {
    
  }

  i = l - 1;
  j = r;
  v = a[r];
  while (i < j)
  {
    while (strcmp(a[++i], v) < 0)
      ;

    while (strcmp(v, a[--j]) < 0)
      if (j == l)
    {
      break;
    }
    else
    {
      
    }


    if (i < j)
    {
      char *t = a[i];
      a[i] = a[j];
      a[j] = t;
    }
    else
    {
      
    }

    ;
  }

  {
    char *t = a[i];
    a[i] = a[r];
    a[r] = t;
  }
  ;
  quicksort(a, l, i - 1);
  quicksort(a, i + 1, r);
}

void free_estruturas(Hashtable_Jogo *htj, Hashtable_Equipa *hte, Lista_Ligada_Jogo *jogos, Lista_Ligada_Equipa *equipas)
{
  free_lista_ligada_jogo(jogos);
  free_lista_ligada_equipa(equipas);
  free_hash_jogo(htj);
  free_hash_equipa(hte);
}

void cmd_a(Hashtable_Jogo *htj, Hashtable_Equipa *hte, Lista_Ligada_Jogo *jogos, int nl, char *chave, char *ne1, char *ne2, int se1, int se2)
{
  Jogo *jogo;
  Equipa *e1;
  Equipa *e2;
  if (ht_pesquisar_jogo(htj, chave))
  {
    printf("%d Jogo existente.\n", nl);
  }
  else
  {
    e1 = ht_pesquisar_equipa(hte, ne1);
    e2 = ht_pesquisar_equipa(hte, ne2);
    if (e1 && e2)
    {
      jogo = j_criar(e1, e2, se1, se2);
      ll_inserir_jogo(jogos, jogo, chave);
      ht_inserir_jogo(htj, jogo, chave);
      if (vencedor(jogo))
      {
        vencedor(jogo)->vitorias++;
      }
      else
      {
        
      }

    }
    else
    {
      printf("%d Equipa inexistente.\n", nl);
    }

  }

}

void cmd_A(Hashtable_Equipa *hte, Lista_Ligada_Equipa *equipas, int nl, char *chave)
{
  Equipa *equipa;
  if (ht_pesquisar_equipa(hte, chave))
  {
    printf("%d Equipa existente.\n", nl);
  }
  else
  {
    equipa = e_criar(chave);
    ll_inserir_equipa(equipas, equipa, chave);
    ht_inserir_equipa(hte, equipa, chave);
  }

}

void cmd_l(Lista_Ligada_Jogo *jogos, int nl)
{
  No_Jogo *n;
  for (n = jogos->inicio; n; n = n->prox)
    print_jogo(nl, n->chave, n->jogo);

}

void cmd_p(Hashtable_Jogo *htj, int nl, char *chave)
{
  Jogo *jogo = ht_pesquisar_jogo(htj, chave);
  if (jogo)
  {
    print_jogo(nl, chave, jogo);
  }
  else
  {
    printf("%d Jogo inexistente.\n", nl);
  }

}

void cmd_P(Hashtable_Equipa *hte, int nl, char *chave)
{
  Equipa *equipa = ht_pesquisar_equipa(hte, chave);
  if (equipa)
  {
    printf("%d %s %d\n", nl, equipa->nome_equipa, equipa->vitorias);
  }
  else
  {
    printf("%d Equipa inexistente.\n", nl);
  }

}

void cmd_r(Hashtable_Jogo *htj, Lista_Ligada_Jogo *jogos, int nl, char *chave)
{
  Jogo *jogo = ht_pesquisar_jogo(htj, chave);
  if (jogo)
  {
    if (vencedor(jogo))
    {
      vencedor(jogo)->vitorias--;
    }
    else
    {
      
    }

    ht_deletar_jogo(htj, chave);
    ll_deletar_jogo(jogos, chave);
  }
  else
  {
    printf("%d Jogo inexistente.\n", nl);
  }

}

void cmd_s(Hashtable_Jogo *htj, int nl, char *chave, int se1_novo, int se2_novo)
{
  Jogo *antigo = ht_pesquisar_jogo(htj, chave);
  Jogo *novo;
  Equipa *e_antiga;
  Equipa *e_nova;
  if (antigo)
  {
    novo = j_criar(antigo->equipa_1, antigo->equipa_2, se1_novo, se2_novo);
    e_antiga = vencedor(antigo);
    e_nova = vencedor(novo);
    if (e_antiga != e_nova)
    {
      if (e_nova)
      {
        if (e_antiga)
        {
          e_antiga->vitorias--;
        }
        else
        {
          
        }

        e_nova->vitorias++;
      }
      else
      {
        if (e_antiga)
        {
          e_antiga->vitorias--;
        }
        else
        {
          
        }

      }

    }
    else
    {
      
    }

    antigo->score_equipa_1 = novo->score_equipa_1;
    antigo->score_equipa_2 = novo->score_equipa_2;
    free(novo);
  }
  else
  {
    printf("%d Jogo inexistente.\n", nl);
  }

}

void cmd_g(Lista_Ligada_Equipa *equipas, int nl)
{
  int i;
  int valor_aux = 100;
  int valor_adiciona_aux = 100;
  int index_aux = 0;
  int maior = 0;
  char **equipas_filt;
  No_Equipa *n = equipas->inicio;
  if (equipas->inicio)
  {
    equipas_filt = malloc((sizeof(char *)) * valor_aux);
    while (n)
    {
      if (n->equipa->vitorias > maior)
      {
        maior = n->equipa->vitorias;
        index_aux = 0;
        equipas_filt[index_aux++] = n->chave;
      }
      else
      {
        if (n->equipa->vitorias == maior)
        {
          if (index_aux >= valor_aux)
          {
            valor_aux += valor_adiciona_aux;
            equipas_filt = realloc(equipas_filt, (sizeof(char *)) * valor_aux);
          }
          else
          {
            
          }

          equipas_filt[index_aux++] = n->chave;
        }
        else
        {
          
        }

      }

      n = n->prox;
    }

    quicksort(equipas_filt, 0, index_aux - 1);
    printf("%d Melhores %d\n", nl, maior);
    for (i = 0; i < index_aux; i++)
      printf("%d * %s\n", nl, equipas_filt[i]);

    free(equipas_filt);
  }
  else
  {
    
  }

}

int main()
{
  int nl = 0;
  int score_equipa_1;
  int score_equipa_2;
  char opcao;
  char nome_jogo[1024];
  char nome_equipa_1[1024];
  char nome_equipa_2[1024];
  Hashtable_Jogo *htj = ht_criar_jogo(1997);
  Hashtable_Equipa *hte = ht_criar_equipa(1997);
  Lista_Ligada_Jogo *jogos = ll_criar_jogo();
  Lista_Ligada_Equipa *equipas = ll_criar_equipa();
  while ((1 != EOF) && (opcao != 'x'))
  {
    opcao = new_sym_var(sizeof(char) * 8);
    nl++;
    switch (opcao)
    {
      case 'a':
        for (int nome_jogo_index = 0; nome_jogo_index < 10; nome_jogo_index++)
      {
        nome_jogo[nome_jogo_index] = new_sym_var(sizeof(char) * 8);
      }

        nome_jogo[10 - 1] = '\0';
        for (int nome_equipa_1_index = 0; nome_equipa_1_index < 10; nome_equipa_1_index++)
      {
        nome_equipa_1[nome_equipa_1_index] = new_sym_var(sizeof(char) * 8);
      }

        nome_equipa_1[10 - 1] = '\0';
        for (int nome_equipa_2_index = 0; nome_equipa_2_index < 10; nome_equipa_2_index++)
      {
        nome_equipa_2[nome_equipa_2_index] = new_sym_var(sizeof(char) * 8);
      }

        nome_equipa_2[10 - 1] = '\0';
        score_equipa_1 = new_sym_var(sizeof(int) * 8);
        score_equipa_2 = new_sym_var(sizeof(int) * 8);
        cmd_a(htj, hte, jogos, nl, nome_jogo, nome_equipa_1, nome_equipa_2, score_equipa_1, score_equipa_2);
        break;

      case 'A':
        for (int nome_equipa_1_index = 0; nome_equipa_1_index < 10; nome_equipa_1_index++)
      {
        nome_equipa_1[nome_equipa_1_index] = new_sym_var(sizeof(char) * 8);
      }

        nome_equipa_1[10 - 1] = '\0';
        cmd_A(hte, equipas, nl, nome_equipa_1);
        break;

      case 'l':
        cmd_l(jogos, nl);
        break;

      case 'p':
        for (int nome_jogo_index = 0; nome_jogo_index < 10; nome_jogo_index++)
      {
        nome_jogo[nome_jogo_index] = new_sym_var(sizeof(char) * 8);
      }

        nome_jogo[10 - 1] = '\0';
        cmd_p(htj, nl, nome_jogo);
        break;

      case 'P':
        for (int nome_equipa_1_index = 0; nome_equipa_1_index < 10; nome_equipa_1_index++)
      {
        nome_equipa_1[nome_equipa_1_index] = new_sym_var(sizeof(char) * 8);
      }

        nome_equipa_1[10 - 1] = '\0';
        cmd_P(hte, nl, nome_equipa_1);
        break;

      case 'r':
        for (int nome_jogo_index = 0; nome_jogo_index < 10; nome_jogo_index++)
      {
        nome_jogo[nome_jogo_index] = new_sym_var(sizeof(char) * 8);
      }

        nome_jogo[10 - 1] = '\0';
        cmd_r(htj, jogos, nl, nome_jogo);
        break;

      case 's':
        for (int nome_jogo_index = 0; nome_jogo_index < 10; nome_jogo_index++)
      {
        nome_jogo[nome_jogo_index] = new_sym_var(sizeof(char) * 8);
      }

        nome_jogo[10 - 1] = '\0';
        score_equipa_1 = new_sym_var(sizeof(int) * 8);
        score_equipa_2 = new_sym_var(sizeof(int) * 8);
        cmd_s(htj, nl, nome_jogo, score_equipa_1, score_equipa_2);
        break;

      case 'g':
        cmd_g(equipas, nl);
        break;

    }

    getchar();
  }

  free_estruturas(htj, hte, jogos, equipas);
  return 0;
}

