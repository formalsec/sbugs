/*File generated by PreProcessor.py*/


#include <stdlib.h>
#include <string.h>
#include "tabela_equipas.h"


size_t hash_e(const char *s, size_t max)
{
  size_t h = 0;
  size_t a = 31415;
  size_t b = 27183;
  for (; (*s) != '\0'; s++, a = (a * b) % (max - 1))
    h = ((a * h) + (*s)) % max;

  return h;
}

equipas *inic_equipas(size_t max)
{
  equipas *t = malloc(sizeof(equipas));
  t->capacidade = max;
  t->sz = 0;
  t->tb = calloc(t->capacidade, sizeof(equipa));
  return t;
}

equipa *make_equipa(size_t vit, const char *nome)
{
  equipa *new_e = malloc(sizeof(equipa));
  new_e->flag = malloc((strlen(nome) + 1) * (sizeof(char)));
  strcpy(new_e->flag, nome);
  new_e->vitorias = vit;
  return new_e;
}

int procura_e(const char *nome, equipas *tb_e)
{
  size_t h = hash_e(nome, tb_e->capacidade);
  while (tb_e->tb[h])
  {
    if (strcmp(tb_e->tb[h]->flag, nome) == 0)
    {
      return h;
    }
    else
    {
      h = (h + 1) % tb_e->capacidade;
    }

  }

  return -1;
}

void free_equipa(equipa *e)
{
  free(e->flag);
  free(e);
}

equipas *expand_e(equipas *tb_e)
{
  size_t i;
  equipas *old = tb_e;
  tb_e->capacidade *= 2;
  tb_e = inic_equipas(tb_e->capacidade);
  for (i = 0; i < (tb_e->capacidade / 2); i++)
    if (old->tb[i])
  {
    tb_e = insere_e(old->tb[i]->vitorias, old->tb[i]->flag, tb_e);
    free_equipa(old->tb[i]);
  }
  else
  {
    
  }


  free(old->tb);
  free(old);
  return tb_e;
}

equipas *insere_e(size_t vit, const char *flag, equipas *tb_e)
{
  size_t h = hash_e(flag, tb_e->capacidade);
  while (tb_e->tb[h])
    h = (h + 1) % tb_e->capacidade;

  tb_e->tb[h] = make_equipa(vit, flag);
  if ((tb_e->sz++) > (tb_e->capacidade / 2))
  {
    tb_e = expand_e(tb_e);
  }
  else
  {
    
  }

  return tb_e;
}

size_t max_vitorias(equipas *tb_e)
{
  size_t i;
  size_t max = 0;
  for (i = 0; i < tb_e->capacidade; i++)
    if (tb_e->tb[i])
  {
    if (tb_e->tb[i]->vitorias > max)
    {
      max = tb_e->tb[i]->vitorias;
    }
    else
    {
      
    }

  }
  else
  {
    
  }


  return max;
}

char *make_str(char *flag)
{
  char *s = malloc((strlen(flag) + 1) * (sizeof(char)));
  strcpy(s, flag);
  return s;
}

size_t n_strings(size_t max, equipas *tb_e)
{
  size_t i;
  size_t n = 0;
  for (i = 0; i < tb_e->capacidade; i++)
  {
    if (tb_e->tb[i])
    {
      if (tb_e->tb[i]->vitorias == max)
      {
        n++;
      }
      else
      {
        
      }

    }
    else
    {
      
    }

  }

  return n;
}

int cmp_strings(const void *a, const void *b)
{
  const char **ia = (const char **) a;
  const char **ib = (const char **) b;
  return strcmp(*ia, *ib);
}

char **encontra_melhores(size_t n_strings, size_t max, equipas *tb_e)
{
  size_t i;
  size_t j = 0;
  char **melhores = calloc(n_strings, sizeof(char *));
  for (i = 0; i < tb_e->capacidade; i++)
  {
    if (tb_e->tb[i])
    {
      if (tb_e->tb[i]->vitorias == max)
      {
        melhores[j++] = make_str(tb_e->tb[i]->flag);
      }
      else
      {
        
      }

      if (j == n_strings)
      {
        break;
      }
      else
      {
        
      }

    }
    else
    {
      
    }

  }

  qsort(melhores, n_strings, sizeof(char *), cmp_strings);
  return melhores;
}

void free_equipas(equipas *tb_e)
{
  size_t i;
  for (i = 0; i < tb_e->capacidade; i++)
    if (tb_e->tb[i])
  {
    free_equipa(tb_e->tb[i]);
  }
  else
  {
    
  }


  free(tb_e->tb);
  free(tb_e);
}

