/*File generated by PreProcessor.py*/


#include "structs.h"
#include <string.h>
#include <stdio.h>


Hash_table *init_table(int size_table)
{
  Hash_table *new_t = (Hash_table *) malloc(sizeof(Hash_table));
  new_t->table = (Hash_node **) calloc(size_table, sizeof(Hash_node *));
  new_t->capacity = size_table;
  return new_t;
}

void insertJogo_T(Hash_table *t, Node *jogoIns)
{
  int i = hash(jogoIns->nome, t->capacity);
  if (t->table[i] == 0)
  {
    Hash_node *head = 0;
    head = insertJogo_N(head, jogoIns);
    t->table[i] = head;
  }
  else
  {
    Hash_node *head = t->table[i];
    insertJogo_N(head, jogoIns);
  }

}

Hash_node *insertJogo_N(Hash_node *head, Node *jogoIns)
{
  Hash_node *new = (Hash_node *) malloc(sizeof(Hash_node));
  new->jogo = jogoIns;
  new->next = 0;
  if (head == 0)
  {
    head = new;
    return head;
  }
  else
  {
    Hash_node *actual = head;
    while (actual->next != 0)
    {
      actual = actual->next;
    }

    actual->next = new;
  }

  return new;
}

Node *removeTable(Hash_table *t, Hash_tableEq *equipasT, char *aux, int nl)
{
  Hash_node *node;
  Hash_node *prev;
  Node *nodeList;
  Hash_nodeEq *nodeVit;
  int h;
  int h1;
  int h2;
  h = hash(aux, t->capacity);
  node = t->table[h];
  if ((node != 0) && (!strcmp(node->jogo->nome, aux)))
  {
    h1 = hash(node->jogo->equipa1, equipasT->capacity);
    h2 = hash(node->jogo->equipa2, equipasT->capacity);
    if (node->jogo->score1 > node->jogo->score2)
    {
      nodeVit = equipasT->table[h1];
      while (strcmp(nodeVit->equipa->nome, node->jogo->equipa1))
      {
        nodeVit = nodeVit->next;
      }

      nodeVit->equipa->vitorias--;
    }
    else
    {
      if (node->jogo->score1 < node->jogo->score2)
      {
        nodeVit = equipasT->table[h2];
        while (strcmp(nodeVit->equipa->nome, node->jogo->equipa2))
        {
          nodeVit = nodeVit->next;
        }

        nodeVit->equipa->vitorias--;
      }
      else
      {
        
      }

    }

    nodeList = node->jogo;
    t->table[h] = node->next;
    free(node);
    return nodeList;
  }
  else
  {
    
  }

  while ((node != 0) && strcmp(node->jogo->nome, aux))
  {
    prev = node;
    node = node->next;
  }

  if (node == 0)
  {
    printf("%d Jogo inexistente.\n", nl);
    nodeList = 0;
    return nodeList;
  }
  else
  {
    
  }

  nodeList = node->jogo;
  prev->next = node->next;
  h1 = hash(node->jogo->equipa1, equipasT->capacity);
  h2 = hash(node->jogo->equipa2, equipasT->capacity);
  if (node->jogo->score1 > node->jogo->score2)
  {
    nodeVit = equipasT->table[h1];
    while (strcmp(nodeVit->equipa->nome, node->jogo->equipa1))
    {
      nodeVit = nodeVit->next;
    }

    nodeVit->equipa->vitorias--;
  }
  else
  {
    if (node->jogo->score1 < node->jogo->score2)
    {
      nodeVit = equipasT->table[h2];
      while (strcmp(nodeVit->equipa->nome, node->jogo->equipa2))
      {
        nodeVit = nodeVit->next;
      }

      nodeVit->equipa->vitorias--;
    }
    else
    {
      
    }

  }

  free(node);
  return nodeList;
}

void destroyTable(Hash_table *t)
{
  int i;
  Hash_node *node;
  for (i = 0; i < t->capacity; i++)
  {
    while (t->table[i])
    {
      node = t->table[i]->next;
      free(t->table[i]);
      t->table[i] = node;
    }

  }

  free(t->table);
  free(t);
}

void printTable(Hash_table *t)
{
  int i;
  int vazios = 0;
  int colisoes = 0;
  for (i = 0; i < t->capacity; i++)
  {
    Hash_node *head = t->table[i];
    printf("%d: ", i);
    if (head == 0)
    {
      vazios++;
      printf("NULL");
    }
    else
    {
      Hash_node *current = head;
      colisoes--;
      while (current != 0)
      {
        colisoes++;
        printf("%s ", current->jogo->nome);
        current = current->next;
      }

    }

    printf("\n");
  }

  printf("Numero de vazios: %d\n", vazios);
  printf("Numero de colisoes: %d\n", colisoes);
}

