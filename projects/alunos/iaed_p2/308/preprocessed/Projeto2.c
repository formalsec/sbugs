/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdbool.h>


typedef struct Equipa
{
  char *nome;
  int vitorias;
  struct Equipa *next;
} Equipa;
typedef struct 
{
  Equipa **indice;
} hash_Equipa;
static hash_Equipa *hashtable_equipa;
unsigned int hash(const char *nome)
{
  unsigned long int length = strlen(nome);
  unsigned int valor = 0;
  unsigned int i;
  for (i = 0; i < length; i++)
  {
    valor = (valor * 55) + nome[i];
  }

  valor = valor % 1009;
  return valor;
}

void inicia_hashtable_equipa()
{
  hashtable_equipa = malloc(sizeof(hash_Equipa));
  hashtable_equipa->indice = malloc((sizeof(Equipa)) * 1009);
  int i = 0;
  for (; i < 1009; i++)
  {
    hashtable_equipa->indice[i] = 0;
  }

}

void adiciona_tabela_hash_equipa()
{
  char buffer[1023];
  char *nome;
  for (int buffer_index = 0; buffer_index < 10; buffer_index++)
  {
    buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer[10 - 1] = '\0';
  nome = malloc(((sizeof(char)) * strlen(buffer)) + 1);
  strcpy(nome, buffer);
  unsigned int index = hash(nome);
  Equipa *entrada = hashtable_equipa->indice[index];
  Equipa *equipa;
  equipa = malloc(sizeof(Equipa));
  equipa->nome = nome;
  equipa->vitorias = 0;
  equipa->next = 0;
  if (entrada == 0)
  {
    hashtable_equipa->indice[index] = equipa;
    return;
  }
  else
  {
    
  }

  Equipa *Anterior;
  Anterior = malloc(sizeof(Equipa));
  while (entrada != 0)
  {
    if (strcmp(entrada->nome, nome) == 0)
    {
      printf("_Equipa existente.\n");
      free(equipa);
      free(Anterior);
      return;
    }
    else
    {
      
    }

    Anterior = entrada;
    entrada = Anterior->next;
  }

  Anterior->next = equipa;
}

void procura_equipa()
{
  char buffer[1023];
  char *nome;
  for (int buffer_index = 0; buffer_index < 10; buffer_index++)
  {
    buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer[10 - 1] = '\0';
  nome = malloc(((sizeof(char)) * strlen(buffer)) + 1);
  strcpy(nome, buffer);
  unsigned int index = hash(nome);
  Equipa *entrada = hashtable_equipa->indice[index];
  if (entrada == 0)
  {
    printf("_ Equipa inexistente.\n");
    return;
  }
  else
  {
    
  }

  while (entrada != 0)
  {
    if (strcmp(entrada->nome, nome) == 0)
    {
      printf("_ %s %d.\n", entrada->nome, entrada->vitorias);
      return;
    }
    else
    {
      
    }

    entrada = entrada->next;
  }

  printf("_ Equipa inexistente.\n");
}

typedef struct Jogo
{
  char *nome;
  char *equipa1;
  char *equipa2;
  int score1;
  int socre2;
  struct Jogo *next;
} Jogo;
typedef struct 
{
  Jogo **indice;
} hash_Jogo;
hash_Jogo *hashtable_jogo;
void inicia_hashtable_jogo()
{
  hashtable_jogo = malloc(sizeof(hash_Jogo));
  hashtable_jogo->indice = malloc((sizeof(Jogo)) * 1009);
  int i = 0;
  for (; i < 1009; i++)
  {
    hashtable_jogo->indice[i] = 0;
  }

}

bool verifica_equipa(char *nome)
{
  unsigned int index = hash(nome);
  while (hashtable_equipa->indice[index] != 0)
  {
    if (strcmp(hashtable_equipa->indice[index]->nome, nome) == 0)
    {
      return true;
    }
    else
    {
      
    }

    hashtable_equipa->indice[index] = hashtable_equipa->indice[index]->next;
  }

  return false;
}

void adiciona_hash_tabela_jogo()
{
  char buffer_nome[1023];
  char buffer_equipa1[1023];
  char buffer_equipa2[1023];
  char *nome;
  char *equipa1;
  char *equipa2;
  int score1;
  int score2;
  for (int buffer_nome_index = 0; buffer_nome_index < 10; buffer_nome_index++)
  {
    buffer_nome[buffer_nome_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer_nome[10 - 1] = '\0';
  for (int buffer_equipa1_index = 0; buffer_equipa1_index < 10; buffer_equipa1_index++)
  {
    buffer_equipa1[buffer_equipa1_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer_equipa1[10 - 1] = '\0';
  for (int buffer_equipa2_index = 0; buffer_equipa2_index < 10; buffer_equipa2_index++)
  {
    buffer_equipa2[buffer_equipa2_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer_equipa2[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  nome = malloc(((sizeof(char)) * strlen(buffer_nome)) + 1);
  equipa1 = malloc(((sizeof(char)) * strlen(buffer_equipa1)) + 1);
  equipa2 = malloc(((sizeof(char)) * strlen(buffer_equipa2)) + 1);
  strcpy(nome, buffer_nome);
  strcpy(equipa1, buffer_equipa1);
  strcpy(equipa2, buffer_equipa2);
  int index = hash(nome);
  Jogo *entrada = hashtable_jogo->indice[index];
  int index_equipa1 = hash(equipa1);
  int index_equipa2 = hash(equipa2);
  if ((verifica_equipa(equipa1) == 0) || (verifica_equipa(equipa2) == 0))
  {
    printf("_ Equipa inexistente.\n");
    return;
  }
  else
  {
    
  }

  Jogo *jogo;
  jogo = malloc(sizeof(Jogo));
  jogo->nome = nome;
  jogo->equipa1 = equipa1;
  jogo->equipa2 = equipa2;
  jogo->score1 = score1;
  jogo->socre2 = score2;
  jogo->next = 0;
  if (entrada == 0)
  {
    hashtable_jogo->indice[index] = jogo;
    if (score1 > score2)
    {
      hashtable_equipa->indice[index_equipa1]->vitorias += 1;
      return;
    }
    else
    {
      if (score2 > score1)
      {
        hashtable_equipa->indice[index_equipa2]->vitorias += 1;
        return;
      }
      else
      {
        
      }

    }

  }
  else
  {
    
  }

  Jogo *Anterior;
  Anterior = malloc(sizeof(Jogo));
  while (entrada != 0)
  {
    if (strcmp(entrada->nome, nome) == 0)
    {
      printf("_ Jogo existente.\n");
      free(jogo);
      free(Anterior);
      return;
    }
    else
    {
      
    }

    Anterior = entrada;
    entrada = Anterior->next;
  }

  Anterior->next = jogo;
  if (score1 > score2)
  {
    hashtable_equipa->indice[index_equipa1]->vitorias += 1;
  }
  else
  {
    if (score2 > score1)
    {
      hashtable_equipa->indice[index_equipa2]->vitorias += 1;
    }
    else
    {
      
    }

  }

}

void procura_jogo()
{
  char buffer[1023];
  char *nome;
  for (int buffer_index = 0; buffer_index < 10; buffer_index++)
  {
    buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer[10 - 1] = '\0';
  nome = malloc(((sizeof(char)) * strlen(buffer)) + 1);
  strcpy(nome, buffer);
  unsigned int index = hash(nome);
  Jogo *entrada = hashtable_jogo->indice[index];
  if (entrada == 0)
  {
    printf("_ Jogo inexistente.\n");
    return;
  }
  else
  {
    
  }

  while (entrada != 0)
  {
    if (strcmp(entrada->nome, nome) == 0)
    {
      printf("_ %s %s %s %d %d.\n", entrada->nome, entrada->equipa1, entrada->equipa2, entrada->score1, entrada->socre2);
      return;
    }
    else
    {
      
    }

    entrada = entrada->next;
  }

  printf("_Jogo inexistente.\n");
}

void apaga_jogo()
{
  char buffer[1023];
  char *nome;
  for (int buffer_index = 0; buffer_index < 10; buffer_index++)
  {
    buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer[10 - 1] = '\0';
  nome = malloc(((sizeof(char)) * strlen(buffer)) + 1);
  strcpy(nome, buffer);
  unsigned int index = hash(nome);
  Jogo *entrada = hashtable_jogo->indice[index];
  if (entrada == 0)
  {
    printf("_ Jogo inexistente.\n");
    return;
  }
  else
  {
    
  }

  unsigned int index_equipa1 = hash(entrada->equipa1);
  unsigned int index_equipa2 = hash(entrada->equipa2);
  while (entrada != 0)
  {
    if (strcmp(entrada->nome, nome) == 0)
    {
      if (entrada->score1 > entrada->socre2)
      {
        hashtable_equipa->indice[index_equipa1]->vitorias -= 1;
      }
      else
      {
        if (entrada->socre2 > entrada->score1)
        {
          hashtable_equipa->indice[index_equipa2]->vitorias -= 1;
        }
        else
        {
          
        }

      }

      hashtable_jogo->indice[index] = 0;
      return;
    }
    else
    {
      
    }

    entrada = entrada->next;
  }

  printf("_ Jogo inexistente.\n");
}

void altera_score()
{
  char buffer[1023];
  char *nome;
  int score1;
  int score2;
  for (int buffer_index = 0; buffer_index < 10; buffer_index++)
  {
    buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  nome = malloc(((sizeof(char)) * strlen(buffer)) + 1);
  strcpy(nome, buffer);
  printf("%s %d %d", nome, score1, score2);
  unsigned int index = hash(nome);
  Jogo *entrada = hashtable_jogo->indice[index];
  if (entrada == 0)
  {
    printf("_ Jogo inexistente.\n");
    return;
  }
  else
  {
    
  }

  unsigned int index_equipa1 = hash(hashtable_jogo->indice[index]->equipa1);
  unsigned int index_equipa2 = hash(hashtable_jogo->indice[index]->equipa2);
  while (entrada != 0)
  {
    if (strcmp(entrada->nome, nome) == 0)
    {
      if (hashtable_jogo->indice[index]->score1 > hashtable_jogo->indice[index]->socre2)
      {
        hashtable_equipa->indice[index_equipa1] -= 1;
      }
      else
      {
        if (hashtable_jogo->indice[index]->socre2 > hashtable_jogo->indice[index]->score1)
        {
          hashtable_equipa->indice[index_equipa2] -= 1;
        }
        else
        {
          
        }

      }

      if (score1 > score2)
      {
        hashtable_equipa->indice[index_equipa1] += 1;
      }
      else
      {
        if (score2 > score1)
        {
          hashtable_equipa->indice[index_equipa2] += 1;
        }
        else
        {
          
        }

      }

      hashtable_jogo->indice[index]->score1 = score1;
      hashtable_jogo->indice[index]->socre2 = score2;
      return;
    }
    else
    {
      
    }

    entrada = entrada->next;
  }

  printf("_ Jogo inexistente.\n");
}

int main()
{
  char comando;
  inicia_hashtable_equipa();
  inicia_hashtable_jogo();
  while ((comando = getchar()) != 'x')
  {
    switch (comando)
    {
      case 'A':
        adiciona_tabela_hash_equipa();
        break;

      case 'a':
        adiciona_hash_tabela_jogo();
        break;

      case 'P':
        procura_equipa();
        break;

      case 'p':
        procura_jogo();
        break;

      case 'r':
        apaga_jogo();
        break;

      case 's':
        altera_score();
        break;

      case 'l':
        break;

      default:
        break;

    }

  }

  return 0;
}

