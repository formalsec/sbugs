#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "equipas.h"
#include "jogos.h"
#include "comuns.h"


void a(int Nl, hash_table_jogos table_jogo, lista_jogos *jogos, hash_table_team table_equipas)
{
  char nome[1024];
  char equipa1[1024];
  char equipa2[1024];
  char *nome1;
  char *equipa11;
  char *equipa22;
  int score[2];
  int h;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  for (int equipa1_index = 0; equipa1_index < 10; equipa1_index++)
  {
    equipa1[equipa1_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa1[10 - 1] = '\0';
  for (int equipa2_index = 0; equipa2_index < 10; equipa2_index++)
  {
    equipa2[equipa2_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa2[10 - 1] = '\0';
  score[0] = new_sym_var(sizeof(int) * 8);
  score[1] = new_sym_var(sizeof(int) * 8);
  nome1 = reduce_string(nome);
  equipa11 = reduce_string(equipa1);
  equipa22 = reduce_string(equipa2);
  if (hash_search_jogos(table_jogo, nome1))
  {
    printf("%d Jogo existente.\n", Nl);
  }
  else
  {
    if (!(hash_search_equipas(table_equipas, equipa11) && hash_search_equipas(table_equipas, equipa22)))
    {
      printf("%d Equipa inexistente.\n", Nl);
    }
    else
    {
      int r1;
      jogo new_jogo = cria_jogo(nome1, equipa11, equipa22, score);
      hash_insert_jogos(table_jogo, nome1);
      h = hash(nome1, table_jogo->cap);
      insert_end_list_jogos(jogos, new_jogo);
      table_jogo->table[h]->no_j = jogos->last;
      r1 = score[0] - score[1];
      if (r1 > 0)
      {
        no team = hash_search_equipas(table_equipas, equipa11);
        team->no_e->vitorias += 1;
      }
      else
      {
        if (r1 < 0)
        {
          no team = hash_search_equipas(table_equipas, equipa22);
          team->no_e->vitorias += 1;
        }
        else
        {
          
        }

      }

    }

  }

  free(nome1);
  free(equipa11);
  free(equipa22);
}

void A(int Nl, hash_table_team table_equipas, lista *equipas)
{
  char nome[1024];
  char *equipa;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  equipa = reduce_string(nome);
  if (!hash_search_equipas(table_equipas, equipa))
  {
    equipas->head = insert_equipa(equipas->head, equipa);
    hash_insert_equipas(table_equipas, equipa, equipas);
  }
  else
  {
    printf("%d Equipa existente.\n", Nl);
  }

  free(equipa);
}

void l(int Nl, lista_jogos *jogos)
{
  no_jogo aux;
  for (aux = jogos->head; aux != 0; aux = aux->next)
    printf("%d %s %s %s %d %d\n", Nl, aux->game.nome, aux->game.equipa1, aux->game.equipa2, aux->game.score0, aux->game.score1);

}

void p(int Nl, hash_table_jogos table_jogos)
{
  char nome[1024];
  char *nome1;
  node_jogo aux;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  nome1 = reduce_string(nome);
  aux = hash_search_jogos(table_jogos, nome1);
  free(nome1);
  if (aux == 0)
  {
    printf("%d Jogo inexistente.\n", Nl);
  }
  else
  {
    printf("%d %s %s %s %d %d\n", Nl, aux->no_j->game.nome, aux->no_j->game.equipa1, aux->no_j->game.equipa2, aux->no_j->game.score0, aux->no_j->game.score1);
  }

}

void P(int Nl, hash_table_team table_equipas)
{
  char nome[1024];
  char *equipa;
  no aux;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  equipa = reduce_string(nome);
  aux = hash_search_equipas(table_equipas, equipa);
  free(equipa);
  if (aux == 0)
  {
    printf("%d Equipa inexistente.\n", Nl);
  }
  else
  {
    printf("%d %s %d\n", Nl, aux->no_e->nome_equipa, aux->no_e->vitorias);
  }

}

void r(int Nl, hash_table_jogos table_jogos, lista_jogos *jogos, hash_table_team table_equipas)
{
  char nome[1024];
  char *nome1;
  node_jogo aux;
  no_jogo aux1;
  int r;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  nome1 = reduce_string(nome);
  aux = hash_search_jogos(table_jogos, nome1);
  if (aux == 0)
  {
    printf("%d Jogo inexistente.\n", Nl);
  }
  else
  {
    r = aux->no_j->game.score0 - aux->no_j->game.score1;
    if (r > 0)
    {
      no team = hash_search_equipas(table_equipas, aux->no_j->game.equipa1);
      team->no_e->vitorias -= 1;
    }
    else
    {
      if (r < 0)
      {
        no team = hash_search_equipas(table_equipas, aux->no_j->game.equipa2);
        team->no_e->vitorias -= 1;
      }
      else
      {
        
      }

    }

    if (strcmp(jogos->last->game.nome, aux->no_j->game.nome) == 0)
    {
      jogos->last = jogos->last->prev;
    }
    else
    {
      
    }

    remove_jogos(table_jogos, aux);
    if (jogos->head->game.nome == 0)
    {
      if (jogos->head->next != 0)
      {
        aux1 = jogos->head->next;
        free(jogos->head);
        jogos->head = aux1;
        aux1->prev = 0;
      }
      else
      {
        free(jogos->head);
        jogos->head = 0;
      }

    }
    else
    {
      
    }

  }

  free(nome1);
}

void s(int Nl, hash_table_jogos table_jogos, hash_table_team hash_equipa)
{
  char nome[1024];
  char *nome1;
  int score[2];
  node_jogo aux;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  score[0] = new_sym_var(sizeof(int) * 8);
  score[1] = new_sym_var(sizeof(int) * 8);
  nome1 = reduce_string(nome);
  aux = hash_search_jogos(table_jogos, nome1);
  if (aux == 0)
  {
    printf("%d Jogo inexistente.\n", Nl);
  }
  else
  {
    int r1;
    int r2;
    r1 = aux->no_j->game.score0 - aux->no_j->game.score1;
    r2 = score[0] - score[1];
    if ((r1 > 0) && (r2 < 0))
    {
      no team;
      no team1;
      team = hash_search_equipas(hash_equipa, aux->no_j->game.equipa1);
      team->no_e->vitorias -= 1;
      team1 = hash_search_equipas(hash_equipa, aux->no_j->game.equipa2);
      team1->no_e->vitorias += 1;
    }
    else
    {
      if ((r1 < 0) && (r2 > 0))
      {
        no team;
        no team1;
        team = hash_search_equipas(hash_equipa, aux->no_j->game.equipa1);
        team->no_e->vitorias += 1;
        team1 = hash_search_equipas(hash_equipa, aux->no_j->game.equipa2);
        team1->no_e->vitorias -= 1;
      }
      else
      {
        if ((r1 == 0) && (r2 > 0))
        {
          no team;
          team = hash_search_equipas(hash_equipa, aux->no_j->game.equipa1);
          team->no_e->vitorias += 1;
        }
        else
        {
          if ((r1 == 0) && (r2 < 0))
          {
            no team;
            team = hash_search_equipas(hash_equipa, aux->no_j->game.equipa2);
            team->no_e->vitorias += 1;
          }
          else
          {
            if ((r1 > 0) && (r2 == 0))
            {
              no team;
              team = hash_search_equipas(hash_equipa, aux->no_j->game.equipa1);
              team->no_e->vitorias -= 1;
            }
            else
            {
              if ((r1 < 0) && (r2 == 0))
              {
                no team;
                team = hash_search_equipas(hash_equipa, aux->no_j->game.equipa2);
                team->no_e->vitorias -= 1;
              }
              else
              {
                
              }

            }

          }

        }

      }

    }

    aux->no_j->game.score0 = score[0];
    aux->no_j->game.score1 = score[1];
  }

  free(nome1);
}

void g(int Nl, lista *equipas)
{
  if (equipas->head != 0)
  {
    node_equipa lista;
    node_equipa aux;
    node_equipa aux1;
    int maior = 0;
    lista = 0;
    for (aux = equipas->head; aux != 0; aux = aux->next)
    {
      if (aux->vitorias > maior)
      {
        maior = aux->vitorias;
        libertar_lista_teams(lista);
        lista = 0;
        lista = insert_equipa(lista, aux->nome_equipa);
      }
      else
      {
        if (aux->vitorias == maior)
        {
          char *equipa = aux->nome_equipa;
          lista = adicionar_ordem_alfabetica(lista, equipa);
        }
        else
        {
          
        }

      }

    }

    printf("%d Melhores %d\n", Nl, maior);
    for (aux1 = lista; aux1 != 0; aux1 = aux1->next)
      printf("%d * %s\n", Nl, aux1->nome_equipa);

    libertar_lista_teams(lista);
  }
  else
  {
    
  }

}

int main()
{
  lista *equipas;
  lista_jogos *jogos;
  hash_table_team table_equipas;
  hash_table_jogos table_jogos;
  char comando;
  int NL = 1;
  table_equipas = malloc(sizeof(struct stru_hash_equipa));
  init_hash_table_equipas(table_equipas, 20071);
  table_jogos = init_hash_table_jogos(15731);
  equipas = malloc(sizeof(lista));
  jogos = malloc(sizeof(lista_jogos));
  equipas->head = 0;
  jogos->head = 0;
  comando = getchar();
  while (comando != 'x')
  {
    switch (comando)
    {
      case 'a':
        a(NL, table_jogos, jogos, table_equipas);
        NL++;
        break;

      case 'A':
        A(NL, table_equipas, equipas);
        NL++;
        break;

      case 'l':
        l(NL, jogos);
        NL++;
        break;

      case 'p':
        p(NL, table_jogos);
        NL++;
        break;

      case 'P':
        P(NL, table_equipas);
        NL++;
        break;

      case 'r':
        r(NL, table_jogos, jogos, table_equipas);
        NL++;
        break;

      case 's':
        s(NL, table_jogos, table_equipas);
        NL++;
        break;

      case 'g':
        g(NL, equipas);
        NL++;
        break;

    }

    comando = getchar();
  }

  libertar_hash_equipas(table_equipas);
  free(equipas);
  libertar_hash_jogos(table_jogos);
  free(jogos->head);
  free(jogos);
  return 0;
}

