#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include "jogos.h"


void free_hashs(EHnode *Ehash, JHnode *Jhash)
{
  int i;
  EHnode EHnode_aux;
  EHnode EHtmp;
  JHnode JHnode_aux;
  JHnode JHtmp;
  for (i = 0; i < 137; i++)
  {
    for (EHnode_aux = Ehash[i]; EHnode_aux != 0;)
    {
      EHtmp = EHnode_aux->next;
      free_equipa(EHnode_aux->equipa);
      free(EHnode_aux);
      EHnode_aux = EHtmp;
    }

    for (JHnode_aux = Jhash[i]; JHnode_aux != 0;)
    {
      JHtmp = JHnode_aux->next;
      free_jogo(JHnode_aux->jogo);
      free(JHnode_aux);
      JHnode_aux = JHtmp;
    }

  }

  free(Ehash);
  free(Jhash);
}

void inicializa_total(EHnode *Ehash, Equipas_sistema *equipas_sis, JHnode *Jhash, Jogos_sistema *jogos_sis)
{
  inicializa_equipas_sistema(equipas_sis);
  inicializa_equipas_hash(Ehash);
  inicializa_jogos_sistema(jogos_sis);
  inicializa_jogos_hash(Jhash);
}

void free_total(EHnode *Ehash, Equipas_sistema *equipas_sis, JHnode *Jhash, Jogos_sistema *jogos_sis)
{
  free_jogos_sis(jogos_sis);
  free_equipas_sis(equipas_sis);
  free_hashs(Ehash, Jhash);
}

void swap(Equipa **equipas, int i, int j)
{
  Equipa *equipa = equipas[i];
  equipas[i] = equipas[j];
  equipas[j] = equipa;
}

int partition(Equipa **equipas, int l, int r)
{
  int i = l - 1;
  int j = r;
  Equipa *equipa = equipas[r];
  while (i < j)
  {
    while (strcmp(equipas[++i]->nome, equipa->nome) < 0)
      ;

    while (strcmp(equipa->nome, equipas[--j]->nome) < 0)
      if (j == l)
    {
      break;
    }
    else
    {
      
    }


    if (i < j)
    {
      swap(equipas, i, j);
    }
    else
    {
      
    }

  }

  swap(equipas, i, r);
  return i;
}

void quicksort(Equipa **equipas, int l, int r)
{
  int i;
  if (r <= l)
  {
    return;
  }
  else
  {
    
  }

  i = partition(equipas, l, r);
  quicksort(equipas, l, i - 1);
  quicksort(equipas, i + 1, r);
}

void f_a(int NL, Jogos_sistema *jogos_sis, JHnode *Jhash, EHnode *Ehash)
{
  Jogo *jogo;
  Equipa *equipa1;
  Equipa *equipa2;
  char nome[1024];
  char equipa1_nome[1024];
  char equipa2_nome[1024];
  int score1;
  int score2;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  for (int equipa1_nome_index = 0; equipa1_nome_index < 10; equipa1_nome_index++)
  {
    equipa1_nome[equipa1_nome_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa1_nome[10 - 1] = '\0';
  for (int equipa2_nome_index = 0; equipa2_nome_index < 10; equipa2_nome_index++)
  {
    equipa2_nome[equipa2_nome_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa2_nome[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  jogo = JHsearch(Jhash, nome);
  if (jogo != 0)
  {
    printf("%d Jogo existente.\n", NL);
    return;
  }
  else
  {
    
  }

  equipa1 = EHsearch(Ehash, equipa1_nome);
  equipa2 = EHsearch(Ehash, equipa2_nome);
  if (!((equipa1 != 0) && (equipa2 != 0)))
  {
    printf("%d Equipa inexistente.\n", NL);
    return;
  }
  else
  {
    
  }

  jogo = malloc(sizeof(Jogo));
  jogo->nome = malloc((sizeof(char)) * (strlen(nome) + 1));
  strcpy(jogo->nome, nome);
  jogo->e1 = equipa1;
  jogo->e2 = equipa2;
  jogo->s1 = score1;
  jogo->s2 = score2;
  if (score1 > score2)
  {
    jogo->e1->jogos_ganhos++;
  }
  else
  {
    if (score1 < score2)
    {
      jogo->e2->jogos_ganhos++;
    }
    else
    {
      
    }

  }

  JSinsert(jogos_sis, jogo);
  JHinsert(Jhash, jogo);
}

void f_l(int NL, Jogos_sistema *jogos_sis)
{
  JHnode node;
  for (node = jogos_sis->head; node != 0; node = node->next)
    printf("%d %s %s %s %d %d\n", NL, node->jogo->nome, node->jogo->e1->nome, node->jogo->e2->nome, node->jogo->s1, node->jogo->s2);

}

void f_p(int NL, JHnode *Jhash)
{
  char nome[1024];
  Jogo *jogo;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  jogo = JHsearch(Jhash, nome);
  if (jogo != 0)
  {
    printf("%d %s %s %s %d %d\n", NL, jogo->nome, jogo->e1->nome, jogo->e2->nome, jogo->s1, jogo->s2);
    return;
  }
  else
  {
    
  }

  printf("%d Jogo inexistente.\n", NL);
}

void f_r(int NL, JHnode *Jhash, Jogos_sistema *jogos_sis)
{
  Jogo *jogo;
  char nome[1024];
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  jogo = JHsearch(Jhash, nome);
  if (jogo != 0)
  {
    if (jogo->s1 > jogo->s2)
    {
      jogo->e1->jogos_ganhos--;
    }
    else
    {
      if (jogo->s1 < jogo->s2)
      {
        jogo->e2->jogos_ganhos--;
      }
      else
      {
        
      }

    }

    JSdelete(jogos_sis, nome);
    JHdelete(Jhash, nome);
    return;
  }
  else
  {
    
  }

  printf("%d Jogo inexistente.\n", NL);
}

void f_s(int NL, JHnode *Jhash)
{
  Jogo *jogo;
  char nome[1024];
  int score1;
  int score2;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  jogo = JHsearch(Jhash, nome);
  if (jogo != 0)
  {
    if (jogo->s1 > jogo->s2)
    {
      jogo->e1->jogos_ganhos--;
    }
    else
    {
      if (jogo->s1 < jogo->s2)
      {
        jogo->e2->jogos_ganhos--;
      }
      else
      {
        
      }

    }

    if (score1 > score2)
    {
      jogo->e1->jogos_ganhos++;
    }
    else
    {
      if (score1 < score2)
      {
        jogo->e2->jogos_ganhos++;
      }
      else
      {
        
      }

    }

    jogo->s1 = score1;
    jogo->s2 = score2;
    return;
  }
  else
  {
    
  }

  printf("%d Jogo inexistente.\n", NL);
}

void f_A(int NL, EHnode *Ehash, Equipas_sistema *equipas_sis)
{
  Equipa *equipa;
  char nome[1024];
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  if (EHsearch(Ehash, nome) != 0)
  {
    printf("%d Equipa existente.\n", NL);
    return;
  }
  else
  {
    
  }

  equipa = malloc(sizeof(Equipa));
  equipa->nome = malloc((sizeof(char)) * (strlen(nome) + 1));
  strcpy(equipa->nome, nome);
  equipa->jogos_ganhos = 0;
  EHinsert(Ehash, equipa);
  ESinsert(equipas_sis->equipas, equipa);
  if (equipa->jogos_ganhos == equipas_sis->n_max_vitorias)
  {
    equipas_sis->n_equipas_max++;
  }
  else
  {
    
  }

}

void f_P(int NL, EHnode *Ehash)
{
  Equipa *equipa;
  char nome[1024];
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  equipa = EHsearch(Ehash, nome);
  if (equipa != 0)
  {
    printf("%d %s %d\n", NL, equipa->nome, equipa->jogos_ganhos);
    return;
  }
  else
  {
    
  }

  printf("%d Equipa inexistente.\n", NL);
}

void f_g(int NL, Equipas_sistema *equipas_sis)
{
  int i = 0;
  int m = 50;
  Equipa **equipas_ord;
  EHnode node;
  if (equipas_sis->n_equipas_max == 0)
  {
    return;
  }
  else
  {
    
  }

  equipas_ord = malloc((sizeof(Equipa *)) * 50);
  equipas_sis->n_max_vitorias = 0;
  equipas_sis->n_equipas_max = 0;
  for (node = *equipas_sis->equipas; node != 0; node = node->next)
  {
    if (node->equipa->jogos_ganhos > equipas_sis->n_max_vitorias)
    {
      equipas_sis->n_max_vitorias = node->equipa->jogos_ganhos;
      equipas_sis->n_equipas_max = 0;
      i = 0;
    }
    else
    {
      
    }

    if (node->equipa->jogos_ganhos == equipas_sis->n_max_vitorias)
    {
      equipas_sis->n_equipas_max++;
      if (equipas_sis->n_equipas_max >= m)
      {
        m += 50;
        equipas_ord = realloc(equipas_ord, (sizeof(Equipa *)) * m);
      }
      else
      {
        
      }

      equipas_ord[i++] = node->equipa;
    }
    else
    {
      
    }

  }

  quicksort(equipas_ord, 0, equipas_sis->n_equipas_max - 1);
  printf("%d Melhores %d\n", NL, equipas_sis->n_max_vitorias);
  for (i = 0; i < equipas_sis->n_equipas_max; i++)
  {
    printf("%d * %s\n", NL, equipas_ord[i]->nome);
  }

  free(equipas_ord);
}

int main()
{
  int NL = 1;
  char comando;
  EHnode *Ehash = malloc(137 * (sizeof(EHnode)));
  JHnode *Jhash = malloc(137 * (sizeof(JHnode)));
  Jogos_sistema *jogos_sis = malloc(sizeof(struct jogos_sistema));
  Equipas_sistema *equipas_sis = malloc(sizeof(struct equipas_sistema));
  inicializa_total(Ehash, equipas_sis, Jhash, jogos_sis);
  while (1)
  {
    comando = getchar();
    getchar();
    switch (comando)
    {
      case 'a':
        f_a(NL, jogos_sis, Jhash, Ehash);
        break;

      case 'l':
        f_l(NL, jogos_sis);
        break;

      case 'p':
        f_p(NL, Jhash);
        break;

      case 'r':
        f_r(NL, Jhash, jogos_sis);
        break;

      case 's':
        f_s(NL, Jhash);
        break;

      case 'A':
        f_A(NL, Ehash, equipas_sis);
        break;

      case 'P':
        f_P(NL, Ehash);
        break;

      case 'g':
        f_g(NL, equipas_sis);
        break;

      case 'x':
        free_total(Ehash, equipas_sis, Jhash, jogos_sis);
        return 0;

    }

    NL++;
  }

}

