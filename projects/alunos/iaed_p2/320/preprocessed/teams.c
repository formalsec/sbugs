#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdlib.h>
#include <string.h>
#include "teams.h"


int hashf(char *string)
{
  int h;
  int a = 31415;
  int b = 27183;
  for (h = 0; (*string) != '\0'; string++, a = (a * b) % (1500 - 1))
    h = ((a * h) + (*string)) % 1500;

  return h;
}

char *string_alloc(char *string)
{
  int len = strlen(string);
  int i;
  char *str_alloc = malloc((sizeof(char)) * (len + 1));
  for (i = 0; i <= len; i++)
    str_alloc[i] = string[i];

  return str_alloc;
}

team *new_team(char *t_name)
{
  team *p_t = malloc(sizeof(team));
  p_t->t_name = string_alloc(t_name);
  p_t->n_wins = 0;
  return p_t;
}

void free_team(team *p_t)
{
  free(p_t->t_name);
  free(p_t);
}

dlist_teams *mk_dlist_teams()
{
  dlist_teams *dl = malloc(sizeof(dlist_teams));
  dl->head = 0;
  dl->last = 0;
  return dl;
}

void free_node_dlist_teams(node_dlist_teams *n_dl)
{
  free_team(n_dl->p_t);
  free(n_dl);
}

void free_dlist_teams(dlist_teams *dl)
{
  node_dlist_teams *n_dl = dl->head;
  node_dlist_teams *next;
  while (n_dl != 0)
  {
    next = n_dl->next;
    free_node_dlist_teams(n_dl);
    n_dl = next;
  }

  free(dl);
}

void rm_node_dlist_teams(dlist_teams *dl, node_dlist_teams *n_dl)
{
  if (n_dl->prev == 0)
  {
    dl->head = n_dl->next;
  }
  else
  {
    n_dl->prev->next = n_dl->next;
  }

  if (n_dl->next == 0)
  {
    dl->last = n_dl->prev;
  }
  else
  {
    n_dl->next->prev = n_dl->prev;
  }

  free_node_dlist_teams(n_dl);
}

node_dlist_teams *addlast_dlist_teams(dlist_teams *dl, team *p_t)
{
  node_dlist_teams *n_dl = malloc(sizeof(node_dlist_teams));
  n_dl->prev = dl->last;
  n_dl->next = 0;
  n_dl->p_t = p_t;
  if (dl->last != 0)
  {
    dl->last->next = n_dl;
  }
  else
  {
    dl->head = n_dl;
  }

  dl->last = n_dl;
  return n_dl;
}

dlist_teams **init_hasht_teams()
{
  int i;
  dlist_teams **hasht_t = malloc((sizeof(dlist_teams *)) * 1500);
  for (i = 0; i < 1500; i++)
    hasht_t[i] = mk_dlist_teams();

  return hasht_t;
}

void insert_hasht_t(dlist_teams **hasht_t, team *p_t)
{
  int h = hashf(p_t->t_name);
  addlast_dlist_teams(hasht_t[h], p_t);
}

node_dlist_teams *search_hasht_t(dlist_teams **hasht_t, char *t_name)
{
  int h = hashf(t_name);
  node_dlist_teams *n_dl = hasht_t[h]->head;
  while (n_dl != 0)
  {
    if (!strcmp(n_dl->p_t->t_name, t_name))
    {
      return n_dl;
    }
    else
    {
      
    }

    n_dl = n_dl->next;
  }

  return 0;
}

void free_teams(dlist_teams **hasht_t)
{
  int i;
  for (i = 0; i < 1500; i++)
    free_dlist_teams(hasht_t[i]);

  free(hasht_t);
}

