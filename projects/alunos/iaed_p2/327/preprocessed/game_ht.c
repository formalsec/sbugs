#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <string.h>
#include <stdbool.h>
#include "game_ht.h"


int hash_game(char *v, int M)
{
  int h;
  int a;
  int b;
  a = 27183;
  b = 31415;
  for (h = 0; (*v) != '\0'; v++, a = (a * b) % (M - 1))
    h = ((a * h) + (*v)) % M;

  return h;
}

void game_ht_init(game_ht *games, int max)
{
  int i;
  games->M = max;
  games->N = 0;
  games->ht = malloc(games->M * (sizeof(game_node *)));
  for (i = 0; i < games->M; i++)
    games->ht[i] = 0;

  return;
}

void game_ht_expand(game_ht *games);
void game_ht_insert(game_ht *games, game_node *node, int can_expand)
{
  char *name = node->gm->name;
  int i = hash_game(name, games->M);
  while (games->ht[i] != 0)
    i = (i + 1) % games->M;

  games->ht[i] = node;
  if (((games->N++) > (games->M / 2)) && can_expand)
  {
    game_ht_expand(games);
  }
  else
  {
    
  }

  return;
}

game_node *game_ht_delete(game_ht *games, char *name)
{
  int j;
  int i = hash_game(name, games->M);
  game_node *aux;
  game_node *v;
  while (games->ht[i] != 0)
    if (strcmp(name, games->ht[i]->gm->name) == 0)
  {
    break;
  }
  else
  {
    i = (i + 1) % games->M;
  }


  if (games->ht[i] == 0)
  {
    return games->ht[i];
  }
  else
  {
    
  }

  aux = games->ht[i];
  games->ht[i] = 0;
  games->N--;
  for (j = (i + 1) % games->M; games->ht[j] != 0; j = (j + 1) % games->M, games->N--)
  {
    v = games->ht[j];
    games->ht[j] = 0;
    game_ht_insert(games, v, true);
  }

  return aux;
}

game_node *game_ht_search(game_ht *games, char *name)
{
  int i = hash_game(name, games->M);
  while (games->ht[i] != 0)
    if (strcmp(name, games->ht[i]->gm->name) == 0)
  {
    return games->ht[i];
  }
  else
  {
    i = (i + 1) % games->M;
  }


  return 0;
}

void game_ht_expand(game_ht *games)
{
  int i;
  game_node **t = games->ht;
  game_ht_init(games, games->M * 2);
  for (i = 0; i < (games->M / 2); i++)
    if (t[i] != 0)
  {
    game_ht_insert(games, t[i], false);
  }
  else
  {
    
  }


  free(t);
}

void game_ht_free(game_ht *games)
{
  free(games->ht);
  free(games);
  return;
}

