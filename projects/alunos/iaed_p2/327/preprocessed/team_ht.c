#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdbool.h>
#include "team_ht.h"


int hash_team(char *v, int M)
{
  int h;
  int a;
  int b;
  a = 27183;
  b = 31415;
  for (h = 0; (*v) != '\0'; v++, a = (a * b) % (M - 1))
    h = ((a * h) + (*v)) % M;

  return h;
}

void team_ht_init(team_ht *teams, int max)
{
  int i;
  teams->M = max;
  teams->N = 0;
  teams->ht = malloc(teams->M * (sizeof(team *)));
  for (i = 0; i < teams->M; i++)
    teams->ht[i] = 0;

  return;
}

void team_ht_expand(team_ht *teams);
void team_ht_insert(team_ht *teams, team *team)
{
  char *name = team->name;
  int i = hash_team(name, teams->M);
  while (teams->ht[i] != 0)
    i = (i + 1) % teams->M;

  teams->ht[i] = team;
  if ((teams->N++) > (teams->M / 2))
  {
    team_ht_expand(teams);
  }
  else
  {
    
  }

  return;
}

team *team_ht_delete(team_ht *teams, char *name)
{
  int j;
  int i = hash_team(name, teams->M);
  team *aux;
  team *v;
  while (teams->ht[i] != 0)
    if (strcmp(name, teams->ht[i]->name) == 0)
  {
    break;
  }
  else
  {
    i = (i + 1) % teams->M;
  }


  if (teams->ht[i] == 0)
  {
    return teams->ht[i];
  }
  else
  {
    
  }

  aux = teams->ht[i];
  teams->ht[i] = 0;
  teams->N--;
  for (j = (i + 1) % teams->M; teams->ht[j] != 0; j = (j + 1) % teams->M, teams->N--)
  {
    v = teams->ht[j];
    teams->ht[j] = 0;
    team_ht_insert(teams, v);
  }

  return aux;
}

team *team_ht_search(team_ht *teams, char *name)
{
  int i = hash_team(name, teams->M);
  while (teams->ht[i] != 0)
    if (strcmp(name, teams->ht[i]->name) == 0)
  {
    return teams->ht[i];
  }
  else
  {
    i = (i + 1) % teams->M;
  }


  return 0;
}

void team_ht_print_most_wins(int line, team_ht *teams)
{
  team *t;
  team **lst = malloc(teams->N * (sizeof(team *)));
  int num = 0;
  int i;
  int max_wins = 0;
  for (i = 0; i < teams->M; i++)
  {
    if (t = teams->ht[i])
    {
      if (t->wins > max_wins)
      {
        max_wins = t->wins;
        num = 0;
      }
      else
      {
        
      }

      if (t->wins == max_wins)
      {
        lst[num] = t;
        num++;
      }
      else
      {
        
      }

    }
    else
    {
      
    }

  }

  qsort(lst, num, sizeof(team *), team_cmp);
  if (num > 0)
  {
    printf("%d Melhores %d\n", line, max_wins);
  }
  else
  {
    
  }

  for (i = 0; i < num; i++)
    printf("%d * %s\n", line, lst[i]->name);

  free(lst);
  return;
}

void team_ht_expand(team_ht *teams)
{
  int i;
  team **t = teams->ht;
  team_ht_init(teams, teams->M * 2);
  for (i = 0; i < (teams->M / 2); i++)
    if (t[i] != 0)
  {
    team_ht_insert(teams, t[i]);
  }
  else
  {
    
  }


  free(t);
}

void team_ht_free(team_ht *teams)
{
  int i;
  for (i = 0; i < teams->M; i++)
    if (teams->ht[i])
  {
    free_team(teams->ht[i]);
  }
  else
  {
    
  }


  free(teams->ht);
  free(teams);
  return;
}

