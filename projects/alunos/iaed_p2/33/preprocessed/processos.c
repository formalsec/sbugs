#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include "processos.h"


void processa(Avl avl, Hashtable ht, Lista lst)
{
  char cmd;
  int NL = 0;
  while ((cmd = getchar()) != 'x')
  {
    if (cmd >= 'A')
    {
      NL++;
    }
    else
    {
      
    }

    switch (cmd)
    {
      case 'a':
        adiciona_jogo(avl, ht, lst, NL);
        break;

      case 'A':
        adiciona_equipa(avl, NL);
        break;

      case 'l':
        lista_jogos(lst, NL);
        break;

      case 'P':
        procura_equipa(avl, NL);
        break;

      case 'p':
        procura_jogo(ht, NL);
        break;

      case 'r':
        remove_jogo(ht, lst, NL);
        break;

      case 's':
        altera_score(ht, NL);
        break;

      case 'g':
        lista_melhores(avl, NL);
        break;

    }

  }

}

void inicializa(Avl *avl, Hashtable *ht, Lista *lst)
{
  avl_init(avl);
  ht_init(ht);
  lst_init(lst);
}

void limpa(Avl avl, Hashtable ht, Lista lst)
{
  avl_free(avl);
  ht_free(ht);
  lst_free(lst);
}

void obtem_nome(char *nome)
{
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
}

void obtem_score(int score[])
{
  score[0] = new_sym_var(sizeof(int) * 8);
  score[1] = new_sym_var(sizeof(int) * 8);
}

void obtem_equipas(char nomes[][1024])
{
  for (int nomes_index = 0; nomes_index < 10; nomes_index++)
  {
    nomes[0][nomes_index] = new_sym_var(sizeof(char) * 8);
  }

  nomes[0][10 - 1] = '\0';
  for (int nomes_index = 0; nomes_index < 10; nomes_index++)
  {
    nomes[1][nomes_index] = new_sym_var(sizeof(char) * 8);
  }

  nomes[1][10 - 1] = '\0';
}

void adiciona_jogo(Avl avl, Hashtable ht, Lista lst, int NL)
{
  int i;
  int score[2];
  char nome_jogo[1024];
  char nome_equipas[2][1024];
  avl_link link_avl[2];
  ht_link link_ht;
  lst_link link_lst;
  pJogo jogo;
  pEquipa equipas[2];
  obtem_nome(nome_jogo);
  obtem_equipas(nome_equipas);
  obtem_score(score);
  link_ht = ht_verifica(nome_jogo, ht, 1, NL);
  if (link_ht == 0)
  {
    for (i = 0; i < 2; i++)
    {
      link_avl[i] = avl_verifica(avl, nome_equipas[i], 0, NL);
      if (link_avl[i] == 0)
      {
        return;
      }
      else
      {
        
      }

      equipas[i] = link_avl[i]->equipa;
    }

    jogo = jogo_cria(nome_jogo, equipas, score);
    link_lst = lst_insere(jogo, lst);
    ht_insere(link_lst, ht);
    equipa_atualiza_ganhos(equipas, score, 1);
  }
  else
  {
    
  }

}

void adiciona_equipa(Avl avl, int NL)
{
  char nome[1024];
  pEquipa equipa;
  avl_link link;
  obtem_nome(nome);
  link = avl_verifica(avl, nome, 1, NL);
  if (link == 0)
  {
    equipa = equipa_cria(nome);
    avl->head = avl_insere(avl->head, equipa);
  }
  else
  {
    
  }

}

void lista_jogos(Lista lst, int NL)
{
  lst_print(lst, NL);
}

void procura_equipa(Avl avl, int NL)
{
  char nome[1024];
  avl_link link;
  obtem_nome(nome);
  link = avl_verifica(avl, nome, 0, NL);
  if (!(link == 0))
  {
    equipa_print(link->equipa, NL);
  }
  else
  {
    
  }

}

void procura_jogo(Hashtable ht, int NL)
{
  char nome[1024];
  ht_link link;
  obtem_nome(nome);
  link = ht_verifica(nome, ht, 0, NL);
  if (!(link == 0))
  {
    jogo_print(link->lst->jogo, NL);
  }
  else
  {
    
  }

}

void remove_jogo(Hashtable ht, Lista lst, int NL)
{
  char nome[1024];
  ht_link link;
  obtem_nome(nome);
  link = ht_verifica(nome, ht, 0, NL);
  if (!(link == 0))
  {
    equipa_atualiza_ganhos(link->lst->jogo->equipas, link->lst->jogo->score, 0);
    ht_remove(link, lst, ht);
  }
  else
  {
    
  }

}

void altera_score(Hashtable ht, int NL)
{
  char nome[1024];
  int score[2];
  ht_link link;
  obtem_nome(nome);
  obtem_score(score);
  link = ht_verifica(nome, ht, 0, NL);
  if (!(link == 0))
  {
    equipa_atualiza_ganhos_s(link->lst->jogo->equipas, link->lst->jogo->score, score);
    jogo_atualiza_score(link->lst->jogo, score);
  }
  else
  {
    
  }

}

void lista_melhores(Avl avl, int NL)
{
  int max_ganhos = avl_obtem_max_ganhos(avl->head, 0);
  if (!(avl->head == 0))
  {
    printf("%d Melhores %d\n", NL, max_ganhos);
    avl_print_melhores(avl->head, max_ganhos, NL);
  }
  else
  {
    
  }

}

