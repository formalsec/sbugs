/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "jogos.h"
#include "hash_jogos.h"
#include "equipas.h"
#include "hash_equipas.h"


jogo *init_tab_jogos()
{
  int i;
  int M = 32911;
  jogo *ht = malloc(M * (sizeof(jogo)));
  for (i = 0; i < M; i++)
  {
    ht[i] = 0;
  }

  return ht;
}

void tab_insert_jg(jogo jg, jogo *ht)
{
  char *key = jg->nome_jogo;
  int i = 0;
  int M = 32911;
  int h = hash(key);
  while (ht[(h + i) % M] != 0)
  {
    i += 1;
  }

  ht[(h + i) % M] = jg;
}

int procura_jogo(char *key, jogo *ht)
{
  int i = 0;
  int M = 32911;
  int h = hash(key);
  while (ht[(h + i) % M] != 0)
  {
    if (strcmp(ht[(h + i) % M]->nome_jogo, key) == 0)
    {
      return (h + i) % M;
    }
    else
    {
      
    }

    i += 1;
  }

  if ((ht[(h + i) % M] != 0) && (strcmp(ht[(h + i) % M]->nome_jogo, key) == 0))
  {
    return (h + i) % M;
  }
  else
  {
    
  }

  return -1;
}

void free_tabela_jg(jogo *ht)
{
  int i;
  for (i = 0; i < 32911; i++)
  {
    if (ht[i] != 0)
    {
      free_jogo(ht[i]);
    }
    else
    {
      
    }

  }

}

void tab_delete_jg(jogo jg, jogo *ht_jg)
{
  char *key = jg->nome_jogo;
  int j;
  int i = 0;
  int M = 32911;
  int h = hash(key);
  jogo reposicionar;
  while (ht_jg[(h + i) % M] != 0)
  {
    if (strcmp(ht_jg[(h + i) % M]->nome_jogo, key) == 0)
    {
      break;
    }
    else
    {
      i += 1;
    }

  }

  if ((ht_jg[(h + i) % M] != 0) && (strcmp(ht_jg[(h + i) % M]->nome_jogo, key) == 0))
  {
    free_jogo(ht_jg[(h + i) % M]);
    ht_jg[(h + i) % M] = 0;
  }
  else
  {
    if (strcmp(ht_jg[0]->nome_jogo, key) == 0)
    {
      free_jogo(ht_jg[0]);
      ht_jg[0] = 0;
    }
    else
    {
      
    }

  }

  i += 1;
  for (j = (h + i) % M; ht_jg[j] != 0; j = (j + 1) % M)
  {
    reposicionar = ht_jg[j];
    ht_jg[j] = 0;
    tab_insert_jg(reposicionar, ht_jg);
  }

}

void reposicionar(jogo jg, jogo *ht_jg)
{
  char *key = jg->nome_jogo;
  int j;
  int i = 0;
  int M = 32911;
  int h = hash(key);
  jogo reposicionar;
  while (ht_jg[(h + i) % M] != 0)
  {
    if (strcmp(ht_jg[(h + i) % M]->nome_jogo, key) == 0)
    {
      break;
    }
    else
    {
      i += 1;
    }

  }

  if (((((h + i) % M) != 0) && (ht_jg[(h + i) % M] != 0)) && (strcmp(ht_jg[(h + i) % M]->nome_jogo, key) == 0))
  {
    ht_jg[(h + i) % M] = 0;
  }
  else
  {
    
  }

  i += 1;
  for (j = (h + i) % M; ht_jg[j] != 0; j = (j + 1) % M)
  {
    reposicionar = ht_jg[j];
    ht_jg[j] = 0;
    tab_insert_jg(reposicionar, ht_jg);
  }

}

void apaga_jogo(int nl, jogo *ht_jg, equipa *ht_eq)
{
  char *nome = malloc(1023 * (sizeof(char)));
  int indice;
  int eq1;
  int eq2;
  jogo aux_free;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  indice = procura_jogo(nome, ht_jg);
  if (ht_jg[0] != 0)
  {
    if (strcmp(ht_jg[0]->nome_jogo, nome) == 0)
    {
      eq1 = procura_equipa(ht_jg[0]->nome_eq1, ht_eq);
      eq2 = procura_equipa(ht_jg[0]->nome_eq2, ht_eq);
      if (ht_jg[0]->score_eq1 > ht_jg[0]->score_eq2)
      {
        ht_eq[eq1]->vitorias -= 1;
      }
      else
      {
        if (ht_jg[0]->score_eq2 > ht_jg[0]->score_eq1)
        {
          ht_eq[eq2]->vitorias -= 1;
        }
        else
        {
          
        }

      }

      if (ht_jg[0]->next == 0)
      {
        free_jogo(ht_jg[0]);
        ht_jg[0] = 0;
      }
      else
      {
        aux_free = ht_jg[0];
        ht_jg[0] = aux_free->next;
        ht_jg[0]->prev = 0;
        reposicionar(aux_free->next, ht_jg);
        free_jogo(aux_free);
      }

    }
    else
    {
      if (indice > 0)
      {
        eq1 = procura_equipa(ht_jg[indice]->nome_eq1, ht_eq);
        eq2 = procura_equipa(ht_jg[indice]->nome_eq2, ht_eq);
        if (ht_jg[indice]->score_eq1 > ht_jg[indice]->score_eq2)
        {
          ht_eq[eq1]->vitorias -= 1;
        }
        else
        {
          if (ht_jg[indice]->score_eq2 > ht_jg[indice]->score_eq1)
          {
            ht_eq[eq2]->vitorias -= 1;
          }
          else
          {
            
          }

        }

        if (ht_jg[indice]->next == 0)
        {
          ht_jg[indice]->prev->next = 0;
          tab_delete_jg(ht_jg[indice], ht_jg);
        }
        else
        {
          if (ht_jg[indice]->prev == 0)
          {
            ht_jg[indice]->next->prev = 0;
            tab_delete_jg(ht_jg[indice], ht_jg);
          }
          else
          {
            ht_jg[indice]->next->prev = ht_jg[indice]->prev;
            ht_jg[indice]->prev->next = ht_jg[indice]->next;
            tab_delete_jg(ht_jg[indice], ht_jg);
          }

        }

      }
      else
      {
        printf("%d Jogo inexistente.\n", nl);
      }

    }

  }
  else
  {
    printf("%d Jogo inexistente.\n", nl);
  }

  free(nome);
}

