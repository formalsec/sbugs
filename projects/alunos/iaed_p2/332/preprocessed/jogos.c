#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "jogos.h"
#include "hash_jogos.h"
#include "equipas.h"
#include "hash_equipas.h"


void free_jogo(jogo x)
{
  free(x->nome_jogo);
  free(x->nome_eq1);
  free(x->nome_eq2);
  free(x);
}

jogo cria_jogo(char *nome, char *eq1, char *eq2, int score1, int score2)
{
  jogo novo = (jogo) malloc(sizeof(struct jogo));
  novo->nome_jogo = strdup(nome);
  novo->nome_eq1 = strdup(eq1);
  novo->nome_eq2 = strdup(eq2);
  novo->score_eq1 = score1;
  novo->score_eq2 = score2;
  return novo;
}

void adiciona_jogo(int nl, jogo *ht_jg, equipa *ht_eq)
{
  char game[1023];
  char team1[1023];
  char team2[1023];
  char *nome_jogo;
  char *nome_eq1;
  char *nome_eq2;
  int score1;
  int score2;
  int verif;
  int verif_eq1;
  int verif_eq2;
  jogo novo;
  jogo aux_jg;
  for (int game_index = 0; game_index < 10; game_index++)
  {
    game[game_index] = new_sym_var(sizeof(char) * 8);
  }

  game[10 - 1] = '\0';
  for (int team1_index = 0; team1_index < 10; team1_index++)
  {
    team1[team1_index] = new_sym_var(sizeof(char) * 8);
  }

  team1[10 - 1] = '\0';
  for (int team2_index = 0; team2_index < 10; team2_index++)
  {
    team2[team2_index] = new_sym_var(sizeof(char) * 8);
  }

  team2[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  nome_jogo = malloc((strlen(game) + 1) * (sizeof(char)));
  nome_eq1 = malloc((strlen(team1) + 1) * (sizeof(char)));
  nome_eq2 = malloc((strlen(team2) + 1) * (sizeof(char)));
  strcpy(nome_jogo, game);
  strcpy(nome_eq1, team1);
  strcpy(nome_eq2, team2);
  novo = cria_jogo(nome_jogo, nome_eq1, nome_eq2, score1, score2);
  verif = procura_jogo(nome_jogo, ht_jg);
  verif_eq1 = procura_equipa(nome_eq1, ht_eq);
  verif_eq2 = procura_equipa(nome_eq2, ht_eq);
  if (ht_jg[0] != 0)
  {
    if (strcmp(ht_jg[0]->nome_jogo, novo->nome_jogo) == 0)
    {
      printf("%d Jogo existente.\n", nl);
      free_jogo(novo);
    }
    else
    {
      if (verif > 0)
      {
        printf("%d Jogo existente.\n", nl);
        free_jogo(novo);
      }
      else
      {
        if ((verif_eq1 == (-1)) || (verif_eq2 == (-1)))
        {
          printf("%d Equipa inexistente.\n", nl);
          free_jogo(novo);
        }
        else
        {
          if (score1 > score2)
          {
            ht_eq[verif_eq1]->vitorias += 1;
          }
          else
          {
            if (score2 > score1)
            {
              ht_eq[verif_eq2]->vitorias += 1;
            }
            else
            {
              
            }

          }

          novo->next = ht_jg[0];
          novo->prev = 0;
          ht_jg[0]->prev = novo;
          aux_jg = ht_jg[0];
          ht_jg[0] = novo;
          tab_insert_jg(aux_jg, ht_jg);
        }

      }

    }

  }
  else
  {
    if ((verif_eq1 == (-1)) || (verif_eq2 == (-1)))
    {
      printf("%d Equipa inexistente.\n", nl);
      free_jogo(novo);
    }
    else
    {
      if (score1 > score2)
      {
        ht_eq[verif_eq1]->vitorias += 1;
      }
      else
      {
        if (score2 > score1)
        {
          ht_eq[verif_eq2]->vitorias += 1;
        }
        else
        {
          
        }

      }

      novo->next = 0;
      novo->prev = 0;
      ht_jg[0] = novo;
    }

  }

  free(nome_jogo);
  free(nome_eq1);
  free(nome_eq2);
}

void encontra_jogo(int nl, jogo *ht_jg)
{
  char *nome = malloc(1023 * (sizeof(char)));
  int indice;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  indice = procura_jogo(nome, ht_jg);
  if (ht_jg[0] != 0)
  {
    if (strcmp(ht_jg[0]->nome_jogo, nome) == 0)
    {
      printf("%d %s %s %s %d %d\n", nl, ht_jg[0]->nome_jogo, ht_jg[0]->nome_eq1, ht_jg[0]->nome_eq2, ht_jg[0]->score_eq1, ht_jg[0]->score_eq2);
    }
    else
    {
      if (indice > 0)
      {
        printf("%d %s %s %s %d %d\n", nl, ht_jg[indice]->nome_jogo, ht_jg[indice]->nome_eq1, ht_jg[indice]->nome_eq2, ht_jg[indice]->score_eq1, ht_jg[indice]->score_eq2);
      }
      else
      {
        printf("%d Jogo inexistente.\n", nl);
      }

    }

  }
  else
  {
    printf("%d Jogo inexistente.\n", nl);
  }

  free(nome);
}

void altera_score(int nl, jogo *ht_jg, equipa *ht_eq)
{
  char *nome = malloc(1023 * (sizeof(char)));
  int eq1;
  int eq2;
  int novo_score1;
  int novo_score2;
  int indice;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  novo_score1 = new_sym_var(sizeof(int) * 8);
  novo_score2 = new_sym_var(sizeof(int) * 8);
  indice = procura_jogo(nome, ht_jg);
  if (ht_jg[0] != 0)
  {
    if (strcmp(ht_jg[0]->nome_jogo, nome) == 0)
    {
      eq1 = procura_equipa(ht_jg[0]->nome_eq1, ht_eq);
      eq2 = procura_equipa(ht_jg[0]->nome_eq2, ht_eq);
      if (ht_jg[0]->score_eq1 > ht_jg[0]->score_eq2)
      {
        ht_eq[eq1]->vitorias -= 1;
      }
      else
      {
        if (ht_jg[0]->score_eq2 > ht_jg[0]->score_eq1)
        {
          ht_eq[eq2]->vitorias -= 1;
        }
        else
        {
          
        }

      }

      ht_jg[0]->score_eq1 = novo_score1;
      ht_jg[0]->score_eq2 = novo_score2;
      if (novo_score1 > novo_score2)
      {
        ht_eq[eq1]->vitorias += 1;
      }
      else
      {
        if (novo_score2 > novo_score1)
        {
          ht_eq[eq2]->vitorias += 1;
        }
        else
        {
          
        }

      }

    }
    else
    {
      if (indice > 0)
      {
        eq1 = procura_equipa(ht_jg[indice]->nome_eq1, ht_eq);
        eq2 = procura_equipa(ht_jg[indice]->nome_eq2, ht_eq);
        if (ht_jg[indice]->score_eq1 > ht_jg[indice]->score_eq2)
        {
          ht_eq[eq1]->vitorias -= 1;
        }
        else
        {
          if (ht_jg[indice]->score_eq2 > ht_jg[indice]->score_eq1)
          {
            ht_eq[eq2]->vitorias -= 1;
          }
          else
          {
            
          }

        }

        ht_jg[indice]->score_eq1 = novo_score1;
        ht_jg[indice]->score_eq2 = novo_score2;
        if (novo_score1 > novo_score2)
        {
          ht_eq[eq1]->vitorias += 1;
        }
        else
        {
          if (novo_score2 > novo_score1)
          {
            ht_eq[eq2]->vitorias += 1;
          }
          else
          {
            
          }

        }

      }
      else
      {
        printf("%d Jogo inexistente.\n", nl);
      }

    }

  }
  else
  {
    printf("%d Jogo inexistente.\n", nl);
  }

  free(nome);
}

void lista_jogos(int nl, jogo *ht_jg)
{
  jogo aux;
  if (ht_jg[0] != 0)
  {
    aux = ht_jg[0];
    while (aux->next != 0)
    {
      aux = aux->next;
    }

    while (aux->prev != 0)
    {
      printf("%d %s %s %s %d %d\n", nl, aux->nome_jogo, aux->nome_eq1, aux->nome_eq2, aux->score_eq1, aux->score_eq2);
      aux = aux->prev;
    }

    printf("%d %s %s %s %d %d\n", nl, ht_jg[0]->nome_jogo, ht_jg[0]->nome_eq1, ht_jg[0]->nome_eq2, ht_jg[0]->score_eq1, ht_jg[0]->score_eq2);
  }
  else
  {
    
  }

}

