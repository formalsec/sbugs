#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include "proj2_aux.h"
#include <stdio.h>
#include <string.h>
#include <stdlib.h>


Lista_jogos_equipas *cria_lista()
{
  int i;
  Lista_jogos_equipas *lje = (Lista_jogos_equipas *) malloc(sizeof(Lista_jogos_equipas));
  lje->primeira_equipa = 0;
  lje->ultima_equipa = 0;
  lje->primeiro_jogo = 0;
  lje->ultimo_jogo = 0;
  for (i = 0; i < 23; i++)
  {
    lje->tab_equipa[i] = malloc(sizeof(Tabela_equipas));
    lje->tab_equipa[i]->primeira_equipa = 0;
    lje->tab_equipa[i]->ultima_equipa = 0;
  }

  for (i = 0; i < 23; i++)
  {
    lje->tab_jogo[i] = malloc(sizeof(Tabela_jogos));
    lje->tab_jogo[i]->primeiro_jogo = 0;
    lje->tab_jogo[i]->ultimo_jogo = 0;
  }

  return lje;
}

Tabela_equipas *cria_lista_equipas()
{
  Tabela_equipas *tabela = (Tabela_equipas *) malloc(sizeof(Tabela_equipas));
  tabela->primeira_equipa = 0;
  tabela->ultima_equipa = 0;
  return tabela;
}

int hash(char *b)
{
  int h = 0;
  int a = 127;
  for (; (*b) != '\0'; b++)
  {
    h = ((a * h) + (*b)) % 23;
  }

  return h;
}

Equipa *adiciona_equipa(char *atr1)
{
  Equipa *nova_equipa = (Equipa *) malloc(sizeof(Equipa));
  nova_equipa->nome = (char *) malloc((sizeof(char)) * (strlen(atr1) + 1));
  strcpy(nova_equipa->nome, atr1);
  nova_equipa->vitorias = 0;
  nova_equipa->equipa_seguinte = 0;
  nova_equipa->prox_tabela = 0;
  nova_equipa->prox_vit_max = 0;
  nova_equipa->anterior_vit_max = 0;
  return nova_equipa;
}

Equipa *procura_nome_equipa(Lista_jogos_equipas *lje, char *atr1)
{
  Equipa *equipa;
  int posicao = hash(atr1);
  equipa = lje->tab_equipa[posicao]->primeira_equipa;
  while (equipa != 0)
  {
    if (strcmp(equipa->nome, atr1) == 0)
    {
      return equipa;
    }
    else
    {
      
    }

    equipa = equipa->prox_tabela;
  }

  return 0;
}

Jogo *adiciona_jogo(char *atr1, Equipa *equipa_1, Equipa *equipa_2, char *atr2, char *atr3)
{
  Jogo *novo_jogo = (Jogo *) malloc(sizeof(Jogo));
  novo_jogo->nome = (char *) malloc((sizeof(char)) * (strlen(atr1) + 1));
  strcpy(novo_jogo->nome, atr1);
  novo_jogo->equipa1 = equipa_1;
  novo_jogo->equipa2 = equipa_2;
  novo_jogo->score1 = atoi(atr2);
  novo_jogo->score2 = atoi(atr3);
  novo_jogo->jogo_seguinte = 0;
  novo_jogo->jogo_anterior = 0;
  novo_jogo->prox_tabela = 0;
  novo_jogo->anterior_tabela = 0;
  return novo_jogo;
}

Jogo *procura_nome_jogo(Lista_jogos_equipas *lje, char *atr1)
{
  Jogo *jogo;
  int posicao = hash(atr1);
  jogo = lje->tab_jogo[posicao]->primeiro_jogo;
  while (jogo != 0)
  {
    if (strcmp(jogo->nome, atr1) == 0)
    {
      return jogo;
    }
    else
    {
      
    }

    jogo = jogo->prox_tabela;
  }

  return 0;
}

int procura_max_vitorias(Lista_jogos_equipas *lje)
{
  Equipa *equipa;
  int max_vitorias = 0;
  equipa = lje->primeira_equipa;
  while (equipa != 0)
  {
    if (equipa->vitorias > max_vitorias)
    {
      max_vitorias = equipa->vitorias;
    }
    else
    {
      
    }

    equipa = equipa->equipa_seguinte;
  }

  return max_vitorias;
}

Tabela_equipas *procura_equipa_vitorias(Lista_jogos_equipas *lje, int num_max_vitorias)
{
  Tabela_equipas *max_vitorias;
  Equipa *equipa;
  equipa = lje->primeira_equipa;
  max_vitorias = cria_lista_equipas();
  while (equipa != 0)
  {
    if (equipa->vitorias == num_max_vitorias)
    {
      if (max_vitorias->primeira_equipa == 0)
      {
        max_vitorias->primeira_equipa = equipa;
      }
      else
      {
        max_vitorias->ultima_equipa->prox_vit_max = equipa;
        equipa->anterior_vit_max = max_vitorias->ultima_equipa;
      }

      max_vitorias->ultima_equipa = equipa;
    }
    else
    {
      
    }

    equipa = equipa->equipa_seguinte;
  }

  return max_vitorias;
}

void ordena_equipa_vitorias(Tabela_equipas *max_vitorias, int NL, int num_max_vitorias)
{
  Equipa *equipa_1;
  Equipa *equipa_2;
  Equipa *equipa_menor;
  if (max_vitorias->primeira_equipa == 0)
  {
    free(max_vitorias);
    return;
  }
  else
  {
    
  }

  equipa_1 = max_vitorias->primeira_equipa;
  printf("%d Melhores %d\n", NL, num_max_vitorias);
  while (equipa_1 != 0)
  {
    if (equipa_1->prox_vit_max == 0)
    {
      printf("%d * %s\n", NL, equipa_1->nome);
      max_vitorias->primeira_equipa = 0;
      max_vitorias->ultima_equipa = 0;
      free(max_vitorias);
      return;
    }
    else
    {
      equipa_2 = equipa_1->prox_vit_max;
      while (equipa_2 != 0)
      {
        if (strcmp(equipa_1->nome, equipa_2->nome) > 0)
        {
          equipa_menor = equipa_2;
        }
        else
        {
          if (strcmp(equipa_1->nome, equipa_2->nome) < 0)
          {
            equipa_menor = equipa_1;
          }
          else
          {
            
          }

        }

        equipa_2 = equipa_2->prox_vit_max;
        equipa_1 = equipa_menor;
      }

      printf("%d * %s\n", NL, equipa_menor->nome);
      if (equipa_menor == max_vitorias->primeira_equipa)
      {
        max_vitorias->primeira_equipa = max_vitorias->primeira_equipa->prox_vit_max;
      }
      else
      {
        
      }

      if (equipa_menor->anterior_vit_max == 0)
      {
        if (equipa_menor->prox_vit_max == 0)
        {
          max_vitorias->primeira_equipa = 0;
          max_vitorias->ultima_equipa = 0;
        }
        else
        {
          equipa_menor->prox_vit_max->anterior_vit_max = 0;
        }

      }
      else
      {
        if (equipa_menor->prox_vit_max == 0)
        {
          equipa_menor->anterior_vit_max->prox_vit_max = 0;
          max_vitorias->ultima_equipa = max_vitorias->ultima_equipa->anterior_vit_max;
        }
        else
        {
          equipa_menor->anterior_vit_max->prox_vit_max = equipa_menor->prox_vit_max;
          equipa_menor->prox_vit_max->anterior_vit_max = equipa_menor->anterior_vit_max;
        }

      }

      equipa_1 = max_vitorias->primeira_equipa;
    }

  }

  free(max_vitorias);
}

void free_lista(Lista_jogos_equipas *lje)
{
  Equipa *equipa1;
  Equipa *equipa2;
  Jogo *jogo1;
  Jogo *jogo2;
  int i;
  equipa1 = lje->primeira_equipa;
  while (equipa1 != 0)
  {
    equipa2 = equipa1;
    free(equipa2->nome);
    equipa1 = equipa1->equipa_seguinte;
    free(equipa2);
  }

  jogo1 = lje->primeiro_jogo;
  while (jogo1 != 0)
  {
    jogo2 = jogo1;
    free(jogo2->nome);
    jogo1 = jogo1->jogo_seguinte;
    free(jogo2);
  }

  for (i = 0; i < 23; i++)
  {
    free(lje->tab_equipa[i]);
    free(lje->tab_jogo[i]);
  }

  free(lje);
}

