#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>


typedef struct jogo
{
  char *nome;
  char *equipa1;
  char *equipa2;
  int score1;
  int score2;
} jogo;
typedef struct entry_jogos
{
  struct jogo *jogo;
  struct entry_jogos *next;
} entry_jogos;
typedef struct 
{
  entry_jogos **entries;
  int capacidade;
} ht_jogos;
unsigned int hash(const char *nome, int capacidade)
{
  unsigned long int value = 0;
  unsigned int i = 0;
  unsigned int key_len = strlen(nome);
  for (; i < key_len; ++i)
  {
    value = (value * 37) + nome[i];
  }

  value = value % capacidade;
  return value;
}

entry_jogos *ht_pair_jogos(const char *nome, const char *equipa1, const char *equipa2, int score1, int score2)
{
  entry_jogos *entry = malloc((sizeof(entry_jogos)) * 1);
  entry->jogo = malloc((sizeof(jogo)) * 1);
  entry->jogo->nome = malloc(strlen(nome) + 1);
  entry->jogo->equipa1 = malloc(strlen(equipa1) + 1);
  entry->jogo->equipa2 = malloc(strlen(equipa2) + 1);
  entry->jogo->score1 = score1;
  entry->jogo->score2 = score2;
  strcpy(entry->jogo->nome, nome);
  strcpy(entry->jogo->equipa1, equipa1);
  strcpy(entry->jogo->equipa2, equipa2);
  entry->next = 0;
  return entry;
}

ht_jogos *ht_create_jogos(void)
{
  int i = 0;
  ht_jogos *hashtable = malloc((sizeof(ht_jogos)) * 1);
  hashtable->capacidade = 1913;
  hashtable->entries = malloc((sizeof(entry_jogos *)) * hashtable->capacidade);
  for (; i < hashtable->capacidade; ++i)
  {
    hashtable->entries[i] = 0;
  }

  return hashtable;
}

void ht_set_jogos(ht_jogos *hashtable, const char *nome, const char *equipa1, const char *equipa2, int score1, int score2)
{
  unsigned int slot = hash(nome, hashtable->capacidade);
  entry_jogos *prev;
  entry_jogos *entry = hashtable->entries[slot];
  if (entry == 0)
  {
    hashtable->entries[slot] = ht_pair_jogos(nome, equipa1, equipa2, score1, score2);
    return;
  }
  else
  {
    
  }

  while (entry != 0)
  {
    if (strcmp(entry->jogo->nome, nome) == 0)
    {
      free(entry->jogo->equipa1);
      free(entry->jogo->equipa2);
      entry->jogo->equipa1 = malloc(strlen(equipa1) + 1);
      entry->jogo->equipa2 = malloc(strlen(equipa2) + 1);
      entry->jogo->score1 = score1;
      entry->jogo->score2 = score2;
      strcpy(entry->jogo->equipa1, equipa1);
      strcpy(entry->jogo->equipa2, equipa2);
      return;
    }
    else
    {
      
    }

    prev = entry;
    entry = prev->next;
  }

  prev->next = ht_pair_jogos(nome, equipa1, equipa2, score1, score2);
}

jogo *ht_get_jogos(ht_jogos *hashtable, const char *nome)
{
  unsigned int slot = hash(nome, hashtable->capacidade);
  entry_jogos *entry = hashtable->entries[slot];
  if (entry == 0)
  {
    return 0;
  }
  else
  {
    
  }

  while (entry != 0)
  {
    if (strcmp(entry->jogo->nome, nome) == 0)
    {
      return entry->jogo;
    }
    else
    {
      
    }

    entry = entry->next;
  }

  return 0;
}

void ht_del_jogos(ht_jogos *hashtable, const char *nome)
{
  unsigned int bucket = hash(nome, hashtable->capacidade);
  entry_jogos *prev;
  int idx = 0;
  entry_jogos *entry = hashtable->entries[bucket];
  if (entry == 0)
  {
    return;
  }
  else
  {
    
  }

  while (entry != 0)
  {
    if (strcmp(entry->jogo->nome, nome) == 0)
    {
      if ((entry->next == 0) && (idx == 0))
      {
        hashtable->entries[bucket] = 0;
      }
      else
      {
        
      }

      if ((entry->next != 0) && (idx == 0))
      {
        hashtable->entries[bucket] = entry->next;
      }
      else
      {
        
      }

      if ((entry->next == 0) && (idx != 0))
      {
        prev->next = 0;
      }
      else
      {
        
      }

      if ((entry->next != 0) && (idx != 0))
      {
        prev->next = entry->next;
      }
      else
      {
        
      }

      free(entry->jogo->nome);
      free(entry->jogo->equipa1);
      free(entry->jogo->equipa2);
      free(entry->jogo);
      free(entry);
      return;
    }
    else
    {
      
    }

    prev = entry;
    entry = prev->next;
    ++idx;
  }

}

void ht_dump_jogos(ht_jogos *hashtable)
{
  int i;
  for (i = 0; i < hashtable->capacidade; ++i)
  {
    entry_jogos *entry = hashtable->entries[i];
    if (entry == 0)
    {
      continue;
    }
    else
    {
      
    }

    printf("slot[%4d]: ", i);
    for (;;)
    {
      printf("%s=%s=%s=%d=%d", entry->jogo->nome, entry->jogo->equipa1, entry->jogo->equipa2, entry->jogo->score1, entry->jogo->score2);
      if (entry->next == 0)
      {
        break;
      }
      else
      {
        
      }

      entry = entry->next;
    }

    printf("\n");
  }

}

typedef struct equipa
{
  char *nome;
  int vitorias;
} equipa;
typedef struct entry_equipas
{
  struct equipa *equipa;
  struct entry_equipas *next;
} entry_equipas;
typedef struct 
{
  entry_equipas **entries;
  int capacidade;
} ht_equipas;
entry_equipas *ht_pair_equipas(const char *nome, int vitorias)
{
  entry_equipas *entry = malloc((sizeof(entry_equipas)) * 1);
  entry->equipa = malloc((sizeof(equipa)) * 1);
  entry->equipa->nome = malloc(strlen(nome) + 1);
  entry->equipa->vitorias = vitorias;
  strcpy(entry->equipa->nome, nome);
  entry->next = 0;
  return entry;
}

ht_equipas *ht_create_equipa(void)
{
  int i = 0;
  ht_equipas *hashtable = malloc((sizeof(ht_equipas)) * 1);
  hashtable->capacidade = 1913;
  hashtable->entries = malloc((sizeof(entry_equipas *)) * hashtable->capacidade);
  for (; i < hashtable->capacidade; ++i)
  {
    hashtable->entries[i] = 0;
  }

  return hashtable;
}

void ht_set_equipas(ht_equipas *hashtable, const char *nome, int vitorias)
{
  unsigned int slot = hash(nome, hashtable->capacidade);
  entry_equipas *prev;
  entry_equipas *entry = hashtable->entries[slot];
  if (entry == 0)
  {
    hashtable->entries[slot] = ht_pair_equipas(nome, vitorias);
    return;
  }
  else
  {
    
  }

  while (entry != 0)
  {
    if (strcmp(entry->equipa->nome, nome) == 0)
    {
      entry->equipa->vitorias = vitorias;
      return;
    }
    else
    {
      
    }

    prev = entry;
    entry = prev->next;
  }

  prev->next = ht_pair_equipas(nome, vitorias);
}

equipa *ht_get_equipas(ht_equipas *hashtable, const char *nome)
{
  unsigned int slot = hash(nome, hashtable->capacidade);
  entry_equipas *entry = hashtable->entries[slot];
  if (entry == 0)
  {
    return 0;
  }
  else
  {
    
  }

  while (entry != 0)
  {
    if (strcmp(entry->equipa->nome, nome) == 0)
    {
      return entry->equipa;
    }
    else
    {
      
    }

    entry = entry->next;
  }

  return 0;
}

void ht_dump_equipas(ht_equipas *hashtable)
{
  int i;
  for (i = 0; i < hashtable->capacidade; ++i)
  {
    entry_equipas *entry = hashtable->entries[i];
    if (entry == 0)
    {
      continue;
    }
    else
    {
      
    }

    printf("slot[%4d]: ", i);
    for (;;)
    {
      printf("%s=%d", entry->equipa->nome, entry->equipa->vitorias);
      if (entry->next == 0)
      {
        break;
      }
      else
      {
        
      }

      entry = entry->next;
    }

    printf("\n");
  }

}

int adicionaJogo(int nl, ht_jogos *hashtable_jogos, ht_equipas *hashtable_equipas)
{
  char nome[1024];
  char equipa1[1024];
  char equipa2[1024];
  int score1;
  int score2;
  jogo *jogo;
  equipa *equipa;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  for (int equipa1_index = 0; equipa1_index < 10; equipa1_index++)
  {
    equipa1[equipa1_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa1[10 - 1] = '\0';
  for (int equipa2_index = 0; equipa2_index < 10; equipa2_index++)
  {
    equipa2[equipa2_index] = new_sym_var(sizeof(char) * 8);
  }

  equipa2[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  jogo = ht_get_jogos(hashtable_jogos, nome);
  if (jogo != 0)
  {
    printf("%d Jogo existente.\n", nl);
    return 0;
  }
  else
  {
    
  }

  equipa = ht_get_equipas(hashtable_equipas, equipa1);
  if (equipa == 0)
  {
    printf("%d Equipa inexistente.\n", nl);
    return 0;
  }
  else
  {
    
  }

  equipa = ht_get_equipas(hashtable_equipas, equipa2);
  if (equipa == 0)
  {
    printf("%d Equipa inexistente.\n", nl);
    return 0;
  }
  else
  {
    
  }

  ht_set_jogos(hashtable_jogos, nome, equipa1, equipa2, score1, score2);
  if (score1 > score2)
  {
    equipa = ht_get_equipas(hashtable_equipas, equipa1);
    equipa->vitorias += 1;
  }
  else
  {
    
  }

  if (score1 < score2)
  {
    equipa = ht_get_equipas(hashtable_equipas, equipa2);
    equipa->vitorias += 1;
  }
  else
  {
    
  }

  return 0;
}

int adicionaEquipa(int nl, ht_equipas *hashtable)
{
  char nome[1024];
  int i = 0;
  equipa *equipa;
  nl++;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  equipa = ht_get_equipas(hashtable, nome);
  if (equipa != 0)
  {
    printf("%d Equipa existente.\n", nl);
    return 0;
  }
  else
  {
    
  }

  ht_set_equipas(hashtable, nome, i);
  return 0;
}

int procuraJogo(int nl, ht_jogos *hashtable_jogos)
{
  char nome[1024];
  jogo *jogo;
  nl++;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  jogo = ht_get_jogos(hashtable_jogos, nome);
  if (jogo == 0)
  {
    printf("%d Jogo inexistente.\n", nl);
    return 0;
  }
  else
  {
    
  }

  printf("%d %s\n", nl, jogo->nome);
  return 0;
}

int procuraEquipa(int nl, ht_equipas *hashtable_equipas)
{
  char nome[1024];
  equipa *equipa;
  nl++;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  equipa = ht_get_equipas(hashtable_equipas, nome);
  if (equipa == 0)
  {
    printf("%d Equipa inexistente.\n", nl);
    return 0;
  }
  else
  {
    
  }

  printf("%d %s %d\n", nl, equipa->nome, equipa->vitorias);
  return 0;
}

int alteraScore(int nl, ht_jogos *hashtable_jogos, ht_equipas *hashtable_equipas)
{
  char nome[1024];
  int novo_score1;
  int novo_score2;
  jogo *jogo;
  equipa *equipa;
  nl++;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  novo_score1 = new_sym_var(sizeof(int) * 8);
  novo_score2 = new_sym_var(sizeof(int) * 8);
  jogo = ht_get_jogos(hashtable_jogos, nome);
  if (jogo == 0)
  {
    printf("%d Jogo inexistente.\n", nl);
    return 0;
  }
  else
  {
    
  }

  if (jogo->score1 > jogo->score2)
  {
    equipa = ht_get_equipas(hashtable_equipas, jogo->equipa1);
    equipa->vitorias -= 1;
    if (novo_score1 > novo_score2)
    {
      equipa = ht_get_equipas(hashtable_equipas, jogo->equipa1);
      equipa->vitorias += 1;
    }
    else
    {
      
    }

    if (novo_score1 < novo_score2)
    {
      equipa = ht_get_equipas(hashtable_equipas, jogo->equipa2);
      equipa->vitorias += 1;
    }
    else
    {
      
    }

  }
  else
  {
    
  }

  if (jogo->score1 < jogo->score2)
  {
    equipa = ht_get_equipas(hashtable_equipas, jogo->equipa2);
    equipa->vitorias -= 1;
    if (novo_score1 > novo_score2)
    {
      equipa = ht_get_equipas(hashtable_equipas, jogo->equipa1);
      equipa->vitorias += 1;
    }
    else
    {
      
    }

    if (novo_score1 < novo_score2)
    {
      equipa = ht_get_equipas(hashtable_equipas, jogo->equipa2);
      equipa->vitorias += 1;
    }
    else
    {
      
    }

  }
  else
  {
    
  }

  jogo->score1 = novo_score1;
  jogo->score2 = novo_score2;
  return 0;
}

int removeJogo(int nl, ht_jogos *hashtable_jogos, ht_equipas *hashtable_equipas)
{
  char nome[1024];
  jogo *jogo;
  equipa *equipa;
  nl++;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  jogo = ht_get_jogos(hashtable_jogos, nome);
  if (jogo == 0)
  {
    printf("%d Jogo inexistente.\n", nl);
    return 0;
  }
  else
  {
    
  }

  if (jogo->score1 > jogo->score2)
  {
    equipa = ht_get_equipas(hashtable_equipas, jogo->equipa1);
    equipa->vitorias -= 1;
  }
  else
  {
    
  }

  if (jogo->score1 < jogo->score2)
  {
    equipa = ht_get_equipas(hashtable_equipas, jogo->equipa2);
    equipa->vitorias -= 1;
  }
  else
  {
    
  }

  ht_del_jogos(hashtable_jogos, nome);
  return 0;
}

int libertaMemoriaJogos(ht_jogos *hashtable_jogos)
{
  int i;
  entry_jogos *entry;
  entry_jogos *entry_aux;
  for (i = 0; i < 1913; i++)
  {
    entry = hashtable_jogos->entries[i];
    while (entry != 0)
    {
      entry_aux = entry;
      entry = entry->next;
      free(entry_aux->jogo->nome);
      free(entry_aux->jogo->equipa1);
      free(entry_aux->jogo->equipa2);
      free(entry_aux->jogo);
      free(entry_aux);
    }

  }

  free(hashtable_jogos->entries);
  free(hashtable_jogos);
  return 0;
}

int libertaMemoriaEquipas(ht_equipas *hashtable_equipas)
{
  int i;
  entry_equipas *entry;
  entry_equipas *entry_aux;
  for (i = 0; i < 1913; i++)
  {
    entry = hashtable_equipas->entries[i];
    while (entry != 0)
    {
      entry_aux = entry;
      entry = entry->next;
      free(entry_aux->equipa->nome);
      free(entry_aux->equipa);
      free(entry_aux);
    }

  }

  free(hashtable_equipas->entries);
  free(hashtable_equipas);
  return 0;
}

int main()
{
  ht_jogos *ht_jogos = ht_create_jogos();
  ht_equipas *ht_equipas = ht_create_equipa();
  int i;
  int nl = 0;
  while (((i = getchar()) != EOF) && (i != 'x'))
  {
    switch (i)
    {
      case 'a':
        nl++;
        adicionaJogo(nl, ht_jogos, ht_equipas);
        break;

      case 'A':
        nl++;
        adicionaEquipa(nl, ht_equipas);
        break;

      case 'p':
        nl++;
        procuraJogo(nl, ht_jogos);
        break;

      case 'P':
        nl++;
        procuraEquipa(nl, ht_equipas);
        break;

      case 's':
        nl++;
        alteraScore(nl, ht_jogos, ht_equipas);
        break;

      case 'r':
        nl++;
        removeJogo(nl, ht_jogos, ht_equipas);
        break;

    }

  }

  libertaMemoriaJogos(ht_jogos);
  libertaMemoriaEquipas(ht_equipas);
  return 0;
}

