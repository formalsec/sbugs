#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include "jogo.h"
#include "equipa.h"


void AddJogo(linkJogo *pheadj, linkJogo *ptailj, linkJogo tabJogos[631], linkEquipa *pheade, linkEquipa *ptaile, linkEquipa tabEquipas[631], int NL)
{
  char strings[3][2024];
  char c;
  int i = 0;
  int e = 0;
  int s1;
  int s2;
  linkJogo j;
  linkEquipa e1;
  linkEquipa e2;
  getchar();
  for (; i < 3; i++)
  {
    c = getchar();
    while (c != ':')
    {
      strings[i][e] = c;
      e++;
      c = getchar();
    }

    strings[i][e] = '\0';
    e = 0;
  }

  s1 = new_sym_var(sizeof(int) * 8);
  s2 = new_sym_var(sizeof(int) * 8);
  if (ProcuraJHash(tabJogos, strings[0]) != 0)
  {
    printf("%d Jogo existente.\n", NL);
    return;
  }
  else
  {
    
  }

  if (((e1 = ProcuraEHash(tabEquipas, strings[1])) == 0) || ((e2 = ProcuraEHash(tabEquipas, strings[2])) == 0))
  {
    printf("%d Equipa inexistente.\n", NL);
    return;
  }
  else
  {
    
  }

  if (s1 > s2)
  {
    *e1->equipa->vit = (*e1->equipa->vit) + 1;
    ReposCima(pheade, ptaile, e1);
  }
  else
  {
    if (s1 < s2)
    {
      *e2->equipa->vit = (*e2->equipa->vit) + 1;
      ReposCima(pheade, ptaile, e2);
    }
    else
    {
      
    }

  }

  j = NovoJogo(strings[0], strings[1], strings[2], s1, s2);
  InserirJogo(pheadj, ptailj, tabJogos, j);
}

void AddEquipa(linkEquipa *pheade, linkEquipa *ptaile, linkEquipa tabEquipas[631], int NL)
{
  char string[2024];
  char c;
  int i = 0;
  linkEquipa e;
  getchar();
  c = getchar();
  while (c != '\n')
  {
    string[i] = c;
    i++;
    c = getchar();
  }

  string[i] = '\0';
  if (ProcuraEHash(tabEquipas, string) != 0)
  {
    printf("%d Equipa existente.\n", NL);
    return;
  }
  else
  {
    
  }

  e = NovaEquipa(string);
  InserirEquipa(pheade, ptaile, tabEquipas, e);
}

void ListaJogos(linkJogo headj, int NL)
{
  linkJogo aux;
  getchar();
  if (headj == 0)
  {
    return;
  }
  else
  {
    
  }

  aux = headj;
  while (aux != 0)
  {
    printf("%d %s %s %s %d %d\n", NL, aux->jogo->nome, aux->jogo->equipa1, aux->jogo->equipa2, *aux->jogo->score1, *aux->jogo->score2);
    aux = aux->nextList;
  }

}

void FindJogo(linkJogo tabJogos[631], int NL)
{
  char string[2024];
  char c;
  int i = 0;
  linkJogo j;
  getchar();
  c = getchar();
  while (c != '\n')
  {
    string[i] = c;
    i++;
    c = getchar();
  }

  string[i] = '\0';
  j = ProcuraJHash(tabJogos, string);
  if (j == 0)
  {
    printf("%d Jogo inexistente.\n", NL);
    return;
  }
  else
  {
    
  }

  printf("%d %s %s %s %d %d\n", NL, string, j->jogo->equipa1, j->jogo->equipa2, *j->jogo->score1, *j->jogo->score2);
}

void FindEquipa(linkEquipa tabEquipas[631], int NL)
{
  char string[2024];
  char c;
  int i = 0;
  linkEquipa e;
  getchar();
  c = getchar();
  while (c != '\n')
  {
    string[i] = c;
    i++;
    c = getchar();
  }

  string[i] = '\0';
  e = ProcuraEHash(tabEquipas, string);
  if (e == 0)
  {
    printf("%d Equipa inexistente.\n", NL);
    return;
  }
  else
  {
    
  }

  printf("%d %s %d\n", NL, string, *e->equipa->vit);
}

void RemoveJogo(linkJogo *pheadj, linkJogo *ptailj, linkJogo tabJogos[631], linkEquipa *pheade, linkEquipa *ptaile, linkEquipa tabEquipas[631], int NL)
{
  char string[2024];
  char c;
  int i = 0;
  linkJogo j;
  linkEquipa e;
  getchar();
  c = getchar();
  while (c != '\n')
  {
    string[i] = c;
    i++;
    c = getchar();
  }

  string[i] = '\0';
  j = ProcuraJHash(tabJogos, string);
  if (j == 0)
  {
    printf("%d Jogo inexistente.\n", NL);
    return;
  }
  else
  {
    
  }

  if ((*j->jogo->score1) > (*j->jogo->score2))
  {
    e = ProcuraEHash(tabEquipas, j->jogo->equipa1);
    *e->equipa->vit = (*e->equipa->vit) - 1;
    ReposBaixo(pheade, ptaile, e);
  }
  else
  {
    if ((*j->jogo->score2) > (*j->jogo->score1))
    {
      e = ProcuraEHash(tabEquipas, j->jogo->equipa2);
      *e->equipa->vit = (*e->equipa->vit) - 1;
      ReposBaixo(pheade, ptaile, e);
    }
    else
    {
      
    }

  }

  RemoverJogo(pheadj, ptailj, tabJogos, j);
}

void AltScore(linkJogo tabJogos[631], linkEquipa *pheade, linkEquipa *ptaile, linkEquipa tabEquipas[631], int NL)
{
  char string[2024];
  char c;
  int i = 0;
  int s1;
  int s2;
  int ps1;
  int ps2;
  linkJogo j;
  int *v1;
  int *v2;
  linkEquipa e1;
  linkEquipa e2;
  getchar();
  c = getchar();
  while (c != ':')
  {
    string[i] = c;
    i++;
    c = getchar();
  }

  string[i] = '\0';
  s1 = new_sym_var(sizeof(int) * 8);
  s2 = new_sym_var(sizeof(int) * 8);
  j = ProcuraJHash(tabJogos, string);
  if (j == 0)
  {
    printf("%d Jogo inexistente.\n", NL);
    return;
  }
  else
  {
    
  }

  e1 = ProcuraEHash(tabEquipas, j->jogo->equipa1);
  e2 = ProcuraEHash(tabEquipas, j->jogo->equipa2);
  v1 = e1->equipa->vit;
  v2 = e2->equipa->vit;
  ps1 = *j->jogo->score1;
  ps2 = *j->jogo->score2;
  if (ps1 > ps2)
  {
    if (s1 < s2)
    {
      *v1 = (*v1) - 1;
      ReposBaixo(pheade, ptaile, e1);
      *v2 = (*v2) + 1;
      ReposCima(pheade, ptaile, e2);
    }
    else
    {
      if (s1 == s2)
      {
        *v1 = (*v1) - 1;
        ReposBaixo(pheade, ptaile, e1);
      }
      else
      {
        
      }

    }

  }
  else
  {
    if (ps1 < ps2)
    {
      if (s1 > s2)
      {
        *v1 = (*v1) + 1;
        ReposCima(pheade, ptaile, e1);
        *v2 = (*v2) - 1;
        ReposBaixo(pheade, ptaile, e2);
      }
      else
      {
        if (s1 == s2)
        {
          *v2 = (*v2) - 1;
          ReposBaixo(pheade, ptaile, e2);
        }
        else
        {
          
        }

      }

    }
    else
    {
      if (s1 > s2)
      {
        *v1 = (*v1) + 1;
        ReposCima(pheade, ptaile, e1);
      }
      else
      {
        if (s1 < s2)
        {
          *v2 = (*v2) + 1;
          ReposCima(pheade, ptaile, e2);
        }
        else
        {
          
        }

      }

    }

  }

  *j->jogo->score1 = s1;
  *j->jogo->score2 = s2;
}

void ListMelhores(linkEquipa taile, int NL)
{
  linkEquipa aux;
  if (taile == 0)
  {
    return;
  }
  else
  {
    
  }

  printf("%d Melhores %d\n", NL, *taile->equipa->vit);
  aux = taile;
  printf("%d * %s\n", NL, aux->equipa->nome);
  while ((aux->prevList != 0) && ((*aux->equipa->vit) == (*aux->prevList->equipa->vit)))
  {
    aux = aux->prevList;
    printf("%d * %s\n", NL, aux->equipa->nome);
  }

}

int main()
{
  int c = 0;
  int i = 0;
  int NL = 1;
  linkJogo headj = 0;
  linkJogo tailj = 0;
  linkJogo tabJogos[631];
  linkEquipa heade = 0;
  linkEquipa taile = 0;
  linkEquipa tabEquipas[631];
  for (; i < 631; i++)
  {
    tabJogos[i] = 0;
  }

  for (i = 0; i < 631; i++)
  {
    tabEquipas[i] = 0;
  }

  c = getchar();
  while (c != 'x')
  {
    if (c == 'a')
    {
      AddJogo(&headj, &tailj, tabJogos, &heade, &taile, tabEquipas, NL);
    }
    else
    {
      if (c == 'A')
      {
        AddEquipa(&heade, &taile, tabEquipas, NL);
      }
      else
      {
        if (c == 'l')
        {
          ListaJogos(headj, NL);
        }
        else
        {
          if (c == 'p')
          {
            FindJogo(tabJogos, NL);
          }
          else
          {
            if (c == 'P')
            {
              FindEquipa(tabEquipas, NL);
            }
            else
            {
              if (c == 'r')
              {
                RemoveJogo(&headj, &tailj, tabJogos, &heade, &taile, tabEquipas, NL);
              }
              else
              {
                if (c == 's')
                {
                  AltScore(tabJogos, &heade, &taile, tabEquipas, NL);
                }
                else
                {
                  if (c == 'g')
                  {
                    ListMelhores(taile, NL);
                  }
                  else
                  {
                    
                  }

                }

              }

            }

          }

        }

      }

    }

    c = getchar();
    if (c != '\n')
    {
      NL++;
    }
    else
    {
      
    }

  }

  if (headj != 0)
  {
    freeLinkJogo(headj);
  }
  else
  {
    
  }

  for (i = 0; i < 631; i++)
    if (tabEquipas[i] != 0)
  {
    freeLinkEquipa(tabEquipas[i]);
  }
  else
  {
    
  }


  return 0;
}

