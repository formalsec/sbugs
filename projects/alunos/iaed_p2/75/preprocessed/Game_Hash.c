#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdlib.h>
#include <string.h>
#include <stdio.h>
#include "Game_Hash.h"
#include "Game.h"


int hash_game(char *str, int M)
{
  int i = 0;
  int a = 19163;
  int b = 27183;
  for (; (*str) != '\0'; str++, a = (a * b) % (M - 1))
  {
    i = ((a * i) + (*str)) % M;
  }

  return i;
}

link_game *initGame_Hash(int size)
{
  link_game *p_hashgames = (link_game *) malloc((sizeof(link_game)) * size);
  int i = 0;
  while (i < size)
  {
    p_hashgames[i] = 0;
    i++;
  }

  return p_hashgames;
}

void insertGame_Hash(int size, link_game *h, Game *g)
{
  int i = hash_game(g->pname, size);
  link_game ptaux = (link_game) malloc(sizeof(struct node_game));
  ptaux->pgame = g;
  ptaux->next = h[i];
  h[i] = ptaux;
}

void deleteGame_Hash(int size, link_game *h, char *g_name)
{
  int i = hash_game(g_name, size);
  link_game paux;
  link_game previous = 0;
  for (paux = h[i]; paux != 0; previous = paux, paux = paux->next)
  {
    if (strcmp(paux->pgame->pname, g_name) == 0)
    {
      if (paux == h[i])
      {
        h[i] = paux->next;
      }
      else
      {
        previous->next = paux->next;
      }

      delGame(paux->pgame);
      free(paux);
      break;
    }
    else
    {
      
    }

  }

}

Game *searchGame_Hash(int size, link_game *h, char *name)
{
  int i = hash_game(name, size);
  link_game p_aux;
  for (p_aux = h[i]; p_aux != 0; p_aux = p_aux->next)
  {
    if (strcmp(p_aux->pgame->pname, name) == 0)
    {
      return p_aux->pgame;
    }
    else
    {
      
    }

    ;
  }

  return 0;
}

void destroyGame_Hash(int size, link_game *head)
{
  int i;
  link_game p_aux;
  link_game p_aux_delete;
  for (i = 0; i < size; i++)
  {
    p_aux = head[i];
    while (p_aux != 0)
    {
      delGame(p_aux->pgame);
      p_aux_delete = p_aux;
      p_aux = p_aux->next;
      free(p_aux_delete);
    }

  }

  free(head);
}

lnk_dblist initGHash_auxList()
{
  lnk_dblist head = 0;
  return head;
}

lnk_dblist insrtGHash_auxList(lnk_dblist head, Game *game)
{
  lnk_dblist ptr_aux = (lnk_dblist) malloc(sizeof(struct db_listnode));
  lnk_dblist ptr_endlist;
  ptr_aux->pgame = game;
  ptr_aux->next = 0;
  if (head == 0)
  {
    head = ptr_aux;
    head->previous = head;
    return head;
  }
  else
  {
    ptr_endlist = head->previous;
    ptr_endlist->next = ptr_aux;
    ptr_aux->previous = ptr_endlist;
    head->previous = ptr_aux;
    return head;
  }

}

lnk_dblist removGHash_auxList(lnk_dblist head, Game *game)
{
  lnk_dblist ptr_aux;
  lnk_dblist ptr_aux2;
  for (ptr_aux = head; ptr_aux != 0; ptr_aux = ptr_aux->next)
  {
    if (ptr_aux->pgame == game)
    {
      if (ptr_aux == head)
      {
        if (head->next == 0)
        {
          free(ptr_aux);
          return 0;
        }
        else
        {
          ptr_aux2 = head->next;
          ptr_aux2->previous = head->previous;
          free(head);
          return ptr_aux2;
        }

      }
      else
      {
        ptr_aux->previous->next = ptr_aux->next;
        if (ptr_aux->next == 0)
        {
          head->previous = ptr_aux->previous;
        }
        else
        {
          ptr_aux->next->previous = ptr_aux->previous;
        }

        free(ptr_aux);
        return head;
      }

    }
    else
    {
      
    }

  }

  return head;
}

void destroyAux_List(lnk_dblist head)
{
  lnk_dblist p_node = head;
  lnk_dblist p_previous;
  while (p_node != 0)
  {
    p_previous = p_node;
    p_node = p_node->next;
    free(p_previous);
  }

}

