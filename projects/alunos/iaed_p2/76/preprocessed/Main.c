#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "Equipas.h"
#include "Jogos.h"
#include "Misc.h"


equipa **adiciona_equipa(int cont_linhas, equipa **h_equipas, int *tam_h_equipas, int *cont_equipas)
{
  char nome[1024];
  equipa *nova_equipa;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  if (procura_equipa_h(nome, h_equipas, *tam_h_equipas))
  {
    printf("%d Equipa existente.\n", cont_linhas);
    return h_equipas;
  }
  else
  {
    
  }

  (*cont_equipas)++;
  nova_equipa = cria_equipa(nome);
  h_equipas = insere_equipa_h(h_equipas, nova_equipa, cont_equipas, tam_h_equipas);
  return h_equipas;
}

void procura_equipa(int cont_linhas, equipa **h_equipas, int tam_h_equipas)
{
  char nome[1024];
  equipa *equipa;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  if (equipa = procura_equipa_h(nome, h_equipas, tam_h_equipas))
  {
    printf("%d %s %d\n", cont_linhas, equipa->nome, equipa->vitorias);
    return;
  }
  else
  {
    
  }

  printf("%d Equipa inexistente.\n", cont_linhas);
}

void encontra_melhores_equipas(int cont_linhas, equipa **h_equipas, int tam_h_equipas, int cont_equipas)
{
  if (cont_equipas)
  {
    int max = -1;
    int num_max = 0;
    int i;
    int j = 0;
    int k;
    int l;
    char **melhores_equipas;
    for (i = 0; i < tam_h_equipas; i++)
    {
      if (h_equipas[i])
      {
        if (h_equipas[i]->vitorias > max)
        {
          max = h_equipas[i]->vitorias;
          num_max = 1;
        }
        else
        {
          if (h_equipas[i]->vitorias == max)
          {
            num_max++;
          }
          else
          {
            
          }

        }

      }
      else
      {
        
      }

    }

    melhores_equipas = (char **) malloc((sizeof(char *)) * num_max);
    for (k = 0; k < tam_h_equipas; k++)
      if (h_equipas[k] && (h_equipas[k]->vitorias == max))
    {
      melhores_equipas[j++] = h_equipas[k]->nome;
    }
    else
    {
      
    }


    qsort(melhores_equipas, num_max, sizeof(char *), comparador);
    printf("%d Melhores %d\n", cont_linhas, max);
    for (l = 0; l < j; l++)
    {
      printf("%d * %s\n", cont_linhas, melhores_equipas[l]);
    }

    free(melhores_equipas);
  }
  else
  {
    
  }

}

jogo **adiciona_jogo(int cont_linhas, jogo **h_jogos, lista_jogos *lst_jogos, int *tam_h_jogos, int *cont_jogos, equipa **h_equipas, int *tam_h_equipas)
{
  char nome_jogo[1024];
  char nome_casa[1024];
  char nome_fora[1024];
  equipa *eq_casa;
  equipa *eq_fora;
  int golos_casa;
  int golos_fora;
  jogo *novo_jogo;
  for (int nome_jogo_index = 0; nome_jogo_index < 10; nome_jogo_index++)
  {
    nome_jogo[nome_jogo_index] = new_sym_var(sizeof(char) * 8);
  }

  nome_jogo[10 - 1] = '\0';
  for (int nome_casa_index = 0; nome_casa_index < 10; nome_casa_index++)
  {
    nome_casa[nome_casa_index] = new_sym_var(sizeof(char) * 8);
  }

  nome_casa[10 - 1] = '\0';
  for (int nome_fora_index = 0; nome_fora_index < 10; nome_fora_index++)
  {
    nome_fora[nome_fora_index] = new_sym_var(sizeof(char) * 8);
  }

  nome_fora[10 - 1] = '\0';
  golos_casa = new_sym_var(sizeof(int) * 8);
  golos_fora = new_sym_var(sizeof(int) * 8);
  if (procura_jogo_h(nome_jogo, h_jogos, *tam_h_jogos))
  {
    printf("%d Jogo existente.\n", cont_linhas);
    return h_jogos;
  }
  else
  {
    
  }

  if (!((eq_casa = procura_equipa_h(nome_casa, h_equipas, *tam_h_equipas)) && (eq_fora = procura_equipa_h(nome_fora, h_equipas, *tam_h_equipas))))
  {
    printf("%d Equipa inexistente.\n", cont_linhas);
    return h_jogos;
  }
  else
  {
    
  }

  (*cont_jogos)++;
  novo_jogo = cria_jogo(nome_jogo, eq_casa, eq_fora, golos_casa, golos_fora);
  insere_fim_jogo(lst_jogos, novo_jogo);
  h_jogos = insere_jogo_h(h_jogos, novo_jogo, cont_jogos, tam_h_jogos);
  return h_jogos;
}

void procura_jogo(int cont_linhas, jogo **h_jogos, int tam_h_jogos)
{
  char nome[1024];
  jogo *jogo;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  if (jogo = procura_jogo_h(nome, h_jogos, tam_h_jogos))
  {
    printf("%d %s %s %s %d %d\n", cont_linhas, jogo->nome, jogo->eq_casa->nome, jogo->eq_fora->nome, jogo->golos_casa, jogo->golos_fora);
    return;
  }
  else
  {
    
  }

  printf("%d Jogo inexistente.\n", cont_linhas);
}

jogo **remove_jogo(int cont_linhas, jogo **h_jogos, lista_jogos *lst_jogos, int *tam_h_jogos, int *cont_jogos)
{
  char nome[1024];
  int i;
  int j;
  jogo *aux;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  i = hash(nome, *tam_h_jogos);
  for (; h_jogos[i]; i = (i + 1) % (*tam_h_jogos))
    if (!strcmp(h_jogos[i]->nome, nome))
  {
    repor_score(h_jogos[i]->eq_casa, h_jogos[i]->eq_fora, h_jogos[i]->golos_casa, h_jogos[i]->golos_fora);
    remove_jogo_lst(lst_jogos, nome);
    free(h_jogos[i]->nome);
    free(h_jogos[i]);
    h_jogos[i] = 0;
    (*cont_jogos)--;
    for (j = (i + 1) % (*tam_h_jogos); h_jogos[j]; j = (j + 1) % (*tam_h_jogos))
    {
      (*cont_jogos)--;
      aux = h_jogos[j];
      h_jogos[j] = 0;
      h_jogos = insere_jogo_h(h_jogos, aux, cont_jogos, tam_h_jogos);
    }

    return h_jogos;
  }
  else
  {
    
  }


  printf("%d Jogo inexistente.\n", cont_linhas);
  return h_jogos;
}

void altera_score(int cont_linhas, jogo **h_jogos, int tam_h_jogos)
{
  char nome[1024];
  int novos_golos_casa;
  int novos_golos_fora;
  jogo *jogo;
  for (int nome_index = 0; nome_index < 10; nome_index++)
  {
    nome[nome_index] = new_sym_var(sizeof(char) * 8);
  }

  nome[10 - 1] = '\0';
  novos_golos_casa = new_sym_var(sizeof(int) * 8);
  novos_golos_fora = new_sym_var(sizeof(int) * 8);
  if (!(jogo = procura_jogo_h(nome, h_jogos, tam_h_jogos)))
  {
    printf("%d Jogo inexistente.\n", cont_linhas);
  }
  else
  {
    repor_score(jogo->eq_casa, jogo->eq_fora, jogo->golos_casa, jogo->golos_fora);
    jogo->golos_casa = novos_golos_casa;
    jogo->golos_fora = novos_golos_fora;
    atribui_vitoria(jogo->eq_casa, jogo->eq_fora, jogo->golos_casa, jogo->golos_fora);
  }

}

void listar_jogos(int cont_linhas, lista_jogos *lst_jogos)
{
  node_jogo *aux = lst_jogos->inicio;
  while (aux)
  {
    if (aux->jogo)
    {
      printf("%d %s %s %s %d %d\n", cont_linhas, aux->jogo->nome, aux->jogo->eq_casa->nome, aux->jogo->eq_fora->nome, aux->jogo->golos_casa, aux->jogo->golos_fora);
    }
    else
    {
      
    }

    aux = aux->prox;
  }

}

int main()
{
  int cont_linhas = 0;
  int cont_equipas = 0;
  int cont_jogos = 0;
  int tam_h_equipas = 101;
  int tam_h_jogos = 101;
  equipa **h_equipas = (equipa **) calloc(tam_h_equipas, sizeof(equipa *));
  jogo **h_jogos = (jogo **) calloc(tam_h_jogos, sizeof(jogo));
  lista_jogos *lst_jogos = cria_lst_jogos();
  char comm;
  while ((comm = getchar()) != 'x')
  {
    switch (comm)
    {
      case 'a':
        h_jogos = adiciona_jogo(++cont_linhas, h_jogos, lst_jogos, &tam_h_jogos, &cont_jogos, h_equipas, &tam_h_equipas);
        break;

      case 'A':
        h_equipas = adiciona_equipa(++cont_linhas, h_equipas, &tam_h_equipas, &cont_equipas);
        break;

      case 'l':
        listar_jogos(++cont_linhas, lst_jogos);
        break;

      case 'p':
        procura_jogo(++cont_linhas, h_jogos, tam_h_jogos);
        break;

      case 'P':
        procura_equipa(++cont_linhas, h_equipas, tam_h_equipas);
        break;

      case 'r':
        h_jogos = remove_jogo(++cont_linhas, h_jogos, lst_jogos, &tam_h_jogos, &cont_jogos);
        break;

      case 's':
        altera_score(++cont_linhas, h_jogos, tam_h_jogos);
        break;

      case 'g':
        encontra_melhores_equipas(++cont_linhas, h_equipas, tam_h_equipas, cont_equipas);
        break;

    }

  }

  destroi_h_jogos(h_jogos, tam_h_jogos);
  destroi_lst_jogos(lst_jogos);
  destroi_h_equipas(h_equipas, tam_h_equipas);
  return 0;
}

