#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "myLib.h"
#include "competition.h"
#include "game.h"


Competition *comp_new(char *name)
{
  extern char *strdup(const char *);
  Competition *competition = (Competition *) malloc(sizeof(Competition));
  if (errno > 0)
  {
    perror("comp_new: create_competition");
    exit(errno);
  }
  else
  {
    
  }

  ;
  competition->name = strdup(name);
  competition->count = 0;
  competition->first = 0;
  competition->last = 0;
  return competition;
}

Comp_node *comp_new_node(Game *g)
{
  Comp_node *cn = (Comp_node *) malloc(sizeof(Comp_node));
  if (errno > 0)
  {
    perror("comp_new_node: malloc");
    exit(errno);
  }
  else
  {
    
  }

  ;
  cn->game = g;
  return cn;
}

void comp_node_free(Comp_node *cn)
{
  if (cn == 0)
  {
    printf("%s: null pointer\n", "comp_node_free");
    exit(1);
  }
  else
  {
    
  }

  ;
  game_free(cn->game);
  free(cn);
}

void competition_free(Competition *c)
{
  Comp_node *cn;
  if (c == 0)
  {
    printf("%s: null pointer\n", "competition_free");
    exit(1);
  }
  else
  {
    
  }

  ;
  free(c->name);
  cn = c->first;
  while (cn != 0)
  {
    Comp_node *next = cn->next;
    comp_node_free(cn);
    cn = next;
  }

  free(c);
}

void comp_add_game(Competition *c, Game *g)
{
  Comp_node *cn;
  if (c == 0)
  {
    printf("%s: null pointer\n", "comp_add_game");
    exit(1);
  }
  else
  {
    
  }

  ;
  cn = comp_new_node(g);
  cn->next = 0;
  cn->previous = c->last;
  c->last = cn;
  if (c->count == 0)
  {
    c->first = cn;
  }
  else
  {
    
  }

  c->count++;
}

Comp_node *_comp_find_game(Competition *c, char *game_name)
{
  Comp_node *cn;
  if (c == 0)
  {
    printf("%s: null pointer\n", "_comp_find_game");
    exit(1);
  }
  else
  {
    
  }

  ;
  cn = c->first;
  while (cn != 0)
  {
    if (strcmp(game_get_name(cn->game), game_name) == 0)
    {
      return cn;
    }
    else
    {
      
    }

    cn = cn->next;
  }

  return 0;
}

Game *comp_find_game(Competition *c, char *game_name)
{
  Comp_node *cn;
  cn = _comp_find_game(c, game_name);
  if (cn == 0)
  {
    return 0;
  }
  else
  {
    return cn->game;
  }

}

int comp_remove_game(Competition *c, char *game_name)
{
  Comp_node *cn;
  if (c == 0)
  {
    printf("%s: null pointer\n", "competition_remove_game");
    exit(1);
  }
  else
  {
    
  }

  ;
  cn = _comp_find_game(c, game_name);
  if (cn == 0)
  {
    return -1;
  }
  else
  {
    
  }

  c->count--;
  if (cn->previous == 0)
  {
    c->first = cn->next;
  }
  else
  {
    
  }

  if (cn->next == 0)
  {
    c->last = cn->previous;
  }
  else
  {
    
  }

  if (cn->previous != 0)
  {
    cn->previous->next = cn->next;
  }
  else
  {
    
  }

  comp_node_free(cn);
  return 0;
}

Game *comp_set_score(Competition *c, char *game_name, int s1, int s2)
{
  Comp_node *cn;
  if (c == 0)
  {
    printf("%s: null pointer\n", "comp_set_score");
    exit(1);
  }
  else
  {
    
  }

  ;
  cn = _comp_find_game(c, game_name);
  if (cn == 0)
  {
    return 0;
  }
  else
  {
    game_set_score(cn->game, s1, s2);
    return cn->game;
  }

}

int comp_get_victories(Competition *c, char *team_name)
{
  Comp_node *cn;
  int victories = 0;
  Team *team;
  if (c == 0)
  {
    printf("%s: null pointer\n", "comp_get_victories");
    exit(1);
  }
  else
  {
    
  }

  ;
  cn = c->first;
  while (cn != 0)
  {
    team = game_get_team(cn->game, team_name);
    if ((team != 0) && (game_get_winner(cn->game) == team))
    {
      victories++;
    }
    else
    {
      
    }

    cn = cn->next;
  }

  return victories;
}

void competition_print(Competition *c)
{
  char first_game[100];
  char last_game[100];
  if (c == 0)
  {
    printf("%s: null pointer\n", "competition_print");
    exit(1);
  }
  else
  {
    
  }

  ;
  if (c->first != 0)
  {
    strcpy(first_game, c->first->game->name);
  }
  else
  {
    strcpy(first_game, "NULL");
  }

  if (c->last != 0)
  {
    strcpy(last_game, c->last->game->name);
  }
  else
  {
    strcpy(last_game, "NULL");
  }

  printf("COMP: %s, %d, %s, %s\n", c->name, c->count, first_game, last_game);
}

void comp_print_games(Competition *c, int nl)
{
  Comp_node *cn;
  char buf[(1023 + (2 * 1023)) + 10];
  if (c == 0)
  {
    printf("%s: null pointer\n", "competition_print");
    exit(1);
  }
  else
  {
    
  }

  ;
  cn = c->first;
  while (cn != 0)
  {
    printf("%d %s\n", nl, game_to_string(cn->game, buf));
    cn = cn->next;
  }

}

