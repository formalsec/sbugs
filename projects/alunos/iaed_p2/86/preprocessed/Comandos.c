/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "Projeto2.h"


int scanCommand(int *nrCommand, teamLink *hashTeamTable, gameLink *headGame, gameLink *hashGameTable, gameLink *tailGame)
{
  char c;
  c = getchar();
  switch (c)
  {
    case 'a':
      (*nrCommand)++;
      newGame(nrCommand, hashTeamTable, headGame, hashGameTable, tailGame);
      break;

    case 'A':
      (*nrCommand)++;
      newTeam(nrCommand, hashTeamTable);
      break;

    case 'l':
      (*nrCommand)++;
      listGames(nrCommand, headGame);
      break;

    case 'p':
      (*nrCommand)++;
      searchGameByName(nrCommand, hashGameTable);
      break;

    case 'P':
      (*nrCommand)++;
      searchTeamByName(nrCommand, hashTeamTable);
      break;

    case 'r':
      (*nrCommand)++;
      deleteGameByName(nrCommand, hashGameTable, headGame);
      break;

    case 's':
      (*nrCommand)++;
      changeScore(nrCommand, hashGameTable);
      break;

    case 'g':
      (*nrCommand)++;
      bestTeams(nrCommand, hashTeamTable);
      break;

    case 'x':
      return 0;

  }

  return 1;
}

void newTeam(int *nrCommand, teamLink *hashTeamTable)
{
  char buffer[1024];
  for (int buffer_index = 0; buffer_index < 10; buffer_index++)
  {
    buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer[10 - 1] = '\0';
  if (searchTeamHash(hashTeamTable, buffer) == 0)
  {
    insertTeamHash(hashTeamTable, buffer);
  }
  else
  {
    printf("%d Equipa existente.\n", *nrCommand);
  }

}

void newGame(int *nrCommand, teamLink *hashTeamTable, gameLink *headGame, gameLink *hashGameTable, gameLink *tailGame)
{
  int score1;
  int score2;
  char team1Name[1024];
  char team2Name[1024];
  char gameName[1024];
  teamLink team1;
  teamLink team2;
  Game *newGame;
  for (int gameName_index = 0; gameName_index < 10; gameName_index++)
  {
    gameName[gameName_index] = new_sym_var(sizeof(char) * 8);
  }

  gameName[10 - 1] = '\0';
  for (int team1Name_index = 0; team1Name_index < 10; team1Name_index++)
  {
    team1Name[team1Name_index] = new_sym_var(sizeof(char) * 8);
  }

  team1Name[10 - 1] = '\0';
  for (int team2Name_index = 0; team2Name_index < 10; team2Name_index++)
  {
    team2Name[team2Name_index] = new_sym_var(sizeof(char) * 8);
  }

  team2Name[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  if (searchGameHash(hashGameTable, gameName) != 0)
  {
    printf("%d Jogo existente.\n", *nrCommand);
    return;
  }
  else
  {
    
  }

  team1 = searchTeamHash(hashTeamTable, team1Name);
  if (team1 == 0)
  {
    printf("%d Equipa inexistente.\n", *nrCommand);
    return;
  }
  else
  {
    
  }

  team2 = searchTeamHash(hashTeamTable, team2Name);
  if (team2 == 0)
  {
    printf("%d Equipa inexistente.\n", *nrCommand);
    return;
  }
  else
  {
    
  }

  newGame = createGame(gameName, team1, team2, score1, score2);
  insertGameEnd(headGame, newGame, tailGame);
  insertGameHash(hashGameTable, newGame);
  if (score1 > score2)
  {
    team1->gamesWon++;
  }
  else
  {
    if (score2 > score1)
    {
      team2->gamesWon++;
    }
    else
    {
      
    }

  }

}

void listGames(int *nrCommand, gameLink *headGame)
{
  gameLink t;
  Game *game;
  for (t = *headGame; t != 0; t = t->next)
  {
    if (!t->deleted)
    {
      game = t->game;
      printf("%d %s %s %s %d %d\n", *nrCommand, game->name, game->team1->name, game->team2->name, *game->score, *(game->score + 1));
    }
    else
    {
      
    }

  }

}

void searchGameByName(int *nrCommand, gameLink *hashGameTable)
{
  char name[1024];
  gameLink gameLink;
  Game *game;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  gameLink = searchGameHash(hashGameTable, name);
  if (gameLink == 0)
  {
    printf("%d Jogo inexistente.\n", *nrCommand);
  }
  else
  {
    game = gameLink->game;
    printf("%d %s %s %s %d %d\n", *nrCommand, game->name, game->team1->name, game->team2->name, game->score[0], game->score[1]);
  }

}

void searchTeamByName(int *nrCommand, teamLink *hashTeamTable)
{
  char name[1024];
  teamLink team;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  team = searchTeamHash(hashTeamTable, name);
  if (team == 0)
  {
    printf("%d Equipa inexistente.\n", *nrCommand);
  }
  else
  {
    printf("%d %s %d\n", *nrCommand, team->name, team->gamesWon);
  }

}

void deleteGameByName(int *nrCommand, gameLink *hashGameTable, gameLink *headGame)
{
  char name[1024];
  gameLink gameLink_;
  gameLink gameLinkList;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  gameLink_ = searchGameHash(hashGameTable, name);
  if (gameLink_ == 0)
  {
    printf("%d Jogo inexistente.\n", *nrCommand);
  }
  else
  {
    if (gameLink_->game->score[0] > gameLink_->game->score[1])
    {
      gameLink_->game->team1->gamesWon--;
    }
    else
    {
      if (gameLink_->game->score[0] < gameLink_->game->score[1])
      {
        gameLink_->game->team2->gamesWon--;
      }
      else
      {
        
      }

    }

    gameLinkList = searchGame(*headGame, name);
    gameLinkList->deleted = 1;
    deleteGameHash(hashGameTable, name);
  }

}

void changeScore(int *nrCommand, gameLink *hashGameTable)
{
  char name[1024];
  gameLink gameLink;
  Game *game;
  int score1;
  int score2;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  gameLink = searchGameHash(hashGameTable, name);
  if (gameLink == 0)
  {
    printf("%d Jogo inexistente.\n", *nrCommand);
  }
  else
  {
    game = gameLink->game;
    if (game->score[0] > game->score[1])
    {
      game->team1->gamesWon--;
    }
    else
    {
      if (game->score[0] < game->score[1])
      {
        game->team2->gamesWon--;
      }
      else
      {
        
      }

    }

    game->score[0] = score1;
    game->score[1] = score2;
    if (game->score[0] > game->score[1])
    {
      game->team1->gamesWon++;
    }
    else
    {
      if (score2 > score1)
      {
        game->team2->gamesWon++;
      }
      else
      {
        
      }

    }

  }

}

void bestTeams(int *nrCommand, teamLink *hashTeamTable)
{
  int i;
  int max;
  int teamNr;
  int index;
  teamLink t;
  char **bestOnes;
  max = 0;
  teamNr = 0;
  for (i = 0; i < 2131; i++)
  {
    for (t = hashTeamTable[i]; t != 0; t = t->next)
    {
      if (max < t->gamesWon)
      {
        teamNr = 0;
        max = t->gamesWon;
      }
      else
      {
        
      }

      if (max == t->gamesWon)
      {
        teamNr++;
      }
      else
      {
        
      }

    }

  }

  if (teamNr > 0)
  {
    index = 0;
    bestOnes = (char **) malloc((sizeof(char *)) * teamNr);
    for (i = 0; i < 2131; i++)
    {
      for (t = hashTeamTable[i]; t != 0; t = t->next)
      {
        if (t->gamesWon == max)
        {
          bestOnes[index] = t->name;
          index++;
        }
        else
        {
          
        }

      }

    }

    qsort(bestOnes, teamNr, sizeof(char *), compare);
    printf("%d Melhores %d\n", *nrCommand, max);
    for (i = 0; i < teamNr; i++)
    {
      printf("%d * %s\n", *nrCommand, bestOnes[i]);
    }

    free(bestOnes);
  }
  else
  {
    
  }

}

int compare(const void *a, const void *b)
{
  const char **pa;
  const char **pb;
  pa = (const char **) a;
  pb = (const char **) b;
  return strcmp(*pa, *pb);
}

