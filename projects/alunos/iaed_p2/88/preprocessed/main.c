#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "equipa.h"
#include "jogo.h"
#include "tab_equipas.h"
#include "tab_jogos.h"


void adiciona_jogo(tab_disp tab_jogos, tab_disp tab_equipas, jogo *j_1, jogo *j_ult, int n_linha);
void lista_jogos(jogo j_1, int n_linha);
void procura_jogo_nome(tab_disp tab_jogos, int n_linha);
void retira_jogo(tab_disp tab_jogos, jogo *j_1, jogo *j_ult, int n_linha);
void altera_score(tab_disp tab_jogos, int n_linha);
void adiciona_equipa(tab_disp tab_jogos, int n_linha);
void procura_equipa_nome(tab_disp tab_jogos, int n_linha);
int mudanca_vitorias(int dif_antes, int dif_depois);
int main()
{
  char comando;
  int n_linha = 1;
  jogo jogo_1 = 0;
  jogo jogo_ult = 0;
  tab_disp tab_equipas;
  tab_disp tab_jogos;
  tab_equipas = nova_tab(2027);
  tab_jogos = nova_tab(2999);
  while ((comando = getchar()) != 'x')
  {
    switch (comando)
    {
      case 'a':
        adiciona_jogo(tab_jogos, tab_equipas, &jogo_1, &jogo_ult, n_linha);
        n_linha++;
        break;

      case 'l':
        lista_jogos(jogo_1, n_linha);
        n_linha++;
        break;

      case 'p':
        procura_jogo_nome(tab_jogos, n_linha);
        n_linha++;
        break;

      case 'r':
        retira_jogo(tab_jogos, &jogo_1, &jogo_ult, n_linha);
        n_linha++;
        break;

      case 's':
        altera_score(tab_jogos, n_linha);
        n_linha++;
        break;

      case 'A':
        adiciona_equipa(tab_equipas, n_linha);
        n_linha++;
        break;

      case 'P':
        procura_equipa_nome(tab_equipas, n_linha);
        n_linha++;
        break;

      case 'g':
        mostra_equipas_max(tab_equipas, n_linha);
        n_linha++;
        break;

    }

  }

  liberta_tab_jogos(tab_jogos);
  liberta_tab_equipas(tab_equipas);
  return 0;
}

void adiciona_jogo(tab_disp tab_jogos, tab_disp tab_equipas, jogo *j_1, jogo *j_ult, int n_linha)
{
  char buf_nome[1024];
  char buf_e1[1024];
  char buf_e2[1024];
  int score_e1;
  int score_e2;
  equipa e1 = 0;
  equipa e2 = 0;
  for (int buf_nome_index = 0; buf_nome_index < 10; buf_nome_index++)
  {
    buf_nome[buf_nome_index] = new_sym_var(sizeof(char) * 8);
  }

  buf_nome[10 - 1] = '\0';
  for (int buf_e1_index = 0; buf_e1_index < 10; buf_e1_index++)
  {
    buf_e1[buf_e1_index] = new_sym_var(sizeof(char) * 8);
  }

  buf_e1[10 - 1] = '\0';
  for (int buf_e2_index = 0; buf_e2_index < 10; buf_e2_index++)
  {
    buf_e2[buf_e2_index] = new_sym_var(sizeof(char) * 8);
  }

  buf_e2[10 - 1] = '\0';
  score_e1 = new_sym_var(sizeof(int) * 8);
  score_e2 = new_sym_var(sizeof(int) * 8);
  if (procura_tab_jogo(tab_jogos, buf_nome) != 0)
  {
    printf("%d Jogo existente.\n", n_linha);
    return;
  }
  else
  {
    
  }

  if (((e1 = procura_tab_equipa(tab_equipas, buf_e1)) == 0) || ((e2 = procura_tab_equipa(tab_equipas, buf_e2)) == 0))
  {
    printf("%d Equipa inexistente.\n", n_linha);
    return;
  }
  else
  {
    
  }

  *j_ult = novo_jogo(buf_nome, e1, e2, score_e1, score_e2, *j_ult);
  insere_tab_jogo(tab_jogos, *j_ult);
  if ((*j_1) == 0)
  {
    *j_1 = *j_ult;
  }
  else
  {
    
  }

  if (score_e1 > score_e2)
  {
    e1->vitorias++;
  }
  else
  {
    if (score_e1 < score_e2)
    {
      e2->vitorias++;
    }
    else
    {
      
    }

  }

  return;
}

void adiciona_equipa(tab_disp tab_equipas, int n_linha)
{
  char buf[1024];
  equipa equipa_aux;
  for (int buf_index = 0; buf_index < 10; buf_index++)
  {
    buf[buf_index] = new_sym_var(sizeof(char) * 8);
  }

  buf[10 - 1] = '\0';
  if (procura_tab_equipa(tab_equipas, buf) != 0)
  {
    printf("%d Equipa existente.\n", n_linha);
    return;
  }
  else
  {
    
  }

  equipa_aux = nova_equipa(buf, 0);
  insere_tab_equipa(tab_equipas, equipa_aux);
  return;
}

void lista_jogos(jogo jogo_1, int n_linha)
{
  jogo j_aux = jogo_1;
  while (j_aux != 0)
  {
    printf("%d %s %s %s %d %d\n", n_linha, j_aux->nome, j_aux->e1->nome, j_aux->e2->nome, j_aux->score_e1, j_aux->score_e2);
    j_aux = j_aux->prox;
  }

  return;
}

void procura_jogo_nome(tab_disp tab_jogos, int n_linha)
{
  char buf[1024];
  jogo j_aux;
  for (int buf_index = 0; buf_index < 10; buf_index++)
  {
    buf[buf_index] = new_sym_var(sizeof(char) * 8);
  }

  buf[10 - 1] = '\0';
  if ((j_aux = procura_tab_jogo(tab_jogos, buf)) == 0)
  {
    printf("%d Jogo inexistente.\n", n_linha);
    return;
  }
  else
  {
    
  }

  printf("%d %s %s %s %d %d\n", n_linha, j_aux->nome, j_aux->e1->nome, j_aux->e2->nome, j_aux->score_e1, j_aux->score_e2);
  return;
}

void retira_jogo(tab_disp tab_jogos, jogo *j_1, jogo *j_ult, int n_linha)
{
  char buf[1024];
  jogo j_aux;
  for (int buf_index = 0; buf_index < 10; buf_index++)
  {
    buf[buf_index] = new_sym_var(sizeof(char) * 8);
  }

  buf[10 - 1] = '\0';
  if ((j_aux = procura_tab_jogo(tab_jogos, buf)) == 0)
  {
    printf("%d Jogo inexistente.\n", n_linha);
    return;
  }
  else
  {
    
  }

  if (j_aux->score_e1 > j_aux->score_e2)
  {
    j_aux->e1->vitorias--;
  }
  else
  {
    if (j_aux->score_e2 > j_aux->score_e1)
    {
      j_aux->e2->vitorias--;
    }
    else
    {
      
    }

  }

  if (strcmp((*j_1)->nome, buf) == 0)
  {
    *j_1 = (*j_1)->prox;
    if ((*j_1) == 0)
    {
      *j_ult = *j_1;
    }
    else
    {
      
    }

  }
  else
  {
    if (strcmp((*j_ult)->nome, buf) == 0)
    {
      *j_ult = (*j_ult)->ant;
    }
    else
    {
      
    }

  }

  retira_tab_jogo(tab_jogos, buf);
  return;
}

void altera_score(tab_disp tab_jogos, int n_linha)
{
  char buf[1024];
  int score_e1;
  int score_e2;
  jogo jogo_aux;
  int dif_antes;
  int dif_depois;
  for (int buf_index = 0; buf_index < 10; buf_index++)
  {
    buf[buf_index] = new_sym_var(sizeof(char) * 8);
  }

  buf[10 - 1] = '\0';
  score_e1 = new_sym_var(sizeof(int) * 8);
  score_e2 = new_sym_var(sizeof(int) * 8);
  if ((jogo_aux = procura_tab_jogo(tab_jogos, buf)) == 0)
  {
    printf("%d Jogo inexistente.\n", n_linha);
    return;
  }
  else
  {
    
  }

  dif_antes = jogo_aux->score_e1 - jogo_aux->score_e2;
  dif_depois = score_e1 - score_e2;
  if ((dif_antes * dif_depois) <= 0)
  {
    jogo_aux->e1->vitorias += mudanca_vitorias(dif_antes, dif_depois);
    jogo_aux->e2->vitorias += mudanca_vitorias((-1) * dif_antes, (-1) * dif_depois);
  }
  else
  {
    
  }

  jogo_aux->score_e1 = score_e1;
  jogo_aux->score_e2 = score_e2;
  return;
}

int mudanca_vitorias(int dif_antes, int dif_depois)
{
  if (dif_depois > 0)
  {
    return 1;
  }
  else
  {
    
  }

  if (dif_antes > 0)
  {
    return -1;
  }
  else
  {
    return 0;
  }

}

void procura_equipa_nome(tab_disp tab_equipas, int n_linha)
{
  char buffer[1024];
  equipa equipa_aux;
  for (int buffer_index = 0; buffer_index < 10; buffer_index++)
  {
    buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
  }

  buffer[10 - 1] = '\0';
  if ((equipa_aux = procura_tab_equipa(tab_equipas, buffer)) == 0)
  {
    printf("%d Equipa inexistente.\n", n_linha);
    return;
  }
  else
  {
    
  }

  printf("%d %s %d\n", n_linha, equipa_aux->nome, equipa_aux->vitorias);
  return;
}

