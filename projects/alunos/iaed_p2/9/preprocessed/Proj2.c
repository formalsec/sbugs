#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include <stdlib.h>
#include <stdio.h>
#include <string.h>


typedef struct equipa
{
  char *nome;
  int nJogos;
} Equipa;
typedef struct score
{
  int n1;
  int n2;
} Score;
typedef struct jogo
{
  char *nome;
  Equipa *equipa1;
  Equipa *equipa2;
  Score *resultado;
} Jogo;
typedef struct no
{
  void *info;
  struct no *Prox;
} NO;
typedef struct no No;
typedef struct Lista
{
  NO *Inicio;
  int NEL;
} Lista;
char *corrigeString(char *c)
{
  char *string = (char *) malloc((sizeof(char)) * (strlen(c) + 1));
  strcpy(string, c);
  return string;
}

NO *criarNo(void *info)
{
  NO *P = (NO *) malloc(sizeof(NO));
  P->Prox = 0;
  P->info = info;
  return P;
}

Lista *criarLista()
{
  Lista *L = (Lista *) malloc(sizeof(Lista));
  L->Inicio = 0;
  L->NEL = 0;
  return L;
}

void inserirNoFimDaLista(Lista *L, void *info)
{
  NO *P;
  NO *aux;
  if (!L)
  {
    return;
  }
  else
  {
    
  }

  P = criarNo(info);
  if (!L->Inicio)
  {
    L->Inicio = P;
    return;
  }
  else
  {
    
  }

  aux = L->Inicio;
  while (aux->Prox)
  {
    aux = aux->Prox;
  }

  aux->Prox = P;
}

Score *criarScore(int n1, int n2)
{
  Score *Res = (Score *) malloc(sizeof(Score));
  Res->n1 = n1;
  Res->n2 = n2;
  return Res;
}

Equipa *criarEquipa(char *nome)
{
  Equipa *E = (Equipa *) malloc(sizeof(Equipa));
  E->nome = nome;
  E->nJogos = 0;
  return E;
}

Jogo *criarJogo(char *nome, Equipa *equipa1, Equipa *equipa2, Score *resultado)
{
  Jogo *J = (Jogo *) malloc(sizeof(Jogo));
  J->equipa1 = equipa1;
  J->equipa2 = equipa2;
  J->nome = corrigeString(nome);
  J->resultado = resultado;
  return J;
}

void mostrarScore(void *P)
{
  Score *S = (Score *) P;
  printf("%d %d", S->n1, S->n2);
}

void mostrarEquipa(void *P, int NL)
{
  Equipa *E = (Equipa *) P;
  printf("%d %s %d", NL, E->nome, E->nJogos);
}

void mostrarJogo(void *P, int NL)
{
  Jogo *J = (Jogo *) P;
  printf("%d %s %s %s %d %d ", NL, J->nome, J->equipa1->nome, J->equipa2->nome, J->resultado->n1, J->resultado->n2);
}

void mostrarLista(Lista *L, void (*func)(void *, int), int NL)
{
  NO *P;
  if (!L)
  {
    return;
  }
  else
  {
    
  }

  P = L->Inicio;
  while (P)
  {
    (*func)(P->info, NL);
    printf("\n");
    P = P->Prox;
  }

}

Equipa *procurarEquipa(Lista *L, char *nome)
{
  Equipa *equipa1;
  No *aux;
  if (!L)
  {
    return 0;
  }
  else
  {
    
  }

  if (!L->Inicio)
  {
    return 0;
  }
  else
  {
    
  }

  aux = L->Inicio;
  while (aux)
  {
    equipa1 = (Equipa *) aux->info;
    if (strcmp(equipa1->nome, nome) == 0)
    {
      return equipa1;
    }
    else
    {
      
    }

    aux = aux->Prox;
  }

  return 0;
}

int quemGanhou(Score *res)
{
  if (res->n1 > res->n2)
  {
    return 0;
  }
  else
  {
    
  }

  if (res->n2 > res->n1)
  {
    return 1;
  }
  else
  {
    return 2;
  }

}

Jogo *procurarJogo(Lista *L, char *nome)
{
  No *aux;
  Jogo *jogo1;
  if (!L)
  {
    return 0;
  }
  else
  {
    
  }

  if (!L->Inicio)
  {
    return 0;
  }
  else
  {
    
  }

  aux = L->Inicio;
  while (aux)
  {
    jogo1 = (Jogo *) aux->info;
    if (strcmp(jogo1->nome, nome) == 0)
    {
      return jogo1;
    }
    else
    {
      
    }

    aux = aux->Prox;
  }

  return 0;
}

void LibertaNoJogo(NO *P)
{
  Jogo *jogo1 = (Jogo *) P->info;
  free(jogo1->nome);
  free(jogo1->resultado);
  free(jogo1);
}

int equipaMaisJogosGanhos(Lista *L)
{
  No *P;
  Equipa *E;
  int maior;
  if (!L)
  {
    return -1;
  }
  else
  {
    
  }

  if (!L->Inicio)
  {
    return -1;
  }
  else
  {
    
  }

  maior = 0;
  P = L->Inicio;
  while (P)
  {
    E = (Equipa *) P->info;
    if (maior < E->nJogos)
    {
      maior = E->nJogos;
    }
    else
    {
      
    }

    P = P->Prox;
  }

  return maior;
}

void mostrarEquipaNJogosGanhos(Lista *L, int n, int NL)
{
  Equipa *E;
  No *P;
  if (!L)
  {
    return;
  }
  else
  {
    
  }

  if (!L->Inicio)
  {
    return;
  }
  else
  {
    
  }

  printf("%d Melhores %d\n", NL, n);
  P = L->Inicio;
  while (P)
  {
    E = (Equipa *) P->info;
    if (E->nJogos == n)
    {
      printf("%d * %s", NL, E->nome);
      printf("\n");
    }
    else
    {
      
    }

    P = P->Prox;
  }

}

void actualizarResultados(Lista *LJ, Lista *LE)
{
  Equipa *E;
  Jogo *J;
  No *P;
  int n;
  if (!LE)
  {
    return;
  }
  else
  {
    
  }

  if (!LE->Inicio)
  {
    return;
  }
  else
  {
    
  }

  if (!LJ)
  {
    return;
  }
  else
  {
    
  }

  if (!LJ->Inicio)
  {
    return;
  }
  else
  {
    
  }

  P = LE->Inicio;
  while (P)
  {
    E = (Equipa *) P->info;
    E->nJogos = 0;
    P = P->Prox;
  }

  P = LJ->Inicio;
  while (P)
  {
    J = (Jogo *) P->info;
    n = quemGanhou(J->resultado);
    if (n == 0)
    {
      J->equipa1->nJogos++;
    }
    else
    {
      if (n == 1)
      {
        J->equipa2->nJogos++;
      }
      else
      {
        
      }

    }

    P = P->Prox;
  }

}

void eliminarNoListaJogos(Lista *L, Jogo *J)
{
  No *P;
  No *Antes;
  Jogo *aux;
  if (!L)
  {
    return;
  }
  else
  {
    
  }

  if (!L->Inicio)
  {
    return;
  }
  else
  {
    
  }

  P = L->Inicio;
  Antes = P;
  aux = (Jogo *) P->info;
  if (strcmp(aux->nome, J->nome) == 0)
  {
    L->Inicio = P->Prox;
    LibertaNoJogo(P);
    free(P);
    return;
  }
  else
  {
    
  }

  while (P)
  {
    aux = (Jogo *) P->info;
    if (strcmp(aux->nome, J->nome) == 0)
    {
      break;
    }
    else
    {
      
    }

    Antes = P;
    P = P->Prox;
  }

  if (!P)
  {
    return;
  }
  else
  {
    
  }

  Antes->Prox = P->Prox;
  LibertaNoJogo(P);
  free(P);
}

int main()
{
  int score1;
  int score2;
  Score *res;
  Equipa *equipa1;
  Equipa *equipa2;
  Jogo *jogo1;
  int n;
  int NL = 0;
  char buffer[200];
  char *string;
  char *token;
  char *nome;
  Lista *Lista_Jogos = criarLista();
  Lista *Lista_Equipas = criarLista();
  do
  {
    actualizarResultados(Lista_Jogos, Lista_Equipas);
    for (int buffer_index = 0; buffer_index < 10; buffer_index++)
    {
      buffer[buffer_index] = new_sym_var(sizeof(char) * 8);
    }

    buffer[10 - 1] = '\0';
    string = corrigeString(buffer);
    if (string[0] == 'a')
    {
      token = strtok(string, " ");
      token = strtok(0, ":");
      nome = token;
      jogo1 = procurarJogo(Lista_Jogos, nome);
      if (jogo1)
      {
        printf("%d Jogo existente.", NL);
        NL++;
        continue;
      }
      else
      {
        
      }

      token = strtok(0, ":");
      equipa1 = procurarEquipa(Lista_Equipas, token);
      if (!equipa1)
      {
        printf("%d Equipa inexistente.\n", NL);
        continue;
      }
      else
      {
        
      }

      token = strtok(0, ":");
      equipa2 = procurarEquipa(Lista_Equipas, token);
      if (!equipa2)
      {
        printf("%d Equipa inexistente.\n", NL);
        continue;
      }
      else
      {
        
      }

      token = strtok(0, ":");
      score1 = atoi(token);
      token = strtok(0, ":");
      score2 = atoi(token);
      res = criarScore(score1, score2);
      jogo1 = criarJogo(nome, equipa1, equipa2, res);
      inserirNoFimDaLista(Lista_Jogos, jogo1);
    }
    else
    {
      
    }

    if (string[0] == 'l')
    {
      mostrarLista(Lista_Jogos, mostrarJogo, NL);
    }
    else
    {
      
    }

    if (string[0] == 'p')
    {
      token = strtok(string, " ");
      token = strtok(0, " ");
      jogo1 = procurarJogo(Lista_Jogos, token);
      if (!jogo1)
      {
        printf("%d Jogo inexistente.", NL);
        printf("\n");
        NL++;
        continue;
      }
      else
      {
        
      }

      mostrarJogo(jogo1, NL);
      printf("\n");
    }
    else
    {
      
    }

    if (string[0] == 'r')
    {
      token = strtok(string, " ");
      token = strtok(0, " ");
      nome = corrigeString(token);
      jogo1 = procurarJogo(Lista_Jogos, nome);
      if (!jogo1)
      {
        printf("%d Jogo inexistente.", NL);
        printf("\n");
        NL++;
        continue;
      }
      else
      {
        
      }

      eliminarNoListaJogos(Lista_Jogos, jogo1);
    }
    else
    {
      
    }

    if (string[0] == 's')
    {
      token = strtok(string, " ");
      token = strtok(0, ":");
      jogo1 = procurarJogo(Lista_Jogos, corrigeString(token));
      if (!jogo1)
      {
        printf("%d NL Jogo inexistente.", NL);
        NL++;
        continue;
      }
      else
      {
        
      }

      token = strtok(0, ":");
      jogo1->resultado->n1 = atoi(token);
      token = strtok(0, ":");
      jogo1->resultado->n2 = atoi(token);
    }
    else
    {
      
    }

    if (string[0] == 'A')
    {
      token = strtok(string, " ");
      token = strtok(0, " ");
      nome = corrigeString(token);
      equipa1 = procurarEquipa(Lista_Equipas, nome);
      if (equipa1)
      {
        printf("%d Equipa existente.", NL);
        NL++;
        continue;
      }
      else
      {
        
      }

      equipa1 = criarEquipa(nome);
      inserirNoFimDaLista(Lista_Equipas, equipa1);
    }
    else
    {
      
    }

    if (string[0] == 'P')
    {
      token = strtok(string, " ");
      token = strtok(0, " ");
      nome = corrigeString(token);
      equipa1 = procurarEquipa(Lista_Equipas, nome);
      if (!equipa1)
      {
        printf("%d Equipa inexistente.", NL);
        printf("\n");
        NL++;
        continue;
      }
      else
      {
        
      }

      printf("%d ", NL);
      mostrarEquipa(equipa1, NL);
      printf("\n");
    }
    else
    {
      
    }

    if (string[0] == 'g')
    {
      n = equipaMaisJogosGanhos(Lista_Equipas);
      mostrarEquipaNJogosGanhos(Lista_Equipas, n, NL);
    }
    else
    {
      
    }

    NL++;
  }
  while (string[0] != 'x');
  return 0;
}

