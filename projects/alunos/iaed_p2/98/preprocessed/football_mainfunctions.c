#include "/home/fmarques/sbugs/projects/alunos/lib/stubs.h"
/*File generated by PreProcessor.py*/


#include "football_mainfunctions.h"


Game_Link *initGameTable()
{
  int i;
  Game_Link *heads = malloc(1049 * (sizeof(Game_Link)));
  for (i = 0; i < 1049; i++)
    heads[i] = 0;

  return heads;
}

Team_Link *initTeamTable()
{
  int i;
  Team_Link *heads = malloc(1049 * (sizeof(Team_Link)));
  for (i = 0; i < 1049; i++)
    heads[i] = 0;

  return heads;
}

Team findWinner(Game item, Team_Link *heads)
{
  Team x = 0;
  if (item->score1 > item->score2)
  {
    x = searchTeam(item->team1, heads);
    return x;
  }
  else
  {
    if (item->score2 > item->score1)
    {
      x = searchTeam(item->team2, heads);
      return x;
    }
    else
    {
      
    }

  }

  return x;
}

void addGame(int l, Game_Link *headsG, List_Limits headAndTail, Team_Link *headsT)
{
  char name[1024];
  char team1[1024];
  char team2[1024];
  int score1;
  int score2;
  Game x;
  Team t;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  for (int team1_index = 0; team1_index < 10; team1_index++)
  {
    team1[team1_index] = new_sym_var(sizeof(char) * 8);
  }

  team1[10 - 1] = '\0';
  for (int team2_index = 0; team2_index < 10; team2_index++)
  {
    team2[team2_index] = new_sym_var(sizeof(char) * 8);
  }

  team2[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  if (searchGame(name, headsG) != 0)
  {
    printf("%d Jogo existente.\n", l);
  }
  else
  {
    if ((searchTeam(team1, headsT) == 0) || (searchTeam(team2, headsT) == 0))
    {
      printf("%d Equipa inexistente.\n", l);
    }
    else
    {
      x = createGame(name, team1, team2, score1, score2);
      insertGameTable(x, headsG);
      insertGameList(x, headAndTail);
      t = findWinner(x, headsT);
      if (t != 0)
      {
        t->victories++;
      }
      else
      {
        
      }

    }

  }

}

void printGame(int l, Game x)
{
  printf("%d %s %s %s %d %d\n", l, x->name, x->team1, x->team2, x->score1, x->score2);
}

void listGames(int l, List_Limits headAndTail)
{
  Game_Link x;
  for (x = headAndTail->head; x != 0; x = x->next)
    printGame(l, x->item);

}

void findGame(int l, Game_Link *heads)
{
  char name[1024];
  Game x;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  x = searchGame(name, heads);
  if (x != 0)
  {
    printGame(l, x);
  }
  else
  {
    printf("%d Jogo inexistente.\n", l);
  }

}

void removeGame(int l, Game_Link *headsG, List_Limits headAndTail, Team_Link *headsT)
{
  char name[1024];
  char *pname;
  Game x;
  Team t;
  int i;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  x = searchGame(name, headsG);
  pname = strdup(name);
  if (x != 0)
  {
    i = hash(pname, 1049);
    t = findWinner(x, headsT);
    if (t != 0)
    {
      t->victories--;
    }
    else
    {
      
    }

    freeGame(x, i, headsG, headAndTail);
  }
  else
  {
    printf("%d Jogo inexistente.\n", l);
  }

  free(pname);
}

void changeScore(int l, Game_Link *headsG, Team_Link *headsT)
{
  Game x;
  Team t;
  Team s;
  char name[1024];
  int score1;
  int score2;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  score1 = new_sym_var(sizeof(int) * 8);
  score2 = new_sym_var(sizeof(int) * 8);
  x = searchGame(name, headsG);
  if (x == 0)
  {
    printf("%d Jogo inexistente.\n", l);
  }
  else
  {
    t = findWinner(x, headsT);
    x->score1 = score1;
    x->score2 = score2;
    s = findWinner(x, headsT);
    if (((t != s) && (s != 0)) && (t != 0))
    {
      s->victories++;
      t->victories--;
    }
    else
    {
      if ((t != s) && (t != 0))
      {
        t->victories--;
      }
      else
      {
        if ((t != s) && (s != 0))
        {
          s->victories++;
        }
        else
        {
          
        }

      }

    }

  }

}

void addTeam(int l, Team_Link *heads)
{
  char name[1024];
  Team x;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  if (searchTeam(name, heads) == 0)
  {
    x = createTeam(name);
    insertTeam(x, heads);
  }
  else
  {
    printf("%d Equipa existente.\n", l);
  }

}

void findTeam(int l, Team_Link *heads)
{
  char name[1024];
  Team x;
  for (int name_index = 0; name_index < 10; name_index++)
  {
    name[name_index] = new_sym_var(sizeof(char) * 8);
  }

  name[10 - 1] = '\0';
  x = searchTeam(name, heads);
  if (x != 0)
  {
    printf("%d %s %d\n", l, x->name, x->victories);
  }
  else
  {
    printf("%d Equipa inexistente.\n", l);
  }

}

int compareTeamNames(const void *a, const void *b)
{
  Team ia = *((Team *) a);
  Team ib = *((Team *) b);
  return strcmp(ia->name, ib->name);
}

void printWinningTeams(int l, int M, int nTeams, Team_Link *heads)
{
  Team_Link x;
  Team *p;
  int i = 0;
  int j = 0;
  p = malloc((sizeof(Team)) * nTeams);
  while (j < nTeams)
  {
    for (x = heads[i]; x != 0; x = x->next)
      if (x->item->victories == M)
    {
      p[j++] = x->item;
      if (j >= nTeams)
      {
        break;
      }
      else
      {
        
      }

    }
    else
    {
      
    }


    i++;
  }

  qsort(p, nTeams, sizeof(Team), compareTeamNames);
  printf("%d Melhores %d\n", l, M);
  for (i = 0; i < nTeams; i++)
    printf("%d * %s\n", l, p[i]->name);

  free(p);
}

void findWinningTeams(int l, Team_Link *heads)
{
  Team_Link x;
  int i = 0;
  int max = 0;
  int nTeams = 0;
  while (i < 1049)
  {
    for (x = heads[i]; x != 0; x = x->next)
    {
      if (x->item->victories > max)
      {
        max = x->item->victories;
        nTeams = 1;
      }
      else
      {
        if (x->item->victories == max)
        {
          nTeams++;
        }
        else
        {
          
        }

      }

    }

    i++;
  }

  if (nTeams != 0)
  {
    printWinningTeams(l, max, nTeams, heads);
  }
  else
  {
    
  }

}

Team_Link freeTeamsLink(Team_Link head)
{
  Team_Link x;
  x = head->next;
  free(head->item->name);
  free(head->item);
  free(head);
  return x;
}

void freeTeamsIndex(Team_Link head)
{
  Team_Link x;
  for (x = head; x != 0; x = freeTeamsLink(x))
    ;

}

void freeTeams(Team_Link *heads)
{
  int i;
  for (i = 0; i < 1049; i++)
    freeTeamsIndex(heads[i]);

  free(heads);
}

Game_Link freeGamesListLink(Game_Link head)
{
  Game_Link x;
  x = head->next;
  freeGameAux(head->item);
  free(head);
  return x;
}

void freeGamesList(List_Limits headAndTail)
{
  Game_Link x;
  for (x = headAndTail->head; x != 0; x = freeGamesListLink(x))
    ;

  free(headAndTail);
}

Game_Link freeGamesTableLink(Game_Link head)
{
  Game_Link x;
  x = head->next;
  free(head);
  return x;
}

void freeGamesTableIndex(Game_Link head)
{
  Game_Link x;
  for (x = head; x != 0; x = freeGamesTableLink(x))
    ;

}

void freeGamesTable(Game_Link *heads)
{
  int i;
  for (i = 0; i < 1049; i++)
    freeGamesTableIndex(heads[i]);

  free(heads);
}

